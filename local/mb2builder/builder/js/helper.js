/**
 *
 * @package    local_mb2builder
 * @copyright  2018 - 2020 Mariusz Boloz (https://mb2themes.com/)
 * @license    Commercial https://themeforest.net/licenses
 */
var current_selection,current_selection_offset,current_selection_range,cosik;function local_mb2builder_helper_editor_init(e){document.queryCommandSupported("DefaultParagraphSeparator")&&document.execCommand("DefaultParagraphSeparator",!1,"p"),local_mb2builder_helper_editor_update_from_textarea(e)}function local_mb2builder_helper_editor_link_insert(e,t,i){local_mb2builder_helper_editor_document_focus();var n=current_selection_range;console.log(n),console.log(n.toString()),i.length?(i.attr("href",e),t.prop("checked")?i.attr("target","_blank"):i.removeAttr("target")):(link=document.createElement("a"),n.collapsed?link.appendChild(document.createTextNode(e)):link.appendChild(document.createTextNode(n.toString())),link.setAttribute("href",e),t.prop("checked")?link.setAttribute("target","_blank"):link.removeAttribute("target"),n.deleteContents(),n.insertNode(link))}function local_mb2builder_helper_editor_link_after_save(){$('input[name="mb2_pb_input_link_url"]').val(""),$('input[name="mb2_pb_editor_link_target"]').checked=!1,$(".mb2-pb-editor-document").find("a").removeClass("active")}function local_mb2builder_helper_editor_update_from_textarea(e){e||(e=local_mb2builder_helper_editor_get_empty_content());var t=$(".mb2-pb-active-editor").siblings(".mb2-pb-editor-document");t.empty(),t.append(local_mb2builder_helper_editor_clean_html(e)),""===t.html()&&t.html(local_mb2builder_helper_editor_get_empty_content())}function local_mb2builder_helper_editor_update_from_textarea_before_save(){var e=$(".mb2-pb-active-editor").siblings(".mb2-pb-editor-document").closest(".form-group").find(".mb2-pb-editor-input");e.hasClass("editing")&&local_mb2builder_helper_editor_update_from_textarea(e.val())}function local_mb2builder_helper_editor_get_empty_content(){return"<p><br></p>"}function local_mb2builder_helper_editor_document_focus(){$(".mb2-pb-active-editor").siblings(".mb2-pb-editor-document").focus()}function local_mb2builder_helper_editor_clean_html(e){return local_mb2builder_helper_editor_content_with_rules(e,[{regex:/<style[^>]*>[\s\S]*?<\/style>/gi,replace:""},{regex:/<!--(?![\s\S]*?-->)/gi,replace:""},{regex:/<\/?(?:title|meta|style|st\d|head|font|html|body|link)[^>]*?>/gi,replace:""}])}function local_mb2builder_helper_editor_content_with_rules(e,t){var i=0;for(i=0;i<t.length;i++)e=e.replace(t[i].regex,t[i].replace);return e}function local_mb2builder_helper_editor_get_clean_html(){var e=$(".mb2-pb-active-editor").siblings(".mb2-pb-editor-document").clone();e.find('[id^="yui"]').each(function(){$(this).removeAttr("id")}),e.find('*[class=""]').each(function(){$(this).removeAttr("class")});var t=e.html();return"<p></p>"===t||"<p><br></p>"===t?"":t}function local_mb2builder_helper_image_build_content(){var e="",t=0,i=[],n=[],a=[],o=$("#mb2-pb-modal-images").data("images_baseurl");$("#mb2-pb-lang");for($("#mb2-pb-images-iframe").contents().find("#admin-images").find(".fp-viewbar>.checked").hasClass("fp-vb-icons")?$("#mb2-pb-images-iframe").contents().find("#admin-images").find(".fp-file").each(function(e,t){i[e]=$(this).find(".fp-thumbnail>img").attr("src"),n[e]=$(this).find(".fp-filename").html(),a[e]="mb2-thumbnail"}):$("#mb2-pb-images-iframe").contents().find("#admin-images").find(".fp-filename-icon").each(function(e,t){$(this).hasClass("fp-folder")?a[e]="mb2-thumbnail-folder":a[e]="mb2-thumbnail",i[e]=$(this).find(".fp-icon>img").attr("src").replace("tinyicon","thumb"),n[e]=$(this).find(".fp-filename").html()}),t=0;t<i.length;t++)e+='<a class="mb2-pb-insert-image '+a[t]+'" href="#" data-imgurl="'+o+n[t]+'" data-imgname="'+n[t]+'" data-dismiss="modal">',e+='<img src="'+i[t]+'" alt="'+n[t]+'" />',e+="<span>"+n[t]+"</span>",e+="</a>";e+="</div>";var r=$("#mb2-pb-modal-images").find(".modal-body");r.empty(),r.html(e)}function local_mb2builder_check_image(e){if(e)return!!e.toLowerCase().match(/\.(jpg|png|gif)/g)}function local_mb2builder_get_media_name(e){var t=$("#mb2-pb-modal-images").data("images_baseurl");return e=e.replace(t,"")}$(document).on("click",".mb2-pb-active-editor .mbp-pb-editor-htmlmode",function(e){var t=$(this).closest(".form-group"),i=t.find(".mb2-pb-editor-input");i.hasClass("editing")?(local_mb2builder_helper_editor_update_from_textarea(i.val()),i.removeClass("editing"),t.removeClass("source")):(i.val(""),i.addClass("editing"),t.addClass("source"),textarea_value=local_mb2builder_helper_editor_get_clean_html(),i.val(textarea_value))}),$(document).on("click",".mb2-pb-active-editor button",function(e){e.preventDefault(),local_mb2builder_helper_editor_document_focus();var t=$(this),i=t.data("action"),n=!1,a=null;t.data("show-default-ui")&&(n=t.data("show-default-ui")),t.data("value-args")&&(a=t.data("value-args")),document.execCommand(i,n,a)}),$(document).on("change",'.mb2-pb-active-editor select[data-action="formatBlock"]',function(e){$(this).val()&&document.execCommand("formatBlock",!1,"<"+$(this).val()+">")}),$(document).on("click",".mb2-pb-active-editor .mb2-pb-editor-link-save",function(e){e.preventDefault();var t=$(this).closest(".mb2-pb-editor-helper-element"),i=t.find('input[name="mb2_pb_input_link_url"]').val(),n=t.find('input[name="mb2_pb_editor_link_target"]'),a=$(this).closest(".mb2-pb-form-group").find(".mb2-pb-editor-document").find("a.active");$(this).closest(".mb2-pb-editor-helper-element").slideUp(250),i&&(local_mb2builder_helper_editor_link_insert(i,n,a),local_mb2builder_helper_editor_link_after_save())}),$(document).on("click",".mb2-pb-active-editor .mb2-pb-editor-image-save",function(e){e.preventDefault(),local_mb2builder_helper_editor_document_focus();var t=$(this).closest(".mb2-pb-editor-helper-element"),i=t.find('input[name="mb2_pb_input_image_url"]').val();if($(this).closest(".mb2-pb-editor-helper-element").slideUp(250),i){var n=$(this).closest(".mb2-pb-form-group").find(".mb2-pb-editor-document").find("img.active");0==n.length&&document.execCommand("insertimage",!1,i);var a=$(this).closest(".mb2-pb-form-group").find(".mb2-pb-editor-document").find('img[src="'+i+'"]');if(n.length)a=$(this).closest(".mb2-pb-form-group").find(".mb2-pb-editor-document").find("img.active");var o=t.find('input[name="mb2_pb_editor_image_width"]'),r=t.find('input[name="mb2_pb_editor_image_desc"]'),l=t.find('select[name="mb2_pb_editor_image_align"]');o.val()&&a.attr("width",o.val()),r.val()&&a.attr("alt",r.val()),l.val()&&a.attr("class",l.val()),$(this).closest(".mb2-pb-editor-helper").find(".mb2-pb-preview-image").hide(),$(".mb2-pb-editor-helper-element").find("input,select").val("")}}),$(document).on("click",".mb2-pb-editor-document a",function(){$(".mb2-pb-editor-document").find("a").removeClass("active"),$(this).addClass("active")}),$(document).on("click",".mb2-pb-editor-document img",function(){$(".mb2-pb-editor-document").find("img").removeClass("active");var e=$(this).closest(".mb2-pb-form-group").find(".mb2-pb-editor-helper"),t=$(this),i=$(this).closest(".mb2-pb-form-group").find(".mb2-pb-editor-helper-element"),n=i.find(".mb2-pb-preview-image");n.show(),n.attr("src",t.attr("src"));var a=i.find('input[name="mb2_pb_input_image_url"]'),o=i.find('input[name="mb2_pb_editor_image_width"]'),r=i.find('input[name="mb2_pb_editor_image_desc"]'),l=i.find('select[name="mb2_pb_editor_image_align"]');a.val(t.attr("src")),o.val(t.attr("width")),r.val(t.attr("alt")),l.val(t.attr("class")),$(this).addClass("active"),e.find(".element-image").slideDown(250)}),$(document).on("click",".mb2-pb-active-editor .mb2-pb-editor-image-cancel",function(e){e.preventDefault(),$(".mb2-pb-editor-helper-element").find("input,select").val(""),$(this).closest(".mb2-pb-editor-helper").find(".mb2-pb-preview-image").hide(),$(this).closest(".mb2-pb-editor-helper").find(".element-image").slideUp(250)}),$(document).on("click",".mb2-pb-active-editor .mb2-pb-editor-link-cancel",function(e){e.preventDefault(),$(this).closest(".mb2-pb-editor-helper-element").slideUp(250),local_mb2builder_helper_editor_link_after_save()}),$(document).on("click",".mb2-pb-active-editor .mbp-pb-editor-helper-image",function(e){var t=$(this).closest(".mb2-pb-active-editor").find(".mb2-pb-editor-helper");t.find(".element-link").hide(),t.find(".element-image").slideToggle(250)}),$(document).on("click",".mb2-pb-active-editor .mbp-pb-editor-helper-link",function(e){var t=$(this).closest(".mb2-pb-active-editor").find(".mb2-pb-editor-helper");t.find(".element-image").hide(),t.find(".element-link").slideToggle(250),current_selection=window.getSelection(),current_selection_range=current_selection.getRangeAt(0);var i=$(this).closest(".mb2-pb-form-group").find(".mb2-pb-editor-document").find("a.active");i.length&&(t.find('input[name="mb2_pb_input_link_url"]').val(i.attr("href")),"_blank"===i.attr("target")&&(t.find('input[name="mb2_pb_editor_link_target"]').checked=!0))}),$(document).on("click",".mb2-pb-image-select",function(e){e.preventDefault(),$('input[name="mb2_pb_input_image_url"]').removeClass("mb2_pb_input_image_url_active"),$(this).closest(".mb2-pb-form-group").find('input[name="mb2_pb_input_image_url"]').addClass("mb2_pb_input_image_url_active"),local_mb2builder_helper_image_build_content()}),$(document).on("click",".mb2-pb-upload-images",function(e){e.preventDefault(),$("#mb2-pb-images-iframe").contents().find("body").addClass("mb2-pb-iframe-content")}),$(document).on("click","#applay-file-manager",function(e){e.preventDefault();var t=$(this).closest(".modal"),i=$("#mb2-pb-images-iframe"),n=t.find(".mb2-pb-overlay");i.contents().find("form#adminsettings").submit(),n.fadeIn(250),i.on("load",function(){i.contents().find("body").addClass("mb2-pb-iframe-content"),setTimeout(function(){n.fadeOut(250)},700)}),local_mb2builder_helper_image_build_content()}),$(document).on("click",".mb2-pb-insert-image",function(e){e.preventDefault();var t=$(this).data("imgurl");$(".mb2_pb_input_image_url_active").val(t),$(".mb2_pb_input_image_url_active").closest(".mb2-pb-form-group").removeClass("isvideo"),local_mb2builder_check_image(t)||$(".mb2_pb_input_image_url_active").closest(".mb2-pb-form-group").addClass("isvideo");var i=$(".mb2_pb_input_image_url_active").closest(".mb2-pb-form-group").find(".mb2-pb-preview-image");i.show(),i.attr("src",t),$(".mb2_pb_input_image_url_active").closest(".mb2-pb-form-group").find(".mb2-pb-desc-image").text(local_mb2builder_get_media_name(t))}),$(document).on("click",".mb2-pb-remove-image",function(e){e.preventDefault(),$(this).closest(".mb2-pb-form-group").removeClass("isvideo"),$(this).closest(".mb2-pb-form-group").find('input[name="mb2_pb_input_image_url"]').val("");var t=$(this).closest(".mb2-pb-form-group").find(".mb2-pb-preview-image");t.hide(),t.attr("src",""),$(this).closest(".mb2-pb-form-group").find(".mb2-pb-desc-image").empty()}),$(document).on("click",".mb2-pb-select-icon",function(e){e.preventDefault(),$(".mb2-pb-input-type-icon").removeClass("active"),$(this).closest(".mb2-pb-form-group").find(".mb2-pb-input-type-icon").addClass("active")}),$(document).on("click",".mb2-pb-choose-icon",function(e){e.preventDefault(),$(".mb2-pb-input-type-icon.active").val($(this).data("iconname")),$(".mb2-pb-input-type-icon.active").closest(".mb2-pb-form-group").find("i").show(),$(".mb2-pb-input-type-icon.active").closest(".mb2-pb-form-group").find("i").attr("class",$(this).data("iconname"))}),$(document).on("click",".mb2-pb-remove-icon",function(e){e.preventDefault(),$(this).closest(".mb2-pb-form-group").find(".mb2-pb-input-type-icon").val(""),$(this).closest(".mb2-pb-form-group").find("i").attr("class",""),$(this).closest(".mb2-pb-form-group").find("i").hide()});
