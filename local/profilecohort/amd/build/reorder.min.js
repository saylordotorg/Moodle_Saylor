/**
 * Local plugin "Profile field based cohort membership" - JS code for reordering rules
 *
 * @module    local_profilecohort/reorder
 * @copyright 2016 Davo Smith, Synergy Learning UK on behalf of Alexander Bias, Ulm University <alexander.bias@uni-ulm.de>
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_profilecohort/reorder",["jquery"],(function($){var SELECTORS_MOVETO="select.moveto, .moveto select",SELECTORS_FIELDWRAPPER=".localprofile-fieldwrapper",SELECTORS_RULENUMBER=".localprofile-number";function removeCombinedDivs(){$("#region-main form").find(SELECTORS_FIELDWRAPPER).removeClass("localprofile-flash").each((function(){var $this=$(this);$this.closest(".localprofile-combined").length&&$this.unwrap()}))}function addCombinedDivs(){var $andNextRule,$collection=null;$("#region-main form").find(SELECTORS_FIELDWRAPPER).each((function(){var $this=$(this),$andnextrule=$this.find("input.andnextrule");$andnextrule.length&&($andnextrule.prop("checked")?$collection=$collection?$collection.add($this):$this:$collection&&(($collection=$collection.add($this)).wrapAll('<div class="localprofile-combined" />'),$collection=null))})),$collection&&($collection.wrapAll('<div class="localprofile-combined" />'),$collection=null),($andNextRule=$("#region-main form input.andnextrule")).closest("label").length?$andNextRule.closest("label").removeClass("hidden").last().addClass("hidden"):$andNextRule.closest("span").removeClass("hidden").last().addClass("hidden")}function updateCombinedDivs(){removeCombinedDivs(),addCombinedDivs()}function checkReorderItems(e){var $target=$(e.currentTarget),lastPosition=parseInt($target.data("lastPosition"),10),newPosition=parseInt($target.val(),10);if(lastPosition!==newPosition){var $displace=null,$moveSelects=$(SELECTORS_MOVETO);if($moveSelects.each((function(){var $this=$(this);return $this.attr("id")===$target.attr("id")||parseInt($this.val(),10)!==newPosition||($displace=$this.closest(SELECTORS_FIELDWRAPPER),!1)})),$displace){removeCombinedDivs();var $moveItem=$target.closest(SELECTORS_FIELDWRAPPER);newPosition<lastPosition?$moveItem.insertBefore($displace):$moveItem.insertAfter($displace),($moveSelects=$(SELECTORS_MOVETO)).each((function(idx){var $this=$(this),position=idx+1;$this.data("lastPosition",position),$this.val(position),$this.closest(SELECTORS_FIELDWRAPPER).find(SELECTORS_RULENUMBER).html(position)})),$moveItem.removeClass("localprofile-flash").addClass("localprofile-flash"),addCombinedDivs()}}}function showRulesToBeDeleted(){$("#region-main form input.deleterule").each((function(){var $this=$(this),$container=$this.closest(".localprofile-fieldwrapper");$this.prop("checked")?($container.addClass("todelete"),$container.find(":input:not(.deleterule)").prop("disabled",!0)):($container.removeClass("todelete"),$container.find(":input").prop("disabled",!1))}))}return{init:function(){var $form=$("#region-main form");$form.find(SELECTORS_MOVETO).each((function(){var $this=$(this);$this.data("lastPosition",$this.val())})),$form.on("change",SELECTORS_MOVETO,checkReorderItems),$form.on("change","input.andnextrule",updateCombinedDivs),$form.on("change","input.deleterule",showRulesToBeDeleted),addCombinedDivs()}}}));

//# sourceMappingURL=reorder.min.js.map