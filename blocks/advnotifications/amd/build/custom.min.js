define(["jquery"],function(l){return{initialise:function(){l(document).ready(function(){var e=l("#region-main"),t=l("#add_notification_wrapper_id"),s={save:"Save",update:"Update",req:"Required...",preview:"Preview",title:"Title",message:"Message"};e.on("click",".notifications_table tr > td > form > button[type=submit]",function(e){e.preventDefault();var n={call:"ajax",purpose:"",tableaction:"",blockid:""},i=l(this).closest("form").attr("data-edit"),e=l(this).closest("form").attr("data-delete");n.blockid=l(this).closest("form").find("[name=blockid]")[0].value,d(),void 0!==i&&!1!==i?(n.purpose="edit",n.tableaction=i,(i=l("#add_notification_save")).addClass("update"),i.val(s.update)):void 0!==e&&!1!==e&&(n.purpose="delete",n.tableaction=e);e=M.cfg.wwwroot+"/blocks/advnotifications/pages/process.php?sesskey="+M.cfg.sesskey;l.post(e,n).fail(function(){console.error("No 'manage' response received.")}).done(function(e){if(e=JSON.parse(e),0<parseInt(e.done,10))l("#tr"+n.purpose+e.done).closest("tr").fadeOut(250,function(){l(this).remove(),c(),a()});else if("edit"===n.purpose){for(var i in e){var t;e.hasOwnProperty(i)&&("id"===i&&(t=l("#add_notification_form"),l("#add_notification_id").remove(),t.prepend('<input type="hidden" id="add_notification_id" name="id" value="'+e[i]+'"/>'),l("#add_notification_purpose").val("update")),t=l("#add_notification_wrapper_id").find("#add_notification_"+i),"enabled"!==i&&"global"!==i&&"dismissible"!==i&&"aicon"!==i||1!=e[i]?"enabled"!==i&&"global"!==i&&"dismissible"!==i&&"aicon"!==i||0!=e[i]?t.val(e[i]):t.prop("checked",!1):t.prop("checked",!0))}o()}})}),e.on("click",".notifications_restore_table tr > td > form > button[type=submit]",function(e){e.preventDefault();var i={call:"ajax",purpose:"",tableaction:"",blockid:""},t=l(this).closest("form").attr("data-restore"),e=l(this).closest("form").attr("data-permdelete");i.blockid=l(this).closest("form").find("[name=blockid]")[0].value,void 0!==t&&!1!==t?(i.purpose="restore",i.tableaction=t):void 0!==e&&!1!==e&&(i.purpose="permdelete",i.tableaction=e);e=M.cfg.wwwroot+"/blocks/advnotifications/pages/process.php?sesskey="+M.cfg.sesskey;l.post(e,i).fail(function(){console.error("No 'restore/permdelete' response received.")}).done(function(e){e=JSON.parse(e),0<parseInt(e.done,10)&&l("#tr"+i.purpose+e.done).closest("tr").fadeOut(250,function(){l(this).remove()})})}),t.on("click","#add_notification_cancel",function(e){e.preventDefault(),c()}),e.on("submit","#add_notification_form",function(e){e.preventDefault();var i,o=l("#add_notification_status"),a=l("#add_notification_form");d(),r()&&(o.show(),i=l(this).serialize(),e=M.cfg.wwwroot+"/blocks/advnotifications/pages/process.php",l.post(e,i).fail(function(e){console.error("No 'add' response received.");var i,t,n=e.responseJSON.error;for(i in n)n.hasOwnProperty(i)&&((t=a.find("select[name="+n[i]+"]")).addClass("requiredfield"),l('<strong class="requiredfield"><em>'+s.req+"</em></strong>").insertAfter(t[0].nextSibling));o.hide()}).done(function(){o.find(".saving").hide(),o.find(".done").show(),c(),setTimeout(function(){o.fadeOut(function(){o.find(".done").hide(),o.find(".saving").show()})},1500),l("#advnotifications_table_wrapper").load("# #advnotifications_table_wrapper > *")}))}),t.on("input propertychange paste","#add_notification_title, #add_notification_message",function(){o()}),l("#add_notification_type").on("change",function(){o()}),l("#add_notification_dismissible").on("change",function(){o()}),l("#add_notification_aicon").on("change",function(){o()});var i,n,o=function(){var e=t.find("#add_notification_title");0<e.val().length?t.find(".preview-title")[0].innerHTML=e.val():t.find(".preview-title")[0].innerHTML=s.title;var i=t.find("#add_notification_message");0<i.val().length?t.find(".preview-message")[0].innerHTML=i.val():t.find(".preview-message")[0].innerHTML=s.message;e=l("#add_notification_type").val(),i=l("#add_notification_wrapper_id .preview-alert");i.removeClass("alert-info alert-success alert-danger alert-warning announcement"),"announcement"===e&&(i.addClass(e),e="info"),"info"!==e&&"success"!==e&&"warning"!==e&&"danger"!==e&&(e="info"),i.addClass("alert-"+e),l(".preview-aicon").find("> img").attr("src",M.util.image_url(e,"block_advnotifications")),l("#add_notification_dismissible")[0].checked?(l(".preview-alert-dismissible").show(),i.addClass("dismissible")):(l(".preview-alert-dismissible").hide(),i.removeClass("dismissible")),l("#add_notification_aicon")[0].checked?(l(".preview-aicon").show(),i.addClass("aicon")):(l(".preview-aicon").hide(),i.removeClass("aicon"))},a=function(){var e=l("#notification_preview_wrapper"),i='<div id="notification_preview_wrapper"><strong>'+s.preview+'</strong><br><div class="alert alert-info preview-alert"><div class="preview-aicon" style="display: none;"><img src="'+M.util.image_url("info","block_advnotifications")+'" /></div><strong class="preview-title">'+s.title+'</strong> <div class="preview-message">'+s.message+'</div> <div class="preview-alert-dismissible" style="display: none;"><strong>&times;</strong></div></div></div>';0<e.length?(e.remove(),l(i).prependTo(l(t))):l(i).prependTo(l(t)).hide().slideDown()},r=function(){var e,i=l("#add_notification_form select option:selected:disabled");for(e in i)if(i.hasOwnProperty(e)&&l(i[e]).prop("disabled"))return l(i[e]).closest("select").addClass("requiredfield"),l('<strong class="requiredfield"><em>'+s.req+"</em></strong>").insertAfter(l(i[e]).closest("select")[0].nextSibling),!1;return!0},d=function(){l("select.requiredfield").removeClass("requiredfield"),l("strong.requiredfield").remove()},c=function(){l("#add_notification_form")[0].reset(),d(),a();var e=l("#add_notification_save");e.removeClass("update"),l("#add_notification_id").remove(),l("#add_notification_purpose").val("add"),e.val(s.save)};i={call:"ajax",purpose:"strings"},n=M.cfg.wwwroot+"/blocks/advnotifications/pages/process.php?sesskey="+M.cfg.sesskey,l.post(n,i).fail(function(){console.error("No 'strings' response received.")}).done(function(e){s=e}).always(function(){a()}),l("#add_notification_form").append('<input type="hidden" id="add_notification_call" name="call" value="ajax"/>')})}}});
//# sourceMappingURL=custom.min.js.map