{"version":3,"sources":["../src/script.js"],"names":["define","$","ModalFactory","ModalEvents","init","document","ready","str","identifier","M","block_sharing_cart","moodle","get_action_url","name","args","url","cfg","wwwroot","q","k","push","encodeURIComponent","join","confirm_modal","obj","checkbox","body","create","type","types","SAVE_CANCEL","title","done","modal","setSaveButtonText","save_button","getRoot","on","save","e","response","target","find","is","next","hidden","removeClass","show","in_place_edit_section_name","$section","sectionName","$inPlaceEditable","length","data","on_backup_modal","post_data","title_str","body_str","isSection","on_success","post","fail","show_error","backup_section","sectionid","sectionnumber","courseid","backup","cmid","icon","css","iconClass","$block","course","id","attr","match","is_frontpage","hasClass","ex","JSON","parse","responseText","core","exception","message","verify_layout","menuelement","setCookie","value","expireTimeInMillisecond","d","Date","setTime","getTime","expires","toUTCString","cookie","getCookieValue","param","readCookie","pop","create_command","iconElement","addClass","append","add_spinner","$spinner","add_node_spinner","$node","$node_spinner","reload_tree","replaceWith","init_item_tree","userdata","$commands","sesskey","always","hide","sectionId","sectionNumber","courseId","closest","parent","text","inPlaceEditSectionName","directories","opens","split","map","v","parseInt","setDate","getDate","open","$dir","visible","iconIndex","toggle","i","each","index","dir","reset","move_targets","$cancel","targets","remove","$target","item_id","move","m","area_to","$current","$next","$list","next_id","create_target","$anchor","item","$item","to","before","restore_targets","is_directory","$clipboard","section","href","inSection","util","image_url","$view","html","prepend","cloneNode","replace","$sitetopic","$mainmenu","$container","one","format","get_section_wrapper","sectionDOM","first","get_plugin_name","$blockheader","on_backup","activityName","$backup","$activity","dataowner","on_movedir","$current_dir","current_path","dirs","$form","submit","folder_to","val","$input","setTimeout","focus","unshift","$select","change","$edit","on_move","on_delete","liText","innerText","isDirectory","modalBody","description_text","stopPropagation","on_restore","on_section_backup","init_bulk_delete","isspeciallayout","bulkdelete","init_help_icon","helpicon","init_block_header","add_actions","actions","action","$command","activity_actions","directory_actions","init_activity_commands","ajaxComplete","event","xhr","settings","lastslashindex","lastIndexOf","result","substring","activity_id","activity","add_activity_backup_control","duplicated","create_backup_icon","$backupIcon","activityClass","className","modtype","substr","indexOf","$actionMenuItem","add_section_backup_control","isFlexibleCourseFormat","$sectionTitle","last","insertAfter","activitySelector","$activities","pluginname","$section_selected"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n *  Sharing Cart\r\n *\r\n *  @package    block_sharing_cart\r\n *  @copyright  2017 (C) VERSION2, INC.\r\n *  @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\ndefine(['jquery', 'core/modal_factory', 'core/modal_events'], function($, ModalFactory, ModalEvents) {\r\n    return {\r\n        init: function() {\r\n            $(document).ready(function() {\r\n\r\n                /**\r\n                 *  Returns a localized string\r\n                 *\r\n                 *  @param {String} identifier\r\n                 *  @return {String}\r\n                 */\r\n                function str(identifier) {\r\n                    return M.str.block_sharing_cart[identifier] || M.str.moodle[identifier];\r\n                }\r\n\r\n                /**\r\n                 *  Get an action URL\r\n                 *\r\n                 *  @param {String} name   The action name\r\n                 *  @param {Object} [args] The action parameters\r\n                 *  @return {String}\r\n                 */\r\n                function get_action_url(name, args) {\r\n                    var url = M.cfg.wwwroot + '/blocks/sharing_cart/' + name + '.php';\r\n                    if (args) {\r\n                        var q = [];\r\n                        for (var k in args) {\r\n                            q.push(k + '=' + encodeURIComponent(args[k]));\r\n                        }\r\n                        url += '?' + q.join('&');\r\n                    }\r\n                    return url;\r\n                }\r\n\r\n                /**\r\n                 * Modal called when confirming an action.\r\n                 *\r\n                 * @param obj\r\n                 */\r\n                function confirm_modal(obj) {\r\n\r\n                    // Checkbox for copying userdata confirmation.\r\n                    if (obj.checkbox) {\r\n                        obj.body +=\r\n                            '<div class=\"modal-checbox-wrapper\">' +\r\n                            '<input type=\"checkbox\" id=\"modal-checkbox\" class=\"modal-checkbox\" checked>' +\r\n                            '<label for=\"modal-checkbox\">' + str('modal_checkbox') + '</label>' +\r\n                            '</div>';\r\n                    }\r\n\r\n                    obj.body += '<p class=\"alert alert-danger mt-3\">' + str('backup_heavy_load_warning_message') + '</p>';\r\n\r\n                    ModalFactory.create({\r\n                        type: ModalFactory.types.SAVE_CANCEL,\r\n                        title: obj.title,\r\n                        body: obj.body,\r\n                    }).done(function(modal) {\r\n                        modal.setSaveButtonText(obj.save_button);\r\n\r\n                        // On save save check - if checkbox is checked.\r\n                        modal.getRoot().on(ModalEvents.save, function(e) {\r\n\r\n                            var response = {\r\n                                'checkbox': $(e.target).find('.modal-checkbox').is(':checked'),\r\n                            };\r\n\r\n                            obj.next(response);\r\n                        });\r\n\r\n                        // Remove modal from html.\r\n                        modal.getRoot().on(ModalEvents.hidden, function() {\r\n                            $('body').removeClass('modal-open');\r\n                        });\r\n\r\n                        modal.show();\r\n                    });\r\n                }\r\n\r\n                /**\r\n                 * Get the section name from the section when\r\n                 * it's changed with the in place editor\r\n                 *\r\n                 * @param $section\r\n                 * @returns {*}\r\n                 */\r\n                function in_place_edit_section_name($section) {\r\n                    var sectionName = '';\r\n                    var $inPlaceEditable = $section.find('h3.sectionname .inplaceeditable');\r\n                    if ($inPlaceEditable.length) {\r\n                        sectionName = $inPlaceEditable.data('value');\r\n                    }\r\n                    return sectionName;\r\n                }\r\n\r\n                /**\r\n                 * @param post_data\r\n                 * @param title_str\r\n                 * @param body_str\r\n                 * @param isSection\r\n                 */\r\n                function on_backup_modal(post_data, title_str, body_str, isSection) {\r\n                    (function(on_success) {\r\n                        $.post(get_action_url('rest'), post_data,\r\n                            function(response) {\r\n                                on_success(response);\r\n                            }, \"text\")\r\n                            .fail(function(response) {\r\n                                show_error(response);\r\n                            });\r\n                    })(function(response) {\r\n                        var copyable = response === '1';\r\n                        var checkbox = false;\r\n\r\n                        if (copyable) {\r\n                            checkbox = true;\r\n                        }\r\n\r\n                        confirm_modal({\r\n                            'title': title_str,\r\n                            'body': body_str,\r\n                            'save_button': str('modal_confirm_backup'),\r\n                            'checkbox': checkbox,\r\n                            'next': function(data) {\r\n                                if (isSection === true) {\r\n                                    backup_section(post_data.sectionid, post_data.sectionnumber, post_data.courseid, data.checkbox);\r\n                                } else {\r\n                                    backup(post_data.cmid, data.checkbox);\r\n                                }\r\n                            }\r\n                        });\r\n                    });\r\n                }\r\n\r\n                /** @var {Object}  The icon configurations */\r\n                var icon = {\r\n                    // Actions\r\n                    'backup': {\r\n                        css: 'editing_backup',\r\n                        iconClass: 'fa fa-frown-o',\r\n                    },\r\n                    'movedir': {\r\n                        css: 'editing_right',\r\n                        iconClass: 'fa fa-arrow-right',\r\n                    },\r\n                    'move': {\r\n                        css: 'editing_move_',\r\n                        iconClass: 'fa fa-arrows-v',\r\n                    },\r\n                    'edit': {\r\n                        css: 'editing_update',\r\n                        iconClass: 'fa fa-pencil',\r\n                    },\r\n                    'cancel': {\r\n                        css: 'editing_cancel',\r\n                        iconClass: 'fa fa-ban',\r\n                    },\r\n                    'delete': {\r\n                        css: 'editing_update',\r\n                        iconClass: 'fa fa-trash',\r\n                    },\r\n                    'restore': {\r\n                        css: 'editing_restore',\r\n                        iconClass: 'fa fa-clone',\r\n                    },\r\n                    // Directories\r\n                    'dir-open': {\r\n                        iconClass: 'fa fa-folder-open-o'\r\n                    },\r\n                    'dir-closed': {\r\n                        iconClass: 'fa fa-folder-o'\r\n                    },\r\n                };\r\n\r\n                /** @var {Node}  The Sharing Cart block container node */\r\n                var $block = $('.block_sharing_cart');\r\n\r\n                /** @var {Object}  The current course */\r\n                var course = new function() {\r\n                    var body = $('body');\r\n                    this.id = body.attr('class').match(/course-(\\d+)/)[1];\r\n                    this.is_frontpage = body.hasClass('pagelayout-frontpage');\r\n                }();\r\n\r\n                /**\r\n                 *  Shows an error message with given Ajax error\r\n                 *\r\n                 *  @param {Object} response  The Ajax response\r\n                 */\r\n                function show_error(response) {\r\n                    try {\r\n                        var ex = JSON.parse(response.responseText);\r\n                        new M.core.exception({\r\n                            name: str('pluginname') + ' - ' + str('error'),\r\n                            message: ex.message\r\n                        });\r\n                    } catch (e) {\r\n                        new M.core.exception({\r\n                            name: str('pluginname') + ' - ' + str('error'),\r\n                            message: response.responseText\r\n                        });\r\n                    }\r\n                }\r\n\r\n                /**\r\n                 *  Check special layout (theme boost)\r\n                 *\r\n                 *  @return {Boolean}\r\n                 */\r\n                function verify_layout() {\r\n                    var menuelement = $block.find('.menubar .dropdown .dropdown-menu');\r\n                    return (menuelement.length);\r\n                }\r\n\r\n                /**\r\n                 * Set Cookie\r\n                 * @param name\r\n                 * @param value\r\n                 * @param expireTimeInMillisecond\r\n                 */\r\n                function setCookie(name, value, expireTimeInMillisecond) {\r\n                    var d = new Date();\r\n                    d.setTime(d.getTime() + expireTimeInMillisecond);\r\n                    var expires = 'expires=' + d.toUTCString();\r\n                    document.cookie = name + '=' + value + ';' + expires + '';\r\n                }\r\n\r\n                /**\r\n                 * Get Cookie Value\r\n                 * @param param\r\n                 * @returns {*}\r\n                 */\r\n                function getCookieValue(param) {\r\n                    var readCookie = document.cookie.match('(^|;)\\\\s*' + param + '\\\\s*=\\\\s*([^;]+)');\r\n                    return readCookie ? readCookie.pop() : '';\r\n                }\r\n\r\n                /**\r\n                 * Create a command icon\r\n                 *\r\n                 *  @param {String} name  The command name, predefined in icon\r\n                 *  @param {String} [pix] The icon pix name to override\r\n                 */\r\n                function create_command(name) {\r\n                    var iconElement = $('<i/>')\r\n                        .attr('alt', str(name))\r\n                        .attr('class', icon[name].iconClass);\r\n                    // If (verify_layout()) {\r\n                    //     iconElement.addClass('iconcustom');\r\n                    // }\r\n\r\n                    return $('<a href=\"javascript:void(0)\"/>')\r\n                        .addClass(icon[name].css)\r\n                        .attr('title', str(name))\r\n                        .append(iconElement);\r\n                }\r\n\r\n                /**\r\n                 * Create a spinner\r\n                 * @param $node\r\n                 * @returns {*|jQuery}\r\n                 */\r\n                function add_spinner() {\r\n                    var $spinner = ($('<div class=\"block_spinner\"><i class=\"fa fa-circle-o-notch fa-spin fa-2x\"></i></div>'));\r\n                    $('section.block_sharing_cart').append($spinner);\r\n                    return $spinner;\r\n                }\r\n\r\n                /**\r\n                 *\r\n                 * @param $node\r\n                 * @returns {jQuery.fn.init}\r\n                 */\r\n                function add_node_spinner($node) {\r\n                    var $node_spinner = $('<i class=\"fa fa-circle-o-notch fa-spin node_spinner\"></i>');\r\n                    $node.append($node_spinner);\r\n                    return $node_spinner;\r\n                }\r\n\r\n                $(document).on('click', 'a.restore', function() {\r\n                    add_spinner();\r\n                });\r\n\r\n                /**\r\n                 *\r\n                 *  Reload the Sharing Cart item tree\r\n                 */\r\n                function reload_tree() {\r\n                    $.post(get_action_url(\"rest\"),\r\n                        {\r\n                            \"action\": \"render_tree\",\r\n                            \"courseid\": course.id\r\n                        },\r\n                        function(response) {\r\n                            $block.find(\".tree\").replaceWith($(response));\r\n                            $.init_item_tree();\r\n                        }, \"html\")\r\n                        .fail(function(response) {\r\n                            show_error(response);\r\n                        });\r\n                }\r\n\r\n                /**\r\n                 *  Backup an activity\r\n                 *\r\n                 *  @param {int} cmid\r\n                 *  @param {Boolean} userdata\r\n                 */\r\n                function backup(cmid, userdata) {\r\n                    var $commands = $('#module-' + cmid + ' .actions');\r\n                    if (!$commands.length) {\r\n                        $commands = $('[data-owner=\"#module-' + cmid + '\"]');\r\n                    }\r\n\r\n                    var $spinner = add_spinner();\r\n                    var $node_spinner = add_node_spinner($commands);\r\n\r\n                    $.post(get_action_url(\"rest\"),\r\n                        {\r\n                            \"action\": \"backup\",\r\n                            \"cmid\": cmid,\r\n                            \"userdata\": userdata,\r\n                            \"sesskey\": M.cfg.sesskey,\r\n                            \"courseid\": course.id\r\n                        },\r\n                        function() {\r\n                            reload_tree();\r\n                        })\r\n                        .fail(function(response) {\r\n                            show_error(response);\r\n                        })\r\n                        .always(function() {\r\n                            $node_spinner.hide();\r\n                            $spinner.hide();\r\n                        });\r\n                }\r\n\r\n                /**\r\n                 *  Backup an activities in a section\r\n                 *\r\n                 *  @param {int} sectionId\r\n                 *  @param {int} sectionNumber\r\n                 *  @param {int} courseId\r\n                 *  @param {Boolean} userdata\r\n                 */\r\n                function backup_section(sectionId, sectionNumber, courseId, userdata) {\r\n                    var $commands = $('span.inplaceeditable[data-itemtype=sectionname][data-itemid=' + sectionId + ']');\r\n                    var $section = $commands.closest(\"li.section.main\");\r\n                    var sectionName = $section.attr('aria-label');\r\n\r\n                    if (sectionName === null) {\r\n                        sectionName = String($('#region-main .section_action_menu[data-sectionid=\\'' + sectionId + '\\']')\r\n                            .parent().parent().find('h3.sectionname').text());\r\n                    }\r\n\r\n                    var inPlaceEditSectionName = in_place_edit_section_name($section);\r\n                    sectionName = (inPlaceEditSectionName !== '') ? inPlaceEditSectionName : sectionName;\r\n\r\n                    var $spinner = add_spinner();\r\n                    var $node_spinner = add_node_spinner($commands);\r\n\r\n                    $.post(get_action_url(\"rest\"),\r\n                        {\r\n                            \"action\": \"backup_section\",\r\n                            \"sectionid\": sectionId,\r\n                            \"sectionnumber\": sectionNumber,\r\n                            \"courseid\": courseId,\r\n                            \"sectionname\": sectionName,\r\n                            \"userdata\": userdata,\r\n                            \"sesskey\": M.cfg.sesskey\r\n                        },\r\n                        function() {\r\n                            reload_tree();\r\n                        })\r\n                        .fail(function(response) {\r\n                            show_error(response);\r\n                        })\r\n                        .always(function() {\r\n                            $spinner.hide();\r\n                            $node_spinner.hide();\r\n                        });\r\n                }\r\n\r\n\r\n                // /////// CLASSES /////////\r\n\r\n                /**\r\n                 *  @class Directory states manager\r\n                 */\r\n                var directories = new function() {\r\n                    var KEY = 'block_sharing_cart-dirs';\r\n\r\n                    var opens = getCookieValue(KEY).split(',').map(function(v) {\r\n                        return parseInt(v);\r\n                    });\r\n\r\n                    function save() {\r\n                        var expires = new Date();\r\n                        expires.setDate(expires.getDate() + 30);\r\n                        setCookie(KEY, opens.join(','), expires);\r\n                    }\r\n\r\n                    function open($dir, visible) {\r\n                        var iconIndex = visible ? 'dir-open' : 'dir-closed';\r\n                        var iconElement = icon[iconIndex].iconClass;\r\n                        $dir.find('> div i.icon').attr('class', 'icon ' + iconElement);\r\n                        $dir.find('> ul.list')[visible ? 'show' : 'hide']();\r\n                    }\r\n\r\n                    function toggle(e) {\r\n                        var $dir = $(e.target).closest('li.directory');\r\n                        var i = $dir.attr('id').match(/(\\d+)$/)[1];\r\n                        var v = $dir.find('> ul.list').css('display') === 'none';\r\n\r\n                        open($dir, v);\r\n                        opens[i] = v ? 1 : 0;\r\n                        save();\r\n                    }\r\n\r\n                    /**\r\n                     *  Initialize directory states\r\n                     */\r\n                    this.init = function() {\r\n                        var i = 0;\r\n                        $block.find('li.directory').each(function(index, dir) {\r\n                            var $dir = $(dir);\r\n                            $dir.attr('id', 'block_sharing_cart-dir-' + i);\r\n                            if (i >= opens.length) {\r\n                                opens.push(0);\r\n                            } else if (opens[i]) {\r\n                                open($dir, true);\r\n                            }\r\n                            $dir.find('> div div.toggle-wrapper').css('cursor', 'pointer').on('click', function(e) {\r\n                                toggle(e);\r\n                            });\r\n                            i++;\r\n                        });\r\n                    };\r\n\r\n                    /**\r\n                     *  Reset directory states\r\n                     */\r\n                    this.reset = function() {\r\n                        opens = [];\r\n                        this.init();\r\n                        save();\r\n                    };\r\n                }();\r\n\r\n                /**\r\n                 *  @class Targets for moving an item directory\r\n                 */\r\n                var move_targets = new function() {\r\n                    var $cancel = null,\r\n                        targets = [];\r\n\r\n                    /**\r\n                     *  Hide move targets\r\n                     */\r\n                    this.hide = function() {\r\n                        if ($cancel !== null) {\r\n                            var $commands = $cancel.closest('.commands');\r\n                            $cancel.remove();\r\n                            $cancel = null;\r\n                            $commands.closest('li.activity').css('opacity', 1.0);\r\n                            $commands.find('a').each(function() {\r\n                                $(this).show();\r\n                            });\r\n                            $.each(targets, function(index, $target) {\r\n                                $target.remove();\r\n                            });\r\n                            targets = [];\r\n                        }\r\n                    };\r\n\r\n                    /**\r\n                     *  Show move targets for a given item\r\n                     *\r\n                     *  @param {int} id  The item ID\r\n                     */\r\n                    this.show = function(item_id) {\r\n                        this.hide();\r\n\r\n                        function move(e) {\r\n\r\n                            var m = $(e.target).closest('a').attr('class').match(/move-(\\d+)-to-(\\d+)/);\r\n                            var item_id = m[1],\r\n                                area_to = m[2];\r\n\r\n                            var $spinner = add_spinner();\r\n                            $.post(get_action_url(\"rest\"),\r\n                                {\r\n                                    \"action\": \"move\",\r\n                                    \"item_id\": item_id,\r\n                                    \"area_to\": area_to,\r\n                                    \"sesskey\": M.cfg.sesskey\r\n                                },\r\n                                function() {\r\n                                    reload_tree();\r\n                                })\r\n                                .fail(function(response) {\r\n                                    show_error(response);\r\n                                })\r\n                                .always(function() {\r\n                                    $spinner.hide();\r\n                                });\r\n                        }\r\n\r\n                        var $current = $block.find('#block_sharing_cart-item-' + item_id);\r\n                        var $next = $current.next();\r\n                        var $list = $current.closest('ul');\r\n\r\n                        var next_id = 0;\r\n                        if ($next.length) {\r\n                            next_id = $next.attr('id').match(/item-(\\d+)$/)[1];\r\n                        }\r\n\r\n                        /**\r\n                         *\r\n                         * @param item_id\r\n                         * @param area_to\r\n                         * @returns {jQuery}\r\n                         */\r\n                        function create_target(item_id, area_to) {\r\n                            var $anchor = $('<a href=\"javascript:void(0)\"/>')\r\n                                .addClass('move-' + item_id + '-to-' + area_to)\r\n                                .attr('title', str('movehere'))\r\n                                .append(\r\n                                    $('<p>' + str('clicktomove') + '</p>')\r\n                                        .attr('alt', str('movehere'))\r\n                                );\r\n\r\n                            var $target = $('<li class=\"activity move-to\"/>')\r\n                                .append($anchor);\r\n                            $anchor.on('click', function(e) {\r\n                                move(e);\r\n                            });\r\n\r\n                            return $target;\r\n                        }\r\n\r\n                        $list.find('> li.activity').each(function(index, item) {\r\n                            var $item = $(item);\r\n                            var to = $item.attr('id').match(/item-(\\d+)$/)[1];\r\n                            if (to === item_id) {\r\n                                $cancel = create_command('cancel', 't/left');\r\n                                $cancel.on('click', function() {\r\n                                    move_targets.hide();\r\n                                });\r\n                                var $commands = $item.find('.commands');\r\n                                $commands.find('a').each(function() {\r\n                                    $(this).hide();\r\n                                });\r\n                                $commands.append($cancel);\r\n                                $item.css('opacity', 0.5);\r\n                            } else if (to !== next_id) {\r\n                                var $target = create_target(item_id, to);\r\n                                $item.before($target);\r\n                                targets.push($target);\r\n                            }\r\n                        }, this);\r\n\r\n                        if ($next) {\r\n                            var $target = create_target(item_id, 0);\r\n                            $list.append($target);\r\n                            targets.push($target);\r\n                        }\r\n                    };\r\n                }();\r\n\r\n                /**\r\n                 *  @class Targets for restoring an item\r\n                 */\r\n\r\n                var restore_targets = new function() {\r\n                    this.is_directory = null;\r\n                    var $clipboard = null,\r\n                        targets = [];\r\n\r\n                    /**\r\n                     *\r\n                     * @param id\r\n                     * @param section\r\n                     * @returns {jQuery}\r\n                     */\r\n\r\n\r\n                    function create_target(id, section) {\r\n                        var href = '';\r\n\r\n                        var inSection = $('#copy-section-form').data('in-section');\r\n                        if (restore_targets.is_directory) {\r\n                            href = get_action_url('restore', {\r\n                                'directory': true,\r\n                                'path': id,\r\n                                'course': course.id,\r\n                                'section': section,\r\n                                'in_section': inSection,\r\n                                'sesskey': M.cfg.sesskey\r\n                            });\r\n                        } else {\r\n                            href = get_action_url('restore', {\r\n                                'directory': false,\r\n                                'id': id,\r\n                                'course': course.id,\r\n                                'section': section,\r\n                                'in_section': inSection,\r\n                                'sesskey': M.cfg.sesskey\r\n                            });\r\n                        }\r\n\r\n                        var $target = $('<a/>')\r\n                            .attr('class', 'restore')\r\n                            .attr('href', href)\r\n                            .attr('title', str('copyhere'))\r\n                            .append(\r\n                                $('<img class=\"move_target\"/>')\r\n                                    .attr('alt', str('copyhere'))\r\n                                    .attr('src', M.util.image_url('dropzone_arrow', 'block_sharing_cart'))\r\n                            );\r\n\r\n                        targets.push($target);\r\n                        return $target;\r\n                    }\r\n\r\n                    /**\r\n                     *  Hide restore targets\r\n                     */\r\n                    this.hide = function() {\r\n                        if ($clipboard !== null) {\r\n                            $clipboard.remove();\r\n                            $clipboard = null;\r\n                            $.each(targets, function(index, $target) {\r\n                                $target.remove();\r\n                            });\r\n                            targets = [];\r\n                        }\r\n                    };\r\n\r\n                    /**\r\n                     *\r\n                     *\r\n                     *  @param {int} id  The item ID\r\n                     */\r\n                    this.show = function(id) {\r\n                        this.hide();\r\n\r\n                        var $view = $(\"<span/>\");\r\n\r\n                        if (this.is_directory) {\r\n                            $view.html(id).css('display', 'inline');\r\n                            $view.prepend(\r\n                                $(\"<i/>\").addClass(\"icon\")\r\n                                    .attr(\"alt\", id)\r\n                                // .attr(\"src\", M.util.image_url(icon['dir-closed'].pix, null))\r\n                            );\r\n                        } else {\r\n                            var $item = $block.find('#block_sharing_cart-item-' + id);\r\n                            $view = $($item.find('div')[0].cloneNode(true)).css('display', 'inline');\r\n                            $view.attr('class', $view.attr('class').replace(/mod-indent-\\d+/, ''));\r\n                            $view.find('.commands').remove();\r\n                        }\r\n\r\n                        var $cancel = create_command('cancel');\r\n\r\n                        $cancel.on('click', this.hide);\r\n\r\n                        $clipboard = $('<div class=\"clipboard\"/>');\r\n                        $clipboard.append(str('clipboard') + \": \").append($view).append($cancel);\r\n\r\n                        if (course.is_frontpage) {\r\n                            var $sitetopic = $('.sitetopic');\r\n                            var $mainmenu = $('.block_site_main_menu');\r\n                            if ($sitetopic) {\r\n                                $sitetopic.find('*').before($clipboard);\r\n                            } else if ($mainmenu) {\r\n                                $mainmenu.find('.content').before($clipboard);\r\n                            }\r\n\r\n                            // Mainmenu = section #0, sitetopic = section #1\r\n                            if ($mainmenu) {\r\n                                $mainmenu.find('.footer').before(create_target(id, 0));\r\n                            }\r\n                            if ($sitetopic) {\r\n                                $sitetopic.find('ul.section').append(create_target(id, 1));\r\n                            }\r\n                        } else {\r\n                            var $container = $('.course-content');\r\n                            $container.one('*').before($clipboard);\r\n                            $container.find(M.course.format.get_section_wrapper(null)).each(function(index, sectionDOM) {\r\n                                var $section = $(sectionDOM);\r\n                                var section = $section.attr('id').match(/(\\d+)$/)[1];\r\n                                $section.find('ul.section').first().append(create_target(id, section));\r\n                            }, this);\r\n                        }\r\n                    };\r\n                }();\r\n\r\n                // /////// INITIALIZATION /////////\r\n\r\n                /**\r\n                 *\r\n                 * @returns {string|*}\r\n                 */\r\n                $.get_plugin_name = function() {\r\n                    var $blockheader = $block.find(\"h2\");\r\n\r\n                    if (!$blockheader.length) {\r\n                        $blockheader = $block.find(\"h3\");\r\n\r\n                        if ($blockheader.length) {\r\n                            return $blockheader.html();\r\n                        }\r\n                    } else {\r\n                        return $blockheader.html();\r\n                    }\r\n\r\n                    return \"\";\r\n                };\r\n\r\n                /**\r\n                 *\r\n                 * @param e\r\n                 * @param activityName\r\n                 */\r\n                $.on_backup = function(e, activityName) {\r\n                    var cmid = (function($backup) {\r\n                        var $activity = $backup.closest('li.activity');\r\n                        if ($activity.length) {\r\n                            return $activity.attr('id').match(/(\\d+)$/)[1];\r\n                        }\r\n                        var $commands = $backup.closest('.commands');\r\n                        var dataowner = $commands.attr('data-owner');\r\n                        if (dataowner.length) {\r\n                            return dataowner.match(/(\\d+)$/)[1];\r\n                        }\r\n                        return $commands.find('a.editing_delete').attr('href').match(/delete=(\\d+)/)[1];\r\n                    })($(e.target));\r\n\r\n                    var data =\r\n                        {\r\n                            \"action\": \"is_userdata_copyable\",\r\n                            \"cmid\": cmid\r\n                        };\r\n\r\n                    on_backup_modal(data, activityName, str('confirm_backup'), false);\r\n                };\r\n\r\n                /**\r\n                 *  On movedir command clicked\r\n                 *\r\n                 *  @param {DOMEventFacade} e\r\n                 */\r\n                $.on_movedir = function(e) {\r\n                    var $commands = $(e.target).closest('.commands');\r\n\r\n                    var $current_dir = $commands.closest('li.directory');\r\n                    var current_path = $current_dir.length ? $current_dir.attr('directory-path') : '/';\r\n\r\n                    var item_id = $(e.target).closest('li.activity').attr('id').match(/(\\d+)$/)[1];\r\n\r\n                    var dirs = [];\r\n                    $block.find('li.directory').each(function() {\r\n                        dirs.push($(this).attr('directory-path'));\r\n                    });\r\n\r\n                    var $form = $('<form/>');\r\n                    // eslint-disable-next-line no-script-url\r\n                    $form.attr('action', 'javascript:void(0)');\r\n\r\n                    function submit() {\r\n                        var folder_to = $form.find('[name=\"to\"]').val();\r\n                        var $spinner = add_spinner();\r\n                        $.post(get_action_url('rest'),\r\n                            {\r\n                                \"action\": \"movedir\",\r\n                                \"item_id\": item_id,\r\n                                \"folder_to\": folder_to,\r\n                                \"sesskey\": M.cfg.sesskey\r\n                            },\r\n                            function() {\r\n                                reload_tree();\r\n                                directories.reset();\r\n                            })\r\n                            .fail(function(response) {\r\n                                show_error(response);\r\n                            })\r\n                            .always(function() {\r\n                                $spinner.hide();\r\n                            });\r\n                    }\r\n\r\n                    $form.submit(submit);\r\n\r\n                    if (dirs.length === 0) {\r\n                        var $input = $('<input class=\"form-control\" type=\"text\" name=\"to\"/>').val(current_path);\r\n                        setTimeout(function() {\r\n                            $input.focus();\r\n                        }, 1);\r\n                        $form.append($input);\r\n                    } else {\r\n                        dirs.unshift('/');\r\n\r\n                        var $select = $('<select class=\"custom-select\" name=\"to\"/>');\r\n                        for (var i = 0; i < dirs.length; i++) {\r\n                            $select.append($('<option/>').val(dirs[i]).append(dirs[i]));\r\n                        }\r\n                        $select.val(current_path);\r\n                        $select.change(submit);\r\n                        $form.append($select);\r\n\r\n                        var $edit = create_command('edit');\r\n\r\n                        $edit.on('click', function() {\r\n                            var $input = $('<input type=\"text\" name=\"to\"/>').val(current_path);\r\n                            $select.remove();\r\n                            $edit.replaceWith($input);\r\n                            $input.focus();\r\n                        });\r\n\r\n                        $form.append($edit);\r\n                    }\r\n\r\n                    var $cancel = create_command('cancel');\r\n                    $cancel.on('click', function() {\r\n                        $form.remove();\r\n                        $commands.find('a').show();\r\n                    });\r\n                    $form.append($cancel);\r\n\r\n                    $commands.find('a').each(function() {\r\n                        $(this).hide();\r\n                    });\r\n                    $commands.append($form);\r\n                };\r\n\r\n                /**\r\n                 *  On move command clicked\r\n                 *\r\n                 *  @param {DOMEventFacade} e\r\n                 */\r\n                $.on_move = function(e) {\r\n                    var $item = $(e.target).closest('li.activity');\r\n                    var id = $item.attr('id').match(/(\\d+)$/)[1];\r\n\r\n                    move_targets.show(id);\r\n                };\r\n\r\n                /**\r\n                 *  On delete command clicked\r\n                 *\r\n                 *  @param {DOMEventFacade} e\r\n                 */\r\n                $.on_delete = function(e) {\r\n                    var $item = $(e.target).closest('li');\r\n                    var liText = $item[0].innerText;\r\n\r\n                    var isDirectory = false;\r\n                    var modalBody;\r\n                    var item;\r\n                    var description_text = '';\r\n\r\n                    if ($item.hasClass(\"directory\")) {\r\n                        isDirectory = true;\r\n                        item = str('folder_string');\r\n                        description_text = str('delete_folder');\r\n                    } else {\r\n                        item = str('activity_string');\r\n                    }\r\n\r\n                    modalBody = '<p class=\"delete-item\">' + item + ' ' + liText + description_text + '</p>';\r\n\r\n                    confirm_modal({\r\n                        'title': str('confirm_delete'),\r\n                        'body': modalBody,\r\n                        'save_button': str('modal_confirm_delete'),\r\n                        'checkbox': false,\r\n                        'next': function() {\r\n\r\n                            var data = {};\r\n\r\n                            if (isDirectory === true) {\r\n                                data = {\r\n                                    \"action\": \"delete_directory\",\r\n                                    \"path\": $item.attr(\"directory-path\"),\r\n                                    \"sesskey\": M.cfg.sesskey\r\n                                };\r\n                            } else if ($item.hasClass(\"activity\")) {\r\n                                data = {\r\n                                    \"action\": \"delete\",\r\n                                    \"id\": $item.attr('id').match(/(\\d+)$/)[1],\r\n                                    \"sesskey\": M.cfg.sesskey\r\n                                };\r\n                            }\r\n\r\n                            var $spinner = add_spinner();\r\n\r\n                            $.post(get_action_url(\"rest\"), data,\r\n                                function() {\r\n                                    reload_tree();\r\n                                })\r\n                                .fail(function(response) {\r\n                                    show_error(response);\r\n                                })\r\n                                .always(function() {\r\n                                    $spinner.hide();\r\n                                });\r\n\r\n                            e.stopPropagation();\r\n                        }\r\n                    });\r\n                };\r\n\r\n                /**\r\n                 *  On restore command clicked\r\n                 *\r\n                 *  @param {DOMEventFacade} e\r\n                 */\r\n                $.on_restore = function(e) {\r\n                    var $item = $(e.target).closest('li');\r\n                    var id = null;\r\n\r\n                    if ($item.hasClass(\"directory\")) {\r\n                        id = $item.attr(\"directory-path\");\r\n                        restore_targets.is_directory = true;\r\n                    } else if ($item.hasClass(\"activity\")) {\r\n                        id = $item.attr('id').match(/(\\d+)$/)[1];\r\n                        restore_targets.is_directory = false;\r\n                    }\r\n\r\n                    restore_targets.show(id);\r\n                };\r\n\r\n                /**\r\n                 * On backup the whole section as a folder\r\n                 *\r\n                 * @param {int} sectionId\r\n                 * @param {int} sectionNumber\r\n                 * @param {int} courseId\r\n                 * @param {string} sectionName\r\n                 */\r\n                $.on_section_backup = function(sectionId, sectionNumber, courseId, sectionName) {\r\n                    var data =\r\n                        {\r\n                            \"action\": \"is_userdata_copyable_section\",\r\n                            \"sectionid\": sectionId,\r\n                            \"sectionnumber\": sectionNumber,\r\n                            \"courseid\": courseId,\r\n                        };\r\n\r\n                    on_backup_modal(data, sectionName, str('confirm_backup_section'), true);\r\n                };\r\n\r\n                /**\r\n                 *  Initialize the delete bulk\r\n                 */\r\n                $.init_bulk_delete = function(isspeciallayout) {\r\n                    var bulkdelete = $block.find('.editing_bulkdelete');\r\n                    if (bulkdelete.length) {\r\n                        if (isspeciallayout) {\r\n                            bulkdelete.attr('role', 'menuitem').addClass('dropdown-item menu-action');\r\n                            bulkdelete.append($(\"<span class='menu-action-text'/>\").append(bulkdelete.attr('title')));\r\n\r\n                            $block.find('.menubar .dropdown .dropdown-menu').append(bulkdelete);\r\n                        } else {\r\n                            $block.find('.header .commands').append(bulkdelete);\r\n                        }\r\n                    }\r\n                };\r\n\r\n                /**\r\n                 *  Initialize the help icon\r\n                 */\r\n                $.init_help_icon = function(isspeciallayout) {\r\n                    var helpicon = $block.find('.header-commands > .help-icon');\r\n\r\n                    if (isspeciallayout) {\r\n                        $block.find('.header-commands').parent().css('display', 'block');\r\n                    } else {\r\n                        $block.find('.header .commands').append(helpicon);\r\n                    }\r\n                };\r\n\r\n                /**\r\n                 *  Initialize the Sharing Cart block header\r\n                 */\r\n                $.init_block_header = function() {\r\n                    var isspeciallayout = verify_layout();\r\n                    $.init_bulk_delete(isspeciallayout);\r\n                    $.init_help_icon(isspeciallayout);\r\n                };\r\n\r\n                /**\r\n                 *  Initialize the Sharing Cart item tree\r\n                 */\r\n                $.init_item_tree = function() {\r\n                    function add_actions(item, actions) {\r\n                        var $item = $(item);\r\n                        var $commands = $item.find('.commands').first();\r\n\r\n                        $.each(actions, function(index, action) {\r\n                            var $command = create_command(action);\r\n                            $command.on('click', function(e) {\r\n                                $['on_' + action](e);\r\n                            });\r\n                            $commands.append($command);\r\n                        }, this);\r\n                    }\r\n\r\n                    var activity_actions = ['movedir', 'move', 'delete'];\r\n                    if (course) {\r\n                        activity_actions.push('restore');\r\n                    }\r\n\r\n                    var directory_actions = ['delete', 'restore'];\r\n\r\n                    // Initialize items\r\n                    $block.find('li.activity').each(function(index, item) {\r\n                        add_actions(item, activity_actions);\r\n                    });\r\n\r\n                    // Initialize directory items\r\n                    $block.find('li.directory').each(function(index, item) {\r\n                        add_actions(item, directory_actions);\r\n                    });\r\n\r\n                    // Initialize directories\r\n                    directories.init();\r\n                };\r\n\r\n                /**\r\n                 * Extract html object from area where moodle ajax was called.\r\n                 *\r\n                 * Call add_activity_backup_control to re append sharing cart icon.\r\n                 */\r\n                $.init_activity_commands = function() {\r\n                    $(document).ajaxComplete(function(event, xhr, settings) {\r\n\r\n                        var url = settings.url;\r\n                        var lastslashindex = url.lastIndexOf('=');\r\n                        var result = url.substring(lastslashindex + 1);\r\n\r\n                        if (result === 'core_course_edit_module' || result === 'core_course_get_module') {\r\n\r\n                            var data = JSON.parse(settings.data);\r\n                            var action = data[0].args.action;\r\n\r\n                            // Don't try to add icon if activity has been deleted.\r\n                            if (action === 'delete') {\r\n                                return;\r\n                            }\r\n\r\n                            setTimeout(function() {\r\n                                var activity_id = data[0].args.id;\r\n                                var activity = $('#module-' + activity_id);\r\n                                add_activity_backup_control(activity);\r\n\r\n                                if (action === 'duplicate') {\r\n                                    var duplicated = activity.next();\r\n                                    add_activity_backup_control(duplicated);\r\n                                }\r\n                            }, 1);\r\n                        }\r\n                    });\r\n\r\n                    /**\r\n                     * Create the backup icon\r\n                     *\r\n                     * @returns $backupIcon\r\n                     */\r\n                    function create_backup_icon() {\r\n\r\n                        var $backupIcon = $('<a href=\"javascript:void(0)\" class=\"add-to-sharing-cart\" />')\r\n                            .append($('<i class=\"fa fa-shopping-basket icon\"></i>'))\r\n                            .attr('title', str('backup'));\r\n\r\n                        return $backupIcon;\r\n                    }\r\n\r\n                    /**\r\n                     * Add backup control with a click event to an activity\r\n                     * Added fix for copying an activity without backup routine\r\n                     *\r\n                     * @param $activity\r\n                     */\r\n                    function add_activity_backup_control($activity) {\r\n\r\n                        var activityClass = $activity[0].className;\r\n\r\n                        // Selecting modtype without prefix.\r\n                        var modtype = activityClass.substr(activityClass.indexOf('modtype_') + 8);\r\n\r\n                        // Default activity name.\r\n                        var activityName = str('activity_string');\r\n\r\n                        // Label is using a different html / css layout, so it's needed to get the name by using another $find.\r\n                        if (modtype !== 'label') {\r\n                            activityName = $('.activity#' + $activity[0].id)\r\n                                .find('.mod-indent-outer .activityinstance span.instancename')\r\n                                .html();\r\n                        }\r\n\r\n                        var $backupIcon = create_backup_icon();\r\n\r\n                        $backupIcon.on('click', function(e) {\r\n                            $.on_backup(e, activityName);\r\n                        });\r\n\r\n                        var $actionMenuItem = $activity.find('.action-menu.section-cm-edit-actions').parent('.actions');\r\n\r\n                        $actionMenuItem.append($backupIcon);\r\n                    }\r\n\r\n                    /**\r\n                     * Add backup control with a click event to a section\r\n                     *\r\n                     * @param $section\r\n                     */\r\n                    function add_section_backup_control($section) {\r\n\r\n                        var sectionId = $section.find('.section_action_menu').data('sectionid');\r\n                        var sectionNumber = parseInt(String($section.attr('id')).match(/\\d+/)[0]);\r\n                        var sectionName = $section.attr('aria-label');\r\n\r\n                        var isFlexibleCourseFormat = $('body[id$=flexsections]').length;\r\n\r\n                        // Extract the section ID from the section if this is a Flexible\r\n                        // course format (since this format doesn't have an action menu)\r\n                        if (isFlexibleCourseFormat && (typeof sectionId === 'undefined' || sectionId === null)) {\r\n                            sectionId = $section.data('section-id');\r\n                        }\r\n\r\n                        // A bit unsafe to extract the course ID from the body but it's the best option we got at the moment\r\n                        var courseId = parseInt(String($('body').attr('class')).match(/course-([0-9]*)( |$)/)[1]);\r\n\r\n                        var $backupIcon = create_backup_icon();\r\n\r\n                        $backupIcon.on('click', function() {\r\n                            var inPlaceEditSectionName = in_place_edit_section_name($section);\r\n                            sectionName = (inPlaceEditSectionName !== '') ? inPlaceEditSectionName : sectionName;\r\n                            $.on_section_backup(sectionId, sectionNumber, courseId, sectionName);\r\n                        });\r\n\r\n                        var $sectionTitle = $section.find('h3.sectionname').first().find('a').last();\r\n\r\n                        var $inPlaceEditable = $section.find('h3.sectionname .inplaceeditable').first();\r\n                        if ($inPlaceEditable.length) {\r\n                            $sectionTitle = $inPlaceEditable;\r\n                        }\r\n\r\n                        // Add the backup icon after the cog wheel if this is a Flexible course format\r\n                        if (isFlexibleCourseFormat && sectionNumber === 0) {\r\n                            $sectionTitle = $section.find('> .controls');\r\n                            $sectionTitle.prepend($backupIcon);\r\n                        } else {\r\n                            $backupIcon.insertAfter($sectionTitle);\r\n                        }\r\n\r\n                        var activitySelector = 'li.activity';\r\n\r\n                        if (isFlexibleCourseFormat) {\r\n                            activitySelector = 'li.activity.activity-section-' + sectionId;\r\n                        }\r\n\r\n                        var $activities = $section.find(activitySelector);\r\n\r\n                        $($activities).each(function() {\r\n                            add_activity_backup_control($(this));\r\n                        });\r\n                    }\r\n\r\n                    $(\"body.editing .course-content li.section\").each(function() {\r\n                        add_section_backup_control($(this));\r\n                    });\r\n                };\r\n\r\n                /**\r\n                 * Initialize the Sharing Cart block\r\n                 */\r\n                $.init = function() {\r\n                    M.str.block_sharing_cart.pluginname = this.get_plugin_name();\r\n\r\n                    // Arrange header icons (bulkdelete, help)\r\n                    $.init_block_header();\r\n                    $.init_item_tree();\r\n                    $.init_activity_commands();\r\n                };\r\n                var $spinner = $('<i/>').addClass('spinner fa fa-3x fa-circle-o-notch fa-spin');\r\n                $('div#sharing-cart-spinner-modal div.spinner-container').prepend($spinner);\r\n\r\n                $.init();\r\n            });\r\n\r\n            $('.copy_section').on('click', function() {\r\n\r\n                var $section_selected = ($('.section-dropdown option:selected'));\r\n                var sectionId = $section_selected.data('section-id');\r\n                var sectionNumber = $section_selected.data('section-number');\r\n                var courseId = $section_selected.data('course-id');\r\n                var sectionName = $section_selected.data('section-name');\r\n\r\n                $.on_section_backup(sectionId, sectionNumber, courseId, sectionName);\r\n            });\r\n        }\r\n    };\r\n});\r\n"],"file":"script.min.js"}