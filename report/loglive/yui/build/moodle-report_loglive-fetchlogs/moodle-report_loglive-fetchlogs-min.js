YUI.add("moodle-report_loglive-fetchlogs",function(r,e){function t(){t.superclass.constructor.apply(this,arguments)}var i="newrow",l={NEWROW:"."+i,TBODY:".flexible tbody",PAUSEBUTTON:"#livelogs-pause-button",SPINNER:"."+"spinner"};r.extend(t,r.Base,{callBack:{},spinner:{},pauseButton:{},initializer:function(){0===this.get("page")&&(this.callBack=r.later(1e3*this.get("interval"),this,this.fetchRecentLogs,null,!0)),this.spinner=r.one(l.SPINNER),this.pauseButton=r.one(l.PAUSEBUTTON),this.spinner.hide(),r.one(l.PAUSEBUTTON).on("click",this.toggleUpdate,this)},fetchRecentLogs:function(){var e,t;this.spinner.show(),e={logreader:this.get("logreader"),since:this.get("since"),page:this.get("page"),id:this.get("courseid")},e={method:"get",context:this,on:{complete:this.updateLogTable},data:e},t=M.cfg.wwwroot+"/report/loglive/loglive_ajax.php",r.io(t,e)},updateLogTable:function(e,t){var i,n,o;r.later(600,this,"hideLoadingIcon");try{if((i=r.JSON.parse(t.responseText)).error)return r.use("moodle-core-notification-ajaxexception",function(){return new M.core.ajaxException(i)}),this}catch(s){return r.use("moodle-core-notification-exception",function(){return new M.core.exception(s)}),this}this.set("since",i.until),t=i.logs,(n=r.one(l.TBODY))&&t&&((o=n.get("firstChild"))&&n.insertBefore(t,o),n.get("children").slice(this.get("perpage")).remove(),r.later(5e3,this,"removeHighlight",i.until))},removeHighlight:function(e){r.all(".time"+e).removeClass(i)},hideLoadingIcon:function(){this.spinner.hide()},toggleUpdate:function(){this.callBack?(this.callBack.cancel(),this.callBack="",this.pauseButton.setContent(M.util.get_string("resume","report_loglive"))):(this.callBack=r.later(1e3*this.get("interval"),this,this.fetchRecentLogs,null,!0),this.pauseButton.setContent(M.util.get_string("pause","report_loglive")))}},{NAME:"fetchLogs",ATTRS:{since:null,courseid:0,page:0,perpage:100,interval:60,logreader:"logstore_standard"}}),r.namespace("M.report_loglive.FetchLogs").init=function(e){return new t(e)}},"@VERSION@",{requires:["base","event","node","io","node-event-delegate"]});