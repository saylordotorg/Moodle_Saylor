define ("qtype_coderunner/authorform",["jquery","qtype_coderunner/userinterfacewrapper","core/str"],function(a,b,c){var d={template:["#id_template","value",""],iscombinatortemplate:["#id_iscombinatortemplate","checked","",function(a){return"1"===a?!0:!1}],cputimelimitsecs:["#id_cputimelimitsecs","value",""],memlimitmb:["#id_memlimitmb","value",""],sandbox:["#id_sandbox","value","DEFAULT"],sandboxparams:["#id_sandboxparams","value",""],testsplitterre:["#id_testsplitterre","value","",function(a){return a.replace("\n","\\n")}],allowmultiplestdins:["#id_allowmultiplestdins","checked","",function(a){return"1"===a?!0:!1}],grader:["#id_grader","value","EqualityGrader"],resultcolumns:["#id_resultcolumns","value",""],language:["#id_language","value",""],acelang:["#id_acelang","value",""],uiplugin:["#id_uiplugin","value","ace"]};return{initEditForm:function(){var u=a("#id_coderunnertype"),v=a("#id_template"),w=a("#id_templateparamsevalpertry"),x=a("#id_globalextra"),y=a("#id_prototypeextra"),z=a("#id_useace"),A=a("#id_language"),B=a("#id_acelang"),C=a("#id_customise"),D=a("#id_iscombinatortemplate"),E=a("#id_testsplitterre"),F=a("#id_allowmultiplestdins"),G=a("#id_customisationheader"),H=a("#id_advancedcustomisationheader"),I=C.prop("checked"),J=a("#id_prototypetype"),K=a("#id_answerpreloadhdr"),L=a("#id_typename"),N=a("input[name=\"courseid\"]").prop("value"),O=a("#qtype-help"),P=a("select#id_precheck"),Q=a("div.testtype"),R=a("#id_broken_question"),S=a("#id_uiplugin"),T=a("#id_uiparameters");function e(c,d){var e=a(document.getElementById(c)),f,g=e.attr("data-lang"),h=e.attr("data-params"),i={},j;e.attr("data-prototypeextra",y.val());e.attr("data-globalextra",x.val());e.attr("data-test0",a("#id_testcode_0").val());try{i=JSON.parse(h)}catch(a){}d=d.toLowerCase();if("none"===d){d=""}if("id_templateparams"==c||"id_uiparameters"==c){f=""}else{f=A.prop("value");if("id_template"!==c&&B.prop("value")){f=n(B.prop("value"))}}j=e.data("current-ui-wrapper");if(j&&j.uiname===d&&g==f){return}e.attr("data-lang",f);if(!j){j=new b.InterfaceWrapper(d,c)}else{i.lang=f;j.loadUi(d,i)}}function f(){var a=S.val(),b=!0;if("html"===a&&""!==T.val().trim()){try{var c=JSON.parse(T.val());if(!1===c.enable_in_editor){b=!1}}catch(a){alert("Invalid UI parameters.")}}if(b){e("id_answer",a);e("id_answerpreload",a)}}function g(a){var b=a?"block":"none";G.css("display",b);H.css("display",b);if(a&&z.prop("checked")){e("id_template","ace")}}function h(b){var c=["id_template","id_uiparameters"],d,e;if(z.prop("checked")){for(var f=0;f<c.length;f++){e=a(document.getElementById(c[f]));d=e.data("current-ui-wrapper");if(d&&b){d.restart()}else if(d&&!b){d.stop()}}}}function i(){var a=D.prop("checked");E.prop("disabled",!a);F.prop("disabled",!a)}function j(b,e){var f,j,k;h(!1);for(var m in d){f=d[m];j=e[m]?e[m]:f[2];if(3<f.length){k=f[3];j=k(j)}a(f[0]).prop(f[1],j)}L.prop("value",b);C.prop("checked",!1);c.get_string("coderunner_question_type","qtype_coderunner").then(function(a){O.html(l(b,a,e.questiontext))});g(!1);i()}function k(a,b){m("prototype_load_failure",b);c.get_string("prototype_error","qtype_coderunner").then(function(c){var d=c+"\n";d+=b+"\n";d+="CourseId: "+N+", qtype: "+a;v.prop("value",d)})}function l(a,b,c){var d="<p class=\"question-type-details-header\">";d+=b;d+=a+"</p>\n"+c;return d}function m(a,b){c.get_string(a,"qtype_coderunner").then(function(a){var c=a.replace(/\n/g," ");if(b){c+="\n"+b}alert(c)})}function n(a){var b,c;if(0>a.indexOf(",")){return a}else{b=a.split(",");for(c=0;c<b.length;c++){if(b[c].endsWith("*")){return b[c].substr(0,b[c].length-1)}}return 0<b.length?b[0]:""}}function o(){var b=u.children("option:selected").text();if(""!==b&&"Undefined"!==b){u.children("option:first-child").prop("disabled","disabled");a.getJSON(M.cfg.wwwroot+"/question/type/coderunner/ajax.php",{qtype:b,courseid:N,sesskey:M.cfg.sesskey},function(a){if(a.success){j(b,a);f()}else{k(b,a.error)}}).fail(function(){m("error_loading_prototype");v.prop("value","*** AJAX ERROR. DON'T SAVE THIS! ***");c.get_string("ajax_error","qtype_coderunner").then(function(a){v.prop("value",a)})})}}function p(a){var b="<div class=\"uiparamtablediv\"><table class=\"uiparamtable\">\n",c=a.columnheaders,d,e;b+="<tr><th>"+c[0]+"</th><th>"+c[1]+"</th><th>"+c[2]+"</th></tr>\n";for(e=0;e<a.uiparamstable.length;e++){d=a.uiparamstable[e];b+="<tr><td>"+d[0]+"</td><td>"+d[1]+"</td><td>"+d[2]+"</td></tr>\n"}b+="</table></div>\n";return b}function q(){var b=S.children("option:selected").text();a.getJSON(M.cfg.wwwroot+"/question/type/coderunner/ajax.php",{uiplugin:b,courseid:N,sesskey:M.cfg.sesskey},function(b){var c=T.val(),d=a(".ui_parameters_descr"),f=a("<button type=\"button\" class=\"toggleuidetails\">"+b.showdetails+"</button>"),g;d.empty();d.append(b.header);if(0==b.uiparamstable.length&&""===c.trim()){T.val("");a("#fgroup_id_uiparametergroup").hide()}else{if(0!=b.uiparamstable.length){d.append(f);g=a(p(b));d.append(g);g.hide();f.click(function(){if(f.html()==b.showdetails){g.show();f.html(b.hidedetails)}else{g.hide();f.html(b.showdetails)}})}a("#fgroup_id_uiparametergroup").show();if(z.prop("checked")){e("id_uiparameters","ace")}}}).fail(function(){m("error_loading_ui_descr")})}function r(){if("3"===P.val()){Q.show()}else{Q.hide()}}function s(){if("ace"===S.val()){f()}}function t(){if(z.prop("checked")){e("id_template","ace")}}if(1==J.prop("value")){c.get_string("proceed_at_own_risk","qtype_coderunner").then(function(a){alert(a)});J.prop("disabled",!0);u.prop("disabled",!0);C.prop("disabled",!0)}(function(){var b=R.prop("value"),c=null;if(""!==b){c=a("<p>"+R.prop("value")+"</p>");a("#id_qtype_coderunner_error_div").append(c)}})();g(I);if(!I){o()}else{f();c.get_string("info_unavailable","qtype_coderunner").then(function(a){O.html("<p>"+a+"</p>")})}r();if(z.prop("checked")){e("id_templateparams","ace");e("id_uiparameters","ace")}q();C.on("change",function(){var a=C.prop("checked");if(a){g(!0)}else{c.get_string("confirm_proceed","qtype_coderunner").then(function(a){if(window.confirm(a)){g(!1)}else{C.prop("checked",!0)}})}});B.on("change",s);A.on("change",function(){t();s()});u.on("change",function(){if(C.prop("checked")){c.get_string("question_type_changed","qtype_coderunner").then(function(a){if(window.confirm(a)){o()}})}else{o()}});z.on("change",function(){var a=z.prop("checked");if(a){e("id_template","ace");e("id_templateparams","ace");e("id_uiparameters","ace")}else{e("id_template","");e("id_templateparams","");e("id_uiparameters","")}});w.on("change",function(){if(w.is(":checked")){m("templateparamsusingsandbox")}});S.on("change",function(){f();q()});P.on("change",r);var U=new MutationObserver(function(){f()});U.observe(K.get(0),{attributes:!0});a("button.replaceexpectedwithgot").click(function(){var b=a(this).prev("pre[id^=\"id_got_\"]"),c=b.attr("id").replace("id_got_","");a("#id_expected_"+c).val(b.text());a("#id_fail_expected_"+c).html(b.text());a(".failrow_"+c).addClass("fixed");a(this).prop("disabled",!0)})}}});
//# sourceMappingURL=authorform.min.js.map
