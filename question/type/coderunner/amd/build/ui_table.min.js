define ("qtype_coderunner/ui_table",["jquery"],function(a){function b(b,c,d,e){this.textArea=a(document.getElementById(b));this.readOnly=this.textArea.prop("readonly");this.tableDiv=null;this.uiParams=e;if(!e.num_columns||!e.num_rows){this.fail=!0;this.failString="table_ui_missingparams";return}this.fail=!1;this.lockedCells=e.locked_cells||[];this.hasHeader=e.column_headers&&0<e.column_headers.length?!0:!1;this.hasRowLabels=e.row_labels&&0<e.row_labels.length?!0:!1;this.numDataColumns=e.num_columns;this.rowsPerCell=e.lines_per_cell||2;this.totNumColumns=this.numDataColumns+(this.hasRowLabels?1:0);this.columnWidths=this.computeColumnWidths();this.reload()}b.prototype.computeColumnWidths=function(){var a=Math.trunc(100/this.totNumColumns),b=[];if(this.uiParams.column_width_percents&&0<this.uiParams.column_width_percents.length){return this.uiParams.column_width_percents}else if(Array.prototype.fill){return Array(this.totNumColumns).fill(a)}else{for(var c=0;c<this.totNumColumns;c++){b.push(a)}return b}};b.prototype.isLockedCell=function(a,b){for(var c=0;c<this.lockedCells.length;c++){if(this.lockedCells[c][0]==a&&this.lockedCells[c][1]==b){return!0}}return!1};b.prototype.getElement=function(){return this.tableDiv};b.prototype.failed=function(){return this.fail};b.prototype.failMessage=function(){return this.failString};b.prototype.sync=function(){var b=[],c=!0,d=a(this.tableDiv).find("table tbody tr");d.each(function(){var d=[];a(this).find("textarea").each(function(){var b=a(this).val();d.push(b);if(b){c=!1}});b.push(d)});if(c){this.textArea.val("")}else{this.textArea.val(JSON.stringify(b))}};b.prototype.tableRow=function(a,b){var c="<tr>",d=0,e;if(this.hasRowLabels){e=this.columnWidths[0];d=1;c+="<th style='padding-top:8px;text-align:center;width:"+e+"%' scope='row'>";if(a<this.uiParams.row_labels.length){c+=this.uiParams.row_labels[a]}c+="</th>"}for(var f=0;f<this.numDataColumns;f++){e=this.columnWidths[d++];c+="<td style='padding:2px;margin:0,width:"+e+"'%>";c+="<textarea rows=\""+this.rowsPerCell+"\"";c+=" style=\"width:100%;padding:0;resize:vertical;font-family: monospace\"";if(this.isLockedCell(a,f)){c+=" disabled>"}else{c+=">"}if(a<b.length){c+=b[a][f]}c+="</textarea>";c+="</td>"}c+="</tr>";return c};b.prototype.tableHeadSection=function(){var a="<thead>\n",b=0;if(this.hasHeader){a+="<tr>";if(this.hasRowLabels){a+="<th style='width:"+this.columnWidths[0]+"%'></th>";b+=1}for(var c=0;c<this.numDataColumns;c++){a+="<th style='width:"+this.columnWidths[b]+"%'>";if(c<this.uiParams.column_headers.length){a+=this.uiParams.column_headers[c]}b++;a+="</th>"}a+="</tr>\n"}a+="</thead>\n";return a};b.prototype.reload=function(){var b=a(this.textArea).val(),c=[],d="<div style='height:fit-content' class='qtype-coderunner-table-outer-div'>\n<table class='table table-bordered qtype-coderunner_table'>\n";if(b){try{c=JSON.parse(b)}catch(a){this.fail=!0;this.failString="table_ui_invalidjson";return}}try{d+=this.tableHeadSection();d+="<tbody>\n";for(var e=Math.max(this.uiParams.num_rows,c.length),f=0;f<e;f++){d+=this.tableRow(f,c)}d+="</tbody>\n</table>\n</div>";this.tableDiv=a(d);if(this.uiParams.dynamic_rows){this.addButtons()}}catch(a){this.fail=!0;this.failString="table_ui_invalidserialisation"}};b.prototype.addButtons=function(){var b=a("<button type=\"button\"style=\"float:right;margin-right:6px\" disabled>Delete row</button>"),c=this;this.tableDiv.append(b);b.click(function(){var b=c.tableDiv.find("table tbody tr").length,d=c.tableDiv.find("tr:last");if(b>c.uiParams.num_rows){d.remove()}d=c.tableDiv.find("tr:last");if(b==c.uiParams.num_rows+1){a(this).prop("disabled",!0)}});var d=a("<button type=\"button\"style=\"float:right;margin-right:6px\">Add row</button>");c.tableDiv.append(d);d.click(function(){var b,d;b=c.tableDiv.find("table tbody tr:last");d=b.clone();d.find("textarea").each(function(){a(this).val("")});b.after(d);a(this).prev().prop("disabled",!1)})};b.prototype.resize=function(){};b.prototype.hasFocus=function(){var b=!1;a(this.tableDiv).find("textarea").each(function(){if(this===document.activeElement){b=!0}});return b};b.prototype.destroy=function(){this.sync();a(this.tableDiv).remove();this.tableDiv=null};return{Constructor:b}});
//# sourceMappingURL=ui_table.min.js.map
