{"version":3,"sources":["../src/graphelements.js"],"names":["define","util","Node","parent","x","y","mouseOffsetX","mouseOffsetY","isAcceptState","textBox","TextBox","caretPosition","prototype","setMouseStart","mouseX","mouseY","setAnchorPoint","trackMouse","draw","c","beginPath","arc","nodeRadius","Math","PI","stroke","closestPointOnCircle","dx","dy","scale","sqrt","containsPoint","neighbours","links","link","i","length","Link","nodeA","includes","nodeB","push","traverseGraph","visited","neighbour","a","b","lineAngleAdjust","parallelPart","perpendicularPart","getAnchorPoint","abs","SNAP_TO_PADDING","getEndPointsAndCircle","midX","midY","start","end","anchor","circle","circleFromThreePoints","isReversed","reverseScale","rRatio","radius","startAngle","atan2","endAngle","startX","cos","startY","sin","endX","endY","linkInfo","textX","textY","textAngle","relDist","hasCircle","circleX","circleY","circleRadius","moveTo","lineTo","arrowIfReqd","distance","HIT_TARGET_PADDING","angle","temp","percent","SelfLink","node","mouse","anchorAngle","mouseOffsetAngle","mouseStartX","mouseStartY","snap","round","StartLink","deltaX","deltaY","getEndPoints","endPoints","TemporaryLink","from","to","Button","topX","topY","text","BUTTON_WIDTH","BUTTON_HEIGHT","TEXT_OFFSET_X","TEXT_OFFSET_Y","highLighted","isInside","width","height","fillStyle","fillRect","lineWidth","strokeStyle","strokeRect","font","textAlign","fillText","onClick","HelpBox","call","helpOpen","LINE_HEIGHT","HELP_INDENT","lines","helpText","split","offset","textOffset","dragged","boundingBox","insertChar","char","slice","caretRight","deleteChar","caretLeft","position","vectorMagnitude","textVector","linkVector","projection","scalarProjection","pow","ccw","isCCW","reversed","angleOrNull","parentObject","graph","getCanvas","getContext","fontSize","beforeCaretText","convertLatexShortcuts","afterCaretText","measureText","cornerPointX","cornerPointY","slide","advancedFillText","prevStyle","caretX","selectedObject","caretVisible","hasFocus","document"],"mappings":"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","sourcesContent":["/******************************************************************************\n *\n * A module for use by ui_graph, defining classes Node, Link, SelfLink,\n * StartLink and TemporaryLink\n *\n ******************************************************************************/\n// This code is a modified version of Finite State Machine Designer\n// (http://madebyevan.com/fsm/)\n/*\n Finite State Machine Designer (http://madebyevan.com/fsm/)\n License: MIT License (see below)\n Copyright (c) 2010 Evan Wallace\n Permission is hereby granted, free of charge, to any person\n obtaining a copy of this software and associated documentation\n files (the \"Software\"), to deal in the Software without\n restriction, including without limitation the rights to use,\n copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the\n Software is furnished to do so, subject to the following\n conditions:\n The above copyright notice and this permission notice shall be\n included in all copies or substantial portions of the Software.\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n OTHER DEALINGS IN THE SOFTWARE.\n*/\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more util.details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n\ndefine(['qtype_coderunner/graphutil'], function(util) {\n\n    /***********************************************************************\n     *\n     * Define a class Node that represents a node in a graph\n     *\n     ***********************************************************************/\n\n    function Node(parent, x, y) {\n        this.parent = parent;  // The ui_graph instance.\n        this.x = x;\n        this.y = y;\n        this.mouseOffsetX = 0;\n        this.mouseOffsetY = 0;\n        this.isAcceptState = false;\n        this.textBox = new TextBox('', this);\n        this.caretPosition = 0;\n    }\n\n    // At the start of a drag, record our position relative to the mouse.\n    Node.prototype.setMouseStart = function(mouseX, mouseY) {\n        this.mouseOffsetX = this.x - mouseX;\n        this.mouseOffsetY = this.y - mouseY;\n    };\n\n    Node.prototype.setAnchorPoint = function(x, y) {\n        this.x = x + this.mouseOffsetX;\n        this.y = y + this.mouseOffsetY;\n    };\n\n    // Given a new mouse position during a drag, move to the appropriate\n    // new position.\n    Node.prototype.trackMouse = function(mouseX, mouseY) {\n        this.x = this.mouseOffsetX + mouseX;\n        this.y = this.mouseOffsetY + mouseY;\n    };\n\n    Node.prototype.draw = function(c) {\n        // Draw the circle.\n        c.beginPath();\n        c.arc(this.x, this.y, this.parent.nodeRadius(), 0, 2 * Math.PI, false);\n        c.stroke();\n\n        // Draw the text.\n        this.textBox.draw(this.x, this.y, null, this);\n\n        // Draw a double circle for an accept state.\n        if(this.isAcceptState) {\n            c.beginPath();\n            c.arc(this.x, this.y, this.parent.nodeRadius() - 6, 0, 2 * Math.PI, false);\n            c.stroke();\n        }\n    };\n\n    Node.prototype.closestPointOnCircle = function(x, y) {\n        var dx = x - this.x;\n        var dy = y - this.y;\n        var scale = Math.sqrt(dx * dx + dy * dy);\n        return {\n            'x': this.x + dx * this.parent.nodeRadius() / scale,\n            'y': this.y + dy * this.parent.nodeRadius() / scale,\n        };\n    };\n\n    Node.prototype.containsPoint = function(x, y) {\n        return (x - this.x) * (x - this.x) + (y - this.y) * (y - this.y) < this.parent.nodeRadius() * this.parent.nodeRadius();\n    };\n\n    // Method of a Node that, given a list of all links in a graph, returns\n    // a list of any nodes that contain a link to this node (excluding StartLinks\n    // and SelfLinks).\n    Node.prototype.neighbours = function(links) {\n        var neighbours = [], link;\n        for (var i = 0; i < links.length; i++) {\n            link = links[i];\n            if (link instanceof Link) { // Exclude SelfLinks and StartLinks.\n                if (link.nodeA === this && !neighbours.includes(link.nodeB)) {\n                    neighbours.push(link.nodeB);\n                } else if (link.nodeB === this && !neighbours.includes(link.nodeA)) {\n                    neighbours.push(link.nodeA);\n                }\n            }\n        }\n        return neighbours;\n    };\n\n    // Method of Node that traverses a graph defined by a given set of links\n    // starting at 'this' node and updating the visited list for each new\n    // node. Returns the updated visited list, which (for the root call)\n    // is a list of all nodes connected to the given start node.\n    Node.prototype.traverseGraph = function(links, visited) {\n        var neighbours,\n            neighbour;\n        if (!visited.includes(this)) {\n            visited.push(this);\n            neighbours = this.neighbours(links);\n            for (var i = 0; i < neighbours.length; i++) {\n                neighbour = neighbours[i];\n                if (!visited.includes(neighbour)) {\n                    neighbour.traverseGraph(links, visited);\n                }\n            }\n        }\n        return visited;\n    };\n\n    /***********************************************************************\n     *\n     * Define a class Link that represents a connection between two nodes.\n     *\n     ***********************************************************************/\n    function Link(parent, a, b) {\n        this.parent = parent;  // The parent ui_digraph instance.\n        this.nodeA = a;\n        this.nodeB = b;\n        this.textBox = new TextBox('', this);\n        this.lineAngleAdjust = 0; // Value to add to textAngle when link is straight line.\n        this.caretPosition = 0;\n\n        // Make anchor point relative to the locations of nodeA and nodeB.\n        this.parallelPart = 0.5;    // Percentage from nodeA to nodeB.\n        this.perpendicularPart = 0; // Pixels from line between nodeA and nodeB.\n    }\n\n    Link.prototype.getAnchorPoint = function() {\n        var dx = this.nodeB.x - this.nodeA.x;\n        var dy = this.nodeB.y - this.nodeA.y;\n        var scale = Math.sqrt(dx * dx + dy * dy);\n        return {\n            'x': this.nodeA.x + dx * this.parallelPart - dy * this.perpendicularPart / scale,\n            'y': this.nodeA.y + dy * this.parallelPart + dx * this.perpendicularPart / scale\n        };\n    };\n\n    Link.prototype.setAnchorPoint = function(x, y) {\n        var dx = this.nodeB.x - this.nodeA.x;\n        var dy = this.nodeB.y - this.nodeA.y;\n        var scale = Math.sqrt(dx * dx + dy * dy);\n        this.parallelPart = (dx * (x - this.nodeA.x) + dy * (y - this.nodeA.y)) / (scale * scale);\n        this.perpendicularPart = (dx * (y - this.nodeA.y) - dy * (x - this.nodeA.x)) / scale;\n        // Snap to a straight line.\n        if(this.parallelPart > 0 && this.parallelPart < 1 && Math.abs(this.perpendicularPart) < this.parent.SNAP_TO_PADDING) {\n            this.lineAngleAdjust = (this.perpendicularPart < 0) * Math.PI;\n            this.perpendicularPart = 0;\n        }\n    };\n\n    Link.prototype.getEndPointsAndCircle = function() {\n        if(this.perpendicularPart === 0) {\n            var midX = (this.nodeA.x + this.nodeB.x) / 2;\n            var midY = (this.nodeA.y + this.nodeB.y) / 2;\n            var start = this.nodeA.closestPointOnCircle(midX, midY);\n            var end = this.nodeB.closestPointOnCircle(midX, midY);\n            return {\n                'hasCircle': false,\n                'startX': start.x,\n                'startY': start.y,\n                'endX': end.x,\n                'endY': end.y,\n            };\n        }\n        var anchor = this.getAnchorPoint();\n        var circle = util.circleFromThreePoints(this.nodeA.x, this.nodeA.y, this.nodeB.x, this.nodeB.y, anchor.x, anchor.y);\n        var isReversed = (this.perpendicularPart > 0);\n        var reverseScale = isReversed ? 1 : -1;\n        var rRatio = reverseScale * this.parent.nodeRadius() / circle.radius;\n        var startAngle = Math.atan2(this.nodeA.y - circle.y, this.nodeA.x - circle.x) - rRatio;\n        var endAngle = Math.atan2(this.nodeB.y - circle.y, this.nodeB.x - circle.x) + rRatio;\n        var startX = circle.x + circle.radius * Math.cos(startAngle);\n        var startY = circle.y + circle.radius * Math.sin(startAngle);\n        var endX = circle.x + circle.radius * Math.cos(endAngle);\n        var endY = circle.y + circle.radius * Math.sin(endAngle);\n        return {\n            'hasCircle': true,\n            'startX': startX,\n            'startY': startY,\n            'endX': endX,\n            'endY': endY,\n            'startAngle': startAngle,\n            'endAngle': endAngle,\n            'circleX': circle.x,\n            'circleY': circle.y,\n            'circleRadius': circle.radius,\n            'reverseScale': reverseScale,\n            'isReversed': isReversed,\n        };\n    };\n\n    Link.prototype.draw = function(c) {\n        var linkInfo = this.getEndPointsAndCircle(), textX, textY, textAngle, relDist;\n        // Draw arc.\n        c.beginPath();\n        if(linkInfo.hasCircle) {\n            c.arc(linkInfo.circleX,\n                  linkInfo.circleY,\n                  linkInfo.circleRadius,\n                  linkInfo.startAngle,\n                  linkInfo.endAngle,\n                  linkInfo.isReversed);\n        } else {\n            c.moveTo(linkInfo.startX, linkInfo.startY);\n            c.lineTo(linkInfo.endX, linkInfo.endY);\n        }\n        c.stroke();\n        // Draw the head of the arrow.\n        if(linkInfo.hasCircle) {\n            this.parent.arrowIfReqd(c,\n                      linkInfo.endX,\n                      linkInfo.endY,\n                      linkInfo.endAngle - linkInfo.reverseScale * (Math.PI / 2));\n        } else {\n            this.parent.arrowIfReqd(c,\n                      linkInfo.endX,\n                      linkInfo.endY,\n                      Math.atan2(linkInfo.endY - linkInfo.startY, linkInfo.endX - linkInfo.startX));\n        }\n        // Draw the text.\n        relDist = this.textBox.relDist;\n        if(linkInfo.hasCircle) {\n            var startAngle = linkInfo.startAngle;\n            var endAngle = linkInfo.endAngle;\n            if (endAngle < startAngle) {\n                endAngle += Math.PI * 2;\n            }\n\n            textAngle = ((1 - relDist) * startAngle + relDist * endAngle);\n            if (linkInfo.isReversed){\n              textAngle += (1 - relDist) * (2 * Math.PI); // Reflect text across the line between the link points\n            }\n            textX = linkInfo.circleX + linkInfo.circleRadius * Math.cos(textAngle);\n            textY = linkInfo.circleY + linkInfo.circleRadius * Math.sin(textAngle);\n            this.textBox.draw(textX, textY, textAngle, this);\n        } else {\n            textX = ((1 - relDist) * linkInfo.startX + relDist * linkInfo.endX);\n            textY = ((1 - relDist) * linkInfo.startY + relDist * linkInfo.endY);\n            textAngle = Math.atan2(linkInfo.endX - linkInfo.startX, linkInfo.startY - linkInfo.endY);\n            this.textBox.draw(textX, textY, textAngle + this.lineAngleAdjust, this);\n        }\n    };\n\n    Link.prototype.containsPoint = function(x, y) {\n        var linkInfo = this.getEndPointsAndCircle(), dx, dy, distance;\n        if(linkInfo.hasCircle) {\n            dx = x - linkInfo.circleX;\n            dy = y - linkInfo.circleY;\n            distance = Math.sqrt(dx * dx + dy * dy) - linkInfo.circleRadius;\n            if(Math.abs(distance) < this.parent.HIT_TARGET_PADDING) {\n                var angle = Math.atan2(dy, dx);\n                var startAngle = linkInfo.startAngle;\n                var endAngle = linkInfo.endAngle;\n                if(linkInfo.isReversed) {\n                    var temp = startAngle;\n                    startAngle = endAngle;\n                    endAngle = temp;\n                }\n                if(endAngle < startAngle) {\n                    endAngle += Math.PI * 2;\n                }\n                if(angle < startAngle) {\n                    angle += Math.PI * 2;\n                } else if(angle > endAngle) {\n                    angle -= Math.PI * 2;\n                }\n                return (angle > startAngle && angle < endAngle);\n            }\n        } else {\n            dx = linkInfo.endX - linkInfo.startX;\n            dy = linkInfo.endY - linkInfo.startY;\n            var length = Math.sqrt(dx * dx + dy * dy);\n            var percent = (dx * (x - linkInfo.startX) + dy * (y - linkInfo.startY)) / (length * length);\n            distance = (dx * (y - linkInfo.startY) - dy * (x - linkInfo.startX)) / length;\n            return (percent > 0 && percent < 1 && Math.abs(distance) < this.parent.HIT_TARGET_PADDING);\n        }\n        return false;\n    };\n\n    /***********************************************************************\n     *\n     * Define a class SelfLink that represents a connection from a node back\n     * to itself.\n     *\n     ***********************************************************************/\n\n    function SelfLink(parent, node, mouse) {\n        this.parent = parent;\n        this.node = node;\n        this.anchorAngle = 0;\n        this.mouseOffsetAngle = 0;\n        this.textBox = new TextBox('', this);\n\n        if(mouse) {\n            this.setAnchorPoint(mouse.x, mouse.y);\n        }\n    }\n\n    SelfLink.prototype.setMouseStart = function(x, y) {\n        this.mouseStartX = x;\n        this.mouseStartY = y;\n    };\n\n    SelfLink.prototype.setAnchorPoint = function(x, y) {\n        this.anchorAngle = Math.atan2(y - this.node.y, x - this.node.x) + this.mouseOffsetAngle;\n        // Snap to 90 degrees.\n        var snap = Math.round(this.anchorAngle / (Math.PI / 2)) * (Math.PI / 2);\n        if(Math.abs(this.anchorAngle - snap) < 0.1) {\n            this.anchorAngle = snap;\n        }\n        // Keep in the range -pi to pi so our containsPoint() function always works.\n        if(this.anchorAngle < -Math.PI) {\n            this.anchorAngle += 2 * Math.PI;\n        }\n        if(this.anchorAngle > Math.PI) {\n            this.anchorAngle -= 2 * Math.PI;\n        }\n    };\n\n    SelfLink.prototype.getEndPointsAndCircle = function() {\n        var circleX = this.node.x + 1.5 * this.parent.nodeRadius() * Math.cos(this.anchorAngle);\n        var circleY = this.node.y + 1.5 * this.parent.nodeRadius() * Math.sin(this.anchorAngle);\n        var circleRadius = 0.75 * this.parent.nodeRadius();\n        var startAngle = this.anchorAngle - Math.PI * 0.8;\n        var endAngle = this.anchorAngle + Math.PI * 0.8;\n        var startX = circleX + circleRadius * Math.cos(startAngle);\n        var startY = circleY + circleRadius * Math.sin(startAngle);\n        var endX = circleX + circleRadius * Math.cos(endAngle);\n        var endY = circleY + circleRadius * Math.sin(endAngle);\n        return {\n            'hasCircle': true,\n            'startX': startX,\n            'startY': startY,\n            'endX': endX,\n            'endY': endY,\n            'startAngle': startAngle,\n            'endAngle': endAngle,\n            'circleX': circleX,\n            'circleY': circleY,\n            'circleRadius': circleRadius\n        };\n    };\n\n    SelfLink.prototype.draw = function(c) {\n        var linkInfo = this.getEndPointsAndCircle();\n        // Draw arc.\n        c.beginPath();\n        c.arc(linkInfo.circleX, linkInfo.circleY, linkInfo.circleRadius, linkInfo.startAngle, linkInfo.endAngle, false);\n        c.stroke();\n        // Draw the text on the loop.\n        var relDist = this.textBox.relDist;\n        var textAngle = linkInfo.startAngle * (1 - relDist) + linkInfo.endAngle * relDist;\n        var textX = linkInfo.circleX + linkInfo.circleRadius * Math.cos(textAngle);\n        var textY = linkInfo.circleY + linkInfo.circleRadius * Math.sin(textAngle);\n        this.textBox.draw(textX, textY, textAngle, this);\n        // Draw the head of the arrow.\n        this.parent.arrowIfReqd(c, linkInfo.endX, linkInfo.endY, linkInfo.endAngle + Math.PI * 0.4);\n    };\n\n    SelfLink.prototype.containsPoint = function(x, y) {\n        var linkInfo = this.getEndPointsAndCircle();\n        var dx = x - linkInfo.circleX;\n        var dy = y - linkInfo.circleY;\n        var distance = Math.sqrt(dx * dx + dy * dy) - linkInfo.circleRadius;\n        return (Math.abs(distance) < this.parent.HIT_TARGET_PADDING);\n    };\n\n    /***********************************************************************\n     *\n     * Define a class StartLink that represents a start link in a finite\n     * state machine. Not useful in general digraphs.\n     *\n     ***********************************************************************/\n    function StartLink(parent, node, start) {\n        this.parent = parent;\n        this.node = node;\n        this.deltaX = 0;\n        this.deltaY = 0;\n\n        if(start) {\n            this.setAnchorPoint(start.x, start.y);\n        }\n    }\n\n    StartLink.prototype.setAnchorPoint = function(x, y) {\n        this.deltaX = x - this.node.x;\n        this.deltaY = y - this.node.y;\n\n        if(Math.abs(this.deltaX) < this.parent.SNAP_TO_PADDING) {\n            this.deltaX = 0;\n        }\n\n        if(Math.abs(this.deltaY) < this.parent.SNAP_TO_PADDING) {\n            this.deltaY = 0;\n        }\n    };\n\n    StartLink.prototype.getEndPoints = function() {\n        var startX = this.node.x + this.deltaX;\n        var startY = this.node.y + this.deltaY;\n        var end = this.node.closestPointOnCircle(startX, startY);\n        return {\n            'startX': startX,\n            'startY': startY,\n            'endX': end.x,\n            'endY': end.y,\n        };\n    };\n\n    StartLink.prototype.draw = function(c) {\n        var endPoints = this.getEndPoints();\n\n        // Draw the line.\n        c.beginPath();\n        c.moveTo(endPoints.startX, endPoints.startY);\n        c.lineTo(endPoints.endX, endPoints.endY);\n        c.stroke();\n\n        // Draw the head of the arrow.\n        this.parent.arrowIfReqd(c, endPoints.endX, endPoints.endY, Math.atan2(-this.deltaY, -this.deltaX));\n    };\n\n    StartLink.prototype.containsPoint = function(x, y) {\n        var endPoints = this.getEndPoints();\n        var dx = endPoints.endX - endPoints.startX;\n        var dy = endPoints.endY - endPoints.startY;\n        var length = Math.sqrt(dx * dx + dy * dy);\n        var percent = (dx * (x - endPoints.startX) + dy * (y - endPoints.startY)) / (length * length);\n        var distance = (dx * (y - endPoints.startY) - dy * (x - endPoints.startX)) / length;\n        return (percent > 0 && percent < 1 && Math.abs(distance) < this.parent.HIT_TARGET_PADDING);\n    };\n\n    /***********************************************************************\n     *\n     * Define a class TemporaryLink that represents a link that's in the\n     * process of being created.\n     *\n     ***********************************************************************/\n\n    function TemporaryLink(parent, from, to) {\n        this.parent = parent;\n        this.from = from;\n        this.to = to;\n    }\n\n    TemporaryLink.prototype.draw = function(c) {\n        // Draw the line.\n        c.beginPath();\n        c.moveTo(this.to.x, this.to.y);\n        c.lineTo(this.from.x, this.from.y);\n        c.stroke();\n\n        // Draw the head of the arrow.\n        this.parent.arrowIfReqd(c, this.to.x, this.to.y, Math.atan2(this.to.y - this.from.y, this.to.x - this.from.x));\n    };\n\n    /***********************************************************************\n     *\n     * Define a class Button for a pseudo-menu button.\n     *\n     ***********************************************************************/\n\n    function Button(parent, topX, topY, text) {\n      this.BUTTON_WIDTH = 60;\n      this.BUTTON_HEIGHT = 25;\n      this.TEXT_OFFSET_X = 30;\n      this.TEXT_OFFSET_Y = 17;\n      this.topX = topX;\n      this.topY = topY;\n      this.parent = parent;\n      this.text = text;\n      this.highLighted = false;\n    }\n\n    Button.prototype.containsPoint = function(x, y) {\n        return util.isInside({x: x, y: y},\n          {x: this.topX, y: this.topY, width: this.BUTTON_WIDTH, height: this.BUTTON_HEIGHT});\n    };\n\n    Button.prototype.draw = function(c) {\n        if (this.highLighted) {\n            c.fillStyle = '#FFFFFF';\n        } else {\n            c.fillStyle = '#F0F0F0';\n        }\n        c.fillRect(this.topX, this.topY,\n            this.BUTTON_WIDTH, this.BUTTON_HEIGHT);\n        c.lineWidth = 0.5;\n        c.strokeStyle = '#000000';\n        c.strokeRect(this.topX, this.topY,\n            this.BUTTON_WIDTH, this.BUTTON_HEIGHT);\n\n        c.font = '12pt Arial';\n        c.fillStyle = '#000000';\n        c.textAlign = \"center\";\n        c.fillText(this.text, this.topX + this.TEXT_OFFSET_X, this.topY + this.TEXT_OFFSET_Y);\n        c.textAlign = \"left\";\n    };\n\n    Button.prototype.onClick = function() {\n\n    };\n\n    /***********************************************************************\n     *\n     * Define a class HelpBox for the help box and its pseudo-menu button.\n     *\n     ***********************************************************************/\n\n    function HelpBox(parent, topX, topY) {\n      Button.call(this, parent, topX, topY, \"Help\");\n      this.helpOpen = false;\n      this.LINE_HEIGHT = 18;\n      this.HELP_INDENT = 5;\n    }\n\n    HelpBox.prototype = new Button();\n\n    HelpBox.prototype.draw = function(c) {\n        var lines, i, y, helpText;\n\n        Button.prototype.draw.call(this, c);\n\n        if (this.helpOpen) {\n            helpText = this.parent.helpText;\n            c.font = '12pt Arial';\n            lines = helpText.split('\\n');\n            y = this.topY + this.BUTTON_HEIGHT;\n            for (i = 0; i < lines.length; i += 1) {\n                y += this.LINE_HEIGHT;\n                c.fillText(lines[i], this.topX + this.HELP_INDENT, y);\n            }\n        }\n    };\n\n    HelpBox.prototype.onClick = function() {\n        this.helpOpen = ! this.helpOpen;\n        this.parent.draw();\n    };\n\n\n    /***********************************************************************\n     *\n     * Define a class TextBox for a possibly editable text box that might\n     * be contained in another element\n     *\n     ***********************************************************************/\n\n    function TextBox(text, parent) {\n        this.text = text;\n        this.parent = parent;\n        this.caretPosition = text.length;\n        this.relDist = 0.5;\n        this.offset = parent.parent.textOffset();\n        this.dragged = false;\n        this.boundingBox = {};\n    }\n\n    // Inserts a given character into the TextBox at its current caretPosition\n    TextBox.prototype.insertChar = function(char) {\n        this.text = this.text.slice(0, this.caretPosition) + char + this.text.slice(this.caretPosition);\n        this.caretRight();\n    };\n\n    // Deletes the character in the TextBox that is located behind the current caretPosition\n    TextBox.prototype.deleteChar = function() {\n        if (this.caretPosition > 0){\n            this.text = this.text.slice(0, this.caretPosition - 1) + this.text.slice(this.caretPosition);\n            this.caretLeft();\n        }\n    };\n\n    // Moves the TextBox's caret left one character if possible\n    TextBox.prototype.caretLeft = function() {\n        if (this.caretPosition > 0) {\n            this.caretPosition --;\n        }\n    };\n\n    // Moves the TextBox's caret right one character if possible\n    TextBox.prototype.caretRight = function() {\n        if (this.caretPosition < this.text.length) {\n            this.caretPosition ++;\n        }\n    };\n\n    TextBox.prototype.containsPoint = function(x, y) {\n        var point = {x: x, y: y};\n        return util.isInside(point, this.boundingBox);\n    };\n\n    TextBox.prototype.setMouseStart = function(x, y) {\n      // At the start of a drag, record our position relative to the mouse.\n        this.mouseOffsetX = this.position.x - x;\n        this.mouseOffsetY = this.position.y - y;\n    };\n\n    TextBox.prototype.setAnchorPoint = function(x, y) {\n        x += (this.mouseOffsetX || 0);\n        y += (this.mouseOffsetY || 0);\n        var linkInfo = this.parent.getEndPointsAndCircle();\n        var relDist, offset;\n        //Calculate the relative distance of the dragged text along its parent link\n        if (linkInfo.hasCircle){\n            var textAngle = Math.atan2(y-linkInfo.circleY, x-linkInfo.circleX);\n            // Ensure textAngle is either between start and end angle, or more than end angle\n            if (textAngle < linkInfo.startAngle) {\n                textAngle += Math.PI * 2;\n            }\n            if (linkInfo.endAngle < linkInfo.startAngle) {\n                linkInfo.endAngle += Math.PI * 2;\n            }\n            // Calculate relDist from angle (inverse of angle-from-relDist calculation in Link.prototype.draw)\n            if (linkInfo.isReversed){\n                relDist = (textAngle - linkInfo.startAngle - Math.PI*2) / (linkInfo.endAngle - linkInfo.startAngle - Math.PI*2);\n            }else{\n                relDist = (textAngle - linkInfo.startAngle) / (linkInfo.endAngle - linkInfo.startAngle);\n            }\n            offset = util.vectorMagnitude({x: x-linkInfo.circleX, y: y-linkInfo.circleY}) - linkInfo.circleRadius;\n        }\n        else {\n            // Calculate relative position of the mouse projected onto the link.\n            var textVector = {x: x - linkInfo.startX,\n                              y: y - linkInfo.startY};\n            var linkVector = {x: linkInfo.endX - linkInfo.startX,\n                              y: linkInfo.endY - linkInfo.startY};\n            var projection = util.scalarProjection(textVector, linkVector);\n            relDist = projection / util.vectorMagnitude(linkVector);\n            // Calculate offset (closest distance) of the mouse position from the link\n            offset = Math.sqrt(Math.pow(util.vectorMagnitude(textVector), 2)- Math.pow(projection, 2));\n            // If the mouse is on the opposite side of the link from the default text position, negate the offset\n            var ccw = util.isCCW(textVector, linkVector);\n            var reversed = (this.parent.lineAngleAdjust != 0);\n            if ((!ccw && reversed) || (ccw && !reversed)){\n                offset *= -1;\n            }\n        }\n        if (relDist > 0 && relDist < 1){  //Ensure text isn't dragged past end of the link\n            this.relDist = relDist;\n            this.offset = Math.round(offset);\n            this.dragged = true;\n        }\n    };\n\n    TextBox.prototype.draw = function(x, y, angleOrNull, parentObject) {\n        var graph = parentObject.parent,\n            c = graph.getCanvas().getContext('2d');\n\n        c.font = graph.fontSize() + 'px Arial';\n        //Text before and after caret are drawn separately to expand Latex shortcuts at the caret position\n        var beforeCaretText = util.convertLatexShortcuts(this.text.slice(0, this.caretPosition));\n        var afterCaretText = util.convertLatexShortcuts(this.text.slice(this.caretPosition));\n        var width = c.measureText(beforeCaretText + afterCaretText).width;\n        var dy = Math.round(graph.fontSize() / 2);\n\n        // Position the text appropriately if it is part of a link\n        if(angleOrNull !== null) {\n            var cos = Math.cos(angleOrNull);\n            var sin = Math.sin(angleOrNull);\n\n            //Add text offset in the direction of the text angle\n            x += this.offset * cos;\n            y += this.offset * sin;\n\n            // Position text intelligently if text has not been manually moved\n            if (!this.dragged){\n                var cornerPointX = (width / 2) * (cos > 0 ? 1 : -1);\n                var cornerPointY = (dy / 2) * (sin > 0 ? 1 : -1);\n                var slide = sin * Math.pow(Math.abs(sin), 40) * cornerPointX - cos * Math.pow(Math.abs(cos), 10) * cornerPointY;\n                x += cornerPointX - sin * slide;\n                y += cornerPointY + cos * slide;\n            }\n            this.position = {x: Math.round(x), y: Math.round(y)};  //Record the position where text is anchored to\n        }\n\n        x -= width / 2;  // Center the text.\n\n        //Round the coordinates so they fall on a pixel\n        x = Math.round(x);\n        y = Math.round(y);\n\n        // Draw text and caret\n        if('advancedFillText' in c) {\n            c.advancedFillText(this.text, this.text, x + width / 2, y, angleOrNull);\n        } else {\n             // Draw translucent white rectangle behind text\n            var prevStyle = c.fillStyle;\n            c.fillStyle = \"rgba(255, 255, 255, 0.7)\";\n            c.fillRect(x, y-dy, width, dy*2);\n            c.fillStyle = prevStyle;\n\n            // Draw text\n            dy = Math.round(graph.fontSize() / 3); // Don't understand this.\n            c.fillText(beforeCaretText, x, y + dy);\n            var caretX = x + c.measureText(beforeCaretText).width;\n            c.fillText(afterCaretText, caretX, y + dy);\n\n            // Draw caret\n            dy = Math.round(graph.fontSize() / 2);\n            if(parentObject == graph.selectedObject && graph.caretVisible && graph.hasFocus() && document.hasFocus()) {\n                c.beginPath();\n                c.moveTo(caretX, y - dy);\n                c.lineTo(caretX, y + dy);\n                c.stroke();\n            }\n        }\n        this.boundingBox = {x: x, y: y - dy, height: dy * 2, width: width};\n    };\n\n\n    return {\n        Node: Node,\n        Link: Link,\n        SelfLink: SelfLink,\n        TemporaryLink: TemporaryLink,\n        StartLink: StartLink,\n        Button: Button,\n        HelpBox: HelpBox,\n        TextBox: TextBox\n    };\n});\n"],"file":"graphelements.min.js"}