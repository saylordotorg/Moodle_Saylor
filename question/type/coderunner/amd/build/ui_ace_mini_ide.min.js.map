{"version":3,"sources":["../src/ui_ace_mini_ide.js"],"names":["define","$","ajax","AceMiniIdeWrapper","textareaId","w","h","params","textarea","document","getElementById","wrapper","focused","activeElement","lang","button","button_div","session","ide_response_div","t","window","ace","require","modelist","enabled","contents_changed","capturingTab","clickInProgress","language","editNode","editor","edit","get","prop","setReadOnly","setOptions","enableBasicAutocompletion","newLineMode","$blockScrolling","workArea","append","ide_response","css","resize","height","width","getSession","setValue","val","theme","setTheme","setLanguage","setEventHandlers","setMiniIdeHandlers","captureTab","renderer","on","gutter","find","hasClass","addClass","focus","navigateFileEnd","aceLabel","attr","aceTextarea","fail","err","alert","prototype","failed","failMessage","sync","syncIntervalSecs","mode","findMode","setMode","getElement","commands","bindKeys","releaseTab","getValue","trigger","container","addEventListener","e","which","keyCode","ctrlKey","altKey","preventDefault","shiftKey","that","code","call","methodname","args","sourcecode","stdin","done","responseJson","response","JSON","parse","text","cmpinfo","output","stderr","error","destroy","isFocused","remove","selectionStart","value","length","hasFocus","candidate","filename","result","candidates","nameMap","toLowerCase","replace","i","modesByName","getModeForPath","name","outerHeight","outerWidth","Constructor"],"mappings":"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","sourcesContent":["/**\n * This file is part of Moodle - http:moodle.org/\n *\n * Moodle is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Moodle is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Moodle.  If not, see <http:www.gnu.org/licenses/>.\n */\n\n/**\n * An alternative interface to the Ace editor that provides a few basic\n * IDE capabilities, such as running the existing file on the Jobe server\n * without its being an actual check or precheck.\n * EXPERIMENTAL!\n * The class defined in this module is a plugin for the InterfaceWrapper class\n * declared in userinterfacewrapper.js. See that file for an explanation of\n * the interface to this module.\n *\n * A special case behaviour of the AceMiniIdeWrapper is that it needs to know\n * the Programming language that is being edited. This MUST be provided in\n * the constructor params parameter (an associative array) as a string\n * with key 'lang'.\n *\n * @module qtype_coderunner/ui_ace_mini_ide\n * @copyright  Richard Lobb, 2015, 2017, The University of Canterbury\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * WARNING: The ace editor must have already been loaded before this\n * module is used, as it assumes window.ace exists.\n */\n\ndefine(['jquery', 'core/ajax'], function($, ajax) {\n\n    /**\n     * Constructor for the Ace interface object.\n     * @param {string} textareaId The ID of the textarea HTML element.\n     * @param {int} w The width of the textarea in pixels.\n     * @param {int} h The height of the textarea in pixels.\n     * @param {object} params The UI parameters object.\n     */\n    function AceMiniIdeWrapper(textareaId, w, h, params) {\n        var textarea = $(document.getElementById(textareaId)),\n            wrapper = $(document.getElementById(textareaId + '_wrapper')),\n            focused = textarea[0] === document.activeElement,\n            lang = params.lang,\n            button = $('<button type=\"button\" class=\"qtype-coderunner-ide-button\">Run code</button>'),\n            button_div = $('<div class=\"qtype-coderunner-ide-buttons\"></div>'),\n            session,\n            ide_response_div,\n            t = this;  // For embedded callbacks.\n\n        try {\n            window.ace.require(\"ace/ext/language_tools\");\n            this.modelist = window.ace.require('ace/ext/modelist');\n\n            this.textarea = textarea;\n            this.enabled = false;\n            this.contents_changed = false;\n            this.capturingTab = false;\n            this.clickInProgress = false;\n            this.language = lang;\n\n            this.editNode = $(\"<div></div>\"); // Ace editor manages this\n\n            this.editor = window.ace.edit(this.editNode.get(0));\n            if (textarea.prop('readonly')) {\n                this.editor.setReadOnly(true);\n            }\n\n            this.editor.setOptions({\n                enableBasicAutocompletion: true,\n                newLineMode: \"unix\",\n            });\n\n            this.editor.$blockScrolling = Infinity;\n\n            /**\n             * Build the work area consisting of Ace + the mini-IDE\n             */\n            this.workArea = $('<div></div>');\n            this.workArea.append(this.editNode);\n            this.button = button;\n            button_div.append(button);\n            this.workArea.append(button_div); // Add the mini-ide buttons.\n            this.ide_response = $('<textarea rows=\"5\" class=\"edit_code\" style=\"width:100%\"></textarea>');\n            ide_response_div = $('<div></div>');\n            ide_response_div.append(this.ide_response);\n            this.workArea.append(ide_response_div);\n            this.editNode.css({\n                resize: 'none',\n                height: h / 2,\n                width: \"100%\"\n            });\n\n            session = this.editor.getSession();\n            session.setValue(this.textarea.val());\n\n            /**\n             * Set theme if available (not currently enabled).\n             */\n            if (params.theme) {\n                this.editor.setTheme(\"ace/theme/\" + params.theme);\n            }\n\n            this.setLanguage(lang);\n\n            this.setEventHandlers();\n            this.setMiniIdeHandlers();\n            this.captureTab();\n\n            /**\n             * Try to tell Moodle about parts of the editor with z-index.\n             * It is hard to be sure if this is complete. ACE adds all its CSS using JavaScript.\n             * Here, we just deal with things that are known to cause a problem.\n             * Can't do these operations until editor has rendered. So ...\n             */\n            this.editor.renderer.on('afterRender', function() {\n                var gutter =  wrapper.find('.ace_gutter');\n                if (gutter.hasClass('moodle-has-zindex')) {\n                    return;  // So we only do what follows once.\n                }\n                gutter.addClass('moodle-has-zindex');\n\n                if (focused) {\n                    t.editor.focus();\n                    t.editor.navigateFileEnd();\n                }\n                t.aceLabel = wrapper.find('.answerprompt');\n                t.aceLabel.attr('for', 'ace_' + textareaId);\n\n                t.aceTextarea = wrapper.find('.ace_text-input');\n                t.aceTextarea.attr('id', 'ace_' + textareaId);\n            });\n\n            this.fail = false;\n        }\n        catch(err) {\n            /**\n             * Something ugly happened. Probably ace editor hasn't been loaded\n             */\n            alert(err);\n            this.fail = true;\n        }\n    }\n\n\n    AceMiniIdeWrapper.prototype.failed = function() {\n        return this.fail;\n    };\n\n    AceMiniIdeWrapper.prototype.failMessage = function() {\n        return 'ace_ui_notready';\n    };\n\n\n    /**\n     * Sync to TextArea\n     */\n    AceMiniIdeWrapper.prototype.sync = function() {\n        /**\n         * Nothing to do ... always sync'd\n         */\n    };\n\n    /**\n     * Disable autosync, too.\n     */\n    AceMiniIdeWrapper.prototype.syncIntervalSecs = function() {\n        return 0;\n    };\n\n    AceMiniIdeWrapper.prototype.setLanguage = function(language) {\n        var session = this.editor.getSession(),\n            mode = this.findMode(language);\n        if (mode) {\n            session.setMode(mode.mode);\n        }\n        this.language = language;\n    };\n\n    AceMiniIdeWrapper.prototype.getElement = function() {\n        return this.workArea;\n    };\n\n    AceMiniIdeWrapper.prototype.captureTab = function () {\n        this.capturingTab = true;\n        this.editor.commands.bindKeys({'Tab': 'indent', 'Shift-Tab': 'outdent'});\n    };\n\n    AceMiniIdeWrapper.prototype.releaseTab = function () {\n        this.capturingTab = false;\n        this.editor.commands.bindKeys({'Tab': null, 'Shift-Tab': null});\n    };\n\n    AceMiniIdeWrapper.prototype.setEventHandlers = function () {\n        var TAB = 9,\n            ESC = 27,\n            KEY_M = 77,\n            t = this;\n\n        this.editor.getSession().on('change', function() {\n            t.textarea.val(t.editor.getSession().getValue());\n            t.contents_changed = true;\n        });\n\n        this.editor.on('blur', function() {\n            if (t.contents_changed) {\n                t.textarea.trigger('change');\n            }\n        });\n\n        this.editor.on('mousedown', function() {\n            /**\n             * Event order seems to be (\\ is where the mouse button is pressed, / released):\n             * Chrome: \\ mousedown, mouseup, focusin / click.\n             * Firefox/IE: \\ mousedown, focusin / mouseup, click.\n             */\n            t.clickInProgress = true;\n        });\n\n        this.editor.on('focus', function() {\n            if (t.clickInProgress) {\n                t.captureTab();\n            } else {\n                t.releaseTab();\n            }\n        });\n\n        this.editor.on('click', function() {\n            t.clickInProgress = false;\n        });\n\n        this.editor.container.addEventListener('keydown', function(e) {\n            if (e.which === undefined || e.which !== 0) { // Normal keypress?\n                if (e.keyCode === KEY_M && e.ctrlKey && !e.altKey) {\n                    if (t.capturingTab) {\n                        t.releaseTab();\n                    } else {\n                        t.captureTab();\n                    }\n                    e.preventDefault(); // Firefox uses this for mute audio in current browser tab.\n                }\n                else if (e.keyCode === ESC) {\n                    t.releaseTab();\n                }\n                else if (!(e.shiftKey || e.ctrlKey || e.altKey || e.keyCode == TAB)) {\n                    t.captureTab();\n                }\n            }\n        }, true);\n    };\n\n    AceMiniIdeWrapper.prototype.setMiniIdeHandlers = function() {\n        var that = this;\n        this.button.on('click', function() {\n            var code = that.textarea.val();\n            ajax.call([{\n                methodname: 'qtype_coderunner_run_in_sandbox',\n                args: {sourcecode: code, language: that.language, stdin: ''},\n                done: function(responseJson) {\n                    var response = JSON.parse(responseJson);\n                    var text = response.cmpinfo + response.output + response.stderr;\n                    that.ide_response.val(text);\n                },\n                fail: function(error) { alert(\"We're dead, Fred: \" + error); }\n            }]);\n        });\n    };\n\n\n    AceMiniIdeWrapper.prototype.destroy = function () {\n        var focused;\n        if (!this.fail) {\n            /**\n             * Proceed only if this wrapper was correctly constructed\n             */\n            focused = this.editor.isFocused();\n            this.textarea.val(this.editor.getSession().getValue()); // Copy data back\n            this.editor.destroy();\n            $(this.workArea).remove();\n            if (focused) {\n                this.textarea.focus();\n                this.textarea[0].selectionStart = this.textarea[0].value.length;\n            }\n        }\n    };\n\n    AceMiniIdeWrapper.prototype.hasFocus = function() {\n        return this.editor.isFocused();\n    };\n\n    AceMiniIdeWrapper.prototype.findMode = function (language) {\n        var candidate,\n            filename,\n            result,\n            candidates = [], // List of candidate modes.\n            nameMap = {\n                'octave': 'matlab',\n                'nodejs': 'javascript',\n                'c#': 'cs'\n            };\n\n        if (typeof language !== 'string') {\n            return undefined;\n        }\n        if (language.toLowerCase() in nameMap) {\n            language = nameMap[language.toLowerCase()];\n        }\n\n        candidates = [language, language.replace(/\\d+$/, \"\")];\n        for (var i = 0; i < candidates.length; i++) {\n            candidate = candidates[i];\n            filename = \"input.\" + candidate;\n            result = this.modelist.modesByName[candidate] ||\n                this.modelist.modesByName[candidate.toLowerCase()] ||\n                this.modelist.getModeForPath(filename) ||\n                this.modelist.getModeForPath(filename.toLowerCase());\n\n            if (result && result.name !== 'text') {\n                return result;\n            }\n        }\n        return undefined;\n    };\n\n\n    AceMiniIdeWrapper.prototype.resize = function(w, h) {\n        this.workArea.outerHeight(h);\n        this.workArea.outerWidth(w);\n        this.editNode.css({\n                resize: 'none',\n                height: h / 2,\n                width: \"100%\"\n            });\n        this.ide_response.css({\n                resize: 'none',\n                height: h / 2,\n                width: \"100%\"\n            });\n        this.editor.resize();\n    };\n\n     return {\n        Constructor: AceMiniIdeWrapper\n    };\n});\n"],"file":"ui_ace_mini_ide.min.js"}