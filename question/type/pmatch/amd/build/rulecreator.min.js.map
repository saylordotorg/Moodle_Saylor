{"version":3,"sources":["../src/rulecreator.js"],"names":["define","$","t","store","init","each","id","attr","replace","val","parent","next","addClass","rc","find","click","termAdd","termExclude","termOr","templateAdd","templateExclude","precedesAdd","cprecedesAdd","addToAnswer","clear","e","wrapper","target","closest","icon","src","slideToggle","indexOf","slice","term","getTerm","focus","termid","addToStore","addToPrecedes","displayResult","disablePrecedes","terms","getPrecedesChoices","removeFromPrecedes","result","text","change","resetPrecedes","type","getStoreLength","M","util","get_string","trim","term1","term2","append","value","prop","remove","i","op","ref","length","push","getStoredResult","rule","temp","mystore","num","first","second","orpos","orcount","currentterm"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This class provides functionality for the rule creation assistant.\n *\n * This is based on the work of Dr Alistair Willis published:\n * http://aclweb.org/anthology/W/W15/W15-0628.pdf\n *\n * @module    qtype_pmatch\n * @class     rulecreator\n * @package   question\n * @copyright 2016 The Open University\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since     2.9\n */\ndefine(['jquery'], function($) {\n\n    /**\n     * @alias qtype_pmatch/rulecreator\n     */\n    var t = {\n        store: {},\n\n        /**\n         * Initialise the rule creation assistant.\n         */\n        init: function() {\n            $('textarea[name^=\"answer\"]').each(function() {\n                var id = $(this).attr('id').replace('id_answer_', '');\n                var ref = 'id_' + id;\n                t.store[ref] = [];\n                // Hide the 'show/hide rule creator assistant' unless there is no existing rule.\n                // It would be much better to not show this element unless js is enabled, but\n                // using a static element means we cannot add classes to enable this.\n                if ($(this).val() !== '') {\n                    $(this).parent().parent().next().addClass('rc-hidden');\n                } else {\n                    $(this).parent().parent().next().addClass('rcw');\n                }\n                var rc = $(this).parent().parent().next().find('div.rule-creator');\n                // Add ids to make things easier, and add button clicks.\n                rc.attr('id', 'rc_' + id);\n                $(this).parent().parent().next().find('a.rule-creator-btn').attr('id', 'rc_btn_' + id);\n                rc.find('div[class=\"rc-notice\"]').attr('id', 'rc_notice_' + id);\n                rc.find('label[for=\"term\"]').attr('for', 'rc_term_' + id);\n                rc.find('input[name=\"term\"]').attr('id', 'rc_term_' + id);\n                rc.find('input[name=\"termadd\"]').attr('id', 'rc_termadd_' + id).click(function() {\n                    t.termAdd(id);\n                    return false;\n                });\n                rc.find('input[name=\"termexclude\"]').attr('id', 'rc_termexclude_' + id).click(function() {\n                    t.termExclude(id);\n                    return false;\n                });\n                rc.find('input[name=\"termor\"]').attr('id', 'rc_termor_' + id).click(function() {\n                    t.termOr(id);\n                    return false;\n                });\n                rc.find('label[for=\"template\"]').attr('for', 'rc_template_' + id);\n                rc.find('input[name=\"template\"]').attr('id', 'rc_template_' + id);\n                rc.find('input[name=\"templateadd\"]').attr('id', 'rc_templateadd_' + id).click(function() {\n                    t.templateAdd(id);\n                    return false;\n                });\n                rc.find('input[name=\"templateexclude\"]').attr('id', 'rc_templateexclude_' + id).click(function() {\n                    t.templateExclude(id);\n                    return false;\n                });\n                rc.find('label[for=\"precedesadd\"]').attr('for', 'rc_precedes1_' + id);\n                rc.find('select[name=\"precedes1\"]').attr('id', 'rc_precedes1_' + id);\n                rc.find('select[name=\"precedes2\"]').attr('id', 'rc_precedes2_' + id);\n                rc.find('input[name=\"precedesadd\"]').attr('id', 'rc_precedesadd_' + id).click(function() {\n                    t.precedesAdd(id);\n                    return false;\n                });\n                rc.find('label[for=\"cprecedesadd\"]').attr('for', 'rc_cprecedes1_' + id);\n                rc.find('select[name=\"cprecedes1\"]').attr('id', 'rc_cprecedes1_' + id);\n                rc.find('select[name=\"cprecedes2\"]').attr('id', 'rc_cprecedes2_' + id);\n                rc.find('input[name=\"cprecedesadd\"]').attr('id', 'rc_cprecedesadd_' + id).click(function() {\n                    t.cprecedesAdd(id);\n                    return false;\n                });\n                rc.find('div.rc-result').attr('id', 'rc_result_' + id);\n                rc.find('input[name=\"add\"]').attr('id', 'rc_add_' + id).click(function() {\n                    t.addToAnswer(id);\n                    return false;\n                });\n                rc.find('input[name=\"clear\"]').attr('id', 'rc_clear_' + id).click(function() {\n                    t.clear(id);\n                    return false;\n                });\n            });\n            $('.rule-creator-btn').click(function (e) {\n                var wrapper = $(e.target).closest('.fitem.rcw'),\n                    icon = $(e.target).closest('.rule-creator-btn').find('img.icon'),\n                    src = icon.attr('src');\n                wrapper.find('.rule-creator').slideToggle();\n                if (src === undefined) {\n                    return false;\n                }\n                if (src.indexOf('collapsed') > 0) {\n                    src = src.slice(0, -9) + 'expanded';\n                } else {\n                    src = src.slice(0, -8) + 'collapsed';\n                }\n                icon.attr('src', src);\n                return false;\n            });\n        },\n\n        termAdd: function(id) {\n            var term = this.getTerm(id, 'term');\n            if (!term) {\n                $('#rc_term_' + id).focus();\n                return;\n            }\n            var termid = this.addToStore(id, term, 'and', 'term');\n            this.addToPrecedes(id, termid, term);\n            this.displayResult(id);\n            $('#rc_term_' + id).val('');\n        },\n\n        termExclude: function(id) {\n            var term = this.getTerm(id, 'term');\n            if (!term) {\n                $('#rc_term_' + id).focus();\n                return;\n            }\n            this.addToStore(id, term, 'not', 'term');\n            this.disablePrecedes(id, true);\n            this.displayResult(id);\n            $('#rc_term_' + id).val('');\n        },\n\n        termOr: function(id) {\n            var term = this.getTerm(id, 'term');\n            if (!term) {\n                $('#rc_term_' + id).focus();\n                return;\n            }\n            var termid = this.addToStore(id, term, 'or', 'term');\n            this.addToPrecedes(id, termid, term);\n            this.displayResult(id);\n            $('#rc_term_' + id).val('');\n        },\n\n        templateAdd: function(id) {\n            var term = this.getTerm(id, 'template');\n            if (!term) {\n                $('#rc_template_' + id).focus();\n                return;\n            }\n            var termid = this.addToStore(id, term, 'and', 'template');\n            this.addToPrecedes(id, termid, term);\n            this.displayResult(id);\n            $('#rc_template_' + id).val('');\n        },\n\n        templateExclude: function(id) {\n            var term = this.getTerm(id, 'template');\n            if (!term) {\n                $('#rc_template_' + id).focus();\n                return;\n            }\n            this.addToStore(id, term, 'not', 'template');\n            this.disablePrecedes(id, true);\n            this.displayResult(id);\n            $('#rc_template_' + id).val('');\n        },\n\n        precedesAdd: function(id) {\n            var terms = this.getPrecedesChoices(id, 'precedes');\n            if (!terms) {\n                return;\n            }\n            this.addToStore(id, terms, 'and', 'precedes');\n            this.removeFromPrecedes(id, terms);\n            this.displayResult(id);\n        },\n\n        cprecedesAdd: function(id) {\n            var terms = this.getPrecedesChoices(id, 'cprecedes');\n            if (!terms) {\n                return;\n            }\n            this.addToStore(id, terms, 'and', 'cprecedes');\n            this.removeFromPrecedes(id, terms);\n            this.displayResult(id);\n        },\n\n        addToAnswer: function(id) {\n            var result = $('#rc_result_' + id).text();\n            if (result === null || result === '') {\n                return;\n            }\n            $('#id_answer_' + id).val(result);\n            this.clear();\n            $('#rc_btn_' + id).click();\n            $('#id_fraction_' + id).val('1.0').change();\n            $('#id_answer_' + id).focus();\n        },\n\n        clear: function(id) {\n            var ref = 'id_' + id;\n            this.store[ref] = [];\n            $('#rc_term_' + id).val('');\n            $('#rc_template_' + id).val('');\n            $('#rc_result_' + id).text('');\n            this.resetPrecedes(id);\n        },\n\n        getTerm: function(id, type) {\n            // Amati limits the number of terms to a max of 6.\n            if (this.getStoreLength(id) > 4) {\n                $('#rc_notice_' + id).text(M.util.get_string('rulecreationtoomanyterms', 'qtype_pmatch'));\n                return false;\n            }\n            var term = $('#rc_' + type + '_' + id).val();\n            if (term === undefined || term === null || term === '') {\n                return false;\n            }\n            term = term.trim();\n            if (term === '') {\n                return false;\n            }\n            // Amati allows single character words, but only one word as a term or template.\n            if (term.indexOf(' ') > -1) {\n                return false;\n            }\n            // Note Pmatch relies on an underscore for closely precedes, so these cannot be included\n            // without escaping (\\_). Also applies to | [] ? and * (* is except for templates).\n            // Amati ignores apostrophies, numbers, special and extended characters etc.\n            // It seems to only work with [a-z][A-Z].\n            // Special care with the presence of a \\ may also be required.\n            if (term.indexOf('_') > -1) {\n                term = term.replace(/_/g, '\\\\_');\n            }\n            if (type === 'term') {\n                return term;\n            } else {\n                if (term.slice(-1) === '*') {\n                    return term;\n                } else {\n                    return term + '*';\n                }\n            }\n        },\n\n        getPrecedesChoices: function(id, type) {\n            var term1 = $('#rc_' + type + '1_' + id).val();\n            if (term1 === '0') {\n                $('#rc_' + type + '1_' + id).focus();\n                return false;\n            }\n            var term2 = $('#rc_' + type + '2_' + id).val();\n            if (term2 === '0') {\n                $('#rc_' + type + '2_' + id).focus();\n                return false;\n            }\n            if (term1 === term2) {\n                $('#rc_' + type + '2_' + id).focus();\n                return false;\n            }\n            return [term1, term2];\n        },\n\n        addToPrecedes: function(id, termid, term) {\n            $('#rc_precedes1_' + id).append($('<option>', {value: termid}).text(term));\n            $('#rc_precedes2_' + id).append($('<option>', {value: termid}).text(term));\n            $('#rc_cprecedes1_' + id).append($('<option>', {value: termid}).text(term));\n            $('#rc_cprecedes2_' + id).append($('<option>', {value: termid}).text(term));\n        },\n\n        disablePrecedes: function(id, type) {\n            $('#rc_precedes1_' + id).prop('disabled', type);\n            $('#rc_precedes2_' + id).prop('disabled', type);\n            $('#rc_cprecedes1_' + id).prop('disabled', type);\n            $('#rc_cprecedes2_' + id).prop('disabled', type);\n        },\n\n        resetPrecedes: function(id) {\n            this.disablePrecedes(id, false);\n            $('#rc_precedes1_' + id).find('option[value!=\"0\"]').remove();\n            $('#rc_precedes2_' + id).find('option[value!=\"0\"]').remove();\n            $('#rc_cprecedes1_' + id).find('option[value!=\"0\"]').remove();\n            $('#rc_cprecedes2_' + id).find('option[value!=\"0\"]').remove();\n        },\n\n        removeFromPrecedes: function(id, terms) {\n            var i;\n            for (i = 0; i < 2; i++) {\n                $('#rc_precedes1_' + id + ' option[value=\"' + terms[i] + '\"]').remove();\n                $('#rc_precedes2_' + id + ' option[value=\"' + terms[i] + '\"]').remove();\n                $('#rc_cprecedes1_' + id + ' option[value=\"' + terms[i] + '\"]').remove();\n                $('#rc_cprecedes2_' + id + ' option[value=\"' + terms[i] + '\"]').remove();\n            }\n        },\n\n        addToStore: function(id, term, op, type) {\n            var ref = 'id_' + id;\n            var termid = this.store[ref].length + 1;\n            this.store[ref].push({termid: termid, term: term, op: op, type: type});\n            return termid;\n        },\n\n        getStoreLength: function(id) {\n            var ref = 'id_' + id;\n            return this.store[ref].length;\n        },\n\n        getStoredResult: function(id) {\n            var ref = 'id_' + id;\n            var rule = '';\n            // Temporary store of rule elements.\n            var temp = [];\n            // Clone the bit of the store we are interested in, so we can change elements.\n            var mystore = this.store[ref].slice(0);\n            var num = mystore.length;\n            var i = 0;\n            var first = 0;\n            var second = 0;\n            var orpos = [];\n            var orcount = 0;\n            if (num === 0) {\n                return rule;\n            }\n            for (i = 0; i < num; i++) {\n                var currentterm = '';\n                if (mystore[i].type === 'term') {\n                    if (mystore[i].op === 'and') {\n                        currentterm = 'match_w(' + mystore[i].term + ')';\n                    }\n                    if (mystore[i].op === 'or') {\n                        currentterm = 'match_w(' + mystore[i].term + ')';\n                        if (i > 0) {\n                            // The first item is not really an 'or'.\n                            orpos.push(i);\n                        }\n                    }\n                    if (mystore[i].op === 'not') {\n                        currentterm = 'not(match_w(' + mystore[i].term + '))';\n                    }\n                }\n                if (mystore[i].type === 'template') {\n                    if (mystore[i].op === 'and') {\n                        currentterm = 'match_wm(' + mystore[i].term + ')';\n                    }\n                    if (mystore[i].op === 'not') {\n                        currentterm = 'match_wm(' + mystore[i].term + ')';\n                    }\n                }\n                if (mystore[i].type === 'precedes') {\n                    first = mystore[i].term[0] - 1;\n                    second = mystore[i].term[1] - 1;\n                    currentterm = ' match_w(' + mystore[first].term + ' ' + mystore[second].term + ')';\n                }\n                if (mystore[i].type === 'cprecedes') {\n                    first = mystore[i].term[0] - 1;\n                    second = mystore[i].term[1] - 1;\n                    currentterm = ' match_w(' + mystore[first].term + '_' + mystore[second].term + ')';\n                }\n                temp.push(currentterm);\n            }\n            num = temp.length;\n            // Simplest scenarios first.\n            if (num === 0) {\n                return '';\n            }\n            if (num === 1) {\n                return temp[0];\n            }\n            orcount = orpos.length;\n            if (orcount === 0) {\n                // For term, template, precedes or closely precedes and press 'add' or 'exclude'.\n                // So no 'or' pressed, e.g. a add, b add. (Type a in term, press 'add', then ...)\n                rule = 'match_all(\\n  ' + temp[0];\n                for (i = 1; i < num; i++) {\n                    rule = rule + ' ' + temp[i];\n                }\n                rule = rule + '\\n)';\n                return rule;\n            }\n            if (num === (orcount + 1)) {\n                // For a or, b or; a add, b or, c or.\n                rule = 'match_any(\\n  ' + temp[0];\n                for (i = 1; i < num; i++) {\n                    rule = rule + ' ' + temp[i];\n                }\n                rule = rule + '\\n)';\n                return rule;\n            }\n            // And the more tricky scenarios.\n            if (orcount === 1) {\n                if (orpos[0] === 1) { // Note orpos[0] can never be 0).\n                    if (num === 2) {\n                        // For a add, b or.\n                        rule = 'match_any(\\n  ' + temp[0] + ' ' + temp[1] + '\\n)';\n                    } else {\n                        // For a add, b or, c add.\n                        rule = 'match_all(\\n  match_any(\\n    ' + temp[0] + ' ' + temp[1] + '\\n  )\\n ';\n                        for (i = 2; i < num; i++) {\n                            rule = rule + ' ' + temp[i];\n                        }\n                        rule = rule + '\\n)';\n                    }\n                } else {\n                    // For a add, b add, c or.\n                    rule = 'match_all(\\n    ' + temp[0];\n                    for (i = 1; i < orpos[0]; i++) {\n                        rule = rule + ' ' + temp[i];\n                    }\n                    rule = 'match_any(\\n  ' + rule + '\\n  )\\n  ' + temp[orpos[0]] + '\\n)';\n                    if (num > (orpos[0] + 1)) {\n                        // For a add, b add, c or, d add.\n                        rule = 'match_all(\\n' + rule + '\\n';\n                        for (i = orpos[0] + 1; i < num; i++) {\n                            rule = rule + ' ' + temp[i];\n                        }\n                        rule = rule + '\\n)';\n                    }\n                }\n            } else if (orcount === 2) {\n                if (orpos[0] === 1) {\n                    rule = 'match_any(\\n  ' + temp[0] + ' ' + temp[1];\n                    if (orpos[1] === 2) {\n                        // For a add, b or, c or, d add.\n                        rule = 'match_all(\\n' + rule + ' ' + temp[2] + '\\n)\\n';\n                        for (i = 3; i < num; i++) {\n                            rule = rule + ' ' + temp[i];\n                        }\n                        rule = rule + '\\n)';\n                    } else {\n                        // For a add, b or, c add, d or.\n                        rule = 'match_all(\\n' + rule + '\\n)\\n';\n                        for (i = 2; i < orpos[1]; i++) {\n                            rule = rule + ' ' + temp[i];\n                        }\n                        rule = 'match_any(\\n' + rule + '\\n)\\n ' + temp[orpos[1]];\n                        if (num > (orpos[1] + 1)) {\n                            // For a add, b or, c add, d or, e add.\n                            rule = '\\nmatch_all(\\n' + rule;\n                            for (i = orpos[1] + 1; i < num; i++) {\n                                rule = rule + ' ' + temp[i];\n                            }\n                            rule = rule + '\\n)';\n                        }\n                        rule = rule + '\\n)';\n                    }\n                } else {\n                    // For a add, b add, c or, d or/add.\n                    rule = 'match_all(\\n' + temp[0];\n                    for (i = 1; i < orpos[0]; i++) {\n                        rule = rule + ' ' + temp[i];\n                    }\n                    // For a add, b add, c or.\n                    rule = 'match_any(\\n' + rule + '\\n)\\n  ' + temp[orpos[0]];\n                    if (orpos[1] === orpos[0] + 1) {\n                        // For a add, b add, c or, d or.\n                        rule = rule + ' ' + temp[orpos[1]] + '\\n)\\n';\n                        if (num > (orpos[1] + 1)) {\n                            // For a add, b add, c or, d or, e add.\n                            rule = 'match_all(\\n' + rule;\n                            for (i = orpos[1] + 1; i < num; i++) {\n                                rule = rule + ' ' + temp[i];\n                            }\n                            rule = rule + '\\n)';\n                        }\n                    } else {\n                        rule = 'match_all(\\n' + rule + '\\n)\\n';\n                        for (i = orpos[0] + 1; i < orpos[1]; i++) {\n                            rule = rule + ' ' + temp[i];\n                        }\n                        // For a add, b add, c or, d add, e or.\n                        rule = 'match_any(\\n' + rule + '\\n)\\n' + temp[orpos[1]] + '\\n)\\n';\n                        if (num > (orpos[1] + 1)) {\n                            // For a add, b add, c or, d add, e or, f add.\n                            rule = 'match_all(\\n' + rule;\n                            for (i = orpos[1] + 1; i < num; i++) {\n                                rule = rule + ' ' + temp[i];\n                            }\n                            rule = rule + '\\n)\\n';\n                        }\n                    }\n                }\n            } else {\n                // Currently this simple interface cannot cope with more than two 'or's,\n                // though adding all or's will work.\n                $('#rc_notice_' + id).text(M.util.get_string('rulecreationtoomanyors', 'qtype_pmatch'));\n                return '';\n            }\n            return rule.trim();\n        },\n\n        displayResult: function(id) {\n            var result = this.getStoredResult(id);\n            $('#rc_result_' + id).text(result);\n        }\n    };\n\n    return t;\n});\n"],"file":"rulecreator.min.js"}