define ("qtype_pmatch/creator",["jquery","core/str","core/ajax","core/templates","core/key_codes"],function(a,b,c,d,f){var g={newRowId:"",idxLastRow:0,questionId:"",init:function init(){g.questionId=a("#attemptsform input[name=\"id\"]").val();g.table=a("#responses");g.idxLastRow=g.table.find("tbody tr").length-1;g.disableControlButtonAndSelectionBox();a("#newresponsebutton").click(function(b){b.preventDefault();g.idxLastRow++;g.newRowId="qtype-pmatch-new-response_"+g.idxLastRow;d.render("qtype_pmatch/newresponse",{newrowid:g.newRowId}).done(function(b){g.table.append(b);a("html, body").animate({scrollTop:a("#"+g.newRowId).offset().top},800);a(".new-expectedfraction").focus();M.core_formchangechecker.set_form_changed()});g.disableControlButtons(!0)});var b=null;a(document).on("keyup paste",".new-response",function(){var c=a(this).val().trim();if(b){M.util.js_complete("checkresponse");clearTimeout(b)}M.util.js_pending("checkresponse");b=setTimeout(function(){if(""===c){g.handleSaveNewResponseButton(!1,"")}else{g.checkResponse(c)}M.util.js_complete("checkresponse")},500)});a(document).on("keydown",".new-response",function(a){if(a.keyCode==f.enter){g.saveNewResponse();return!1}});a(document).on("keydown",".new-expectedfraction, .new-response, .savenewresponse, .cancelnewresponse",function(a){if(a.keyCode==f.escape){g.cancelNewResponse()}});a(document).on("click",".savenewresponse",function(){return g.saveNewResponse()});a(document).on("click",".cancelnewresponse",function(){g.cancelNewResponse()})},saveNewResponse:function saveNewResponse(){var b=a(".new-response").val().trim();if(""!==b){var d=a(".new-expectedfraction").is(":checked")?1:0,e=c.call([{methodname:"qtype_pmatch_create_response",args:{questionid:g.questionId,expectedfraction:d,response:b,curentrow:g.idxLastRow}}],!0);e[0].done(function(b){if("error"===b.status){g.handleSaveNewResponseButton(!1,b.message)}else{g.disableControlButtons(!1);a("#"+g.newRowId).detach();g.table.append(a(b.html));var c=M.util.get_string("testquestionresultssummary","qtype_pmatch",b.counts);a("#testquestion_gradesummary").html(c)}}).fail(function(a){g.handleSaveNewResponseButton(!1,a.message)});g.disableControlButtonAndSelectionBox();g.resetFormState()}},cancelNewResponse:function cancelNewResponse(){a("#"+g.newRowId).remove();g.disableControlButtons(!1);g.disableControlButtonAndSelectionBox();g.resetFormState();g.idxLastRow--},checkResponse:function checkResponse(a){var b=c.call([{methodname:"qtype_pmatch_check_response",args:{questionid:g.questionId,response:a}}],!0);b[0].done(function(a){var b=!1;if("success"==a.status){a.message="";b=!0}g.handleSaveNewResponseButton(b,a.message)}).fail(function(a){g.handleSaveNewResponseButton(!1,a.message)})},handleSaveNewResponseButton:function handleSaveNewResponseButton(b,c){if(b){a(".savenewresponse").removeAttr("disabled")}else{a(".savenewresponse").attr("disabled","true")}a(".response.error").html(c)},disableControlButtons:function disableControlButtons(b){if(b){a("#newresponsebutton").attr("disabled","true");a("#deleteresponsesbutton").attr("disabled","true");a("#testresponsesbutton").attr("disabled","true")}else{a("#newresponsebutton").removeAttr("disabled");a("#deleteresponsesbutton").removeAttr("disabled");a("#testresponsesbutton").removeAttr("disabled")}},resetFormState:function resetFormState(){if(M.core_formchangechecker.get_form_dirty_state()){M.core_formchangechecker.reset_form_dirty_state()}},disableControlButtonAndSelectionBox:function disableControlButtonAndSelectionBox(){var b=a("#tqheadercheckbox"),c=a("#responses");if(0>=c.find("tbody tr:not(.emptyrow)").length){b.attr("disabled",!0);a("#deleteresponsesbutton").attr("disabled","true");a("#testresponsesbutton").attr("disabled","true")}else{b.removeAttr("disabled");a("#deleteresponsesbutton").removeAttr("disabled");a("#testresponsesbutton").removeAttr("disabled")}}};return g});
//# sourceMappingURL=creator.min.js.map
