define("qtype_pmatch/updater",["exports","jquery","core/notification"],(function(_exports,_jquery,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * This class provides functionality for the testquestion response updater.
   *
   * @module    qtype_pmatch
   * @class     updater
   * @copyright 2016 The Open University
   * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_notification=_interopRequireDefault(_notification);const t={init:function(){const table=document.getElementById("attemptsform");table.addEventListener("click",(e=>{const updater=e.target.closest(".updater-ef");updater&&(e.preventDefault(),t.update(updater.dataset.id))})),table.addEventListener("keypress",(e=>{const checkbox=e.target.closest('input[type="checkbox"]');if(checkbox&&"Enter"===e.key)return e.preventDefault(),void checkbox.click();e.target.closest("tr")&&"Enter"===e.key&&e.preventDefault()}));const body=(0,_jquery.default)("body");body.on("updatefailed","[data-inplaceeditable]",(e=>{e.preventDefault(),_notification.default.alert(M.util.get_string("error:title","qtype_pmatch"),e.exception.message,M.util.get_string("ok","moodle"))})),body.on("updated","[data-inplaceeditable]",(e=>{t.handleUpdated(e)})),document.getElementById("qtype-pmatch-testquestion_r0").classList.contains("emptyrow")&&require(["core/inplace_editable"])},handleUpdated:function(e){if(e.ajaxreturn.value===e.oldvalue)return;const result=JSON.parse(e.ajaxreturn.value),existingRow=e.target.closest("tr");existingRow.outerHTML=result.html.replace(/qtype-pmatch-testquestion_r/g,existingRow.id),document.getElementById("testquestion_gradesummary").innerHtml=result.summary},update:function(id){const pendingid={};M.util.js_pending(pendingid);const data=new FormData;data.append("qid",document.getElementById("attemptsform").querySelector('input[name="id"]').value),data.append("rid",id),data.append("expectedfraction","1"===document.getElementById("updater-ef_"+id).innerText?0:1),data.append("sesskey",M.cfg.sesskey),fetch(M.cfg.wwwroot+"/question/type/pmatch/api/updater.php",{method:"POST",body:data}).then((response=>response.json())).then((result=>{if("success"!==result.status)throw M.util.js_complete(pendingid),new Error(result.data);const updater=document.getElementById("updater-ef_"+id);updater.innerText=result.ef,updater.parentNode.previousElementSibling.innerText=result.gf;updater.parentNode.parentNode.className=result.rowclass,document.getElementById("testquestion_gradesummary").innerHtml=M.util.get_string("testquestionresultssummary","qtype_pmatch",result.counts),M.util.js_complete(pendingid)})).catch(_notification.default.exception)}};var _default=t;return _exports.default=_default,_exports.default}));

//# sourceMappingURL=updater.min.js.map