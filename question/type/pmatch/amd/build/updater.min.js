define ("qtype_pmatch/updater",["jquery","core/notification"],function(a,b){var c={baseUrl:"",sessKey:"",qid:"",headerCheckboxChecked:!0,REPLACESTRING:/qtype-pmatch-testquestion_r/g,init:function init(){var d=a("#attemptsform").attr("action"),e=a("body");c.baseUrl=d.replace("testquestion.php","api/updater.php");c.sessKey=a("#attemptsform input[name=\"sesskey\"]").val();c.qid=a("#attemptsform input[name=\"id\"]").val();a(document).on("click",".updater-ef",function(){var b=a(this).data("id");c.update(b);return!1});a(document).on("keypress","#tablecontainer :checkbox",function(b){if(13==(b.keyCode?b.keyCode:b.which)){b.preventDefault();a(this).trigger("click")}});a("#tqheadercheckbox").click(function(){if(c.headerCheckboxChecked){a(this).attr("title",M.util.get_string("deselectall","moodle"));c.headerCheckboxChecked=!1}else{a(this).attr("title",M.util.get_string("selectall","moodle"));c.headerCheckboxChecked=!0}a("#tablecontainer :checkbox").each(function(){this.checked=!c.headerCheckboxChecked});a(this).prop("checked",!1)});e.on("updatefailed","[data-inplaceeditable]",function(a){var c=a.exception;a.preventDefault();b.alert(M.util.get_string("error:title","qtype_pmatch"),c.message,M.util.get_string("ok","moodle"))});e.on("updated","[data-inplaceeditable]",function(a){c.handleUpdated(a,this)});c.bindInplaceEditEvent()},bindInplaceEditEvent:function bindInplaceEditEvent(){if(a("#qtype-pmatch-testquestion_r0").hasClass("emptyrow")){require(["core/inplace_editable"])}},handleUpdated:function handleUpdated(b,d){var e=b.ajaxreturn;if(e.value!==b.oldvalue){var f=a.parseJSON(e.value),g=a(d).parent().parent(),h=g.attr("id"),i=f.html;a(g).replaceWith(i.replace(c.REPLACESTRING,h));a("#testquestion_gradesummary").html(f.summary)}},update:function update(b){var d=a("#updater-ef_"+b).text(),e=0;if("1"===d){e=0}else{e=1}var f={qid:c.qid,rid:b,expectedfraction:e,sesskey:c.sessKey};a.post(c.baseUrl,f,function(d){if("success"===d.status){a("#updater-ef_"+b).text(d.ef);a("#updater-ef_"+b).parent().prev().text(d.gf);var e=a("#updater-ef_"+b).parent().parent();e.removeClass();e.addClass(d.rowclass);e.find("td[class=\"c3\"]").text(d.gf);var f=M.util.get_string("testquestionresultssummary","qtype_pmatch",d.counts);a("#testquestion_gradesummary").html(f)}else{window.console.log("Testquestion response updater has experienced an issue.\n"+d.data)}})}};return c});
//# sourceMappingURL=updater.min.js.map
