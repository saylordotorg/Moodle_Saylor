{"version":3,"sources":["../src/tryrule.js"],"names":["define","$","t","baseUrl","sessKey","qid","pendingid","baseForm","init","Math","random","toString","slice","base","window","location","protocol","host","pathname","replace","length","first","find","val","on","e","preventDefault","id","parents","prevAll","attr","tryrule","btn","M","util","js_pending","rule","trim","display","next","fraction","data","type","ruletxt","sesskey","post","result","html","js_complete"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This class provides functionality for try rule.\n *\n * This is based on the work of Dr Alistair Willis published:\n * http://aclweb.org/anthology/W/W15/W15-0628.pdf\n *\n * @module    qtype_pmatch\n * @class     tryrule\n * @package   question\n * @copyright 2016 The Open University\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since     2.9\n */\ndefine(['jquery'], function($) {\n\n    /**\n     * @alias qtype_pmatch/tryrule\n     */\n    var t = {\n        baseUrl: '',\n        sessKey: '',\n        qid: '',\n        pendingid: '',\n        baseForm: null,\n\n        /**\n         * Initialise the try rule button.\n         */\n        init: function() {\n            // Set up base variables.\n            t.pendingid = 'tryrule_' + Math.random().toString(36).slice(2); // Random string.\n            var base = window.location;\n            t.baseUrl = base.protocol + '//' + base.host +\n                    base.pathname.replace('question.php', 'type/pmatch/api/api.php');\n            if ($('#mform1').length) {\n                t.baseForm = $('#mform1');\n            } else {\n                // Get the first form in the page.\n                t.baseForm = $('form.mform').first();\n            }\n            t.sessKey = t.baseForm.find('input[name=\"sesskey\"]').val();\n            t.qid = t.baseForm.find('input[name=\"id\"]').val();\n            $('input[name=\"tryrule\"]').on('click', function(e) {\n                e.preventDefault();\n                var id = $(this).parents('.try-rule').prevAll('.answer-rule').first()\n                    .attr('id').replace('fitem_id_answer_', '');\n                t.tryrule(id, this);\n            });\n        },\n        /**\n         * Try rule support send request try rule.\n         *\n         * @param int is id answer try rule\n         * @param Element btn is element button click call tryrule function\n         */\n        tryrule: function(id, btn) {\n            M.util.js_pending(t.pendingid);\n            var rule = $('#id_answer_' + id).val().trim();\n            if (rule === undefined || rule === null || rule === '') {\n                return;\n            }\n            var display = $(btn).next('.try-rule-result');\n            var fraction = $('#id_fraction_' + id).val();\n            // Send request for tryrule result.\n            var data = {type: 'tryrule', qid: t.qid, ruletxt: rule, sesskey: t.sessKey, fraction: fraction};\n            $.post(t.baseUrl, data, function(result) {\n                // Display feedback to the user.\n                display.html(result);\n                M.util.js_complete(t.pendingid);\n            }, 'json');\n        }\n    };\n\n    return t;\n});\n"],"file":"tryrule.min.js"}