{"version":3,"file":"Item.min.js","sources":["../src/Item.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript code for the gapfill question type.\n *\n * @copyright  2017 Marcus Green\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\"jquery\"], function($) {\n  /**\n   *\n   * @param {string} text\n   * @param {string} delimitchars\n   */\n  return function Item(text, delimitchars) {\n    this.questionid = $(\"input[name=id]\").val();\n    this.settings = getSettings();\n    this.gaptext = text;\n    this.delimitchars = delimitchars;\n    /* The l and r is for left and right */\n    this.l = delimitchars.substr(0, 1);\n    this.r = delimitchars.substr(1, 1);\n    this.len = this.gaptext.length;\n    this.startchar = this.gaptext.substring(0, 1);\n    /* For checking if the end char is the right delimiter */\n    this.endchar = this.gaptext.substring(this.len - 1, this.len);\n    this.gaptextNodelim = \"\";\n    this.feedback = {};\n    this.instance = 0;\n    this.feedback.correct = $(\"#id_corecteditable\").html();\n    this.feedback.incorrect = $(\"#id_incorrecteditable\").html();\n    Item.prototype.striptags = function(gaptext) {\n      /* This is not a perfect way of stripping html but it may be good enough */\n      if (gaptext === undefined) {\n        return \"\";\n      }\n      var regex = /(<([^>]+)>)/gi;\n      return gaptext.replace(regex, \"\");\n    };\n    /**\n     * Pull data from hidden settings field on form\n     * @returns {object} settings\n     */\n    function getSettings() {\n      var settings = [];\n      var settingsdata = $(\"[name='itemsettings']\").val();\n      if (settingsdata > \"\") {\n        var obj = JSON.parse(settingsdata);\n        for (var o in obj) {\n          settings.push(obj[o]);\n        }\n      }\n      return settings;\n    }\n    this.stripdelim = function() {\n      if (this.startchar === this.l) {\n        this.gaptextNodelim = this.gaptext.substring(1, this.len);\n      }\n      if (this.endchar === this.r) {\n        var len = this.gaptextNodelim.length;\n        this.gaptextNodelim = this.gaptextNodelim.substring(0, len - 1);\n      }\n      return this.gaptextNodelim;\n    };\n    var itemsettings = [];\n    Item.prototype.getItemSettings = function(target) {\n      var itemid = target.id;\n      var underscore = itemid.indexOf(\"_\");\n      /* The instance, normally 0 but incremented if a gap has the same text as another\n       * instance is not currently used*/\n      this.instance = itemid.substr(underscore + 1);\n      for (var set in this.settings) {\n        text = this.stripdelim();\n        if (this.settings[set].gaptext === text) {\n          itemsettings = this.settings[set];\n        }\n      }\n      return itemsettings;\n    };\n    this.updateJson = function(e) {\n      var found = false;\n      var id = e.target.id;\n      for (var set in this.settings) {\n        if (this.settings[set].gaptext === this.stripdelim()) {\n          this.settings[set].correctfeedback = $(\n            \"#id_correcteditable\"\n          )[0].innerHTML;\n          this.settings[set].incorrectfeedback = $(\n            \"#id_incorrecteditable\"\n          )[0].innerHTML;\n          found = true;\n        }\n      }\n      if (found === false) {\n        /* If there is no record for this word add one */\n        var itemsettings = {\n          itemid: id,\n          questionid: $(\"input[name=id]\").val(),\n          correctfeedback: $(\"#id_correcteditable\").html(),\n          incorrectfeedback: $(\"#id_incorrecteditable\").html(),\n          gaptext: this.stripdelim()\n        };\n        this.settings.push(itemsettings);\n      }\n      return JSON.stringify(this.settings);\n    };\n  };\n});\n"],"names":["define","$","Item","text","delimitchars","this","questionid","val","settings","settingsdata","obj","JSON","parse","o","push","getSettings","gaptext","l","substr","r","len","length","startchar","substring","endchar","gaptextNodelim","feedback","instance","correct","html","incorrect","prototype","striptags","undefined","replace","stripdelim","itemsettings","getItemSettings","target","itemid","id","underscore","indexOf","set","updateJson","e","found","correctfeedback","innerHTML","incorrectfeedback","stringify"],"mappings":";;;;;;AAqBAA,4BAAO,CAAC,WAAW,SAASC,GAM1B,OAAO,SAASC,KAAKC,KAAMC,cACzBC,KAAKC,WAAaL,EAAE,kBAAkBM,MACtCF,KAAKG,SA2BL,WACE,IAAIA,SAAW,GACXC,aAAeR,EAAE,yBAAyBM,MAC9C,GAAIE,aAAe,GAAI,CACrB,IAAIC,IAAMC,KAAKC,MAAMH,cACrB,IAAK,IAAII,KAAKH,IACZF,SAASM,KAAKJ,IAAIG,IAGtB,OAAOL,SApCOO,GAChBV,KAAKW,QAAUb,KACfE,KAAKD,aAAeA,aAEpBC,KAAKY,EAAIb,aAAac,OAAO,EAAG,GAChCb,KAAKc,EAAIf,aAAac,OAAO,EAAG,GAChCb,KAAKe,IAAMf,KAAKW,QAAQK,OACxBhB,KAAKiB,UAAYjB,KAAKW,QAAQO,UAAU,EAAG,GAE3ClB,KAAKmB,QAAUnB,KAAKW,QAAQO,UAAUlB,KAAKe,IAAM,EAAGf,KAAKe,KACzDf,KAAKoB,eAAiB,GACtBpB,KAAKqB,SAAW,GAChBrB,KAAKsB,SAAW,EAChBtB,KAAKqB,SAASE,QAAU3B,EAAE,sBAAsB4B,OAChDxB,KAAKqB,SAASI,UAAY7B,EAAE,yBAAyB4B,OACrD3B,KAAK6B,UAAUC,UAAY,SAAShB,SAElC,QAAgBiB,IAAZjB,QACF,MAAO,GAGT,OAAOA,QAAQkB,QADH,gBACkB,KAiBhC7B,KAAK8B,WAAa,WAIhB,GAHI9B,KAAKiB,YAAcjB,KAAKY,IAC1BZ,KAAKoB,eAAiBpB,KAAKW,QAAQO,UAAU,EAAGlB,KAAKe,MAEnDf,KAAKmB,UAAYnB,KAAKc,EAAG,CAC3B,IAAIC,IAAMf,KAAKoB,eAAeJ,OAC9BhB,KAAKoB,eAAiBpB,KAAKoB,eAAeF,UAAU,EAAGH,IAAM,GAE/D,OAAOf,KAAKoB,gBAEd,IAAIW,aAAe,GACnBlC,KAAK6B,UAAUM,gBAAkB,SAASC,QACxC,IAAIC,OAASD,OAAOE,GAChBC,WAAaF,OAAOG,QAAQ,KAIhC,IAAK,IAAIC,OADTtC,KAAKsB,SAAWY,OAAOrB,OAAOuB,WAAa,GAC3BpC,KAAKG,SACnBL,KAAOE,KAAK8B,aACR9B,KAAKG,SAASmC,KAAK3B,UAAYb,OACjCiC,aAAe/B,KAAKG,SAASmC,MAGjC,OAAOP,cAET/B,KAAKuC,WAAa,SAASC,GACzB,IAAIC,OAAQ,EACRN,GAAKK,EAAEP,OAAOE,GAClB,IAAK,IAAIG,OAAOtC,KAAKG,SACfH,KAAKG,SAASmC,KAAK3B,UAAYX,KAAK8B,eACtC9B,KAAKG,SAASmC,KAAKI,gBAAkB9C,EACnC,uBACA,GAAG+C,UACL3C,KAAKG,SAASmC,KAAKM,kBAAoBhD,EACrC,yBACA,GAAG+C,UACLF,OAAQ,GAGZ,IAAc,IAAVA,MAAiB,CAEnB,IAAIV,aAAe,CACjBG,OAAQC,GACRlC,WAAYL,EAAE,kBAAkBM,MAChCwC,gBAAiB9C,EAAE,uBAAuB4B,OAC1CoB,kBAAmBhD,EAAE,yBAAyB4B,OAC9Cb,QAASX,KAAK8B,cAEhB9B,KAAKG,SAASM,KAAKsB,cAErB,OAAOzB,KAAKuC,UAAU7C,KAAKG"}