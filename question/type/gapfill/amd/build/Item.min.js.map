{"version":3,"sources":["../src/Item.js"],"names":["define","$","Item","text","delimitchars","questionid","val","settings","settingsdata","obj","JSON","parse","o","push","gaptext","l","substr","r","len","length","startchar","substring","endchar","gaptextNodelim","feedback","instance","correct","html","incorrect","prototype","striptags","replace","stripdelim","itemsettings","getItemSettings","target","itemid","id","underscore","indexOf","set","updateJson","e","found","correctfeedback","innerHTML","incorrectfeedback","stringify"],"mappings":"AAsBAA,OAAM,sBAAC,CAAC,QAAD,CAAD,CAAa,SAASC,CAAT,CAAY,CAM7B,MAAO,SAASC,CAAAA,CAAT,CAAcC,CAAd,CAAoBC,CAApB,CAAkC,CACvC,KAAKC,UAAL,CAAkBJ,CAAC,CAAC,gBAAD,CAAD,CAAoBK,GAApB,EAAlB,CACA,KAAKC,QAAL,CA2BA,UAAuB,IACjBA,CAAAA,CAAQ,CAAG,EADM,CAEjBC,CAAY,CAAGP,CAAC,CAAC,uBAAD,CAAD,CAA2BK,GAA3B,EAFE,CAGrB,GAAmB,EAAf,CAAAE,CAAJ,CAAuB,CACrB,GAAIC,CAAAA,CAAG,CAAGC,IAAI,CAACC,KAAL,CAAWH,CAAX,CAAV,CACA,IAAK,GAAII,CAAAA,CAAT,GAAcH,CAAAA,CAAd,CAAmB,CACjBF,CAAQ,CAACM,IAAT,CAAcJ,CAAG,CAACG,CAAD,CAAjB,CACD,CACF,CACD,MAAOL,CAAAA,CACR,CArCe,EAAhB,CACA,KAAKO,OAAL,CAAeX,CAAf,CACA,KAAKC,YAAL,CAAoBA,CAApB,CAEA,KAAKW,CAAL,CAASX,CAAY,CAACY,MAAb,CAAoB,CAApB,CAAuB,CAAvB,CAAT,CACA,KAAKC,CAAL,CAASb,CAAY,CAACY,MAAb,CAAoB,CAApB,CAAuB,CAAvB,CAAT,CACA,KAAKE,GAAL,CAAW,KAAKJ,OAAL,CAAaK,MAAxB,CACA,KAAKC,SAAL,CAAiB,KAAKN,OAAL,CAAaO,SAAb,CAAuB,CAAvB,CAA0B,CAA1B,CAAjB,CAEA,KAAKC,OAAL,CAAe,KAAKR,OAAL,CAAaO,SAAb,CAAuB,KAAKH,GAAL,CAAW,CAAlC,CAAqC,KAAKA,GAA1C,CAAf,CACA,KAAKK,cAAL,CAAsB,EAAtB,CACA,KAAKC,QAAL,CAAgB,EAAhB,CACA,KAAKC,QAAL,CAAgB,CAAhB,CACA,KAAKD,QAAL,CAAcE,OAAd,CAAwBzB,CAAC,CAAC,oBAAD,CAAD,CAAwB0B,IAAxB,EAAxB,CACA,KAAKH,QAAL,CAAcI,SAAd,CAA0B3B,CAAC,CAAC,uBAAD,CAAD,CAA2B0B,IAA3B,EAA1B,CACAzB,CAAI,CAAC2B,SAAL,CAAeC,SAAf,CAA2B,SAAShB,CAAT,CAAkB,CAE3C,GAAIA,CAAO,SAAX,CAA2B,CACzB,MAAO,EACR,CAED,MAAOA,CAAAA,CAAO,CAACiB,OAAR,CADK,eACL,CAAuB,EAAvB,CACR,CAPD,CAuBA,KAAKC,UAAL,CAAkB,UAAW,CAC3B,GAAI,KAAKZ,SAAL,GAAmB,KAAKL,CAA5B,CAA+B,CAC7B,KAAKQ,cAAL,CAAsB,KAAKT,OAAL,CAAaO,SAAb,CAAuB,CAAvB,CAA0B,KAAKH,GAA/B,CACvB,CACD,GAAI,KAAKI,OAAL,GAAiB,KAAKL,CAA1B,CAA6B,CAC3B,GAAIC,CAAAA,CAAG,CAAG,KAAKK,cAAL,CAAoBJ,MAA9B,CACA,KAAKI,cAAL,CAAsB,KAAKA,cAAL,CAAoBF,SAApB,CAA8B,CAA9B,CAAiCH,CAAG,CAAG,CAAvC,CACvB,CACD,MAAO,MAAKK,cACb,CATD,CAUA,GAAIU,CAAAA,CAAY,CAAG,EAAnB,CACA/B,CAAI,CAAC2B,SAAL,CAAeK,eAAf,CAAiC,SAASC,CAAT,CAAiB,IAC5CC,CAAAA,CAAM,CAAGD,CAAM,CAACE,EAD4B,CAE5CC,CAAU,CAAGF,CAAM,CAACG,OAAP,CAAe,GAAf,CAF+B,CAKhD,KAAKd,QAAL,CAAgBW,CAAM,CAACpB,MAAP,CAAcsB,CAAU,CAAG,CAA3B,CAAhB,CACA,IAAK,GAAIE,CAAAA,CAAT,GAAgB,MAAKjC,QAArB,CAA+B,CAC7BJ,CAAI,CAAG,KAAK6B,UAAL,EAAP,CACA,GAAI,KAAKzB,QAAL,CAAciC,CAAd,EAAmB1B,OAAnB,GAA+BX,CAAnC,CAAyC,CACvC8B,CAAY,CAAG,KAAK1B,QAAL,CAAciC,CAAd,CAChB,CACF,CACD,MAAOP,CAAAA,CACR,CAbD,CAcA,KAAKQ,UAAL,CAAkB,SAASC,CAAT,CAAY,IACxBC,CAAAA,CAAK,GADmB,CAExBN,CAAE,CAAGK,CAAC,CAACP,MAAF,CAASE,EAFU,CAG5B,IAAK,GAAIG,CAAAA,CAAT,GAAgB,MAAKjC,QAArB,CAA+B,CAC7B,GAAI,KAAKA,QAAL,CAAciC,CAAd,EAAmB1B,OAAnB,GAA+B,KAAKkB,UAAL,EAAnC,CAAsD,CACpD,KAAKzB,QAAL,CAAciC,CAAd,EAAmBI,eAAnB,CAAqC3C,CAAC,CACpC,qBADoC,CAAD,CAEnC,CAFmC,EAEhC4C,SAFL,CAGA,KAAKtC,QAAL,CAAciC,CAAd,EAAmBM,iBAAnB,CAAuC7C,CAAC,CACtC,uBADsC,CAAD,CAErC,CAFqC,EAElC4C,SAFL,CAGAF,CAAK,GACN,CACF,CACD,GAAI,IAAAA,CAAJ,CAAqB,CAEnB,GAAIV,CAAAA,CAAY,CAAG,CACjBG,MAAM,CAAEC,CADS,CAEjBhC,UAAU,CAAEJ,CAAC,CAAC,gBAAD,CAAD,CAAoBK,GAApB,EAFK,CAGjBsC,eAAe,CAAE3C,CAAC,CAAC,qBAAD,CAAD,CAAyB0B,IAAzB,EAHA,CAIjBmB,iBAAiB,CAAE7C,CAAC,CAAC,uBAAD,CAAD,CAA2B0B,IAA3B,EAJF,CAKjBb,OAAO,CAAE,KAAKkB,UAAL,EALQ,CAAnB,CAOA,KAAKzB,QAAL,CAAcM,IAAd,CAAmBoB,CAAnB,CACD,CACD,MAAOvB,CAAAA,IAAI,CAACqC,SAAL,CAAe,KAAKxC,QAApB,CACR,CACF,CACF,CAnGK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript code for the gapfill question type.\n *\n * @package    qtype_gapfill\n * @copyright  2017 Marcus Green\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\"jquery\"], function($) {\n  /**\n   *\n   * @param {string} text\n   * @param {string} delimitchars\n   */\n  return function Item(text, delimitchars) {\n    this.questionid = $(\"input[name=id]\").val();\n    this.settings = getSettings();\n    this.gaptext = text;\n    this.delimitchars = delimitchars;\n    /* The l and r is for left and right */\n    this.l = delimitchars.substr(0, 1);\n    this.r = delimitchars.substr(1, 1);\n    this.len = this.gaptext.length;\n    this.startchar = this.gaptext.substring(0, 1);\n    /* For checking if the end char is the right delimiter */\n    this.endchar = this.gaptext.substring(this.len - 1, this.len);\n    this.gaptextNodelim = \"\";\n    this.feedback = {};\n    this.instance = 0;\n    this.feedback.correct = $(\"#id_corecteditable\").html();\n    this.feedback.incorrect = $(\"#id_incorrecteditable\").html();\n    Item.prototype.striptags = function(gaptext) {\n      /* This is not a perfect way of stripping html but it may be good enough */\n      if (gaptext === undefined) {\n        return \"\";\n      }\n      var regex = /(<([^>]+)>)/gi;\n      return gaptext.replace(regex, \"\");\n    };\n    /**\n     * Pull data from hidden settings field on form\n     * @returns {object} settings\n     */\n    function getSettings() {\n      var settings = [];\n      var settingsdata = $(\"[name='itemsettings']\").val();\n      if (settingsdata > \"\") {\n        var obj = JSON.parse(settingsdata);\n        for (var o in obj) {\n          settings.push(obj[o]);\n        }\n      }\n      return settings;\n    }\n    this.stripdelim = function() {\n      if (this.startchar === this.l) {\n        this.gaptextNodelim = this.gaptext.substring(1, this.len);\n      }\n      if (this.endchar === this.r) {\n        var len = this.gaptextNodelim.length;\n        this.gaptextNodelim = this.gaptextNodelim.substring(0, len - 1);\n      }\n      return this.gaptextNodelim;\n    };\n    var itemsettings = [];\n    Item.prototype.getItemSettings = function(target) {\n      var itemid = target.id;\n      var underscore = itemid.indexOf(\"_\");\n      /* The instance, normally 0 but incremented if a gap has the same text as another\n       * instance is not currently used*/\n      this.instance = itemid.substr(underscore + 1);\n      for (var set in this.settings) {\n        text = this.stripdelim();\n        if (this.settings[set].gaptext === text) {\n          itemsettings = this.settings[set];\n        }\n      }\n      return itemsettings;\n    };\n    this.updateJson = function(e) {\n      var found = false;\n      var id = e.target.id;\n      for (var set in this.settings) {\n        if (this.settings[set].gaptext === this.stripdelim()) {\n          this.settings[set].correctfeedback = $(\n            \"#id_correcteditable\"\n          )[0].innerHTML;\n          this.settings[set].incorrectfeedback = $(\n            \"#id_incorrecteditable\"\n          )[0].innerHTML;\n          found = true;\n        }\n      }\n      if (found === false) {\n        /* If there is no record for this word add one */\n        var itemsettings = {\n          itemid: id,\n          questionid: $(\"input[name=id]\").val(),\n          correctfeedback: $(\"#id_correcteditable\").html(),\n          incorrectfeedback: $(\"#id_incorrecteditable\").html(),\n          gaptext: this.stripdelim()\n        };\n        this.settings.push(itemsettings);\n      }\n      return JSON.stringify(this.settings);\n    };\n  };\n});\n"],"file":"Item.min.js"}