define ("qtype_gapfill/questionedit",["jquery","qtype_gapfill/Item"],function(a,b){return{init:function init(){a("#id_answerdisplay").change(function(){var b=a(this).val();if("gapfill"==b){a("#id_fixedgapsize").prop("disabled",!1);a("#id_optionsaftertext").prop("disabled",!0).prop("checked",!1);a("#id_singleuse").prop("disabled",!0).prop("checked",!1)}if("dragdrop"==b){a("#id_optionsaftertext").prop("disabled",!1);a("#id_singleuse").prop("disabled",!1);a("#id_fixedgapsize").prop("disabled",!1)}if("dropdown"==b){a("#id_fixedgapsize").prop("disabled",!0).prop("checked",!1);a("#id_optionsaftertext").prop("disabled",!0).prop("checked",!1);a("#id_singleuse").prop("disabled",!0).prop("checked",!1)}});a("#id_itemsettings_button").on("click",function(){var b=a(".editor_atto").length;if(1>b){a("#id_error_itemsettings_button").css({display:"inline",color:"red"});a("#id_error_itemsettings_button")[0].innerHTML=M.util.get_string("itemsettingserror","qtype_gapfill");return}a("#questiontext .atto_html_button").attr("disabled","true");if(a("#id_questiontexteditable").get(0).isContentEditable){a("#id_questiontexteditable").attr("contenteditable","false");a("#fitem_id_questiontext").find("button").attr("disabled","true");var c=a("#id_questiontexteditable").css("height"),e=a("#id_questiontexteditable").css("width");a("#id_questiontexteditable").css("display","none");a("#id_itemsettings_canvas").css(d(a("#id_questiontexteditable")));var g=a("#id_questiontexteditable").closest(".editor_atto_content_wrap");a("#id_itemsettings_canvas").appendTo(g).css("position","relative");a("#id_itemsettings_canvas").css({display:"block",background:"lightgrey"});a("#id_itemsettings_canvas").html(a("#id_questiontexteditable").prop("innerHTML"));a("#id_itemsettings_canvas").css({height:c,width:e});a("#id_itemsettings_canvas").css({height:"100%",width:"100%"});a("#id_itemsettings_button").html(M.util.get_string("editquestiontext","qtype_gapfill"));a("#id_itemsettings_canvas").height(a("#id_questiontexteditable").height());f(a("#id_itemsettings_canvas")[0])}else{a("#id_questiontexteditable").css({display:"block",backgroundColor:"white"});a("#id_questiontexteditable").attr("contenteditable","true");a("#id_itemsettings_canvas").css("display","none");a("#fitem_id_questiontext").find("button").removeAttr("disabled");a("#id_settings_popup").css("display","none");a("#id_itemsettings_button").html(M.util.get_string("additemsettings","qtype_gapfill"));a("[class^=atto_]").removeAttr("disabled")}});a("#id_itemsettings_canvas").on("click",function(c){if(!a("#id_questiontexteditable").get(0).isContentEditable&&c.target.id.match(/^id[0-9]+_/)){var d=a("#id_delimitchars").val(),e=new b(c.target.innerHTML,d),f=e.getItemSettings(c.target);if(null===f||0===f.length){a("#id_correcteditable").html("");a("#id_incorrecteditable").html("")}else{a("#id_correcteditable").html(f.correctfeedback);a("#id_incorrecteditable").html(f.incorrectfeedback)}a("label[for*='id_correct']").text(M.util.get_string("correct","qtype_gapfill"));a("label[for*='id_incorrect']").text(M.util.get_string("incorrect","qtype_gapfill"));a("#id_itemsettings_popup .atto_image_button").attr("disabled","true");a("#id_itemsettings_popup .atto_media_button").attr("disabled","true");a("#id_itemsettings_popup .atto_managefiles_button").attr("disabled","true");var g=M.util.get_string("additemsettings","qtype_gapfill");g+=": "+a("<div/>").html(e.stripdelim()).text();require(["jquery","jqueryui"],function(a){a("#id_itemsettings_popup").dialog({position:{my:"right",at:"right",of:"#id_itemsettings_canvas"},height:500,width:"70%",modal:!1,title:g,buttons:[{text:"OK",click:function click(){var b=e.updateJson(c);a("[class^=atto_]").removeAttr("disabled");a("[name='itemsettings']").val(b);a(".ui-dialog-content").dialog("close");a("#id_questiontexteditable").attr("contenteditable","true");a("#id_itemsettings_button").click()}}]})})}});function c(a){for(var b=[],c=0,d=a.length;c<d;c++){b.push(a[c])}return b}var f=function(){return function(d){var g=0,h=[];d=d&&d.parentNode?d:document.body;var k,m=c(d.childNodes);if("id_questiontextfeedback"===d.id&&0<g){g=0}for(var n,o,p=a("#id_delimitchars").val(),q=p.substring(0,1),l=p.substring(1,2),r=new RegExp("(\\"+q+".*?\\"+l+")","g"),s,t=document.createElement("span"),u={script:"",button:"",input:"",select:"",textarea:"",option:""},v=0,w=m.length;v<w;v++){k=m[v];if(1===k.nodeType&&!(k.tagName.toLowerCase()in u)){f(k)}else if(3===k.nodeType){var x=new RegExp("(\\"+q+".*?\\"+l+")","g");o=k.data.split(x);if(o){n=document.createDocumentFragment();for(var y=0,z=o.length;y<z;y++){e(o,t,y)}}k.parentNode.replaceChild(n,k)}}function e(c,d,e){h=[];if(r.test(c[e])){s=d.cloneNode(!1);g++;s.className="item";var f=new b(c[e],a("#id_delimitchars").val());if(""<f.gaptext){for(var i=0,j=0;j<h.length;++j){if(h[j]===f.text){i++}}f.id="id"+g+"_"+i;s.id=f.id;var l=f.getItemSettings(f);if(""<f.striptags(l.correctfeedback)){s.className="hascorrect"}if(""<f.striptags(l.incorrectfeedback)){s.className=s.className+" hasnocorrect"}h.push(f.gaptext)}s.appendChild(document.createTextNode(c[e]));n.appendChild(s)}else{n.appendChild(document.createTextNode(c[e]))}}}}();function d(a){var b={},c,d;if(a.length){var f=a.get(0);if(window.getComputedStyle){var g=function(c,a){return a.toUpperCase()},h=function(a){return a.replace(/-([a-z])/g,g)};if(c=window.getComputedStyle(f,null)){for(var j,k,m=0,n=c.length;m<n;m++){d=c[m];j=h(d);k=c.getPropertyValue(d);b[j]=k}}else if(c=f.currentStyle){for(d in c){b[d]=c[d]}}else if(c=f.style){b=e(c,b,d)}return b}}return!1}function e(a,b,c){for(c in a){if("function"!=typeof a[c]){b[c]=a[c]}}return b}}}});
//# sourceMappingURL=questionedit.min.js.map
