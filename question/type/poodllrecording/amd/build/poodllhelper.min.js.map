{"version":3,"file":"poodllhelper.min.js","sources":["../src/poodllhelper.js"],"sourcesContent":["define([\"jquery\", \"core/log\"], function ($, log) {\n    \"use strict\"; // jshint ;_;\n\n    log.debug(\"poodll helper: initialising\");\n\n    return {\n\n\n        init: function (opts) {\n            var that =this;\n            var prquestion = function (evt) {\n\n                if(evt){\n                    switch(evt[1]) {\n                        case 'filesubmitted':\n                            var filename = evt[2];\n                            var updatecontrol = evt[3];\n                            // post a custom event that a filter template might be interested in\n                            var prquestionUploaded = new CustomEvent(\"prquestionUploaded\", {details: evt});\n                            document.dispatchEvent(prquestionUploaded);\n\n                            //if opts safe save\n                            if(opts.safesave==1) {\n                                var nextbtn = $('.submitbtns .mod_quiz-next-nav');\n                                nextbtn.removeClass('qtype_poodllrecording_disabledbtn');\n                                nextbtn.removeAttr('disabled', 'disabled');\n                                //deactivate premature leaving\n                                $(window).off('beforeunload', that.preventPrematureLeaving);\n                            }\n\n                            //poke the filename\n                            var upc = '';\n                            if (typeof updatecontrol !== 'undefined' && updatecontrol !== '') {\n                                upc = $('[id=\"' + updatecontrol + '\"]');\n                                //the code below used to work until odd chars in question id annoyed jquery 3\n                                //upc = $('#' + uploader.config.updatecontrol);\n                            }\n                            if (upc.length < 1) {\n                                upc = $('[id=\"' + updatecontrol + '\"]', window.parent.document);\n                            }\n                            if (upc.length > 0) {\n                                upc.get(0).value = filename;\n                            } else {\n                                log.debug('upload failed #2');\n                                return false;\n                            }\n                            upc.trigger('change');\n                            break;\n                        case 'started':\n                            //if opts safe save\n                            if(opts.safesave==1) {\n                                var savebtn = $('.submitbtns .mod_quiz-next-nav');\n                                savebtn.addClass('qtype_poodllrecording_disabledbtn');\n                                savebtn.attr('disabled', 'disabled');\n                                //Add a page unload check ..\n                                $(window).on('beforeunload', that.preventPrematureLeaving);\n                            }\n\n                            break;\n                    }\n                }\n            }; //end of callback function\n            window.prquestion = prquestion;\n\n        }, //end of init\n\n        preventPrematureLeaving: function(e){\n            log.debug('preventPrematureLeaving has been called');\n            e.preventDefault();\n            e.returnValue = \"Your recording has not been uploaded. Cancel to stay on this page.\";\n            return e.returnValue;\n        },\n\n    };//end of return object\n});"],"names":["define","$","log","debug","init","opts","that","this","window","prquestion","evt","filename","updatecontrol","prquestionUploaded","CustomEvent","details","document","dispatchEvent","safesave","nextbtn","removeClass","removeAttr","off","preventPrematureLeaving","upc","length","parent","get","value","trigger","savebtn","addClass","attr","on","e","preventDefault","returnValue"],"mappings":"AAAAA,4CAAO,CAAC,SAAU,aAAa,SAAUC,EAAGC,YAGxCA,IAAIC,MAAM,+BAEH,CAGHC,KAAM,SAAUC,UACRC,KAAMC,KAqDVC,OAAOC,WApDU,SAAUC,QAEpBA,WACQA,IAAI,QACF,oBACGC,SAAWD,IAAI,GACfE,cAAgBF,IAAI,GAEpBG,mBAAqB,IAAIC,YAAY,qBAAsB,CAACC,QAASL,SACzEM,SAASC,cAAcJ,oBAGL,GAAfR,KAAKa,SAAa,KACbC,QAAUlB,EAAE,kCAChBkB,QAAQC,YAAY,qCACpBD,QAAQE,WAAW,WAAY,YAE/BpB,EAAEO,QAAQc,IAAI,eAAgBhB,KAAKiB,6BAInCC,IAAM,WACmB,IAAlBZ,eAAmD,KAAlBA,gBACxCY,IAAMvB,EAAE,QAAUW,cAAgB,OAIlCY,IAAIC,OAAS,IACbD,IAAMvB,EAAE,QAAUW,cAAgB,KAAMJ,OAAOkB,OAAOV,aAEtDQ,IAAIC,OAAS,UAGbvB,IAAIC,MAAM,qBACH,EAHPqB,IAAIG,IAAI,GAAGC,MAAQjB,SAKvBa,IAAIK,QAAQ,oBAEX,aAEiB,GAAfxB,KAAKa,SAAa,KACbY,QAAU7B,EAAE,kCAChB6B,QAAQC,SAAS,qCACjBD,QAAQE,KAAK,WAAY,YAEzB/B,EAAEO,QAAQyB,GAAG,eAAgB3B,KAAKiB,6BAW1DA,wBAAyB,SAASW,UAC9BhC,IAAIC,MAAM,2CACV+B,EAAEC,iBACFD,EAAEE,YAAc,qEACTF,EAAEE"}