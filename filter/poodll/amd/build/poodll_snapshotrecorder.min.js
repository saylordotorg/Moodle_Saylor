define(["jquery","core/log","filter_poodll/utils_amd","filter_poodll/uploader","filter_poodll/webcam"],(function($,log,utils,uploader,Webcam){return log.debug("PoodLL Snapshot Recorder: initialising"),{instanceprops:[],fetch_instance_props:function(widgetid){return this.instanceprops[widgetid]},init_instance_props:function(widgetid){var props={imagefile:!1,htmlthings:"",config:null,uploader:null};this.instanceprops[widgetid]=props},supports_current_browser:function(config){return!utils.is_ios()&&("snapshot"==config.mediatype&&(log.debug("PoodLL Snapshot Recorder: supports this browser"),!0))},embed:function(element,config){this.init_instance_props(config.widgetid);var ip=this.fetch_instance_props(config.widgetid);ip.config=config,ip.uploader=uploader.clone(),ip.uploader.init(element,config),this.insert_controls(element,config.widgetid),this.register_events(config.widgetid)},insert_controls:function(element,widgetid){var ip=this.fetch_instance_props(widgetid),config=ip.config,htmlthings={camera:config.widgetid+"_poodll_snapshot_camera",preview:config.widgetid+"_poodll_snapshot_preview",snapbutton:config.widgetid+"_poodll_take-snapshot",savebutton:config.widgetid+"_poodll_save-snapshot",cancelbutton:config.widgetid+"_poodll_cancel-snapshot"};ip.htmlthings=htmlthings;var controls='<div id="'+htmlthings.camera+'" style="width:320px; height:240px;"></div>';controls+='<div id="'+htmlthings.preview+'" class="hide" style="width:320px; height:240px;"></div>',controls+='<button type="button" class="poodll_take-snapshot" id="'+htmlthings.snapbutton+'">'+M.util.get_string("recui_takesnapshot","filter_poodll")+"</button>",controls+='<button type="button" class="poodll_cancel-snapshot" id="'+htmlthings.cancelbutton+'">'+M.util.get_string("recui_cancelsnapshot","filter_poodll")+"</button>",controls+='<button type="button" class="poodll_save-recording" id="'+htmlthings.savebutton+'">'+M.util.get_string("recui_save","filter_poodll")+"</button>",$(element).prepend(controls)},register_events:function(widgetid){var ip=this.fetch_instance_props(widgetid);ip.config;Webcam.set("swfURL",M.cfg.wwwroot+"/filter/poodll/3rdparty/webcam/webcam.swf"),Webcam.attach("#"+ip.htmlthings.camera),$("#"+ip.htmlthings.savebutton).on("click",(function(e){if(ip.imagefile){var imageblob=ip.uploader.dataURItoBlob(ip.imagefile,"image/jpeg");ip.uploader.uploadFile(imageblob,"image/jpeg")}else ip.uploader.Output(M.util.get_string("recui_nothingtosaveerror","filter_poodll"))})),$("#"+ip.htmlthings.cancelbutton).on("click",(function(e){ip.imagefile=!1,$("#"+ip.htmlthings.preview).addClass("hide").html(""),$("#"+ip.htmlthings.camera).removeClass("hide")})),$("#"+ip.htmlthings.snapbutton).on("click",(function(e){Webcam.snap((function(data_uri){ip.imagefile=data_uri,$("#"+ip.htmlthings.preview).html('<img src="'+data_uri+'"/>').removeClass("hide"),$("#"+ip.htmlthings.camera).addClass("hide")}))}))}}}));

//# sourceMappingURL=poodll_snapshotrecorder.min.js.map