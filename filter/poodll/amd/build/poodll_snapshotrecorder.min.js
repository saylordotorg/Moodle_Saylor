define(["jquery","core/log","filter_poodll/utils_amd","filter_poodll/uploader","filter_poodll/webcam"],function(a,b,c,d,e){"use strict";return b.debug("PoodLL Snapshot Recorder: initialising"),{instanceprops:[],fetch_instance_props:function(a){return this.instanceprops[a]},init_instance_props:function(a){var b={};b.imagefile=!1,b.htmlthings="",b.config=null,b.uploader=null,this.instanceprops[a]=b},supports_current_browser:function(a){var d=c.is_ios();return!d&&("snapshot"==a.mediatype&&(b.debug("PoodLL Snapshot Recorder: supports this browser"),!0))},embed:function(a,b){this.init_instance_props(b.widgetid);var c=this.fetch_instance_props(b.widgetid);c.config=b,c.uploader=d.clone(),c.uploader.init(a,b),this.insert_controls(a,b.widgetid),this.register_events(b.widgetid)},insert_controls:function(b,c){var d=this.fetch_instance_props(c),e=d.config,f={camera:e.widgetid+"_poodll_snapshot_camera",preview:e.widgetid+"_poodll_snapshot_preview",snapbutton:e.widgetid+"_poodll_take-snapshot",savebutton:e.widgetid+"_poodll_save-snapshot",cancelbutton:e.widgetid+"_poodll_cancel-snapshot"};d.htmlthings=f;var g='<div id="'+f.camera+'" style="width:320px; height:240px;"></div>';g+='<div id="'+f.preview+'" class="hide" style="width:320px; height:240px;"></div>',g+='<button type="button" class="poodll_take-snapshot" id="'+f.snapbutton+'">'+M.util.get_string("recui_takesnapshot","filter_poodll")+"</button>",g+='<button type="button" class="poodll_cancel-snapshot" id="'+f.cancelbutton+'">'+M.util.get_string("recui_cancelsnapshot","filter_poodll")+"</button>",g+='<button type="button" class="poodll_save-recording" id="'+f.savebutton+'">'+M.util.get_string("recui_save","filter_poodll")+"</button>",a(b).prepend(g)},register_events:function(b){var c=this.fetch_instance_props(b);c.config;e.set("swfURL",M.cfg.wwwroot+"/filter/poodll/3rdparty/webcam/webcam.swf"),e.attach("#"+c.htmlthings.camera),a("#"+c.htmlthings.savebutton).on("click",function(a){if(c.imagefile){var b="image/jpeg",d=c.uploader.dataURItoBlob(c.imagefile,b);c.uploader.uploadFile(d,b)}else c.uploader.Output(M.util.get_string("recui_nothingtosaveerror","filter_poodll"))}),a("#"+c.htmlthings.cancelbutton).on("click",function(b){c.imagefile=!1,a("#"+c.htmlthings.preview).addClass("hide").html(""),a("#"+c.htmlthings.camera).removeClass("hide")}),a("#"+c.htmlthings.snapbutton).on("click",function(b){e.snap(function(b){c.imagefile=b,a("#"+c.htmlthings.preview).html('<img src="'+b+'"/>').removeClass("hide"),a("#"+c.htmlthings.camera).addClass("hide")})})}}});