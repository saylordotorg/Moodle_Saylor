define ("filter_poodll/poodll_pushmediaskin",["jquery","jqueryui","core/log","filter_poodll/utils_amd","filter_poodll/upskin_radial","filter_poodll/upskin_bar","filter_poodll/anim_hwave_mic","filter_poodll/dlg_devicesettings"],function(a,b,c,d,e,f,g,h){"use strict";c.debug("PoodLL Push Skin: initialising");return{instanceprops:null,pmr:null,devsettings:null,therecanim:null,buttonmode:null,strings:null,clone:function clone(){return a.extend(!0,{},this)},init:function init(a,b){this.instanceprops=a;this.pmr=b;this.devsettings=h.clone();this.devsettings.init(b,a);this.strings=this.pmr.fetch_strings();this.strings.recui_pushtospeak=M.util.get_string("recui_pushtospeak","filter_poodll")},fetch_instanceprops:function fetch_instanceprops(){return this.instanceprops},onUploadSuccess:function onUploadSuccess(a){this.set_visual_mode("allfinished",a)},onUploadFailure:function onUploadFailure(){},fetch_status_bar:function fetch_status_bar(a){return"<div class=\"poodll_status_"+a+"\" width=\"320\" height=\"50\">00:00:00</div>"},fetch_preview_audio:function fetch_preview_audio(a){return"<audio class=\"poodll_preview_"+a+" hide\"></audio>"},fetch_preview_video:function fetch_preview_video(a){return this.fetch_preview_audio(a)},fetch_resource_audio:function fetch_resource_audio(a){return"<audio class=\"poodll_resourceplayer_"+a+" hide\" ></audio>"},fetch_resource_video:function fetch_resource_video(a){return this.fetch_resource_audio(a)},onfinalspeechcapture:function onfinalspeechcapture(){this.just_stop()},onMediaError:function onMediaError(a){console.error("media error",a)},onMediaSuccess_video:function onMediaSuccess_video(a){this.fetch_instanceprops();this.set_visual_mode("startbuttonrecording",a)},onMediaSuccess_audio:function onMediaSuccess_audio(a){var b=this.fetch_instanceprops(a);b.controlbar.preview.attr("src",null);b.uploader.Output("");this.therecanim.start();b.timer.reset();b.timer.start();this.update_status(a);this.set_visual_mode("startbuttonrecording",a)},handle_timer_update:function handle_timer_update(a){var b=this.fetch_instanceprops();b.controlbar.status.html(b.timer.fetch_display_time());if(0==b.timer.seconds&&0<b.timer.initseconds){this.stop_and_upload(a)}},update_status:function update_status(){var a=this.fetch_instanceprops();a.controlbar.status.html(a.timer.fetch_display_time())},fetch_uploader_skin:function fetch_uploader_skin(a,b){var c=this.fetch_instanceprops(),d=f.clone();d.init(c.config,b,c.controlbar.playcanvas,c.controlbar.status);return d},set_button_style:function set_button_style(b){a.each(["testbuttonready","testbuttonrecording","startbuttonready","startbuttoncountdown","startbuttonrecording","uploading","allfinished"],function(b,c){a(".poodll_mediarecorderbox_push").removeClass("poodll_mediarecorder_push_"+c);a(".poodll_mediarecorderbox_push").removeClass("push_canclick")});a(".poodll_mediarecorderbox_push").addClass("poodll_mediarecorder_push_"+b);if("testbuttonready"==b||"startbuttonready"==b){a(".poodll_mediarecorderbox_push").addClass("push_canclick")}},set_visual_mode:function set_visual_mode(a){var b=this,c=this.fetch_instanceprops();this.buttonmode=a;c.config.hermes.postMessage({type:"recorderstatus",status:a});switch(a){case"startbuttonready":c.controlbar.thecaption.text(b.strings.recui_pushtospeak);c.controlbar.thecaption.show();c.controlbar.playcanvas.hide();c.controlbar.status.hide();c.controlbar.settingsicon.hide();b.set_button_style(a);break;case"startbuttonrecording":c.controlbar.thecaption.hide();c.controlbar.playcanvas.show();b.set_button_style(a);c.controlbar.status.hide();break;case"uploading":c.controlbar.thecaption.html("<i class=\"fa fa-spinner fa-spin fa-3x fa-fw\"></i>");c.controlbar.thecaption.show();c.controlbar.playcanvas.hide();b.set_button_style(a);c.controlbar.status.hide();break;case"allfinished":c.controlbar.thecaption.text("Finished");c.controlbar.thecaption.show();c.controlbar.playcanvas.hide();c.controlbar.status.hide();b.set_button_style(a);break;}},insert_controlbar_video:function insert_controlbar_video(a,b,c,d){return this.prepare_controlbar_audio(a,b,c,d)},insert_controlbar_audio:function insert_controlbar_audio(a,b,c,d){var e=this.prepare_controlbar(a,b,c,d,"audio");return e},prepare_controlbar:function prepare_controlbar(b,c,d){var e=this.fetch_instanceprops(),f=e.config.media_skin_style,g=this.fetch_status_bar("push"),h="<div class=\"poodll_mediarecorderholder_push "+"poodll_mediarecorder_audio"+"\" id=\"holder_"+c+"\">";h+="<div class=\"poodll_mediarecorderbox_push\" id=\""+c+"\">";h+=this.devsettings.fetch_dialogue_box();h+=e.downloaddialog.fetch_dialogue_box();h+=e.errordialog.fetch_dialogue_box();h+="<div class=\"style-holder "+f+"\">";h+=d,h+="<div class=\"settingsicon\" id=\"settingsicon_"+c+"\"><button type=\"button\" class=\"btn btn-info btn-lg\" data-toggle=\"modal\" data-target=\"#myModal\"><i class=\"fa fa-cogs\" aria-hidden=\"true\"></i></button></div>";h+="<canvas id=\""+c+"_playcanvas\" class=\"poodll_mediarecorder_playcanvas_push\" width=\"180\" height=\"50\"></canvas>";h+="<span id=\""+c+"_caption\" class=\"poodll_mediarecorder_caption_push\"></span>";h+=g,h+="</div></div></div>";a(b).prepend(h);var i={settingsdialog:a("#"+c+" .poodll_dialogue_box_settings"),downloaddialog:a("#"+c+" .poodll_dialogue_box_download"),errorsdialog:a("#"+c+" .poodll_dialogue_box_errors"),settingsicon:a("#"+c+" .settingsicon"),status:a("#"+c+" .poodll_status_push"),preview:a("#"+c+" .poodll_preview_push"),bigbutton:a("#"+c+".poodll_mediarecorderbox_push"),playcanvas:a("#"+c+"_playcanvas"),thecaption:a("#"+c+"_caption"),themicicon:a("#"+c+"_micicon"),stopbutton:a("#"+c+" .poodll_mediarecorder_bogusstopbutton_push"),startbutton:a("#"+c+" .poodll_mediarecorder_bogusstartbutton_push")};e.downloaddialog.set_dialogue_box(i.downloaddialog);e.errordialog.set_dialogue_box(i.errorsdialog);this.devsettings.set_dialogue_box(i.settingsdialog);return i},register_controlbar_events_video:function register_controlbar_events_video(a,b){return this.register_controlbar_events_audio(a,b)},register_controlbar_events_audio:function register_controlbar_events_audio(b,d){var f=this,h=this.pmr,i=this.fetch_instanceprops();i.config.recanim="hwave_mic";var e=g.clone();f.therecanim=e;e.init(i.audioanalyser,i.controlbar.playcanvas.get(0));this.set_visual_mode("startbuttonready");i.controlbar.bigbutton.click(function(g){c.debug(g.target);var e=!1;if(g.target===f||a(g.target).hasClass("style-holder")||a(g.target).hasClass("poodll_mediarecorderbox_push")||a(g.target).hasClass("poodll_mediarecorder_caption_push")||a(g.target).hasClass("poodll_mediarecorder_playcanvas_push")){e=!0}if(!e){return}switch(f.buttonmode){case"startbuttonready":var j={};j.type="recorderstatus";j.status="startbuttonrecording";i.config.hermes.postMessage(j);i.timer.disable();h.do_start_audio(i,b);f.set_visual_mode("startbuttonrecording");break;case"startbuttonrecording":f.just_stop(d);break;case"oldstartbuttonready":var k=function(){var a=new Date().getTime(),c=a-l;if(c>m){i.timer.enable();h.do_start_audio(i,b)}else{var d=!1;if(0>n&&0<c){d=m/1e3}else if(1e3>n&&1e3<c){d=m/1e3-1}else if(2e3>n&&2e3<c){d=m/1e3-2}if(d){var e={type:"countdownstatus",status:d};i.config.hermes.postMessage(e)}n=c;setTimeout(k,100)}};i.config.hermes.enable();f.set_visual_mode("startbuttoncountdown");var l=new Date().getTime(),m=3e3,n=-1;setTimeout(k,100);break;case"stopbutton":f.stop_and_upload();}});i.controlbar.settingsicon.click(function(a){c.debug("we no proapagato");a.stopPropagation();if(!f.uploaded){f.devsettings.open()}else{i.downloaddialog.open()}});window.onbeforeunload=function(){}},just_stop:function just_stop(){var a=this.pmr,b=this.fetch_instanceprops(),c=this.therecanim;if(b.mediaRecorder){a.do_stop_audio(b)}c.clear();b.config.hermes.enable();this.set_visual_mode("startbuttonready")},stop_and_upload:function stop_and_upload(a){var b=this,c=this.pmr,d=this.fetch_instanceprops(),e=b.therecanim;c.do_stop_audio(d);e.clear();d.timer.stop();b.update_status(a);var f=function(){if(d.blobs&&0<d.blobs.length){c.do_save_audio(d);d.uploaded=!0}else{setTimeout(f,200)}};setTimeout(f,200);b.set_visual_mode("uploading")},enable_button:function enable_button(b){a(b).attr("disabled",!1);a(b).removeClass("pmr_disabled")},disable_button:function disable_button(b){a(b).attr("disabled",!0);a(b).addClass("pmr_disabled")}}});
//# sourceMappingURL=poodll_pushmediaskin.min.js.map
