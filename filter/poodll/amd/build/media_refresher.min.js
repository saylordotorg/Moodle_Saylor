define(["jquery","core/log"],function(a,b){"use strict";return b.debug("Media refresher: initialising"),{placeholderduration:null,mediaduration:null,alertconverted:null,clone:function(){return a.extend(!0,{},this)},init:function(a,b,c,d){this.placeholderduration=b,this.mediaduration=c,this.alertconverted=d,this.check_updates(a,"firstpass")},should_be_checked:function(c){return b.debug("mediaduration: "+this.mediaduration),b.debug("placeholderduration: "+this.placeholderduration),b.debug("fixed to one mediaduration: "+parseFloat(this.mediaduration).toFixed(1)),b.debug("fixed to one placeholderduration: "+parseFloat(this.placeholderduration).toFixed(1)),!!a.isNumeric(this.placeholderduration)&&(!!a.isNumeric(this.mediaduration)&&(parseFloat(this.mediaduration).toFixed(1)==parseFloat(this.placeholderduration).toFixed(1)&&""!=c))},check_updates:function(a,c){if(this.should_be_checked(a),"firstpass"!=c||this.should_be_checked(a)){var d=new XMLHttpRequest,e=this;d.onreadystatechange=function(f){if(4===this.readyState)if(200==d.status){var g=d.responseText,h=JSON.parse(g);if(h)switch(h.code){case"mediaready":e.alertconverted();break;case"stillwaiting":setTimeout(function(){e.check_updates(a,"secondpass")},15e3);break;case"notask":"secondpass"==c&&e.alertconverted();break;case"notloggedin":}}else b.debug("Not 200 response:"+d.status)};var f="filename="+a;d.open("POST",M.cfg.wwwroot+"/filter/poodll/ajaxmediaquery.php",!0),d.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),d.setRequestHeader("Cache-Control","no-cache"),d.send(f)}}}});