define(["jquery","core/log"],(function($,log){return log.debug("Media refresher: initialising"),{placeholderduration:null,mediaduration:null,alertconverted:null,clone:function(){return $.extend(!0,{},this)},init:function(filename,placeholderduration,mediaduration,alertconverted){this.placeholderduration=placeholderduration,this.mediaduration=mediaduration,this.alertconverted=alertconverted,this.check_updates(filename,"firstpass")},should_be_checked:function(filename){return log.debug("mediaduration: "+this.mediaduration),log.debug("placeholderduration: "+this.placeholderduration),log.debug("fixed to one mediaduration: "+parseFloat(this.mediaduration).toFixed(1)),log.debug("fixed to one placeholderduration: "+parseFloat(this.placeholderduration).toFixed(1)),!!$.isNumeric(this.placeholderduration)&&(!!$.isNumeric(this.mediaduration)&&(parseFloat(this.mediaduration).toFixed(1)==parseFloat(this.placeholderduration).toFixed(1)&&""!=filename))},check_updates:function(filename,checktype){if(this.should_be_checked(filename),"firstpass"!=checktype||this.should_be_checked(filename)){var xhr=new XMLHttpRequest,that=this;xhr.onreadystatechange=function(e){if(4===this.readyState)if(200==xhr.status){var payload=xhr.responseText,payloadobject=JSON.parse(payload);if(payloadobject)switch(payloadobject.code){case"mediaready":that.alertconverted();break;case"stillwaiting":setTimeout((function(){that.check_updates(filename,"secondpass")}),15e3);break;case"notask":"secondpass"==checktype&&that.alertconverted()}}else log.debug("Not 200 response:"+xhr.status)};var params="filename="+filename;xhr.open("POST",M.cfg.wwwroot+"/filter/poodll/ajaxmediaquery.php",!0),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.setRequestHeader("Cache-Control","no-cache"),xhr.send(params)}}}}));

//# sourceMappingURL=media_refresher.min.js.map