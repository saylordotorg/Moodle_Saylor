define(["jquery","core/log"],(function($,log){return log.debug("Filter Poodll Presets initialising"),{presetdata:!1,dataitems:["name","key","version","instructions","showatto","showplayers","requirecss","requirejs","shim","defaults","amd","body","bodyend","script","style","dataset","datasetvars","alternate","alternateend"],fetchcontrols:function(templateindex){var controls={};return controls.name=document.getElementById("id_s_filter_poodll_templatename_"+templateindex),controls.key=document.getElementById("id_s_filter_poodll_templatekey_"+templateindex),controls.version=document.getElementById("id_s_filter_poodll_templateversion_"+templateindex),controls.instructions=document.getElementById("id_s_filter_poodll_templateinstructions_"+templateindex),controls.showatto=document.getElementById("id_s_filter_poodll_template_showatto_"+templateindex),controls.showplayers=document.getElementById("id_s_filter_poodll_template_showplayers_"+templateindex),controls.requirecss=document.getElementById("id_s_filter_poodll_templaterequire_css_"+templateindex),controls.requirejs=document.getElementById("id_s_filter_poodll_templaterequire_js_"+templateindex),controls.shim=document.getElementById("id_s_filter_poodll_templaterequire_js_shim_"+templateindex),controls.defaults=document.getElementById("id_s_filter_poodll_templatedefaults_"+templateindex),controls.amd=document.getElementById("id_s_filter_poodll_template_amd_"+templateindex),controls.body=document.getElementById("id_s_filter_poodll_template_"+templateindex),controls.bodyend=document.getElementById("id_s_filter_poodll_templateend_"+templateindex),controls.script=document.getElementById("id_s_filter_poodll_templatescript_"+templateindex),controls.style=document.getElementById("id_s_filter_poodll_templatestyle_"+templateindex),controls.dataset=document.getElementById("id_s_filter_poodll_dataset_"+templateindex),controls.datasetvars=document.getElementById("id_s_filter_poodll_datasetvars_"+templateindex),controls.alternate=document.getElementById("id_s_filter_poodll_templatealternate_"+templateindex),controls.alternateend=document.getElementById("id_s_filter_poodll_templatealternate_end_"+templateindex),controls.presetdata=document.getElementById("id_s_filter_poodll_presetdata_"+templateindex),controls},fetchjsonbundle:function(templateindex,controls){var bundle={};$.each(this.dataitems,(function(index,item){bundle[item]=controls[item].value}));var jsonbundle=JSON.stringify(bundle);return jsonbundle},exportbundle:function(templateindex){var controls=this.fetchcontrols(templateindex);if(""!=controls.key.value){var jsonbundle=this.fetchjsonbundle(templateindex,controls),pom=document.createElement("a");if(pom.setAttribute("href","data:text/json;charset=utf-8,"+encodeURIComponent(jsonbundle)),pom.setAttribute("download",controls.key.value+".txt"),document.createEvent){var event=document.createEvent("MouseEvents");event.initEvent("click",!0,!0),pom.dispatchEvent(event)}else pom.click()}},populateform:function(templateindex,presetindex,presetdata){var controls=this.fetchcontrols(templateindex);(presetindex||presetdata)&&(0==presetindex&&presetdata||(presetdata=this.presetdata),$.each(this.dataitems,(function(index,item){if(presetdata[presetindex].hasOwnProperty(item)){if("cleartemplate"!=presetdata[presetindex].key||"key"!=item&&"name"!=item)usevalue=presetdata[presetindex][item];else var usevalue="";controls[item].value=usevalue}else switch(item){case"amd":case"showplayers":case"showatto":controls[item].value=0;break;default:controls[item].value=""}})))},dopopulate:function(templateindex,templatedata){this.populateform(templateindex,0,new Array(templatedata))},init:function(opts){if(!this.presetdata){var controlid="#id_s_filter_poodll_presetdata_"+opts.templateindex,presetcontrol=$(controlid).get(0);this.presetdata=JSON.parse(presetcontrol.value),$(controlid).remove()}var amdpresets=this;$("select[name='filter_poodll/presets']").change((function(){amdpresets.populateform(opts.templateindex,$(this).val())}));var ddsquareid="#id_s_filter_poodll_dragdropsquare_"+opts.templateindex;$(ddsquareid).on("click",(function(){amdpresets.exportbundle(opts.templateindex)})),$(ddsquareid).on("dragover",(function(event){event.preventDefault(),event.stopPropagation(),$(this).addClass("filter_poodll_dragging")})),$(ddsquareid).on("dragleave",(function(event){event.preventDefault(),event.stopPropagation(),$(this).removeClass("filter_poodll_dragging")})),$(ddsquareid).on("drop",(function(event){event.preventDefault();var files=event.originalEvent.dataTransfer.files;if(files.length){var f=files[0];if(f){var r=new FileReader;r.onload=function(e){var contents=e.target.result,templatedata=JSON.parse(contents);templatedata.key&&amdpresets.dopopulate(opts.templateindex,templatedata)},r.readAsText(f)}else alert("Failed to load file")}$(this).removeClass("filter_poodll_dragging")}))}}}));

//# sourceMappingURL=template_presets_amd.min.js.map