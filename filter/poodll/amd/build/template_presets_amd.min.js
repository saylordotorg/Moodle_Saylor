define ("filter_poodll/template_presets_amd",["jquery","core/log"],function(a,b){"use strict";b.debug("Filter Poodll Presets initialising");return{presetdata:!1,dataitems:["name","key","version","instructions","showatto","showplayers","requirecss","requirejs","shim","defaults","amd","body","bodyend","script","style","dataset","datasetvars","alternate","alternateend"],fetchcontrols:function fetchcontrols(a){var b={name:document.getElementById("id_s_filter_poodll_templatename_"+a),key:document.getElementById("id_s_filter_poodll_templatekey_"+a),version:document.getElementById("id_s_filter_poodll_templateversion_"+a),instructions:document.getElementById("id_s_filter_poodll_templateinstructions_"+a),showatto:document.getElementById("id_s_filter_poodll_template_showatto_"+a),showplayers:document.getElementById("id_s_filter_poodll_template_showplayers_"+a),requirecss:document.getElementById("id_s_filter_poodll_templaterequire_css_"+a),requirejs:document.getElementById("id_s_filter_poodll_templaterequire_js_"+a),shim:document.getElementById("id_s_filter_poodll_templaterequire_js_shim_"+a),defaults:document.getElementById("id_s_filter_poodll_templatedefaults_"+a),amd:document.getElementById("id_s_filter_poodll_template_amd_"+a),body:document.getElementById("id_s_filter_poodll_template_"+a),bodyend:document.getElementById("id_s_filter_poodll_templateend_"+a),script:document.getElementById("id_s_filter_poodll_templatescript_"+a),style:document.getElementById("id_s_filter_poodll_templatestyle_"+a),dataset:document.getElementById("id_s_filter_poodll_dataset_"+a),datasetvars:document.getElementById("id_s_filter_poodll_datasetvars_"+a),alternate:document.getElementById("id_s_filter_poodll_templatealternate_"+a),alternateend:document.getElementById("id_s_filter_poodll_templatealternate_end_"+a),presetdata:document.getElementById("id_s_filter_poodll_presetdata_"+a)};return b},fetchjsonbundle:function fetchjsonbundle(b,c){var d={};a.each(this.dataitems,function(a,b){d[b]=c[b].value});var e=JSON.stringify(d);return e},exportbundle:function exportbundle(a){var b=this.fetchcontrols(a);if(""==b.key.value){return}var c=this.fetchjsonbundle(a,b),d=document.createElement("a");d.setAttribute("href","data:text/json;charset=utf-8,"+encodeURIComponent(c));d.setAttribute("download",b.key.value+".txt");if(document.createEvent){var e=document.createEvent("MouseEvents");e.initEvent("click",!0,!0);d.dispatchEvent(e)}else{d.click()}},populateform:function populateform(b,c,d){var e=this.fetchcontrols(b);if(!c&&!d){return}if(!(0==c&&d)){d=this.presetdata}a.each(this.dataitems,function(a,b){if(d[c].hasOwnProperty(b)){if("cleartemplate"==d[c].key&&("key"==b||"name"==b)){var f=""}else{var f=d[c][b]}e[b].value=f}else{switch(b){case"amd":case"showplayers":case"showatto":e[b].value=0;break;default:e[b].value="";}}})},dopopulate:function dopopulate(a,b){this.populateform(a,0,Array(b))},init:function init(b){if(!this.presetdata){var c="#id_s_filter_poodll_presetdata_"+b.templateindex,d=a(c).get(0);this.presetdata=JSON.parse(d.value);a(c).remove()}var e=this;a("select[name='filter_poodll/presets']").change(function(){debugger;e.populateform(b.templateindex,a(this).val())});var f="#id_s_filter_poodll_dragdropsquare_"+b.templateindex;a(f).on("click",function(){e.exportbundle(b.templateindex)});a(f).on("dragover",function(b){b.preventDefault();b.stopPropagation();a(this).addClass("filter_poodll_dragging")});a(f).on("dragleave",function(b){b.preventDefault();b.stopPropagation();a(this).removeClass("filter_poodll_dragging")});a(f).on("drop",function(c){c.preventDefault();var d=c.originalEvent.dataTransfer.files;if(d.length){var g=d[0];if(g){var f=new FileReader;f.onload=function(a){var c=a.target.result,d=JSON.parse(c);if(d.key){e.dopopulate(b.templateindex,d)}};f.readAsText(g)}else{alert("Failed to load file")}}a(this).removeClass("filter_poodll_dragging")})}}});
//# sourceMappingURL=template_presets_amd.min.js.map
