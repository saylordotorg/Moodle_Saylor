define(["jquery","core/log","filter_poodll/utils_amd"],(function($,log,utils){return log.debug("PoodLL Shadow Skin: initialising"),{instanceprops:null,pmr:null,uploaded:!1,recorded:!1,mustResetResourcePlayer:!1,clone:function(){return $.extend(!0,{},this)},init:function(ip,pmr){this.instanceprops=ip,this.pmr=pmr},fetch_instanceprops:function(){return this.instanceprops},onUploadSuccess:function(controlbarid){$("#"+controlbarid+" > .poodll_save-recording").hide(),$("#"+controlbarid+" > .poodll_savedsuccessfully").show()},onUploadFailure:function(controlbarid){},fetch_status_bar:function(skin){return'<div class="poodll_status_'+skin+'"></div>'},fetch_preview_audio:function(skin){return'<audio class="poodll_checkplayer_'+skin+' " style="display: none;" controls playsinline="playsinline" muted></audio>'},fetch_preview_video:function(skin){return'<video class="poodll_checkplayer_'+skin+'" width="320" height="240" playsinline="playsinline" muted></video>'},fetch_resource_audio:function(skin){return'<audio class="poodll_resourceplayer_'+skin+'" style="display: none;" src="@@RESOURCEURL@@" playsinline="playsinline" controls></audio>'},fetch_resource_video:function(skin){return'<video class="poodll_resourceplayer_'+skin+'" style="display: none;" src="@@RESOURCEURL@@" playsinline="playsinline"></video>'},fetch_uploader_skin:function(controlbarid,element){return!1},onMediaError:function(e){console.error("media error",e)},onMediaSuccess_video:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);this.recorded=!0,this.do_play_resource(ip),ip.controlbar.resourceplayer.bind("ended",(function(){ip.controlbar.stopbutton.click()})),this.set_visual_mode("recordingmode",ip)},onMediaSuccess_audio:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.controlbar.preview.attr("src",null),this.recorded=!0,this.do_play_resource(ip),ip.controlbar.resourceplayer.bind("ended",(function(){ip.controlbar.stopbutton.click()})),this.set_visual_mode("recordingmode",ip)},handle_timer_update:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);this.update_status(controlbarid),0==ip.timer.seconds&&ip.timer.initseconds>0&&ip.controlbar.stopbutton.click()},update_status:function(controlbarid){},set_visual_mode:function(mode,ip){switch(mode){case"recordingmode":this.disable_button(ip.controlbar.startbutton),ip.controlbar.startbutton.hide(),this.disable_button(ip.controlbar.stopplaybackbutton),ip.controlbar.stopplaybackbutton.hide(),this.disable_button(ip.controlbar.resourcestopbutton),ip.controlbar.resourcestopbutton.hide(),this.enable_button(ip.controlbar.stopbutton),ip.controlbar.stopbutton.show(),this.disable_button(ip.controlbar.playbackbutton),ip.controlbar.playbackbutton.show(),this.disable_button(ip.controlbar.resourceplaybutton),ip.controlbar.resourceplaybutton.show();break;case"resourceplayingmode":this.disable_button(ip.controlbar.stopbutton),ip.controlbar.stopbutton.hide(),this.disable_button(ip.controlbar.playbackbutton),ip.controlbar.playbackbutton.hide(),this.disable_button(ip.controlbar.resourceplaybutton),ip.controlbar.resourceplaybutton.hide(),this.disable_button(ip.controlbar.startbutton),ip.controlbar.startbutton.show(),this.disable_button(ip.controlbar.stopplaybackbutton),ip.controlbar.stopplaybackbutton.show(),this.enable_button(ip.controlbar.resourcestopbutton),ip.controlbar.resourcestopbutton.show();break;case"playingbackmode":this.disable_button(ip.controlbar.stopbutton),ip.controlbar.stopbutton.hide(),this.disable_button(ip.controlbar.playbackbutton),ip.controlbar.playbackbutton.hide(),this.disable_button(ip.controlbar.resourcestopbutton),ip.controlbar.resourcestopbutton.hide(),this.disable_button(ip.controlbar.startbutton),ip.controlbar.startbutton.show(),this.enable_button(ip.controlbar.stopplaybackbutton),ip.controlbar.stopplaybackbutton.show(),this.disable_button(ip.controlbar.resourceplaybutton),ip.controlbar.resourceplaybutton.show();break;case"neverrecordedmode":this.disable_button(ip.controlbar.stopbutton),ip.controlbar.stopbutton.hide(),this.disable_button(ip.controlbar.stopplaybackbutton),ip.controlbar.stopplaybackbutton.hide(),this.disable_button(ip.controlbar.resourcestopbutton),ip.controlbar.resourcestopbutton.hide(),this.enable_button(ip.controlbar.startbutton),ip.controlbar.startbutton.show(),this.disable_button(ip.controlbar.playbackbutton),ip.controlbar.playbackbutton.show(),this.enable_button(ip.controlbar.resourceplaybutton),ip.controlbar.resourceplaybutton.show();break;case"allstoppedmode":this.disable_button(ip.controlbar.stopbutton),ip.controlbar.stopbutton.hide(),this.disable_button(ip.controlbar.stopplaybackbutton),ip.controlbar.stopplaybackbutton.hide(),this.disable_button(ip.controlbar.resourcestopbutton),ip.controlbar.resourcestopbutton.hide(),this.enable_button(ip.controlbar.startbutton),ip.controlbar.startbutton.show(),this.enable_button(ip.controlbar.playbackbutton),ip.controlbar.playbackbutton.show(),this.enable_button(ip.controlbar.resourceplaybutton),ip.controlbar.resourceplaybutton.show()}},insert_controlbar_video:function(element,controlbarid,preview,resourceplayer){return this.prepare_controlbar(element,controlbarid,preview,resourceplayer,"video")},insert_controlbar_audio:function(element,controlbarid,preview,resourceplayer){return this.prepare_controlbar(element,controlbarid,preview,resourceplayer,"audio")},prepare_controlbar:function(element,controlbarid,preview,resourceplayer,mediatype){var ip=this.fetch_instanceprops(controlbarid),skin_style=ip.config.media_skin_style,recorder_class="video"==mediatype?"poodll_mediarecorder_video":"poodll_mediarecorder_audio";resourceplayer=resourceplayer.replace("@@RESOURCEURL@@",ip.config.resource);var size_class="poodll_mediarecorder_size_auto";switch(ip.config.size){case"small":size_class="poodll_mediarecorder_size_small";break;case"big":size_class="poodll_mediarecorder_size_big";break;case"auto":size_class="poodll_mediarecorder_size_auto"}this.pmr.fetch_strings();var controls='<div class="poodll_mediarecorderholder_shadow '+recorder_class+" "+size_class+'" id="holder_'+controlbarid+'">';return controls+='<div class="poodll_mediarecorderbox_shadow" id="'+controlbarid+'">',controls+='<div class="style-holder '+skin_style+'">',controls+=this.fetch_status_bar("shadow"),controls+=preview,controls+=resourceplayer,controls+='<button type="button" class="poodll_mediarecorder_button_shadow poodll_play-resource_shadow"><span class="fa fa-play-circle fa-4x"></span></button>',controls+='<button type="button" class="poodll_mediarecorder_button_shadow poodll_stop-resource_shadow" style="display: none;"><span class="fa fa-stop-circle fa-4x"></span></button>',controls+='<button type="button" class="poodll_mediarecorder_button_shadow poodll_start-recording_shadow"><span class="fa fa-play-circle fa-4x"></span><hr style="color: white"><span class="fa fa-microphone fa-4x"></span></button>',controls+='<button type="button" class="poodll_mediarecorder_button_shadow poodll_stop-recording_shadow pmr_disabled" style="display: none;" disabled><span class="fa fa-stop-circle fa-4x"></span></button>',controls+=' <button type="button" class="poodll_mediarecorder_button_shadow poodll_playback-recording_shadow pmr_disabled" disabled><span class="fa fa-play-circle fa-4x"></span></button>',controls+=' <button type="button" class="poodll_mediarecorder_button_shadow poodll_stopplayback-recording_shadow" style="display: none;"><span class="fa fa-stop-circle fa-4x"></span></button>',controls+='<div class="marker" style="display: none;"><i class="fa fa-check" aria-hidden="true"></i></div>',controls+="</div></div></div>",$(element).prepend(controls),{marker:$("#"+controlbarid+"  .marker"),status:$("#"+controlbarid+"  .poodll_status_shadow"),resourceplayer:$("#"+controlbarid+"  .poodll_resourceplayer_shadow"),preview:$("#"+controlbarid+"  .poodll_checkplayer_shadow"),resourceplaybutton:$("#"+controlbarid+"  .poodll_play-resource_shadow"),resourcestopbutton:$("#"+controlbarid+"  .poodll_stop-resource_shadow"),startbutton:$("#"+controlbarid+"  .poodll_start-recording_shadow"),stopbutton:$("#"+controlbarid+"  .poodll_stop-recording_shadow"),playbackbutton:$("#"+controlbarid+"  .poodll_playback-recording_shadow"),stopplaybackbutton:$("#"+controlbarid+"  .poodll_stopplayback-recording_shadow"),savebutton:$("#"+controlbarid+"  .poodll_save-recording_shadow")}},register_controlbar_events_video:function(onMediaSuccess,controlbarid){return this.register_controlbar_events_audio(onMediaSuccess,controlbarid)},register_controlbar_events_audio:function(onMediaSuccess,controlbarid){var self=this,pmr=this.pmr,ip=this.fetch_instanceprops(controlbarid);ip.controlbar.startbutton.click((function(){pmr.do_start_audio(ip,onMediaSuccess)})),ip.controlbar.stopbutton.click((function(){pmr.do_stop_audio(ip),self.disable_button(this);var resourceplayer=ip.controlbar.resourceplayer;resourceplayer&&resourceplayer.get(0)&&resourceplayer.get(0).pause(),self.set_visual_mode("allstoppedmode",ip),self.do_stop_resource(ip)})),ip.controlbar.playbackbutton.click((function(){self.disable_button(this),ip.controlbar.marker.show();var resourceplayer=ip.controlbar.resourceplayer.get(0);pmr.do_play_audio(ip,resourceplayer),ip.mustResetResourcePlayer=!0,ip.controlbar.resourceplayer.bind("ended",(function(){self.set_visual_mode("allstoppedmode",ip)})),self.set_visual_mode("playingbackmode",ip),self.set_completion(!0,ip)})),ip.controlbar.stopplaybackbutton.click((function(){self.do_stop_resource(ip),self.set_visual_mode("allstoppedmode",ip)})),ip.controlbar.resourceplaybutton.click((function(){self.do_play_resource(ip),ip.controlbar.resourceplayer.bind("ended",(function(){self.recorded?self.set_visual_mode("allstoppedmode",ip):self.set_visual_mode("neverrecordedmode",ip)})),self.set_visual_mode("resourceplayingmode",ip)})),ip.controlbar.resourcestopbutton.click((function(){self.do_stop_resource(ip),self.recorded?self.set_visual_mode("allstoppedmode",ip):self.set_visual_mode("neverrecordedmode",ip)})),ip.controlbar.savebutton.click((function(){return self.disable_button(this),ip.blobs&&ip.blobs.length>0?(pmr.do_save_audio(ip),self.uploaded=!0,self.disable_button(ip.controlbar.startbutton)):ip.uploader.Output(M.util.get_string("recui_nothingtosaveerror","filter_poodll")),!1})),window.onbeforeunload=function(){self.enable_button(ip.controlbar.startbutton);var preview=ip.controlbar.preview;preview&&preview.get(0)&&preview.get(0).pause()}},set_completion:function(completed,ip){},do_stop_resource:function(ip){console.log("stopped the resource");var resourceplayer=ip.controlbar.resourceplayer.get(0);if(resourceplayer.pause(),resourceplayer.currentTime=0,ip.mustResetResourcePlayer){ip.mustResetResourcePlayer=!1,resourceplayer.src=ip.config.resource;resourceplayer.load()}},do_play_resource:function(ip){var resourceplayer=ip.controlbar.resourceplayer.get(0);resourceplayer.play(),resourceplayer.currentTime=0},enable_button:function(button){$(button).attr("disabled",!1),$(button).removeClass("pmr_disabled")},disable_button:function(button){$(button).attr("disabled",!0),$(button).addClass("pmr_disabled")}}}));

//# sourceMappingURL=poodll_shadowmediaskin.min.js.map