define(["jquery","core/log","filter_poodll/uploader"],(function($,log,uploader){return log.debug("PoodLL Upload Recorder: initialising"),{config:null,instanceprops:[],fetch_instance_props:function(widgetid){return this.instanceprops[widgetid]},init_instance_props:function(widgetid){var props={config:null,uploader:null};this.instanceprops[widgetid]=props},supports_current_browser:function(config){return!0},embed:function(element,config){this.init_instance_props(config.widgetid);var ip=this.fetch_instance_props(config.widgetid);ip.config=config,ip.uploader=uploader.clone(),ip.uploader.init(element,config),this.insert_controls(element,config.widgetid),this.register_events(config.widgetid)},insert_controls:function(element,widgetid){var acceptmedia="",config=this.fetch_instance_props(widgetid).config;switch(config.mediatype){case"video":acceptmedia="video/*";break;case"snapshot":case"image":acceptmedia="image/*";case"audio":acceptmedia=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream?"video/*":"audio/*";default:acceptmedia=""}var controls='<div class="p_btn_wrapper">';controls+='<input type="file" id="'+config.widgetid+'_poodllfileselect" name="poodllfileselect[]" accept="'+acceptmedia+'"/>',controls+='<button type="button" class="p_btn">'+M.util.get_string("recui_recordorchoose","filter_poodll")+"</button>",controls+="</div>",$(element).prepend(controls)},register_events:function(widgetid){var self=this;$("#"+widgetid+"_poodllfileselect").on("change",(function(e){self.FileSelectHandler(e,widgetid)}))},FileSelectHandler:function(e,widgetid){for(var file,ip=this.fetch_instance_props(widgetid),files=e.target.files||e.dataTransfer.files,i=0;file=files[i];i++)log.debug("filetype:"+file.type),ip.uploader.uploadBlob(file,file.type)},ParseFile:function(file,widgetid){var ip=this.fetch_instance_props(widgetid),filedata="",reader=new FileReader;reader.onloadend=function(e){filedata=e.target.result,ip.uploader.uploadFile(filedata,file.type)},log.debug("filetype:"+file.type),reader.readAsDataURL(file)}}}));

//# sourceMappingURL=poodll_uploadrecorder.min.js.map