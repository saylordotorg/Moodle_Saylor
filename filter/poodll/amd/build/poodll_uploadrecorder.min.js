define(["jquery","core/log","filter_poodll/uploader"],function(a,b,c){"use strict";return b.debug("PoodLL Upload Recorder: initialising"),{config:null,instanceprops:[],fetch_instance_props:function(a){return this.instanceprops[a]},init_instance_props:function(a){var b={};b.config=null,b.uploader=null,this.instanceprops[a]=b},supports_current_browser:function(a){return!0},embed:function(a,b){this.init_instance_props(b.widgetid);var d=this.fetch_instance_props(b.widgetid);d.config=b,d.uploader=c.clone(),d.uploader.init(a,b),this.insert_controls(a,b.widgetid),this.register_events(b.widgetid)},insert_controls:function(b,c){var d=this.fetch_instance_props(c),e="",f=d.config;switch(f.mediatype){case"video":e="video/*";break;case"snapshot":case"image":e="image/*";case"audio":var g=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;e=g?"video/*":"audio/*";default:e=""}var h='<div class="p_btn_wrapper">';h+='<input type="file" id="'+f.widgetid+'_poodllfileselect" name="poodllfileselect[]" accept="'+e+'"/>',h+='<button type="button" class="p_btn">'+M.util.get_string("recui_recordorchoose","filter_poodll")+"</button>",h+="</div>",a(b).prepend(h)},register_events:function(b){var c=this;a("#"+b+"_poodllfileselect").on("change",function(a){c.FileSelectHandler(a,b)})},FileSelectHandler:function(a,c){for(var d,e=this.fetch_instance_props(c),f=a.target.files||a.dataTransfer.files,g=0;d=f[g];g++)b.debug("filetype:"+d.type),e.uploader.uploadBlob(d,d.type)},ParseFile:function(a,c){var d=this.fetch_instance_props(c),e="",f=new FileReader;f.onloadend=function(b){e=b.target.result,d.uploader.uploadFile(e,a.type)},b.debug("filetype:"+a.type),f.readAsDataURL(a)}}});