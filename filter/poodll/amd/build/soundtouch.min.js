!function(a,b){"function"==typeof define&&define.amd?define([],function(){return b(a)}):a.CloudPoodll=b(a)}(this,function(){function a(a,b){for(var c in b){var d=b.__lookupGetter__(c),e=b.__lookupSetter__(c);d||e?(d&&a.__defineGetter__(c,d),e&&a.__defineSetter__(c,e)):a[c]=b[c]}return a}function b(a,b){return(a>b?a-b:b-a)>1e-10}function c(a){a?(this.inputBuffer=new e,this.outputBuffer=new e):this.inputBuffer=this.outputBuffer=null}function d(a){c.call(this,a),this._reset(),this.rate=1}function e(){this._vector=new Float32Array,this._position=0,this._frameCount=0}function f(a,b){this._pipe=b,this.sourceSound=a,this.historyBufferSize=22050,this._sourcePosition=0,this.outputBufferPosition=0,this._position=0}function g(a,b){c.call(this,a),this.bQuickSeek=!0,this.bMidBufferDirty=!1,this.pMidBuffer=null,this.overlapLength=0,this.bAutoSeqSetting=!0,this.bAutoSeekSetting=!0,this._tempo=1,this.setParameters(b,l,n,o)}function h(a){this.rateTransposer=new d((!1)),this.tdStretch=new g((!1),a),this._inputBuffer=new e,this._intermediateBuffer=new e,this._outputBuffer=new e,this._rate=0,this._tempo=0,this.virtualPitch=1,this.virtualRate=1,this.virtualTempo=1,this._calculateEffectiveRateAndTempo()}function i(a){this.buffer=a}function j(a,b){var c=4096,d=a.createScriptProcessor(c,2,2),e=new Float32Array(2*c);return d.onaudioprocess=function(a){var f=a.outputBuffer.getChannelData(0),g=a.outputBuffer.getChannelData(1),h=b.extract(e,c);0===h&&d.disconnect();for(var i=0;i<h;i++)f[i]=e[2*i],g[i]=e[2*i+1]},d}var k=0,l=k,m=0,n=m,o=8,p=[[124,186,248,310,372,434,496,558,620,682,744,806,868,930,992,1054,1116,1178,1240,1302,1364,1426,1488,0],[-100,-75,-50,-25,25,50,75,100,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-20,-15,-10,-5,5,10,15,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-4,-3,-2,-1,1,2,3,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],q=.5,r=2,s=125,t=50,u=(t-s)/(r-q),v=s-u*q,w=25,x=15,y=(x-w)/(r-q),z=w-y*q;return c.prototype={get inputBuffer(){return this._inputBuffer},set inputBuffer(a){this._inputBuffer=a},get outputBuffer(){return this._outputBuffer},set outputBuffer(a){this._outputBuffer=a},clear:function(){this._inputBuffer.clear(),this._outputBuffer.clear()}},a(d.prototype,c.prototype),a(d.prototype,{set rate(a){this._rate=a},_reset:function(){this.slopeCount=0,this.prevSampleL=0,this.prevSampleR=0},process:function(){var a=this._inputBuffer.frameCount;this._outputBuffer.ensureAdditionalCapacity(a/this._rate+1);var b=this._transpose(a);this._inputBuffer.receive(),this._outputBuffer.put(b)},_transpose:function(a){if(0===a)return 0;for(var b=this._inputBuffer.vector,c=this._inputBuffer.startIndex,d=this._outputBuffer.vector,e=this._outputBuffer.endIndex,f=0,g=0;this.slopeCount<1;)d[e+2*g]=(1-this.slopeCount)*this.prevSampleL+this.slopeCount*b[c],d[e+2*g+1]=(1-this.slopeCount)*this.prevSampleR+this.slopeCount*b[c+1],g++,this.slopeCount+=this._rate;if(this.slopeCount-=1,1!=a)a:for(;;){for(;this.slopeCount>1;)if(this.slopeCount-=1,f++,f>=a-1)break a;var h=c+2*f;d[e+2*g]=(1-this.slopeCount)*b[h]+this.slopeCount*b[h+2],d[e+2*g+1]=(1-this.slopeCount)*b[h+1]+this.slopeCount*b[h+3],g++,this.slopeCount+=this._rate}return this.prevSampleL=b[c+2*a-2],this.prevSampleR=b[c+2*a-1],g}}),e.prototype={get vector(){return this._vector},get position(){return this._position},get startIndex(){return 2*this._position},get frameCount(){return this._frameCount},get endIndex(){return 2*(this._position+this._frameCount)},clear:function(a){this.receive(a),this.rewind()},put:function(a){this._frameCount+=a},putSamples:function(a,b,c){b=b||0;var d=2*b;c>=0||(c=(a.length-d)/2);var e=2*c;this.ensureCapacity(c+this._frameCount);var f=this.endIndex;this._vector.set(a.subarray(d,d+e),f),this._frameCount+=c},putBuffer:function(a,b,c){b=b||0,c>=0||(c=a.frameCount-b),this.putSamples(a.vector,a.position+b,c)},receive:function(a){a>=0&&!(a>this._frameCount)||(a=this._frameCount),this._frameCount-=a,this._position+=a},receiveSamples:function(a,b){var c=2*b,d=this.startIndex;a.set(this._vector.subarray(d,d+c)),this.receive(b)},extract:function(a,b,c){var d=this.startIndex+2*b,e=2*c;a.set(this._vector.subarray(d,d+e))},ensureCapacity:function(a){var b=2*a;if(this._vector.length<b){var c=new Float32Array(b);c.set(this._vector.subarray(this.startIndex,this.endIndex)),this._vector=c,this._position=0}else this.rewind()},ensureAdditionalCapacity:function(a){this.ensureCapacity(this.frameCount+a)},rewind:function(){this._position>0&&(this._vector.set(this._vector.subarray(this.startIndex,this.endIndex)),this._position=0)}},f.prototype={get pipe(){return this._pipe},get position(){return this._position},set position(a){if(a>this._position)throw new RangeError("New position may not be greater than current position");var b=this.outputBufferPosition-(this._position-a);if(b<0)throw new RangeError("New position falls outside of history buffer");this.outputBufferPosition=b,this._position=a},get sourcePosition(){return this._sourcePosition},set sourcePosition(a){this.clear(),this._sourcePosition=a},get inputBuffer(){return this._pipe.inputBuffer},get outputBuffer(){return this._pipe.outputBuffer},fillInputBuffer:function(a){var b=new Float32Array(2*a),c=this.sourceSound.extract(b,a,this._sourcePosition);this._sourcePosition+=c,this.inputBuffer.putSamples(b,0,c)},fillOutputBuffer:function(a){for(;this.outputBuffer.frameCount<a;){var b=16384-this.inputBuffer.frameCount;if(this.fillInputBuffer(b),this.inputBuffer.frameCount<16384)break;this._pipe.process()}},extract:function(a,b){this.fillOutputBuffer(this.outputBufferPosition+b);var c=Math.min(b,this.outputBuffer.frameCount-this.outputBufferPosition);this.outputBuffer.extract(a,this.outputBufferPosition,c);var d=this.outputBufferPosition+c;return this.outputBufferPosition=Math.min(this.historyBufferSize,d),this.outputBuffer.receive(Math.max(d-this.historyBufferSize,0)),this._position+=c,c},handleSampleData:function(a){this.extract(a.data,4096)},clear:function(){this._pipe.clear(),this.outputBufferPosition=0}},a(g.prototype,c.prototype),a(g.prototype,{clear:function(){c.prototype.clear.call(this),this._clearMidBuffer()},_clearMidBuffer:function(){this.bMidBufferDirty&&(this.bMidBufferDirty=!1,this.pMidBuffer=null)},setParameters:function(a,b,c,d){a>0&&(this.sampleRate=a),d>0&&(this.overlapMs=d),b>0?(this.sequenceMs=b,this.bAutoSeqSetting=!1):this.bAutoSeqSetting=!0,c>0?(this.seekWindowMs=c,this.bAutoSeekSetting=!1):this.bAutoSeekSetting=!0,this.calcSeqParameters(),this.calculateOverlapLength(this.overlapMs),this.tempo=this._tempo},set tempo(a){var b;this._tempo=a,this.calcSeqParameters(),this.nominalSkip=this._tempo*(this.seekWindowLength-this.overlapLength),this.skipFract=0,b=Math.floor(this.nominalSkip+.5),this.sampleReq=Math.max(b+this.overlapLength,this.seekWindowLength)+this.seekLength},get inputChunkSize(){return this.sampleReq},get outputChunkSize(){return this.overlapLength+Math.max(0,this.seekWindowLength-2*this.overlapLength)},calculateOverlapLength:function(a){var b;b=this.sampleRate*a/1e3,b<16&&(b=16),b-=b%8,this.overlapLength=b,this.pRefMidBuffer=new Float32Array(2*this.overlapLength),this.pMidBuffer=new Float32Array(2*this.overlapLength)},checkLimits:function(a,b,c){return a<b?b:a>c?c:a},calcSeqParameters:function(){var a,b;this.bAutoSeqSetting&&(a=v+u*this._tempo,a=this.checkLimits(a,t,s),this.sequenceMs=Math.floor(a+.5)),this.bAutoSeekSetting&&(b=z+y*this._tempo,b=this.checkLimits(b,x,w),this.seekWindowMs=Math.floor(b+.5)),this.seekWindowLength=Math.floor(this.sampleRate*this.sequenceMs/1e3),this.seekLength=Math.floor(this.sampleRate*this.seekWindowMs/1e3)},set quickSeek(a){this.bQuickSeek=a},seekBestOverlapPosition:function(){return this.bQuickSeek?this.seekBestOverlapPositionStereoQuick():this.seekBestOverlapPositionStereo()},seekBestOverlapPositionStereo:function(){var a,b,c,d;for(this.precalcCorrReferenceStereo(),b=Number.MIN_VALUE,a=0,d=0;d<this.seekLength;d++)c=this.calcCrossCorrStereo(2*d,this.pRefMidBuffer),c>b&&(b=c,a=d);return a},seekBestOverlapPositionStereoQuick:function(){var a,b,c,d,e,f,g;for(this.precalcCorrReferenceStereo(),c=Number.MIN_VALUE,b=0,f=0,g=0,e=0;e<4;e++){for(a=0;p[e][a]&&(g=f+p[e][a],!(g>=this.seekLength));)d=this.calcCrossCorrStereo(2*g,this.pRefMidBuffer),d>c&&(c=d,b=g),a++;f=b}return b},precalcCorrReferenceStereo:function(){var a,b,c;for(a=0;a<this.overlapLength;a++)c=a*(this.overlapLength-a),b=2*a,this.pRefMidBuffer[b]=this.pMidBuffer[b]*c,this.pRefMidBuffer[b+1]=this.pMidBuffer[b+1]*c},calcCrossCorrStereo:function(a,b){var c=this._inputBuffer.vector;a+=this._inputBuffer.startIndex;var d,e,f;for(d=0,e=2;e<2*this.overlapLength;e+=2)f=e+a,d+=c[f]*b[e]+c[f+1]*b[e+1];return d},overlap:function(a){this.overlapStereo(2*a)},overlapStereo:function(a){var b=this._inputBuffer.vector;a+=this._inputBuffer.startIndex;var c,d,e,f,g,h,i,j=this._outputBuffer.vector,k=this._outputBuffer.endIndex;for(f=1/this.overlapLength,c=0;c<this.overlapLength;c++)e=(this.overlapLength-c)*f,g=c*f,d=2*c,h=d+a,i=d+k,j[i+0]=b[h+0]*g+this.pMidBuffer[d+0]*e,j[i+1]=b[h+1]*g+this.pMidBuffer[d+1]*e},process:function(){var a,b,c;if(null===this.pMidBuffer){if(this._inputBuffer.frameCount<this.overlapLength)return;this.pMidBuffer=new Float32Array(2*this.overlapLength),this._inputBuffer.receiveSamples(this.pMidBuffer,this.overlapLength)}for(;this._inputBuffer.frameCount>=this.sampleReq;){b=this.seekBestOverlapPosition(),this._outputBuffer.ensureAdditionalCapacity(this.overlapLength),this.overlap(Math.floor(b)),this._outputBuffer.put(this.overlapLength),c=this.seekWindowLength-2*this.overlapLength,c>0&&this._outputBuffer.putBuffer(this._inputBuffer,b+this.overlapLength,c);var d=this.inputBuffer.startIndex+2*(b+this.seekWindowLength-this.overlapLength);this.pMidBuffer.set(this._inputBuffer.vector.subarray(d,d+2*this.overlapLength)),this.skipFract+=this.nominalSkip,a=Math.floor(this.skipFract),this.skipFract-=a,this._inputBuffer.receive(a)}}}),a(g.prototype,{get tempo(){return this._tempo}}),h.prototype={clear:function(){this.rateTransposer.clear(),this.tdStretch.clear()},get rate(){return this._rate},set rate(a){this.virtualRate=a,this._calculateEffectiveRateAndTempo()},set rateChange(a){this.rate=1+.01*a},get tempo(){return this._tempo},set tempo(a){this.virtualTempo=a,this._calculateEffectiveRateAndTempo()},set tempoChange(a){this.tempo=1+.01*a},set pitch(a){this.virtualPitch=a,this._calculateEffectiveRateAndTempo()},set pitchOctaves(a){this.pitch=Math.exp(.69314718056*a),this._calculateEffectiveRateAndTempo()},set pitchSemitones(a){this.pitchOctaves=a/12},get inputBuffer(){return this._inputBuffer},get outputBuffer(){return this._outputBuffer},_calculateEffectiveRateAndTempo:function(){var a=this._tempo,c=this._rate;this._tempo=this.virtualTempo/this.virtualPitch,this._rate=this.virtualRate*this.virtualPitch,b(this._tempo,a)&&(this.tdStretch.tempo=this._tempo),b(this._rate,c)&&(this.rateTransposer.rate=this._rate),this._rate>1?this._outputBuffer!=this.rateTransposer.outputBuffer&&(this.tdStretch.inputBuffer=this._inputBuffer,this.tdStretch.outputBuffer=this._intermediateBuffer,this.rateTransposer.inputBuffer=this._intermediateBuffer,this.rateTransposer.outputBuffer=this._outputBuffer):this._outputBuffer!=this.tdStretch.outputBuffer&&(this.rateTransposer.inputBuffer=this._inputBuffer,this.rateTransposer.outputBuffer=this._intermediateBuffer,this.tdStretch.inputBuffer=this._intermediateBuffer,this.tdStretch.outputBuffer=this._outputBuffer)},process:function(){this._rate>1?(this.tdStretch.process(),this.rateTransposer.process()):(this.rateTransposer.process(),this.tdStretch.process())}},i.prototype={extract:function(a,b,c){for(var d=this.buffer.getChannelData(0),e=this.buffer.getChannelData(1),f=0;f<b;f++)a[2*f]=d[f+c],a[2*f+1]=e[f+c];return Math.min(b,d.length-c)}},soundtouch={RateTransposer:d,Stretch:g,SimpleFilter:f,SoundTouch:h,WebAudioBufferSource:i,getWebAudioNode:j}});