var root,factory;root=window,factory=function(){var _SCAN_OFFSETS=[[124,186,248,310,372,434,496,558,620,682,744,806,868,930,992,1054,1116,1178,1240,1302,1364,1426,1488,0],[-100,-75,-50,-25,25,50,75,100,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-20,-15,-10,-5,5,10,15,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-4,-3,-2,-1,1,2,3,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]];function extend(a,b){for(var i in b){var g=b.__lookupGetter__(i),s=b.__lookupSetter__(i);g||s?(g&&a.__defineGetter__(i,g),s&&a.__defineSetter__(i,s)):a[i]=b[i]}return a}function testFloatEqual(a,b){return(a>b?a-b:b-a)>1e-10}function AbstractFifoSamplePipe(createBuffers){createBuffers?(this.inputBuffer=new FifoSampleBuffer,this.outputBuffer=new FifoSampleBuffer):this.inputBuffer=this.outputBuffer=null}function RateTransposer(createBuffers){AbstractFifoSamplePipe.call(this,createBuffers),this._reset(),this.rate=1}function FifoSampleBuffer(){this._vector=new Float32Array,this._position=0,this._frameCount=0}function SimpleFilter(sourceSound,pipe){this._pipe=pipe,this.sourceSound=sourceSound,this.historyBufferSize=22050,this._sourcePosition=0,this.outputBufferPosition=0,this._position=0}function Stretch(createBuffers,sampleRate){AbstractFifoSamplePipe.call(this,createBuffers),this.bQuickSeek=!0,this.bMidBufferDirty=!1,this.pMidBuffer=null,this.overlapLength=0,this.bAutoSeqSetting=!0,this.bAutoSeekSetting=!0,this._tempo=1,this.setParameters(sampleRate,0,0,8)}function SoundTouch(sampleRate){this.rateTransposer=new RateTransposer(!1),this.tdStretch=new Stretch(!1,sampleRate),this._inputBuffer=new FifoSampleBuffer,this._intermediateBuffer=new FifoSampleBuffer,this._outputBuffer=new FifoSampleBuffer,this._rate=0,this._tempo=0,this.virtualPitch=1,this.virtualRate=1,this.virtualTempo=1,this._calculateEffectiveRateAndTempo()}function WebAudioBufferSource(buffer){this.buffer=buffer}return AbstractFifoSamplePipe.prototype={get inputBuffer(){return this._inputBuffer},set inputBuffer(inputBuffer){this._inputBuffer=inputBuffer},get outputBuffer(){return this._outputBuffer},set outputBuffer(outputBuffer){this._outputBuffer=outputBuffer},clear:function(){this._inputBuffer.clear(),this._outputBuffer.clear()}},extend(RateTransposer.prototype,AbstractFifoSamplePipe.prototype),extend(RateTransposer.prototype,{set rate(rate){this._rate=rate},_reset:function(){this.slopeCount=0,this.prevSampleL=0,this.prevSampleR=0},process:function(){var numFrames=this._inputBuffer.frameCount;this._outputBuffer.ensureAdditionalCapacity(numFrames/this._rate+1);var numFramesOutput=this._transpose(numFrames);this._inputBuffer.receive(),this._outputBuffer.put(numFramesOutput)},_transpose:function(numFrames){if(0===numFrames)return 0;for(var src=this._inputBuffer.vector,srcOffset=this._inputBuffer.startIndex,dest=this._outputBuffer.vector,destOffset=this._outputBuffer.endIndex,used=0,i=0;this.slopeCount<1;)dest[destOffset+2*i]=(1-this.slopeCount)*this.prevSampleL+this.slopeCount*src[srcOffset],dest[destOffset+2*i+1]=(1-this.slopeCount)*this.prevSampleR+this.slopeCount*src[srcOffset+1],i++,this.slopeCount+=this._rate;if(this.slopeCount-=1,1!=numFrames)out:for(;;){for(;this.slopeCount>1;)if(this.slopeCount-=1,++used>=numFrames-1)break out;var srcIndex=srcOffset+2*used;dest[destOffset+2*i]=(1-this.slopeCount)*src[srcIndex]+this.slopeCount*src[srcIndex+2],dest[destOffset+2*i+1]=(1-this.slopeCount)*src[srcIndex+1]+this.slopeCount*src[srcIndex+3],i++,this.slopeCount+=this._rate}return this.prevSampleL=src[srcOffset+2*numFrames-2],this.prevSampleR=src[srcOffset+2*numFrames-1],i}}),FifoSampleBuffer.prototype={get vector(){return this._vector},get position(){return this._position},get startIndex(){return 2*this._position},get frameCount(){return this._frameCount},get endIndex(){return 2*(this._position+this._frameCount)},clear:function(frameCount){this.receive(frameCount),this.rewind()},put:function(numFrames){this._frameCount+=numFrames},putSamples:function(samples,position,numFrames){var sourceOffset=2*(position=position||0);numFrames>=0||(numFrames=(samples.length-sourceOffset)/2);var numSamples=2*numFrames;this.ensureCapacity(numFrames+this._frameCount);var destOffset=this.endIndex;this._vector.set(samples.subarray(sourceOffset,sourceOffset+numSamples),destOffset),this._frameCount+=numFrames},putBuffer:function(buffer,position,numFrames){position=position||0,numFrames>=0||(numFrames=buffer.frameCount-position),this.putSamples(buffer.vector,buffer.position+position,numFrames)},receive:function(numFrames){numFrames>=0&&!(numFrames>this._frameCount)||(numFrames=this._frameCount),this._frameCount-=numFrames,this._position+=numFrames},receiveSamples:function(output,numFrames){var numSamples=2*numFrames,sourceOffset=this.startIndex;output.set(this._vector.subarray(sourceOffset,sourceOffset+numSamples)),this.receive(numFrames)},extract:function(output,position,numFrames){var sourceOffset=this.startIndex+2*position,numSamples=2*numFrames;output.set(this._vector.subarray(sourceOffset,sourceOffset+numSamples))},ensureCapacity:function(numFrames){var minLength=2*numFrames;if(this._vector.length<minLength){var newVector=new Float32Array(minLength);newVector.set(this._vector.subarray(this.startIndex,this.endIndex)),this._vector=newVector,this._position=0}else this.rewind()},ensureAdditionalCapacity:function(numFrames){this.ensureCapacity(this.frameCount+numFrames)},rewind:function(){this._position>0&&(this._vector.set(this._vector.subarray(this.startIndex,this.endIndex)),this._position=0)}},SimpleFilter.prototype={get pipe(){return this._pipe},get position(){return this._position},set position(position){if(position>this._position)throw new RangeError("New position may not be greater than current position");var newOutputBufferPosition=this.outputBufferPosition-(this._position-position);if(newOutputBufferPosition<0)throw new RangeError("New position falls outside of history buffer");this.outputBufferPosition=newOutputBufferPosition,this._position=position},get sourcePosition(){return this._sourcePosition},set sourcePosition(sourcePosition){this.clear(),this._sourcePosition=sourcePosition},get inputBuffer(){return this._pipe.inputBuffer},get outputBuffer(){return this._pipe.outputBuffer},fillInputBuffer:function(numFrames){var samples=new Float32Array(2*numFrames),numFramesExtracted=this.sourceSound.extract(samples,numFrames,this._sourcePosition);this._sourcePosition+=numFramesExtracted,this.inputBuffer.putSamples(samples,0,numFramesExtracted)},fillOutputBuffer:function(numFrames){for(;this.outputBuffer.frameCount<numFrames;){var numInputFrames=16384-this.inputBuffer.frameCount;if(this.fillInputBuffer(numInputFrames),this.inputBuffer.frameCount<16384)break;this._pipe.process()}},extract:function(target,numFrames){this.fillOutputBuffer(this.outputBufferPosition+numFrames);var numFramesExtracted=Math.min(numFrames,this.outputBuffer.frameCount-this.outputBufferPosition);this.outputBuffer.extract(target,this.outputBufferPosition,numFramesExtracted);var currentFrames=this.outputBufferPosition+numFramesExtracted;return this.outputBufferPosition=Math.min(this.historyBufferSize,currentFrames),this.outputBuffer.receive(Math.max(currentFrames-this.historyBufferSize,0)),this._position+=numFramesExtracted,numFramesExtracted},handleSampleData:function(e){this.extract(e.data,4096)},clear:function(){this._pipe.clear(),this.outputBufferPosition=0}},extend(Stretch.prototype,AbstractFifoSamplePipe.prototype),extend(Stretch.prototype,{clear:function(){AbstractFifoSamplePipe.prototype.clear.call(this),this._clearMidBuffer()},_clearMidBuffer:function(){this.bMidBufferDirty&&(this.bMidBufferDirty=!1,this.pMidBuffer=null)},setParameters:function(aSampleRate,aSequenceMS,aSeekWindowMS,aOverlapMS){aSampleRate>0&&(this.sampleRate=aSampleRate),aOverlapMS>0&&(this.overlapMs=aOverlapMS),aSequenceMS>0?(this.sequenceMs=aSequenceMS,this.bAutoSeqSetting=!1):this.bAutoSeqSetting=!0,aSeekWindowMS>0?(this.seekWindowMs=aSeekWindowMS,this.bAutoSeekSetting=!1):this.bAutoSeekSetting=!0,this.calcSeqParameters(),this.calculateOverlapLength(this.overlapMs),this.tempo=this._tempo},set tempo(newTempo){var intskip;this._tempo=newTempo,this.calcSeqParameters(),this.nominalSkip=this._tempo*(this.seekWindowLength-this.overlapLength),this.skipFract=0,intskip=Math.floor(this.nominalSkip+.5),this.sampleReq=Math.max(intskip+this.overlapLength,this.seekWindowLength)+this.seekLength},get inputChunkSize(){return this.sampleReq},get outputChunkSize(){return this.overlapLength+Math.max(0,this.seekWindowLength-2*this.overlapLength)},calculateOverlapLength:function(overlapInMsec){var newOvl;(newOvl=this.sampleRate*overlapInMsec/1e3)<16&&(newOvl=16),newOvl-=newOvl%8,this.overlapLength=newOvl,this.pRefMidBuffer=new Float32Array(2*this.overlapLength),this.pMidBuffer=new Float32Array(2*this.overlapLength)},checkLimits:function(x,mi,ma){return x<mi?mi:x>ma?ma:x},calcSeqParameters:function(){var seq,seek;this.bAutoSeqSetting&&(seq=150+-50*this._tempo,seq=this.checkLimits(seq,50,125),this.sequenceMs=Math.floor(seq+.5)),this.bAutoSeekSetting&&(seek=28.333333333333332+-6.666666666666667*this._tempo,seek=this.checkLimits(seek,15,25),this.seekWindowMs=Math.floor(seek+.5)),this.seekWindowLength=Math.floor(this.sampleRate*this.sequenceMs/1e3),this.seekLength=Math.floor(this.sampleRate*this.seekWindowMs/1e3)},set quickSeek(enable){this.bQuickSeek=enable},seekBestOverlapPosition:function(){return this.bQuickSeek?this.seekBestOverlapPositionStereoQuick():this.seekBestOverlapPositionStereo()},seekBestOverlapPositionStereo:function(){var bestOffs,bestCorr,corr,i;for(this.precalcCorrReferenceStereo(),bestCorr=Number.MIN_VALUE,bestOffs=0,i=0;i<this.seekLength;i++)(corr=this.calcCrossCorrStereo(2*i,this.pRefMidBuffer))>bestCorr&&(bestCorr=corr,bestOffs=i);return bestOffs},seekBestOverlapPositionStereoQuick:function(){var j,bestOffs,bestCorr,corr,scanCount,corrOffset,tempOffset;for(this.precalcCorrReferenceStereo(),bestCorr=Number.MIN_VALUE,bestOffs=0,corrOffset=0,tempOffset=0,scanCount=0;scanCount<4;scanCount++){for(j=0;_SCAN_OFFSETS[scanCount][j]&&!((tempOffset=corrOffset+_SCAN_OFFSETS[scanCount][j])>=this.seekLength);)(corr=this.calcCrossCorrStereo(2*tempOffset,this.pRefMidBuffer))>bestCorr&&(bestCorr=corr,bestOffs=tempOffset),j++;corrOffset=bestOffs}return bestOffs},precalcCorrReferenceStereo:function(){var i,cnt2,temp;for(i=0;i<this.overlapLength;i++)temp=i*(this.overlapLength-i),cnt2=2*i,this.pRefMidBuffer[cnt2]=this.pMidBuffer[cnt2]*temp,this.pRefMidBuffer[cnt2+1]=this.pMidBuffer[cnt2+1]*temp},calcCrossCorrStereo:function(mixingPos,compare){var corr,i,mixingOffset,mixing=this._inputBuffer.vector;for(mixingPos+=this._inputBuffer.startIndex,corr=0,i=2;i<2*this.overlapLength;i+=2)corr+=mixing[mixingOffset=i+mixingPos]*compare[i]+mixing[mixingOffset+1]*compare[i+1];return corr},overlap:function(ovlPos){this.overlapStereo(2*ovlPos)},overlapStereo:function(pInputPos){var pInput=this._inputBuffer.vector;pInputPos+=this._inputBuffer.startIndex;var i,cnt2,fTemp,fScale,fi,pInputOffset,pOutputOffset,pOutput=this._outputBuffer.vector,pOutputPos=this._outputBuffer.endIndex;for(fScale=1/this.overlapLength,i=0;i<this.overlapLength;i++)fTemp=(this.overlapLength-i)*fScale,fi=i*fScale,pInputOffset=(cnt2=2*i)+pInputPos,pOutput[(pOutputOffset=cnt2+pOutputPos)+0]=pInput[pInputOffset+0]*fi+this.pMidBuffer[cnt2+0]*fTemp,pOutput[pOutputOffset+1]=pInput[pInputOffset+1]*fi+this.pMidBuffer[cnt2+1]*fTemp},process:function(){var ovlSkip,offset,temp;if(null===this.pMidBuffer){if(this._inputBuffer.frameCount<this.overlapLength)return;this.pMidBuffer=new Float32Array(2*this.overlapLength),this._inputBuffer.receiveSamples(this.pMidBuffer,this.overlapLength)}for(;this._inputBuffer.frameCount>=this.sampleReq;){offset=this.seekBestOverlapPosition(),this._outputBuffer.ensureAdditionalCapacity(this.overlapLength),this.overlap(Math.floor(offset)),this._outputBuffer.put(this.overlapLength),(temp=this.seekWindowLength-2*this.overlapLength)>0&&this._outputBuffer.putBuffer(this._inputBuffer,offset+this.overlapLength,temp);var start=this.inputBuffer.startIndex+2*(offset+this.seekWindowLength-this.overlapLength);this.pMidBuffer.set(this._inputBuffer.vector.subarray(start,start+2*this.overlapLength)),this.skipFract+=this.nominalSkip,ovlSkip=Math.floor(this.skipFract),this.skipFract-=ovlSkip,this._inputBuffer.receive(ovlSkip)}}}),extend(Stretch.prototype,{get tempo(){return this._tempo}}),SoundTouch.prototype={clear:function(){this.rateTransposer.clear(),this.tdStretch.clear()},get rate(){return this._rate},set rate(rate){this.virtualRate=rate,this._calculateEffectiveRateAndTempo()},set rateChange(rateChange){this.rate=1+.01*rateChange},get tempo(){return this._tempo},set tempo(tempo){this.virtualTempo=tempo,this._calculateEffectiveRateAndTempo()},set tempoChange(tempoChange){this.tempo=1+.01*tempoChange},set pitch(pitch){this.virtualPitch=pitch,this._calculateEffectiveRateAndTempo()},set pitchOctaves(pitchOctaves){this.pitch=Math.exp(.69314718056*pitchOctaves),this._calculateEffectiveRateAndTempo()},set pitchSemitones(pitchSemitones){this.pitchOctaves=pitchSemitones/12},get inputBuffer(){return this._inputBuffer},get outputBuffer(){return this._outputBuffer},_calculateEffectiveRateAndTempo:function(){var previousTempo=this._tempo,previousRate=this._rate;this._tempo=this.virtualTempo/this.virtualPitch,this._rate=this.virtualRate*this.virtualPitch,testFloatEqual(this._tempo,previousTempo)&&(this.tdStretch.tempo=this._tempo),testFloatEqual(this._rate,previousRate)&&(this.rateTransposer.rate=this._rate),this._rate>1?this._outputBuffer!=this.rateTransposer.outputBuffer&&(this.tdStretch.inputBuffer=this._inputBuffer,this.tdStretch.outputBuffer=this._intermediateBuffer,this.rateTransposer.inputBuffer=this._intermediateBuffer,this.rateTransposer.outputBuffer=this._outputBuffer):this._outputBuffer!=this.tdStretch.outputBuffer&&(this.rateTransposer.inputBuffer=this._inputBuffer,this.rateTransposer.outputBuffer=this._intermediateBuffer,this.tdStretch.inputBuffer=this._intermediateBuffer,this.tdStretch.outputBuffer=this._outputBuffer)},process:function(){this._rate>1?(this.tdStretch.process(),this.rateTransposer.process()):(this.rateTransposer.process(),this.tdStretch.process())}},WebAudioBufferSource.prototype={extract:function(target,numFrames,position){for(var l=this.buffer.getChannelData(0),r=this.buffer.getChannelData(1),i=0;i<numFrames;i++)target[2*i]=l[i+position],target[2*i+1]=r[i+position];return Math.min(numFrames,l.length-position)}},soundtouch={RateTransposer:RateTransposer,Stretch:Stretch,SimpleFilter:SimpleFilter,SoundTouch:SoundTouch,WebAudioBufferSource:WebAudioBufferSource,getWebAudioNode:function(context,filter){var node=context.createScriptProcessor(4096,2,2),samples=new Float32Array(8192);return node.onaudioprocess=function(e){var l=e.outputBuffer.getChannelData(0),r=e.outputBuffer.getChannelData(1),framesExtracted=filter.extract(samples,4096);0===framesExtracted&&node.disconnect();for(var i=0;i<framesExtracted;i++)l[i]=samples[2*i],r[i]=samples[2*i+1]},node}}},"function"==typeof define&&define.amd?define("filter_poodll/soundtouch",[],(function(){return factory()})):root.CloudPoodll=factory();

//# sourceMappingURL=soundtouch.min.js.map