(function(a,b){if("function"==typeof define&&define.amd){define ("filter_poodll/soundtouch",[],function(){return b(a)})}else{a.CloudPoodll=b(a)}})(this,function(){var a=[[124,186,248,310,372,434,496,558,620,682,744,806,868,930,992,1054,1116,1178,1240,1302,1364,1426,1488,0],[-100,-75,-50,-25,25,50,75,100,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-20,-15,-10,-5,5,10,15,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-4,-3,-2,-1,1,2,3,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],b=.5,c=2,d=125,e=50,f=(e-d)/(c-b),g=25,h=15,i=(h-g)/(c-b);function j(c,a){for(var b in a){var d=a.__lookupGetter__(b),e=a.__lookupSetter__(b);if(d||e){if(d){c.__defineGetter__(b,d)}if(e){c.__defineSetter__(b,e)}}else{c[b]=a[b]}}return c}function k(c,a){return 1e-10<(c>a?c-a:a-c)}function l(a){if(a){this.inputBuffer=new n;this.outputBuffer=new n}else{this.inputBuffer=this.outputBuffer=null}}l.prototype={get inputBuffer(){return this._inputBuffer},set inputBuffer(a){this._inputBuffer=a},get outputBuffer(){return this._outputBuffer},set outputBuffer(a){this._outputBuffer=a},clear:function clear(){this._inputBuffer.clear();this._outputBuffer.clear()}};function m(a){l.call(this,a);this._reset();this.rate=1}j(m.prototype,l.prototype);j(m.prototype,{set rate(a){this._rate=a},_reset:function _reset(){this.slopeCount=0;this.prevSampleL=0;this.prevSampleR=0},process:function process(){var a=this._inputBuffer.frameCount;this._outputBuffer.ensureAdditionalCapacity(a/this._rate+1);var b=this._transpose(a);this._inputBuffer.receive();this._outputBuffer.put(b)},_transpose:function _transpose(a){if(0===a){return 0}var b=this._inputBuffer.vector,c=this._inputBuffer.startIndex,d=this._outputBuffer.vector,e=this._outputBuffer.endIndex,f=0,g=0;while(1>this.slopeCount){d[e+2*g]=(1-this.slopeCount)*this.prevSampleL+this.slopeCount*b[c];d[e+2*g+1]=(1-this.slopeCount)*this.prevSampleR+this.slopeCount*b[c+1];g++;this.slopeCount+=this._rate}this.slopeCount-=1;if(1!=a){out:while(!0){while(1<this.slopeCount){this.slopeCount-=1;f++;if(f>=a-1){break out}}var h=c+2*f;d[e+2*g]=(1-this.slopeCount)*b[h]+this.slopeCount*b[h+2];d[e+2*g+1]=(1-this.slopeCount)*b[h+1]+this.slopeCount*b[h+3];g++;this.slopeCount+=this._rate}}this.prevSampleL=b[c+2*a-2];this.prevSampleR=b[c+2*a-1];return g}});function n(){this._vector=new Float32Array;this._position=0;this._frameCount=0}n.prototype={get vector(){return this._vector},get position(){return this._position},get startIndex(){return 2*this._position},get frameCount(){return this._frameCount},get endIndex(){return 2*(this._position+this._frameCount)},clear:function clear(a){this.receive(a);this.rewind()},put:function put(a){this._frameCount+=a},putSamples:function putSamples(a,b,c){b=b||0;var d=2*b;if(!(0<=c)){c=(a.length-d)/2}var e=2*c;this.ensureCapacity(c+this._frameCount);var f=this.endIndex;this._vector.set(a.subarray(d,d+e),f);this._frameCount+=c},putBuffer:function putBuffer(a,b,c){b=b||0;if(!(0<=c)){c=a.frameCount-b}this.putSamples(a.vector,a.position+b,c)},receive:function receive(a){if(!(0<=a)||a>this._frameCount){a=this._frameCount}this._frameCount-=a;this._position+=a},receiveSamples:function receiveSamples(a,b){var c=this.startIndex;a.set(this._vector.subarray(c,c+2*b));this.receive(b)},extract:function extract(a,b,c){var d=this.startIndex+2*b;a.set(this._vector.subarray(d,d+2*c))},ensureCapacity:function ensureCapacity(a){var b=2*a;if(this._vector.length<b){var c=new Float32Array(b);c.set(this._vector.subarray(this.startIndex,this.endIndex));this._vector=c;this._position=0}else{this.rewind()}},ensureAdditionalCapacity:function ensureAdditionalCapacity(a){this.ensureCapacity(this.frameCount+a)},rewind:function rewind(){if(0<this._position){this._vector.set(this._vector.subarray(this.startIndex,this.endIndex));this._position=0}}};function o(a,b){this._pipe=b;this.sourceSound=a;this.historyBufferSize=22050;this._sourcePosition=0;this.outputBufferPosition=0;this._position=0}o.prototype={get pipe(){return this._pipe},get position(){return this._position},set position(a){if(a>this._position){throw new RangeError("New position may not be greater than current position")}var b=this.outputBufferPosition-(this._position-a);if(0>b){throw new RangeError("New position falls outside of history buffer")}this.outputBufferPosition=b;this._position=a},get sourcePosition(){return this._sourcePosition},set sourcePosition(a){this.clear();this._sourcePosition=a},get inputBuffer(){return this._pipe.inputBuffer},get outputBuffer(){return this._pipe.outputBuffer},fillInputBuffer:function fillInputBuffer(a){var b=new Float32Array(2*a),c=this.sourceSound.extract(b,a,this._sourcePosition);this._sourcePosition+=c;this.inputBuffer.putSamples(b,0,c)},fillOutputBuffer:function fillOutputBuffer(a){while(this.outputBuffer.frameCount<a){var b=16384-this.inputBuffer.frameCount;this.fillInputBuffer(b);if(this.inputBuffer.frameCount<16384){break}this._pipe.process()}},extract:function extract(a,b){this.fillOutputBuffer(this.outputBufferPosition+b);var c=Math.min(b,this.outputBuffer.frameCount-this.outputBufferPosition);this.outputBuffer.extract(a,this.outputBufferPosition,c);var d=this.outputBufferPosition+c;this.outputBufferPosition=Math.min(this.historyBufferSize,d);this.outputBuffer.receive(Math.max(d-this.historyBufferSize,0));this._position+=c;return c},handleSampleData:function handleSampleData(a){this.extract(a.data,4096)},clear:function clear(){this._pipe.clear();this.outputBufferPosition=0}};function p(a,b){l.call(this,a);this.bQuickSeek=!0;this.bMidBufferDirty=!1;this.pMidBuffer=null;this.overlapLength=0;this.bAutoSeqSetting=!0;this.bAutoSeekSetting=!0;this._tempo=1;this.setParameters(b,0,0,8)}j(p.prototype,l.prototype);j(p.prototype,{clear:function clear(){l.prototype.clear.call(this);this._clearMidBuffer()},_clearMidBuffer:function _clearMidBuffer(){if(this.bMidBufferDirty){this.bMidBufferDirty=!1;this.pMidBuffer=null}},setParameters:function setParameters(a,b,c,d){if(0<a){this.sampleRate=a}if(0<d){this.overlapMs=d}if(0<b){this.sequenceMs=b;this.bAutoSeqSetting=!1}else{this.bAutoSeqSetting=!0}if(0<c){this.seekWindowMs=c;this.bAutoSeekSetting=!1}else{this.bAutoSeekSetting=!0}this.calcSeqParameters();this.calculateOverlapLength(this.overlapMs);this.tempo=this._tempo},set tempo(a){var b;this._tempo=a;this.calcSeqParameters();this.nominalSkip=this._tempo*(this.seekWindowLength-this.overlapLength);this.skipFract=0;b=Math.floor(this.nominalSkip+.5);this.sampleReq=Math.max(b+this.overlapLength,this.seekWindowLength)+this.seekLength},get inputChunkSize(){return this.sampleReq},get outputChunkSize(){return this.overlapLength+Math.max(0,this.seekWindowLength-2*this.overlapLength)},calculateOverlapLength:function calculateOverlapLength(a){var b=this.sampleRate*a/1e3;if(16>b)b=16;b-=b%8;this.overlapLength=b;this.pRefMidBuffer=new Float32Array(2*this.overlapLength);this.pMidBuffer=new Float32Array(2*this.overlapLength)},checkLimits:function checkLimits(a,b,c){return a<b?b:a>c?c:a},calcSeqParameters:function calcSeqParameters(){var a,c;if(this.bAutoSeqSetting){a=d-f*b+f*this._tempo;a=this.checkLimits(a,e,d);this.sequenceMs=Math.floor(a+.5)}if(this.bAutoSeekSetting){c=g-i*b+i*this._tempo;c=this.checkLimits(c,h,g);this.seekWindowMs=Math.floor(c+.5)}this.seekWindowLength=Math.floor(this.sampleRate*this.sequenceMs/1e3);this.seekLength=Math.floor(this.sampleRate*this.seekWindowMs/1e3)},set quickSeek(a){this.bQuickSeek=a},seekBestOverlapPosition:function seekBestOverlapPosition(){if(this.bQuickSeek){return this.seekBestOverlapPositionStereoQuick()}else{return this.seekBestOverlapPositionStereo()}},seekBestOverlapPositionStereo:function seekBestOverlapPositionStereo(){var a,b,c,d;this.precalcCorrReferenceStereo();b=Number.MIN_VALUE;a=0;for(d=0;d<this.seekLength;d++){c=this.calcCrossCorrStereo(2*d,this.pRefMidBuffer);if(c>b){b=c;a=d}}return a},seekBestOverlapPositionStereoQuick:function seekBestOverlapPositionStereoQuick(){var b,c,d,e,f,g,h;this.precalcCorrReferenceStereo();d=Number.MIN_VALUE;c=0;g=0;h=0;for(f=0;4>f;f++){b=0;while(a[f][b]){h=g+a[f][b];if(h>=this.seekLength){break}e=this.calcCrossCorrStereo(2*h,this.pRefMidBuffer);if(e>d){d=e;c=h}b++}g=c}return c},precalcCorrReferenceStereo:function precalcCorrReferenceStereo(){var a,b,c;for(a=0;a<this.overlapLength;a++){c=a*(this.overlapLength-a);b=2*a;this.pRefMidBuffer[b]=this.pMidBuffer[b]*c;this.pRefMidBuffer[b+1]=this.pMidBuffer[b+1]*c}},calcCrossCorrStereo:function calcCrossCorrStereo(a,b){var c=this._inputBuffer.vector;a+=this._inputBuffer.startIndex;var d,e,f;d=0;for(e=2;e<2*this.overlapLength;e+=2){f=e+a;d+=c[f]*b[e]+c[f+1]*b[e+1]}return d},overlap:function overlap(a){this.overlapStereo(2*a)},overlapStereo:function overlapStereo(a){var b=this._inputBuffer.vector;a+=this._inputBuffer.startIndex;var c=this._outputBuffer.vector,d=this._outputBuffer.endIndex,e,f,g,h,j,k,l;h=1/this.overlapLength;for(e=0;e<this.overlapLength;e++){g=(this.overlapLength-e)*h;j=e*h;f=2*e;k=f+a;l=f+d;c[l+0]=b[k+0]*j+this.pMidBuffer[f+0]*g;c[l+1]=b[k+1]*j+this.pMidBuffer[f+1]*g}},process:function process(){var a,b,c;if(null===this.pMidBuffer){if(this._inputBuffer.frameCount<this.overlapLength){return}this.pMidBuffer=new Float32Array(2*this.overlapLength);this._inputBuffer.receiveSamples(this.pMidBuffer,this.overlapLength)}while(this._inputBuffer.frameCount>=this.sampleReq){b=this.seekBestOverlapPosition();this._outputBuffer.ensureAdditionalCapacity(this.overlapLength);this.overlap(Math.floor(b));this._outputBuffer.put(this.overlapLength);c=this.seekWindowLength-2*this.overlapLength;if(0<c){this._outputBuffer.putBuffer(this._inputBuffer,b+this.overlapLength,c)}var d=this.inputBuffer.startIndex+2*(b+this.seekWindowLength-this.overlapLength);this.pMidBuffer.set(this._inputBuffer.vector.subarray(d,d+2*this.overlapLength));this.skipFract+=this.nominalSkip;a=Math.floor(this.skipFract);this.skipFract-=a;this._inputBuffer.receive(a)}}});j(p.prototype,{get tempo(){return this._tempo}});function q(a){this.rateTransposer=new m(!1);this.tdStretch=new p(!1,a);this._inputBuffer=new n;this._intermediateBuffer=new n;this._outputBuffer=new n;this._rate=0;this._tempo=0;this.virtualPitch=1;this.virtualRate=1;this.virtualTempo=1;this._calculateEffectiveRateAndTempo()}q.prototype={clear:function clear(){this.rateTransposer.clear();this.tdStretch.clear()},get rate(){return this._rate},set rate(a){this.virtualRate=a;this._calculateEffectiveRateAndTempo()},set rateChange(a){this.rate=1+.01*a},get tempo(){return this._tempo},set tempo(a){this.virtualTempo=a;this._calculateEffectiveRateAndTempo()},set tempoChange(a){this.tempo=1+.01*a},set pitch(a){this.virtualPitch=a;this._calculateEffectiveRateAndTempo()},set pitchOctaves(a){this.pitch=Math.exp(.69314718056*a);this._calculateEffectiveRateAndTempo()},set pitchSemitones(a){this.pitchOctaves=a/12},get inputBuffer(){return this._inputBuffer},get outputBuffer(){return this._outputBuffer},_calculateEffectiveRateAndTempo:function _calculateEffectiveRateAndTempo(){var a=this._tempo,b=this._rate;this._tempo=this.virtualTempo/this.virtualPitch;this._rate=this.virtualRate*this.virtualPitch;if(k(this._tempo,a)){this.tdStretch.tempo=this._tempo}if(k(this._rate,b)){this.rateTransposer.rate=this._rate}if(1<this._rate){if(this._outputBuffer!=this.rateTransposer.outputBuffer){this.tdStretch.inputBuffer=this._inputBuffer;this.tdStretch.outputBuffer=this._intermediateBuffer;this.rateTransposer.inputBuffer=this._intermediateBuffer;this.rateTransposer.outputBuffer=this._outputBuffer}}else{if(this._outputBuffer!=this.tdStretch.outputBuffer){this.rateTransposer.inputBuffer=this._inputBuffer;this.rateTransposer.outputBuffer=this._intermediateBuffer;this.tdStretch.inputBuffer=this._intermediateBuffer;this.tdStretch.outputBuffer=this._outputBuffer}}},process:function process(){if(1<this._rate){this.tdStretch.process();this.rateTransposer.process()}else{this.rateTransposer.process();this.tdStretch.process()}}};function r(a){this.buffer=a}r.prototype={extract:function extract(a,b,c){for(var d=this.buffer.getChannelData(0),e=this.buffer.getChannelData(1),f=0;f<b;f++){a[2*f]=d[f+c];a[2*f+1]=e[f+c]}return Math.min(b,d.length-c)}};return soundtouch={RateTransposer:m,Stretch:p,SimpleFilter:o,SoundTouch:q,WebAudioBufferSource:r,getWebAudioNode:function(a,b){var c=a.createScriptProcessor(4096,2,2),d=new Float32Array(8192);c.onaudioprocess=function(a){var e=a.outputBuffer.getChannelData(0),f=a.outputBuffer.getChannelData(1),g=b.extract(d,4096);if(0===g){c.disconnect()}for(var h=0;h<g;h++){e[h]=d[2*h];f[h]=d[2*h+1]}};return c}}});
//# sourceMappingURL=soundtouch.min.js.map
