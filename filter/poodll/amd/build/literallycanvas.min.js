!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.LC=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(a,b){if(a===b)return!0;if("object"!=typeof a||null===a||"object"!=typeof b||null===b)return!1;var c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(var f=e.bind(b),g=0;g<c.length;g++)if(!f(c[g])||a[c[g]]!==b[c[g]])return!1;return!0}var e=Object.prototype.hasOwnProperty;b.exports=d},{}],2:[function(a,b,c){b.exports=a("react/lib/ReactComponentWithPureRenderMixin")},{"react/lib/ReactComponentWithPureRenderMixin":3}],3:[function(a,b,c){"use strict";var d=a("./shallowCompare"),e={shouldComponentUpdate:function(a,b){return d(this,a,b)}};b.exports=e},{"./shallowCompare":4}],4:[function(a,b,c){"use strict";function d(a,b,c){return!e(a.props,b)||!e(a.state,c)}var e=a("fbjs/lib/shallowEqual");b.exports=d},{"fbjs/lib/shallowEqual":1}],5:[function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s=function(a,b){return function(){return a.apply(b,arguments)}},t=[].slice,u=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};h=a("./actions"),i=a("./bindEvents"),k=a("./math"),l=a("./shapes"),j=l.createShape,q=l.shapeToJSON,e=l.JSONToShape,m=a("./canvasRenderer").renderShapeToContext,n=a("./svgRenderer").renderShapeToSVG,o=a("./renderSnapshotToImage"),p=a("./renderSnapshotToSVG"),g=a("../tools/Pencil"),r=a("./util"),d="infinite",b.exports=f=function(){function a(a,b){this.setImageSize=s(this.setImageSize,this);var c,e;e=null,c=null,a instanceof HTMLElement?(c=a,e=b):e=a,this.opts=e||{},this.config={zoomMin:e.zoomMin||.2,zoomMax:e.zoomMax||4,zoomStep:e.zoomStep||.2},this.colors={primary:e.primaryColor||"#000",secondary:e.secondaryColor||"#fff",background:e.backgroundColor||"transparent"},this.watermarkImage=e.watermarkImage,this.watermarkScale=e.watermarkScale||1,this.backgroundCanvas=document.createElement("canvas"),this.backgroundCtx=this.backgroundCanvas.getContext("2d"),this.canvas=document.createElement("canvas"),this.canvas.style["background-color"]="transparent",this.buffer=document.createElement("canvas"),this.buffer.style["background-color"]="transparent",this.ctx=this.canvas.getContext("2d"),this.bufferCtx=this.buffer.getContext("2d"),this.backingScale=r.getBackingScale(this.ctx),this.backgroundShapes=e.backgroundShapes||[],this._shapesInProgress=[],this.shapes=[],this.undoStack=[],this.redoStack=[],this.isDragging=!1,this.position={x:0,y:0},this.scale=1,this.setTool(new this.opts.tools[0](this)),this.width=e.imageSize.width||d,this.height=e.imageSize.height||d,this.setZoom(this.scale),e.snapshot&&this.loadSnapshot(e.snapshot),this.isBound=!1,c&&this.bindToElement(c),this.respondToSizeChange=function(){}}return a.prototype.bindToElement=function(a){var b,c;return this.containerEl?void console.warn("Trying to bind Literally Canvas to a DOM element more than once is unsupported."):(this.containerEl=a,this._unsubscribeEvents=i(this,this.containerEl,this.opts.keyboardShortcuts),this.containerEl.style["background-color"]=this.colors.background,this.containerEl.appendChild(this.backgroundCanvas),this.containerEl.appendChild(this.canvas),this.isBound=!0,c=function(a){return function(){return a.keepPanInImageBounds(),a.repaintAllLayers()}}(this),this.respondToSizeChange=r.matchElementSize(this.containerEl,[this.backgroundCanvas,this.canvas],this.backingScale,c),this.watermarkImage&&(this.watermarkImage.onload=function(a){return function(){return a.repaintLayer("background")}}(this)),null!=(b=this.tool)&&b.didBecomeActive(this),c())},a.prototype._teardown=function(){var a;return null!=(a=this.tool)&&a.willBecomeInactive(this),"function"==typeof this._unsubscribeEvents&&this._unsubscribeEvents(),this.tool=null,this.containerEl=null,this.isBound=!1},a.prototype.trigger=function(a,b){return this.canvas.dispatchEvent(new CustomEvent(a,{detail:b})),null},a.prototype.on=function(a,b){var c;return c=function(a){return b(a.detail)},this.canvas.addEventListener(a,c),function(b){return function(){return b.canvas.removeEventListener(a,c)}}(this)},a.prototype.getRenderScale=function(){return this.scale*this.backingScale},a.prototype.clientCoordsToDrawingCoords=function(a,b){return{x:(a*this.backingScale-this.position.x)/this.getRenderScale(),y:(b*this.backingScale-this.position.y)/this.getRenderScale()}},a.prototype.drawingCoordsToClientCoords=function(a,b){return{x:a*this.getRenderScale()+this.position.x,y:b*this.getRenderScale()+this.position.y}},a.prototype.setImageSize=function(a,b){return this.width=a||d,this.height=b||d,this.keepPanInImageBounds(),this.repaintAllLayers(),this.trigger("imageSizeChange",{width:this.width,height:this.height})},a.prototype.setTool=function(a){var b;return this.isBound&&null!=(b=this.tool)&&b.willBecomeInactive(this),this.tool=a,this.trigger("toolChange",{tool:a}),this.isBound?this.tool.didBecomeActive(this):void 0},a.prototype.setShapesInProgress=function(a){return this._shapesInProgress=a},a.prototype.pointerDown=function(a,b){var c;return c=this.clientCoordsToDrawingCoords(a,b),this.tool.usesSimpleAPI?(this.tool.begin(c.x,c.y,this),this.isDragging=!0,this.trigger("drawStart",{tool:this.tool})):(this.isDragging=!0,this.trigger("lc-pointerdown",{tool:this.tool,x:c.x,y:c.y,rawX:a,rawY:b}))},a.prototype.pointerMove=function(a,b){return r.requestAnimationFrame(function(c){return function(){var d,e;return d=c.clientCoordsToDrawingCoords(a,b),(null!=(e=c.tool)?e.usesSimpleAPI:0)?c.isDragging?(c.tool["continue"](d.x,d.y,c),c.trigger("drawContinue",{tool:c.tool})):void 0:c.isDragging?c.trigger("lc-pointerdrag",{tool:c.tool,x:d.x,y:d.y,rawX:a,rawY:b}):c.trigger("lc-pointermove",{tool:c.tool,x:d.x,y:d.y,rawX:a,rawY:b})}}(this))},a.prototype.pointerUp=function(a,b){var c;return c=this.clientCoordsToDrawingCoords(a,b),this.tool.usesSimpleAPI?this.isDragging?(this.tool.end(c.x,c.y,this),this.isDragging=!1,this.trigger("drawEnd",{tool:this.tool})):void 0:(this.isDragging=!1,this.trigger("lc-pointerup",{tool:this.tool,x:c.x,y:c.y,rawX:a,rawY:b}))},a.prototype.setColor=function(a,b){if(this.colors[a]=b,this.isBound){switch(a){case"background":this.containerEl.style.backgroundColor=this.colors.background,this.repaintLayer("background");break;case"primary":this.repaintLayer("main");break;case"secondary":this.repaintLayer("main")}return this.trigger(a+"ColorChange",this.colors[a]),"background"===a?this.trigger("drawingChange"):void 0}},a.prototype.getColor=function(a){return this.colors[a]},a.prototype.saveShape=function(a,b,c){return null==b&&(b=!0),null==c&&(c=null),c||(c=this.shapes.length?this.shapes[this.shapes.length-1].id:null),this.execute(new h.AddShapeAction(this,a,c)),b&&this.trigger("shapeSave",{shape:a,previousShapeId:c}),this.trigger("drawingChange")},a.prototype.pan=function(a,b){return this.setPan(this.position.x-a,this.position.y-b)},a.prototype.keepPanInImageBounds=function(){var a,b,c,e;return b=this.getRenderScale(),a=this.position,c=a.x,e=a.y,this.width!==d&&(c=this.canvas.width>this.width*b?(this.canvas.width-this.width*b)/2:Math.max(Math.min(0,c),this.canvas.width-this.width*b)),this.height!==d&&(e=this.canvas.height>this.height*b?(this.canvas.height-this.height*b)/2:Math.max(Math.min(0,e),this.canvas.height-this.height*b)),this.position={x:c,y:e}},a.prototype.setPan=function(a,b){return this.position={x:a,y:b},this.keepPanInImageBounds(),this.repaintAllLayers(),this.trigger("pan",{x:this.position.x,y:this.position.y})},a.prototype.zoom=function(a){var b;return b=this.scale+a,b=Math.max(b,this.config.zoomMin),b=Math.min(b,this.config.zoomMax),b=Math.round(100*b)/100,this.setZoom(b)},a.prototype.setZoom=function(a){var b;return b=this.scale,this.scale=a,this.position.x=k.scalePositionScalar(this.position.x,this.canvas.width,b,this.scale),this.position.y=k.scalePositionScalar(this.position.y,this.canvas.height,b,this.scale),this.keepPanInImageBounds(),this.repaintAllLayers(),this.trigger("zoom",{oldScale:b,newScale:this.scale})},a.prototype.setWatermarkImage=function(a){return this.watermarkImage=a,r.addImageOnload(a,function(a){return function(){return a.repaintLayer("background")}}(this)),a.width?this.repaintLayer("background"):void 0},a.prototype.repaintAllLayers=function(){var a,b,c,d;for(d=["background","main"],a=0,c=d.length;c>a;a++)b=d[a],this.repaintLayer(b);return null},a.prototype.repaintLayer=function(a,b){var c;if(null==b&&(b="main"===a),this.isBound){switch(a){case"background":this.backgroundCtx.clearRect(0,0,this.backgroundCanvas.width,this.backgroundCanvas.height),c=function(a){return function(){return a.repaintLayer("background")}}(this),this.watermarkImage&&this._renderWatermark(this.backgroundCtx,!0,c),this.draw(this.backgroundShapes,this.backgroundCtx,c);break;case"main":c=function(a){return function(){return a.repaintLayer("main",!0)}}(this),b&&(this.buffer.width=this.canvas.width,this.buffer.height=this.canvas.height,this.bufferCtx.clearRect(0,0,this.buffer.width,this.buffer.height),this.draw(this.shapes,this.bufferCtx,c)),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvas.width>0&&this.canvas.height>0&&(this.ctx.fillStyle="#ccc",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.clipped(function(a){return function(){return a.ctx.clearRect(0,0,a.canvas.width,a.canvas.height),a.ctx.drawImage(a.buffer,0,0)}}(this),this.ctx),this.clipped(function(a){return function(){return a.transformed(function(){var b,c,d,e,f;for(d=a._shapesInProgress,e=[],b=0,c=d.length;c>b;b++)f=d[b],e.push(m(a.ctx,f,{bufferCtx:a.bufferCtx,shouldOnlyDrawLatest:!0}));return e},a.ctx,a.bufferCtx)}}(this),this.ctx,this.bufferCtx))}return this.trigger("repaint",{layerKey:a})}},a.prototype._renderWatermark=function(a,b,c){return null==b&&(b=!0),this.watermarkImage.width?(a.save(),a.translate(a.canvas.width/2,a.canvas.height/2),a.scale(this.watermarkScale,this.watermarkScale),b&&a.scale(this.backingScale,this.backingScale),a.drawImage(this.watermarkImage,-this.watermarkImage.width/2,-this.watermarkImage.height/2),a.restore()):void(this.watermarkImage.onload=c)},a.prototype.drawShapeInProgress=function(a){return this.repaintLayer("main",!1),this.clipped(function(b){return function(){return b.transformed(function(){return m(b.ctx,a,{bufferCtx:b.bufferCtx,shouldOnlyDrawLatest:!0})},b.ctx,b.bufferCtx)}}(this),this.ctx,this.bufferCtx)},a.prototype.draw=function(a,b,c){var d;if(a.length)return d=function(d){return function(){var d,e,f,g;for(f=[],d=0,e=a.length;e>d;d++)g=a[d],f.push(m(b,g,{retryCallback:c}));return f}}(this),this.clipped(function(a){return function(){return a.transformed(d,b)}}(this),b)},a.prototype.clipped=function(){var a,b,c,e,f,g,h,i,j,k,l,m;for(c=arguments[0],a=2<=arguments.length?t.call(arguments,1):[],l=this.width===d?0:this.position.x,m=this.height===d?0:this.position.y,k=function(){switch(this.width){case d:return this.canvas.width;default:return this.width*this.getRenderScale()}}.call(this),e=function(){switch(this.height){case d:return this.canvas.height;default:return this.height*this.getRenderScale()}}.call(this),f=0,h=a.length;h>f;f++)b=a[f],b.save(),b.beginPath(),b.rect(l,m,k,e),b.clip();for(c(),j=[],g=0,i=a.length;i>g;g++)b=a[g],j.push(b.restore());return j},a.prototype.transformed=function(){var a,b,c,d,e,f,g,h,i;for(c=arguments[0],a=2<=arguments.length?t.call(arguments,1):[],d=0,f=a.length;f>d;d++)b=a[d],b.save(),b.translate(Math.floor(this.position.x),Math.floor(this.position.y)),i=this.getRenderScale(),b.scale(i,i);for(c(),h=[],e=0,g=a.length;g>e;e++)b=a[e],h.push(b.restore());return h},a.prototype.clear=function(a){var b,c;return null==a&&(a=!0),c=this.shapes,b=[],this.setShapesInProgress([]),this.execute(new h.ClearAction(this,c,b)),this.repaintLayer("main"),a&&this.trigger("clear",null),this.trigger("drawingChange",{})},a.prototype.execute=function(a){return this.undoStack.push(a),a["do"](),this.redoStack=[]},a.prototype.undo=function(){var a;if(this.undoStack.length)return a=this.undoStack.pop(),a.undo(),this.redoStack.push(a),this.trigger("undo",{action:a}),this.trigger("drawingChange",{})},a.prototype.redo=function(){var a;if(this.redoStack.length)return a=this.redoStack.pop(),this.undoStack.push(a),a["do"](),this.trigger("redo",{action:a}),this.trigger("drawingChange",{})},a.prototype.canUndo=function(){return!!this.undoStack.length},a.prototype.canRedo=function(){return!!this.redoStack.length},a.prototype.getPixel=function(a,b){var c,d;return c=this.drawingCoordsToClientCoords(a,b),d=this.ctx.getImageData(c.x,c.y,1,1).data,d[3]?"rgb("+d[0]+", "+d[1]+", "+d[2]+")":null},a.prototype.getContentBounds=function(){return r.getBoundingRect(this.shapes.concat(this.backgroundShapes).map(function(a){return a.getBoundingRect()}),this.width===d?0:this.width,this.height===d?0:this.height)},a.prototype.getDefaultImageRect=function(a,b){var c;return null==a&&(a={width:0,height:0}),null==b&&(b={top:0,right:0,bottom:0,left:0}),r.getDefaultImageRect(function(){var a,b,d,e;for(d=this.shapes.concat(this.backgroundShapes),e=[],a=0,b=d.length;b>a;a++)c=d[a],e.push(c.getBoundingRect(this.ctx));return e}.call(this),a,b)},a.prototype.getImage=function(a){return null==a&&(a={}),null==a.includeWatermark&&(a.includeWatermark=!0),null==a.scaleDownRetina&&(a.scaleDownRetina=!0),null==a.scale&&(a.scale=1),a.scaleDownRetina||(a.scale*=this.backingScale),a.includeWatermark&&(a.watermarkImage=this.watermarkImage,a.watermarkScale=this.watermarkScale,a.scaleDownRetina||(a.watermarkScale*=this.backingScale)),o(this.getSnapshot(),a)},a.prototype.canvasForExport=function(){return this.repaintAllLayers(),r.combineCanvases(this.backgroundCanvas,this.canvas)},a.prototype.canvasWithBackground=function(a){return r.combineCanvases(a,this.canvasForExport())},a.prototype.getSnapshot=function(a){var b,c,d,e,f,g;for(null==a&&(a=null),null==a&&(a=["shapes","imageSize","colors","position","scale","backgroundShapes"]),g={},e=["colors","position","scale"],b=0,d=e.length;d>b;b++)c=e[b],u.call(a,c)>=0&&(g[c]=this[c]);return u.call(a,"shapes")>=0&&(g.shapes=function(){var a,b,c,d;for(c=this.shapes,d=[],a=0,b=c.length;b>a;a++)f=c[a],d.push(q(f));return d}.call(this)),u.call(a,"backgroundShapes")>=0&&(g.backgroundShapes=function(){var a,b,c,d;for(c=this.backgroundShapes,d=[],a=0,b=c.length;b>a;a++)f=c[a],d.push(q(f));return d}.call(this)),u.call(a,"imageSize")>=0&&(g.imageSize={width:this.width,height:this.height}),g},a.prototype.getSnapshotJSON=function(){return console.warn("lc.getSnapshotJSON() is deprecated. use JSON.stringify(lc.getSnapshot()) instead."),JSON.stringify(this.getSnapshot())},a.prototype.getSVGString=function(a){return null==a&&(a={}),p(this.getSnapshot(),a)},a.prototype.loadSnapshot=function(a){var b,c,d,f,g,i,j,k,l,m;if(a){if(a.colors)for(i=["primary","secondary","background"],b=0,f=i.length;f>b;b++)d=i[b],this.setColor(d,a.colors[d]);if(a.shapes)for(this.shapes=[],j=a.shapes,c=0,g=j.length;g>c;c++)m=j[c],l=e(m),l&&this.execute(new h.AddShapeAction(this,l));return a.backgroundShapes&&(this.backgroundShapes=function(){var b,c,d,f;for(d=a.backgroundShapes,f=[],b=0,c=d.length;c>b;b++)k=d[b],f.push(e(k));return f}()),a.imageSize&&(this.width=a.imageSize.width,this.height=a.imageSize.height),a.position&&(this.position=a.position),a.scale&&(this.scale=a.scale),this.repaintAllLayers(),this.trigger("snapshotLoad"),this.trigger("drawingChange",{})}},a.prototype.loadSnapshotJSON=function(a){return console.warn("lc.loadSnapshotJSON() is deprecated. use lc.loadSnapshot(JSON.parse(snapshot)) instead."),this.loadSnapshot(JSON.parse(a))},a}()},{"../tools/Pencil":48,"./actions":7,"./bindEvents":8,"./canvasRenderer":9,"./math":14,"./renderSnapshotToImage":15,"./renderSnapshotToSVG":16,"./shapes":17,"./svgRenderer":18,"./util":19}],6:[function(a,b,c){var d,e,f,g;a("./fontmetrics.js"),g=function(a){var b,c,d,e,f,g,h,i;for(c=a.split(" "),d=0,f=0,g=c.length;g>f;f++)e=c[f],h=parseInt(e.replace("px",""),10),isNaN(h)||(d=h);if(!d)throw"Font size not found";return i=a.substring(c[0].length+1).replace("bold ","").replace("italic ","").replace("underline ",""),b=i,{fontSize:d,fontFamily:b}},f=function(a,b,c){var d,e,f,g,h,i,j,k,l,m;if(!b.length)return["",""];for(e=0,i=0,j=0,m=!1;;)if(e+=1,f=e>=b.length,h=!f&&b[e].match(/\s/),g=h||f,l=b.substring(0,e),d=!c||a.measureTextWidth(l).width<=c,d&&(j=e),g&&m&&(m=!1,d&&(i=e)),m=!h,f||!d){if(d)return[b,""];if(i>0){for(k=i+1;k<b.length&&b[k].match("/s/");)k+=1;return[b.substring(0,i),b.substring(k)]}return[b.substring(0,j),b.substring(j)]}},e=function(a,b,c){var d,e,g,h,i,j,k,l,m;for(m=b.split(/\r\n|\r|\n/g),g=[],d=0,e=m.length;e>d;d++)if(l=m[d],i=f(a,l,c),h=i[0],k=i[1],h)for(;h;)g.push(h),j=f(a,k,c),h=j[0],k=j[1];else g.push(l);return g},d=function(){function a(a,b,c,d,f){var h,i,j;this.text=b,this.font=c,this.forcedWidth=d,this.forcedHeight=f,j=g(this.font),h=j.fontFamily,i=j.fontSize,a.font=this.font,a.textBaseline="baseline",this.emDashWidth=a.measureTextWidth("—",i,h).width,this.caratWidth=a.measureTextWidth("|",i,h).width,this.lines=e(a,this.text,this.forcedWidth),this.metricses=this.lines.map(function(b){return function(c){return a.measureText2(c||"X",i,b.font)}}(this)),this.metrics={ascent:Math.max.apply(Math,this.metricses.map(function(a){var b;return b=a.ascent})),descent:Math.max.apply(Math,this.metricses.map(function(a){var b;return b=a.descent})),fontsize:Math.max.apply(Math,this.metricses.map(function(a){var b;return b=a.fontsize})),leading:Math.max.apply(Math,this.metricses.map(function(a){var b;return b=a.leading})),width:Math.max.apply(Math,this.metricses.map(function(a){var b;return b=a.width})),height:Math.max.apply(Math,this.metricses.map(function(a){var b;return b=a.height})),bounds:{minx:Math.min.apply(Math,this.metricses.map(function(a){var b;return b=a.bounds,b.minx})),miny:Math.min.apply(Math,this.metricses.map(function(a){var b;return b=a.bounds,b.miny})),maxx:Math.max.apply(Math,this.metricses.map(function(a){var b;return b=a.bounds,b.maxx})),maxy:Math.max.apply(Math,this.metricses.map(function(a){var b;return b=a.bounds,b.maxy}))}},this.boundingBoxWidth=Math.ceil(this.metrics.width)}return a.prototype.draw=function(a,b,c){var d,e,f,g,h,i;for(a.textBaseline="top",a.font=this.font,d=0,h=this.lines,i=[],e=0,f=h.length;f>e;e++)g=h[e],a.fillText(g,b,c+d*this.metrics.leading),i.push(d+=1);return i},a.prototype.getWidth=function(a){return null==a&&(a=!1),this.forcedWidth?this.forcedWidth:a?this.metrics.bounds.maxx+this.caratWidth:this.metrics.bounds.maxx},a.prototype.getHeight=function(){return this.forcedHeight||this.metrics.leading*this.lines.length},a}(),b.exports=d},{"./fontmetrics.js":11}],7:[function(a,b,c){var d,e;e=function(){function a(a,b,c){this.lc=a,this.oldShapes=b,this.newShapes=c}return a.prototype["do"]=function(){return this.lc.shapes=this.newShapes,this.lc.repaintLayer("main")},a.prototype.undo=function(){return this.lc.shapes=this.oldShapes,this.lc.repaintLayer("main")},a}(),d=function(){function a(a,b,c){this.lc=a,this.shape=b,this.previousShapeId=null!=c?c:null}return a.prototype["do"]=function(){var a,b,c,d,e,f;if(this.lc.shapes.length&&this.lc.shapes[this.lc.shapes.length-1].id!==this.previousShapeId&&null!==this.previousShapeId){for(d=[],a=!1,e=this.lc.shapes,b=0,c=e.length;c>b;b++)f=e[b],d.push(f),f.id===this.previousShapeId&&(d.push(this.shape),a=!0);a||d.push(this.shape),this.lc.shapes=d}else this.lc.shapes.push(this.shape);return this.lc.repaintLayer("main")},a.prototype.undo=function(){var a,b,c,d,e;if(this.lc.shapes[this.lc.shapes.length-1].id===this.shape.id)this.lc.shapes.pop();else{for(c=[],d=this.lc.shapes,a=0,b=d.length;b>a;a++)e=d[a],e.id!==this.shape.id&&c.push(e);lc.shapes=c}return this.lc.repaintLayer("main")},a}(),b.exports={ClearAction:e,AddShapeAction:d}},{}],8:[function(a,b,c){var d,e,f,g;f=function(a,b){var c,d,e;return d=b.changedTouches[0].clientX,e=b.changedTouches[0].clientY,c=a.getBoundingClientRect(),[d-c.left,e-c.top]},g=function(a,b){var c;return c=a.getBoundingClientRect(),{left:b.clientX-c.left,top:b.clientY-c.top}},e=function(a){return null!=a.buttons?1===a.buttons:a.which>0},b.exports=d=function(a,b,c){var d,e,h,i,j,k;return null==c&&(c=!1),k=[],e=function(c){return function(c){var d;return c.preventDefault(),d=g(b,c),a.pointerMove(d.left,d.top)}}(this),h=function(c){return function(c){var d;return c.preventDefault(),b.onselectstart=function(){return!0},d=g(b,c),a.pointerUp(d.left,d.top),document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",h),b.addEventListener("mousemove",e)}}(this),b.addEventListener("mousedown",function(c){return function(c){var d,f;if("canvas"===c.target.tagName.toLowerCase())return d=!0,c.preventDefault(),b.onselectstart=function(){return!1},f=g(b,c),a.pointerDown(f.left,f.top),b.removeEventListener("mousemove",e),document.addEventListener("mousemove",e),document.addEventListener("mouseup",h)}}(this)),j=function(c){return c.preventDefault(),a.pointerMove.apply(a,f(b,c))},i=function(c){return c.preventDefault(),a.pointerUp.apply(a,f(b,c)),document.removeEventListener("touchmove",j),document.removeEventListener("touchend",i),document.removeEventListener("touchcancel",i)},b.addEventListener("touchstart",function(c){return"canvas"===c.target.tagName.toLowerCase()?(c.preventDefault(),1===c.touches.length?(a.pointerDown.apply(a,f(b,c)),document.addEventListener("touchmove",j),document.addEventListener("touchend",i),document.addEventListener("touchcancel",i)):a.pointerMove.apply(a,f(b,c))):void 0}),c&&(console.warn("Keyboard panning is deprecated."),d=function(b){switch(b.keyCode){case 37:a.pan(-10,0);break;case 38:a.pan(0,-10);break;case 39:a.pan(10,0);break;case 40:a.pan(0,10)}return a.repaintAllLayers()},document.addEventListener("keydown",d),k.push(function(){return document.removeEventListener(d)})),function(){var a,b,c,d;for(d=[],b=0,c=k.length;c>b;b++)a=k[b],d.push(a());return d}}},{}],9:[function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n;j=a("./lineEndCapShapes"),n={},e=function(a,b,c){return n[a]={drawFunc:b,drawLatestFunc:c}},k=function(){},m=function(a,b,c){var d;if(null==c&&(c={}),null==c.shouldIgnoreUnsupportedShapes&&(c.shouldIgnoreUnsupportedShapes=!1),null==c.retryCallback&&(c.retryCallback=k),null==c.shouldOnlyDrawLatest&&(c.shouldOnlyDrawLatest=!1),null==c.bufferCtx&&(c.bufferCtx=null),d=c.bufferCtx,n[b.className])return c.shouldOnlyDrawLatest&&n[b.className].drawLatestFunc?n[b.className].drawLatestFunc(a,d,b,c.retryCallback):n[b.className].drawFunc(a,b,c.retryCallback);if(c.shouldIgnoreUnsupportedShapes)return console.warn("Can't render shape of type "+b.className+" to canvas");throw"Can't render shape of type "+b.className+" to canvas"},l=function(a,b,c){return m(a.getContext("2d"),b,c)},e("Rectangle",function(a,b){var c,d;return c=b.x,d=b.y,b.strokeWidth%2!==0&&(c+=.5,d+=.5),a.fillStyle=b.fillColor,a.fillRect(c,d,b.width,b.height),a.lineWidth=b.strokeWidth,a.strokeStyle=b.strokeColor,a.strokeRect(c,d,b.width,b.height)}),e("Ellipse",function(a,b){var c,d,e,f;return a.save(),f=Math.floor(b.width/2),e=Math.floor(b.height/2),c=b.x+f,d=b.y+e,a.translate(c,d),a.scale(1,Math.abs(b.height/b.width)),a.beginPath(),a.arc(0,0,Math.abs(f),0,2*Math.PI),a.closePath(),a.restore(),a.fillStyle=b.fillColor,a.fill(),a.lineWidth=b.strokeWidth,a.strokeStyle=b.strokeColor,a.stroke()}),e("SelectionBox",function(){var a;return a=function(a,b,c){var d,e;return d=b.x,e=b.y,0!==c?(a.fillStyle="#fff",a.fillRect(d,e,c,c),a.strokeStyle="#000",a.strokeRect(d,e,c,c)):void 0},function(b,c){return a(b,c.getTopLeftHandleRect(),c.handleSize),a(b,c.getTopRightHandleRect(),c.handleSize),a(b,c.getBottomLeftHandleRect(),c.handleSize),a(b,c.getBottomRightHandleRect(),c.handleSize),c.backgroundColor&&(b.fillStyle=c.backgroundColor,b.fillRect(c._br.x-c.margin,c._br.y-c.margin,c._br.width+2*c.margin,c._br.height+2*c.margin)),b.lineWidth=1,b.strokeStyle="#000",b.setLineDash([2,4]),b.strokeRect(c._br.x-c.margin,c._br.y-c.margin,c._br.width+2*c.margin,c._br.height+2*c.margin),b.setLineDash([])}}()),e("Image",function(a,b,c){return b.image.width?1===b.scale?a.drawImage(b.image,b.x,b.y):a.drawImage(b.image,b.x,b.y,b.image.width*b.scale,b.image.height*b.scale):c?b.image.onload=c:void 0}),e("Line",function(a,b){var c,d,e,f,g;if(b.x1!==b.x2||b.y1!==b.y2)return d=b.x1,e=b.x2,f=b.y1,g=b.y2,b.strokeWidth%2!==0&&(d+=.5,e+=.5,f+=.5,g+=.5),a.lineWidth=b.strokeWidth,a.strokeStyle=b.color,a.lineCap=b.capStyle,b.dash&&a.setLineDash(b.dash),a.beginPath(),a.moveTo(d,f),a.lineTo(e,g),a.stroke(),b.dash&&a.setLineDash([]),c=Math.max(2.2*b.strokeWidth,5),b.endCapShapes[0]&&j[b.endCapShapes[0]].drawToCanvas(a,d,f,Math.atan2(f-g,d-e),c,b.color),b.endCapShapes[1]?j[b.endCapShapes[1]].drawToCanvas(a,e,g,Math.atan2(g-f,e-d),c,b.color):void 0}),d=function(a,b,c,d){var e,f,g,h;if(null==c&&(c=!1),null==d&&(d="round"),b.length){for(a.lineCap=d,a.strokeStyle=b[0].color,a.lineWidth=b[0].size,a.beginPath(),b[0].size%2===0?a.moveTo(b[0].x,b[0].y):a.moveTo(b[0].x+.5,b[0].y+.5),h=b.slice(1),e=0,f=h.length;f>e;e++)g=h[e],b[0].size%2===0?a.lineTo(g.x,g.y):a.lineTo(g.x+.5,g.y+.5);return c?a.closePath():void 0}},h=function(a,b){return d(a,b.smoothedPoints),a.stroke()},i=function(a,b,c){var e,f,g;return c.tail?(g=c.smoothedPoints.length-c.segmentSize*c.tailSize,f=g<2*c.segmentSize?0:g,e=g+c.segmentSize+1,d(b,c.smoothedPoints.slice(f,e)),b.stroke()):(d(b,c.smoothedPoints),b.stroke())},e("LinePath",h,i),f=function(a,b){return a.save(),a.globalCompositeOperation="destination-out",h(a,b),a.restore()},g=function(a,b,c){return a.save(),a.globalCompositeOperation="destination-out",b.save(),b.globalCompositeOperation="destination-out",i(a,b,c),a.restore(),b.restore()},e("ErasedLinePath",f,g),e("Text",function(a,b){return b.renderer||b._makeRenderer(a),a.fillStyle=b.color,b.renderer.draw(a,b.x,b.y)}),e("Polygon",function(a,b){return a.fillStyle=b.fillColor,d(a,b.points,b.isClosed,"butt"),a.fill(),a.stroke()}),b.exports={defineCanvasRenderer:e,renderShapeToCanvas:l,renderShapeToContext:m}},{"./lineEndCapShapes":12}],10:[function(a,b,c){"use strict";b.exports={imageURLPrefix:"lib/img",primaryColor:"hsla(0, 0%, 0%, 1)",secondaryColor:"hsla(0, 0%, 100%, 1)",backgroundColor:"transparent",strokeWidths:[1,2,5,10,20,30],defaultStrokeWidth:5,toolbarPosition:"top",keyboardShortcuts:!1,imageSize:{width:"infinite",height:"infinite"},backgroundShapes:[],watermarkImage:null,watermarkScale:1,zoomMin:.2,zoomMax:4,zoomStep:.2,snapshot:null,onInit:function(){},tools:[a("../tools/Pencil"),a("../tools/Eraser"),a("../tools/Line"),a("../tools/Rectangle"),a("../tools/Ellipse"),a("../tools/Text"),a("../tools/Polygon"),a("../tools/Pan"),a("../tools/Eyedropper")]}},{"../tools/Ellipse":43,"../tools/Eraser":44,"../tools/Eyedropper":45,"../tools/Line":46,"../tools/Pan":47,"../tools/Pencil":48,"../tools/Polygon":49,"../tools/Rectangle":50,"../tools/Text":52}],11:[function(a,b,c){"use strict";!function(){if(!document.defaultView.getComputedStyle)throw"ERROR: 'document.defaultView.getComputedStyle' not found. This library only works in browsers that can report computed CSS values.";CanvasRenderingContext2D.prototype.measureTextWidth=CanvasRenderingContext2D.prototype.measureText;var a=function(a,b){return document.defaultView.getComputedStyle(a,null).getPropertyValue(b)};CanvasRenderingContext2D.prototype.measureText2=function(b,c,d){var e=this.measureTextWidth(b),f=!/\S/.test(b);e.fontsize=c;var g=document.createElement("div");g.style.position="absolute",g.style.opacity=0,g.style.font=d,g.innerHTML=b+"<br/>"+b,document.body.appendChild(g),e.leading=1.2*c;var h=a(g,"height");if(h=h.replace("px",""),h>=2*c&&(e.leading=h/2|0),document.body.removeChild(g),f)e.ascent=0,e.descent=0,e.bounds={minx:0,maxx:e.width,miny:0,maxy:0},e.height=0;else{var i=document.createElement("canvas"),j=100;i.width=e.width+j,i.height=3*c,i.style.opacity=1,i.style.font=d;var k=i.getContext("2d");k.font=d;var l=i.width,m=i.height,n=m/2;k.fillStyle="white",k.fillRect(-1,-1,l+2,m+2),k.fillStyle="black",k.fillText(b,j/2,n);for(var o=k.getImageData(0,0,l,m).data,p=0,q=4*l,r=o.length;++p<r&&255===o[p];);var s=p/q|0;for(p=r-1;--p>0&&255===o[p];);var t=p/q|0;for(p=0;r>p&&255===o[p];)p+=q,p>=r&&(p=p-r+4);var u=p%q/4|0,v=1;for(p=r-3;p>=0&&255===o[p];)p-=q,0>p&&(p=r-3-4*v++);var w=p%q/4+1|0;e.ascent=n-s,e.descent=t-n,e.bounds={minx:u-j/2,maxx:w-j/2,miny:0,maxy:t-s},e.height=1+(t-s)}return e}}()},{}],12:[function(a,b,c){b.exports={arrow:function(){var a;return a=function(a,b,c,d,e){return[{x:a+Math.cos(c+Math.PI/2)*d/2,y:b+Math.sin(c+Math.PI/2)*d/2},{x:a+Math.cos(c)*e,y:b+Math.sin(c)*e},{x:a+Math.cos(c-Math.PI/2)*d/2,y:b+Math.sin(c-Math.PI/2)*d/2}]},{drawToCanvas:function(b,c,d,e,f,g,h){var i;return null==h&&(h=0),h=h||f,b.fillStyle=g,b.lineWidth=0,b.strokeStyle="transparent",b.beginPath(),i=a(c,d,e,f,h),b.moveTo(i[0].x,i[0].y),b.lineTo(i[1].x,i[1].y),b.lineTo(i[2].x,i[2].y),b.fill()},svg:function(b,c,d,e,f,g){var h;return null==g&&(g=0),g=g||e,h=a(b,c,d,e,g),"<polygon fill='"+f+"' stroke='none' points='"+h.map(function(a){return a.x+","+a.y})+"' />"}}}()}},{}],13:[function(a,b,c){var d,e,f;f={},e=function(a){return f=a},d=function(a){var b;return b=f[a],b||a},b.exports={localize:e,_:d}},{}],14:[function(a,b,c){var d,e,f,g,h,i;d=a("./shapes").Point,i=a("./util"),f={},f.toPoly=function(a){var b,c,d,f,h,i,j;for(i=[],j=[],c=0,b=0,d=a.length;d>b;b++)h=a[b],f=g(h,e(a,c)),i=i.concat([f[0]]),j=[f[1]].concat(j),c+=1;return i.concat(j)},e=function(a,b){var c;return a.length<3&&(c={x:0,y:0}),c=0===b?e(a,b+1):b===a.length-1?e(a,b-1):f.diff(a[b-1],a[b+1])},f.diff=function(a,b){return{x:b.x-a.x,y:b.y-a.y}},h=function(a){var b;return b=f.len(a),{x:a.x/b,y:a.y/b}},g=function(a,b){return b=h(b),b.x=b.x*a.size/2,b.y=b.y*a.size/2,[{x:a.x-b.y,y:a.y+b.x,color:a.color},{x:a.x+b.y,y:a.y-b.x,color:a.color}]},f.len=function(a){return Math.sqrt(Math.pow(a.x,2)+Math.pow(a.y,2))},f.scalePositionScalar=function(a,b,c,d){var e,f;return f=b*c,e=b*d,a+(f-e)/2},b.exports=f},{"./shapes":17,"./util":19}],15:[function(a,b,c){var d,e,f,g;g=a("./util"),e=a("./shapes").JSONToShape,d="infinite",f=function(a,b,c){return b.width?(a.save(),a.translate(a.canvas.width/2,a.canvas.height/2),a.scale(c,c),a.drawImage(b,-b.width/2,-b.height/2),a.restore()):void 0},b.exports=function(a,b){var c,h,i,j,k,l,m,n;return null==b&&(b={}),null==b.scale&&(b.scale=1),l=function(){var b,c,d,f;for(d=a.shapes,f=[],b=0,c=d.length;c>b;b++)k=d[b],f.push(e(k));return f}(),h=[],a.backgroundShapes&&(h=function(){var b,c,d,f;for(d=a.backgroundShapes,f=[],b=0,c=d.length;c>b;b++)k=d[b],f.push(e(k));return f}()),null==b.margin&&(b.margin={top:0,right:0,bottom:0,left:0}),j=a.imageSize||{width:d,height:d},i=a.colors||{background:"transparent"},c=l.concat(h),m=document.createElement("canvas"),n=m.getContext("2d"),b.rect?(b.rect.x-=b.margin.left,b.rect.y-=b.margin.top,b.rect.width+=b.margin.left+b.margin.right,b.rect.height+=b.margin.top+b.margin.bottom):b.rect=g.getDefaultImageRect(function(){var a,b,d;for(d=[],a=0,b=c.length;b>a;a++)k=c[a],d.push(k.getBoundingRect(n));return d}(),j,b.margin),m.width=b.rect.width*b.scale,m.height=b.rect.height*b.scale,n.fillStyle=i.background,n.fillRect(0,0,m.width,m.height),b.rect.width&&b.rect.height?(b.watermarkImage&&f(n,b.watermarkImage,b.watermarkScale),g.combineCanvases(m,g.renderShapes(h,b.rect,b.scale),g.renderShapes(l,b.rect,b.scale))):null}},{"./shapes":17,"./util":19}],16:[function(a,b,c){
var d,e,f;f=a("./util"),e=a("./shapes").JSONToShape,d="infinite",b.exports=function(a,b){var c,g,h,i,j,k,l,m;return null==b&&(b={}),m=function(){var b,c,d,f;for(d=a.shapes,f=[],b=0,c=d.length;c>b;b++)l=d[b],f.push(e(l));return f}(),g=[],a.backgroundShapes&&(g=function(){var b,c,d,f;for(d=a.backgroundShapes,f=[],b=0,c=d.length;c>b;b++)l=d[b],f.push(e(l));return f}()),null==b.margin&&(b.margin={top:0,right:0,bottom:0,left:0}),k=a.imageSize||{width:d,height:d},h=a.colors||{background:"transparent"},c=m.concat(g),j=document.createElement("canvas"),i=j.getContext("2d"),b.rect?(b.rect.x-=b.margin.left,b.rect.y-=b.margin.top,b.rect.width+=b.margin.left+b.margin.right,b.rect.height+=b.margin.top+b.margin.bottom):b.rect=f.getDefaultImageRect(function(){var a,b,d;for(d=[],a=0,b=c.length;b>a;a++)l=c[a],d.push(l.getBoundingRect(i));return d}(),k,b.margin),LC.renderShapesToSVG(g.concat(m),b.rect,h.background)}},{"./shapes":17,"./util":19}],17:[function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y;y=a("./util"),f=a("./TextRenderer"),q=a("./lineEndCapShapes"),s=a("./canvasRenderer"),n=s.defineCanvasRenderer,u=s.renderShapeToContext,t=a("./svgRenderer"),o=t.defineSVGRenderer,v=t.renderShapeToSVG,x={},p=function(a,b){var c,d,e,f,g,h,i,j;c=function(a,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){return b.constructor.call(this,a,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q),this},c.prototype.className=a,c.fromJSON=b.fromJSON,b.draw&&(g=b.draw,h=b.draw||function(a,b,c){return this.draw(a,b,c)},d=function(a,b,c){return g.call(b,a,c)},e=function(a,b,c,d){return h.call(c,a,b,d)},delete b.draw,b.drawLatest&&delete b.drawLatest,n(a,d,e)),b.toSVG&&(i=b.toSVG,j=function(a){return i.call(a)},delete b.toSVG,o(a,j)),c.prototype.draw=function(a,b){return u(a,this,{retryCallback:b})},c.prototype.drawLatest=function(a,b,c){return u(a,this,{retryCallback:c,bufferCtx:b,shouldOnlyDrawLatest:!0})},c.prototype.toSVG=function(){return v(this)};for(f in b)"fromJSON"!==f&&(c.prototype[f]=b[f]);return x[a]=c,c},m=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r;return r=new x[a](b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q),r.id=y.getGUID(),r},d=function(a){var b,c,d,e;return b=a.className,c=a.data,d=a.id,b in x?(e=x[b].fromJSON(c),e?(d&&(e.id=d),e):(console.log("Unreadable shape:",b,c),null)):(console.log("Unknown shape:",b,c),null)},w=function(a){return{className:a.className,data:a.toJSON(),id:a.id}},l=function(a,b){return b?l(i(i(k(a))),b-1):a},k=function(a){var b,c,d,e,f;for(a=[a[0]].concat(a).concat(y.last(a)),f=[],b=0,e=0,c=a.length;c>e;e++)d=a[e],f[2*b]=d,a[b+1]&&(f[2*b+1]=j(d,a[b+1])),b+=1;return f},i=function(a){var b,c,d,e,f;for(b=[],c=0,f=0,d=a.length;d>f;f++)e=a[f],a[c+1]&&(b[c]=j(e,a[c+1])),c+=1;return b},j=function(a,b){return m("Point",{x:a.x+(b.x-a.x)/2,y:a.y+(b.y-a.y)/2,size:a.size+(b.size-a.size)/2,color:a.color})},p("Image",{constructor:function(a){return null==a&&(a={}),this.x=a.x||0,this.y=a.y||0,this.scale=a.scale||1,this.image=a.image||null},getBoundingRect:function(){return{x:this.x,y:this.y,width:this.image.width*this.scale,height:this.image.height*this.scale}},toJSON:function(){return{x:this.x,y:this.y,imageSrc:this.image.src,imageObject:this.image,scale:this.scale}},fromJSON:function(a){var b,c;return b=null,(null!=(c=a.imageObject)?c.width:void 0)?b=a.imageObject:(b=new Image,b.src=a.imageSrc),m("Image",{x:a.x,y:a.y,image:b,scale:a.scale})},move:function(a){return null==a&&(a={}),this.x=this.x-a.xDiff,this.y=this.y-a.yDiff},setUpperLeft:function(a){return null==a&&(a={}),this.x=a.x,this.y=a.y}}),p("Rectangle",{constructor:function(a){return null==a&&(a={}),this.x=a.x||0,this.y=a.y||0,this.width=a.width||0,this.height=a.height||0,this.strokeWidth=a.strokeWidth||1,this.strokeColor=a.strokeColor||"black",this.fillColor=a.fillColor||"transparent"},getBoundingRect:function(){return{x:this.x-this.strokeWidth/2,y:this.y-this.strokeWidth/2,width:this.width+this.strokeWidth,height:this.height+this.strokeWidth}},toJSON:function(){return{x:this.x,y:this.y,width:this.width,height:this.height,strokeWidth:this.strokeWidth,strokeColor:this.strokeColor,fillColor:this.fillColor}},fromJSON:function(a){return m("Rectangle",a)},move:function(a){return null==a&&(a={}),this.x=this.x-a.xDiff,this.y=this.y-a.yDiff},setUpperLeft:function(a){return null==a&&(a={}),this.x=a.x,this.y=a.y}}),p("Ellipse",{constructor:function(a){return null==a&&(a={}),this.x=a.x||0,this.y=a.y||0,this.width=a.width||0,this.height=a.height||0,this.strokeWidth=a.strokeWidth||1,this.strokeColor=a.strokeColor||"black",this.fillColor=a.fillColor||"transparent"},getBoundingRect:function(){return{x:this.x-this.strokeWidth/2,y:this.y-this.strokeWidth/2,width:this.width+this.strokeWidth,height:this.height+this.strokeWidth}},toJSON:function(){return{x:this.x,y:this.y,width:this.width,height:this.height,strokeWidth:this.strokeWidth,strokeColor:this.strokeColor,fillColor:this.fillColor}},fromJSON:function(a){return m("Ellipse",a)},move:function(a){return null==a&&(a={}),this.x=this.x-a.xDiff,this.y=this.y-a.yDiff},setUpperLeft:function(a){return null==a&&(a={}),this.x=a.x,this.y=a.y}}),p("Line",{constructor:function(a){return null==a&&(a={}),this.x1=a.x1||0,this.y1=a.y1||0,this.x2=a.x2||0,this.y2=a.y2||0,this.strokeWidth=a.strokeWidth||1,this.color=a.color||"black",this.capStyle=a.capStyle||"round",this.endCapShapes=a.endCapShapes||[null,null],this.dash=a.dash||null},getBoundingRect:function(){return{x:Math.min(this.x1,this.x2)-this.strokeWidth/2,y:Math.min(this.y1,this.y2)-this.strokeWidth/2,width:Math.abs(this.x2-this.x1)+this.strokeWidth/2,height:Math.abs(this.y2-this.y1)+this.strokeWidth/2}},toJSON:function(){return{x1:this.x1,y1:this.y1,x2:this.x2,y2:this.y2,strokeWidth:this.strokeWidth,color:this.color,capStyle:this.capStyle,dash:this.dash,endCapShapes:this.endCapShapes}},fromJSON:function(a){return m("Line",a)},move:function(a){return null==a&&(a={}),this.x1=this.x1-a.xDiff,this.y1=this.y1-a.yDiff,this.x2=this.x2-a.xDiff,this.y2=this.y2-a.yDiff},setUpperLeft:function(a){var b,c,d;return null==a&&(a={}),b=this.getBoundingRect(),c=b.x-a.x,d=b.y-a.y,this.move({xDiff:c,yDiff:d})}}),h=function(a){var b,c,d,e,f;if(!a.length)return!1;for(f=a[0].size,b=a[0].color,e=0,c=a.length;c>e;e++)if(d=a[e],d.size===f&&d.color===b||console.log(f,b,d.size,d.color),d.size!==f||d.color!==b)return!1;return!0},g=function(a,b){var c,e,f,g,h;return e=null,b.points?e=function(){var a,e,f,g;for(f=b.points,g=[],e=0,a=f.length;a>e;e++)c=f[e],g.push(d(c));return g}():b.pointCoordinatePairs&&(e=function(){var a,c,e,f,i;for(e=b.pointCoordinatePairs,i=[],c=0,a=e.length;a>c;c++)f=e[c],g=f[0],h=f[1],i.push(d({className:"Point",data:{x:g,y:h,size:b.pointSize,color:b.pointColor,smooth:b.smooth}}));return i}()),f=null,b.smoothedPointCoordinatePairs&&(f=function(){var a,c,e,f,i;for(e=b.smoothedPointCoordinatePairs,i=[],c=0,a=e.length;a>c;c++)f=e[c],g=f[0],h=f[1],i.push(d({className:"Point",data:{x:g,y:h,size:b.pointSize,color:b.pointColor,smooth:b.smooth}}));return i}()),e[0]?m(a,{points:e,smoothedPoints:f,order:b.order,tailSize:b.tailSize,smooth:b.smooth}):null},r={constructor:function(a){var b,c,d,e,f;if(null==a&&(a={}),d=a.points||[],this.order=a.order||3,this.tailSize=a.tailSize||3,this.smooth=!("smooth"in a)||a.smooth,this.segmentSize=Math.pow(2,this.order),this.sampleSize=this.tailSize+1,a.smoothedPoints)return this.points=a.points,this.smoothedPoints=a.smoothedPoints;for(this.points=[],f=[],e=0,b=d.length;b>e;e++)c=d[e],f.push(this.addPoint(c));return f},getBoundingRect:function(){return y.getBoundingRect(this.points.map(function(a){return{x:a.x-a.size/2,y:a.y-a.size/2,width:a.size,height:a.size}}))},toJSON:function(){var a,b;return h(this.points)?{order:this.order,tailSize:this.tailSize,smooth:this.smooth,pointCoordinatePairs:function(){var a,c,d,e;for(d=this.points,e=[],c=0,a=d.length;a>c;c++)b=d[c],e.push([b.x,b.y]);return e}.call(this),smoothedPointCoordinatePairs:function(){var a,c,d,e;for(d=this.smoothedPoints,e=[],c=0,a=d.length;a>c;c++)b=d[c],e.push([b.x,b.y]);return e}.call(this),pointSize:this.points[0].size,pointColor:this.points[0].color}:{order:this.order,tailSize:this.tailSize,smooth:this.smooth,points:function(){var b,c,d,e;for(d=this.points,e=[],c=0,b=d.length;b>c;c++)a=d[c],e.push(w(a));return e}.call(this)}},fromJSON:function(a){return g("LinePath",a)},addPoint:function(a){return this.points.push(a),this.smooth?!this.smoothedPoints||this.points.length<this.sampleSize?this.smoothedPoints=l(this.points,this.order):(this.tail=y.last(l(y.last(this.points,this.sampleSize),this.order),this.segmentSize*this.tailSize),this.smoothedPoints=this.smoothedPoints.slice(0,this.smoothedPoints.length-this.segmentSize*(this.tailSize-1)).concat(this.tail)):void(this.smoothedPoints=this.points)},move:function(a){var b,c,d,e;for(null==a&&(a={}),d=this.smooth?this.smoothedPoints:this.points,e=0,b=d.length;b>e;e++)c=d[e],c.move(a);return this.points=this.smoothedPoints},setUpperLeft:function(a){var b,c,d;return null==a&&(a={}),b=this.getBoundingRect(),c=b.x-a.x,d=b.y-a.y,this.move({xDiff:c,yDiff:d})}},e=p("LinePath",r),p("ErasedLinePath",{constructor:r.constructor,toJSON:r.toJSON,addPoint:r.addPoint,getBoundingRect:r.getBoundingRect,fromJSON:function(a){return g("ErasedLinePath",a)}}),p("Point",{constructor:function(a){return null==a&&(a={}),this.x=a.x||0,this.y=a.y||0,this.size=a.size||0,this.color=a.color||""},getBoundingRect:function(){return{x:this.x-this.size/2,y:this.y-this.size/2,width:this.size,height:this.size}},toJSON:function(){return{x:this.x,y:this.y,size:this.size,color:this.color}},fromJSON:function(a){return m("Point",a)},move:function(a){return null==a&&(a={}),this.x=this.x-a.xDiff,this.y=this.y-a.yDiff},setUpperLeft:function(a){return null==a&&(a={}),this.x=a.x,this.y=a.y}}),p("Polygon",{constructor:function(a){var b,c,d,e,f;for(null==a&&(a={}),this.points=a.points,this.fillColor=a.fillColor||"white",this.strokeColor=a.strokeColor||"black",this.strokeWidth=a.strokeWidth,this.dash=a.dash||null,null==a.isClosed&&(a.isClosed=!0),this.isClosed=a.isClosed,e=this.points,f=[],d=0,b=e.length;b>d;d++)c=e[d],c.color=this.strokeColor,f.push(c.size=this.strokeWidth);return f},addPoint:function(a,b){return this.points.push(LC.createShape("Point",{x:a,y:b}))},getBoundingRect:function(){return y.getBoundingRect(this.points.map(function(a){return a.getBoundingRect()}))},toJSON:function(){return{strokeWidth:this.strokeWidth,fillColor:this.fillColor,strokeColor:this.strokeColor,dash:this.dash,isClosed:this.isClosed,pointCoordinatePairs:this.points.map(function(a){return[a.x,a.y]})}},fromJSON:function(a){return a.points=a.pointCoordinatePairs.map(function(b){var c,d;return c=b[0],d=b[1],m("Point",{x:c,y:d,size:a.strokeWidth,color:a.strokeColor})}),m("Polygon",a)},move:function(a){var b,c,d,e,f;for(null==a&&(a={}),e=this.points,f=[],d=0,b=e.length;b>d;d++)c=e[d],f.push(c.move(a));return f},setUpperLeft:function(a){var b,c,d;return null==a&&(a={}),b=this.getBoundingRect(),c=b.x-a.x,d=b.y-a.y,this.move({xDiff:c,yDiff:d})}}),p("Text",{constructor:function(a){return null==a&&(a={}),this.x=a.x||0,this.y=a.y||0,this.v=a.v||0,this.text=a.text||"",this.color=a.color||"black",this.font=a.font||"18px sans-serif",this.forcedWidth=a.forcedWidth||null,this.forcedHeight=a.forcedHeight||null},_makeRenderer:function(a){return a.lineHeight=1.2,this.renderer=new f(a,this.text,this.font,this.forcedWidth,this.forcedHeight),this.v<1?(console.log("repairing baseline"),this.v=1,this.x-=this.renderer.metrics.bounds.minx,this.y-=this.renderer.metrics.leading-this.renderer.metrics.descent):void 0},setText:function(a){return this.text=a,this.renderer=null},setFont:function(a){return this.font=a,this.renderer=null},setPosition:function(a,b){return this.x=a,this.y=b},setSize:function(a,b){return this.forcedWidth=Math.max(a,0),this.forcedHeight=Math.max(b,0),this.renderer=null},enforceMaxBoundingRect:function(a){var b,c,d;return b=this.getBoundingRect(a.ctx),d={x:-a.position.x/a.scale,y:-a.position.y/a.scale,width:a.canvas.width/a.scale,height:a.canvas.height/a.scale},b.x+b.width>d.x+d.width?(c=b.x-d.x,this.forcedWidth=d.width-c-10,this.renderer=null):void 0},getBoundingRect:function(a,b){if(null==b&&(b=!1),!this.renderer){if(!a)throw"Must pass ctx if text hasn't been rendered yet";this._makeRenderer(a)}return{x:Math.floor(this.x),y:Math.floor(this.y),width:Math.ceil(this.renderer.getWidth(!0)),height:Math.ceil(this.renderer.getHeight())}},toJSON:function(){return{x:this.x,y:this.y,text:this.text,color:this.color,font:this.font,forcedWidth:this.forcedWidth,forcedHeight:this.forcedHeight,v:this.v}},fromJSON:function(a){return m("Text",a)},move:function(a){return null==a&&(a={}),this.x=this.x-a.xDiff,this.y=this.y-a.yDiff},setUpperLeft:function(a){return null==a&&(a={}),this.x=a.x,this.y=a.y}}),p("SelectionBox",{constructor:function(a){return null==a&&(a={}),this.shape=a.shape,null!=a.handleSize?this.handleSize=a.handleSize:this.handleSize=10,this.margin=4,this.backgroundColor=a.backgroundColor||null,this._br=this.shape.getBoundingRect(a.ctx)},toJSON:function(){return{shape:w(this.shape),backgroundColor:this.backgroundColor}},fromJSON:function(a){var b,c,e,f;return f=a.shape,c=a.handleSize,e=a.margin,b=a.backgroundColor,m("SelectionBox",{shape:d(f),backgroundColor:b})},getTopLeftHandleRect:function(){return{x:this._br.x-this.handleSize-this.margin,y:this._br.y-this.handleSize-this.margin,width:this.handleSize,height:this.handleSize}},getBottomLeftHandleRect:function(){return{x:this._br.x-this.handleSize-this.margin,y:this._br.y+this._br.height+this.margin,width:this.handleSize,height:this.handleSize}},getTopRightHandleRect:function(){return{x:this._br.x+this._br.width+this.margin,y:this._br.y-this.handleSize-this.margin,width:this.handleSize,height:this.handleSize}},getBottomRightHandleRect:function(){return{x:this._br.x+this._br.width+this.margin,y:this._br.y+this._br.height+this.margin,width:this.handleSize,height:this.handleSize}},getBoundingRect:function(){return{x:this._br.x-this.margin,y:this._br.y-this.margin,width:this._br.width+2*this.margin,height:this._br.height+2*this.margin}}}),b.exports={defineShape:p,createShape:m,JSONToShape:d,shapeToJSON:w}},{"./TextRenderer":6,"./canvasRenderer":9,"./lineEndCapShapes":12,"./svgRenderer":18,"./util":19}],18:[function(a,b,c){var d,e,f,g;e=a("./lineEndCapShapes"),g={},d=function(a,b){return g[a]=b},f=function(a,b){if(null==b&&(b={}),null==b.shouldIgnoreUnsupportedShapes&&(b.shouldIgnoreUnsupportedShapes=!1),g[a.className])return g[a.className](a);if(b.shouldIgnoreUnsupportedShapes)return console.warn("Can't render shape of type "+a.className+" to SVG"),"";throw"Can't render shape of type "+a.className+" to SVG"},d("Rectangle",function(a){var b,c,d,e,f,g,h,i;return e=a.x,h=a.y,f=a.x+a.width,i=a.y+a.height,d=Math.min(e,f),g=Math.min(h,i),c=Math.max(e,f)-d,b=Math.max(h,i)-g,a.strokeWidth%2!==0&&(d+=.5,g+=.5),"<rect x='"+d+"' y='"+g+"' width='"+c+"' height='"+b+"' stroke='"+a.strokeColor+"' fill='"+a.fillColor+"' stroke-width='"+a.strokeWidth+"' />"}),d("SelectionBox",function(a){return""}),d("Ellipse",function(a){var b,c,d,e;return e=Math.floor(a.width/2),d=Math.floor(a.height/2),b=a.x+e,c=a.y+d,"<ellipse cx='"+b+"' cy='"+c+"' rx='"+Math.abs(e)+"' ry='"+Math.abs(d)+"' stroke='"+a.strokeColor+"' fill='"+a.fillColor+"' stroke-width='"+a.strokeWidth+"' />"}),d("Image",function(a){return"<image x='"+a.x+"' y='"+a.y+"' width='"+a.image.naturalWidth*a.scale+"' height='"+a.image.naturalHeight*a.scale+"' xlink:href='"+a.image.src+"' />"}),d("Line",function(a){var b,c,d,f,g,h,i;return d=a.dash?"stroke-dasharray='"+a.dash.join(", ")+"'":"",c="",b=Math.max(2.2*a.strokeWidth,5),f=a.x1,g=a.x2,h=a.y1,i=a.y2,a.strokeWidth%2!==0&&(f+=.5,g+=.5,h+=.5,i+=.5),a.endCapShapes[0]&&(c+=e[a.endCapShapes[0]].svg(f,h,Math.atan2(h-i,f-g),b,a.color)),a.endCapShapes[1]&&(c+=e[a.endCapShapes[1]].svg(g,i,Math.atan2(i-h,g-f),b,a.color)),"<g> <line x1='"+f+"' y1='"+h+"' x2='"+g+"' y2='"+i+"' "+d+" stroke-linecap='"+a.capStyle+"' stroke='"+a.color+" 'stroke-width='"+a.strokeWidth+"' /> "+c+" </g>"}),d("LinePath",function(a){return"<polyline fill='none' points='"+a.smoothedPoints.map(function(a){var b;return b=a.strokeWidth%2===0?0:.5,a.x+b+","+(a.y+b)}).join(" ")+"' stroke='"+a.points[0].color+"' stroke-linecap='round' stroke-width='"+a.points[0].size+"' />"}),d("ErasedLinePath",function(a){return""}),d("Polygon",function(a){return a.isClosed?"<polygon fill='"+a.fillColor+"' points='"+a.points.map(function(a){var b;return b=a.strokeWidth%2===0?0:.5,a.x+b+","+(a.y+b)}).join(" ")+"' stroke='"+a.strokeColor+"' stroke-width='"+a.strokeWidth+"' />":"<polyline fill='"+a.fillColor+"' points='"+a.points.map(function(a){var b;return b=a.strokeWidth%2===0?0:.5,a.x+b+","+(a.y+b)}).join(" ")+"' stroke='none' /> <polyline fill='none' points='"+a.points.map(function(a){var b;return b=a.strokeWidth%2===0?0:.5,a.x+b+","+(a.y+b)}).join(" ")+"' stroke='"+a.strokeColor+"' stroke-width='"+a.strokeWidth+"' />"}),d("Text",function(a){var b,c,d;return d=a.forcedWidth?"width='"+a.forcedWidth+"px'":"",b=a.forcedHeight?"height='"+a.forcedHeight+"px'":"",c=a.text.split(/\r\n|\r|\n/g),a.renderer&&(c=a.renderer.lines),"<text x='"+a.x+"' y='"+a.y+"' "+d+" "+b+" fill='"+a.color+"' style='font: "+a.font+";'> "+c.map(function(b){return function(b,c){var d;return d=0===c?0:"1.2em","<tspan x='"+a.x+"' dy='"+d+"' alignment-baseline='text-before-edge'> "+b+" </tspan>"}}(this)).join("")+" </text>"}),b.exports={defineSVGRenderer:d,renderShapeToSVG:f}},{"./lineEndCapShapes":12}],19:[function(a,b,c){var d,e,f,g,h=[].slice;f=Array.prototype.slice,d=a("./canvasRenderer").renderShapeToContext,e=a("./svgRenderer").renderShapeToSVG,g={addImageOnload:function(a,b){var c;return c=a.onload,a.onload=function(){return"function"==typeof c&&c(),b()},a},last:function(a,b){return null==b&&(b=null),b?f.call(a,Math.max(a.length-b,0)):a[a.length-1]},classSet:function(a){var b,c;b=[];for(c in a)a[c]&&b.push(c);return b.join(" ")},matchElementSize:function(a,b,c,d){var e;return null==d&&(d=function(){}),e=function(e){return function(){var e,f,g;for(f=0,g=b.length;g>f;f++)e=b[f],e.style.width=a.offsetWidth+"px",e.style.height=a.offsetHeight+"px",null!=e.width&&(e.setAttribute("width",e.offsetWidth*c),e.setAttribute("height",e.offsetHeight*c));return d()}}(this),a.addEventListener("resize",e),window.addEventListener("resize",e),window.addEventListener("orientationchange",e),e(),e},combineCanvases:function(){var a,b,c,d,e,f,g,i;for(c=1<=arguments.length?h.call(arguments,0):[],a=document.createElement("canvas"),a.width=c[0].width,a.height=c[0].height,e=0,g=c.length;g>e;e++)b=c[e],a.width=Math.max(b.width,a.width),a.height=Math.max(b.height,a.height);for(d=a.getContext("2d"),f=0,i=c.length;i>f;f++)b=c[f],d.drawImage(b,0,0);return a},renderShapes:function(a,b,c,e){var f,g,h,i;for(null==c&&(c=1),null==e&&(e=null),e=e||document.createElement("canvas"),e.width=b.width*c,e.height=b.height*c,f=e.getContext("2d"),f.translate(-b.x*c,-b.y*c),f.scale(c,c),g=0,h=a.length;h>g;g++)i=a[g],d(f,i);return e},renderShapesToSVG:function(a,b,c){var d,f,g,h;return g=b.x,h=b.y,f=b.width,d=b.height,("<svg xmlns='http://www.w3.org/2000/svg' width='"+f+"' height='"+d+"' viewBox='0 0 "+f+" "+d+"'> <rect width='"+f+"' height='"+d+"' x='0' y='0' fill='"+c+"' /> <g transform='translate("+-g+", "+-h+")'> "+a.map(e).join("")+" </g> </svg>").replace(/(\r\n|\n|\r)/gm,"")},getBoundingRect:function(a,b,c){var d,e,f,g,h,i,j;if(!a.length)return{x:0,y:0,width:b,height:c};for(h=a[0].x,i=a[0].y,f=a[0].x+a[0].width,g=a[0].y+a[0].height,d=0,e=a.length;e>d;d++)j=a[d],h=Math.floor(Math.min(j.x,h)),i=Math.floor(Math.min(j.y,i)),f=Math.ceil(Math.max(f,j.x+j.width)),g=Math.ceil(Math.max(g,j.y+j.height));return h=b?0:h,i=c?0:i,f=b||f,g=c||g,{x:h,y:i,width:f-h,height:g-i}},getDefaultImageRect:function(a,b,c){var d,e,f;return null==b&&(b={width:0,height:0}),null==c&&(c={top:0,right:0,bottom:0,left:0}),f=b.width,d=b.height,e=g.getBoundingRect(a,"infinite"===f?0:f,"infinite"===d?0:d),e.x-=c.left,e.y-=c.top,e.width+=c.left+c.right,e.height+=c.top+c.bottom,e},getBackingScale:function(a){return null==window.devicePixelRatio?1:window.devicePixelRatio>1?window.devicePixelRatio:1},requestAnimationFrame:(window.requestAnimationFrame||window.setTimeout).bind(window),getGUID:function(){var a;return a=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},function(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}}(),requestAnimationFrame:function(a){return window.requestAnimationFrame?window.requestAnimationFrame(a):window.webkitRequestAnimationFrame?window.webkitRequestAnimationFrame(a):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(a):setTimeout(a,0)},cancelAnimationFrame:function(a){return window.cancelAnimationFrame?window.cancelAnimationFrame(a):window.webkitCancelRequestAnimationFrame?window.webkitCancelRequestAnimationFrame(a):window.webkitCancelAnimationFrame?window.webkitCancelAnimationFrame(a):window.mozCancelAnimationFrame?window.mozCancelAnimationFrame(a):clearTimeout(a)}},b.exports=g},{"./canvasRenderer":9,"./svgRenderer":18}],20:[function(a,b,c){"use strict";!function(){function a(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c}a.prototype=window.CustomEvent.prototype,window.CustomEvent=a}()},{}],21:[function(a,b,c){"use strict";var d=!1;CanvasRenderingContext2D.prototype.setLineDash||(CanvasRenderingContext2D.prototype.setLineDash=function(){d||(console.warn("context2D.setLineDash is a no-op in this browser."),d=!0)}),b.exports=null},{}],22:[function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;a("./ie_customevent"),a("./ie_setLineDash"),d=a("./core/LiterallyCanvas"),j=a("./core/defaultOptions"),g=a("./core/canvasRenderer"),v=a("./core/svgRenderer"),u=a("./core/shapes"),x=a("./core/util"),r=a("./core/renderSnapshotToImage"),s=a("./core/renderSnapshotToSVG"),p=a("./core/localization").localize,e=a("./reactGUI/LiterallyCanvas"),n=a("./reactGUI/initDOM"),a("./optionsStyles/font"),a("./optionsStyles/stroke-width"),a("./optionsStyles/line-options-and-stroke-width"),a("./optionsStyles/polygon-and-stroke-width"),a("./optionsStyles/stroke-or-fill"),a("./optionsStyles/null"),l=a("./optionsStyles/optionsStyles").defineOptionsStyle,h={snapshotToShapes:function(a){var b,c,d,e,f;for(d=a.shapes,e=[],b=0,c=d.length;c>b;b++)f=d[b],e.push(u.JSONToShape(f));return e},snapshotJSONToShapes:function(a){return h.snapshotToShapes(JSON.parse(a))}},f=a("./tools/base"),w={Pencil:a("./tools/Pencil"),Eraser:a("./tools/Eraser"),Line:a("./tools/Line"),Rectangle:a("./tools/Rectangle"),Ellipse:a("./tools/Ellipse"),Text:a("./tools/Text"),Polygon:a("./tools/Polygon"),Pan:a("./tools/Pan"),Eyedropper:a("./tools/Eyedropper"),SelectShape:a("./tools/SelectShape"),Tool:f.Tool,ToolWithStroke:f.ToolWithStroke},k=j.tools,i=j.imageURLPrefix,t=function(a){return i=a,j.imageURLPrefix=a},m=function(b,c){var d,e,f,g,h;null==c&&(c={});for(g in j)g in c||(c[g]=j[g]);for(h=b.children,e=0,f=h.length;f>e;e++)d=h[e],b.removeChild(d);return a("./reactGUI/initDOM")(b,c)},o=function(a,b){var c,e,f;return f=a.className,-1===[" "," "].join(a.className).indexOf(" literally ")&&(a.className=a.className+" literally"),a.className=a.className+" toolbar-hidden",c=document.createElement("div"),c.className="lc-drawing",a.appendChild(c),e=new d(c,b),e.teardown=function(){var b,c,d,g;for(e._teardown(),g=a.children,c=0,d=g.length;d>c;c++)b=g[c],a.removeChild(b);return a.className=f},"onInit"in b&&b.onInit(e),e},q=function(a){return a.fn.literallycanvas=function(a){return null==a&&(a={}),this.each(function(b){return function(b,c){return c.literallycanvas=m(c,a)}}(this)),this}},"undefined"!=typeof window&&(window.LC={init:m},window.$&&q(window.$)),b.exports={init:m,registerJQueryPlugin:q,util:x,tools:w,setDefaultImageURLPrefix:t,defaultTools:k,defineOptionsStyle:l,LiterallyCanvasReactComponent:e,defineShape:u.defineShape,createShape:u.createShape,JSONToShape:u.JSONToShape,shapeToJSON:u.shapeToJSON,defineCanvasRenderer:g.defineCanvasRenderer,renderShapeToContext:g.renderShapeToContext,renderShapeToCanvas:g.renderShapeToCanvas,renderShapesToCanvas:x.renderShapes,defineSVGRenderer:v.defineSVGRenderer,renderShapeToSVG:v.renderShapeToSVG,renderShapesToSVG:x.renderShapesToSVG,snapshotToShapes:h.snapshotToShapes,snapshotJSONToShapes:h.snapshotJSONToShapes,renderSnapshotToImage:r,renderSnapshotToSVG:s,localize:p}},{"./core/LiterallyCanvas":5,"./core/canvasRenderer":9,"./core/defaultOptions":10,"./core/localization":13,"./core/renderSnapshotToImage":15,"./core/renderSnapshotToSVG":16,"./core/shapes":17,"./core/svgRenderer":18,"./core/util":19,"./ie_customevent":20,"./ie_setLineDash":21,"./optionsStyles/font":23,"./optionsStyles/line-options-and-stroke-width":24,"./optionsStyles/null":25,"./optionsStyles/optionsStyles":26,"./optionsStyles/polygon-and-stroke-width":27,"./optionsStyles/stroke-or-fill":28,"./optionsStyles/stroke-width":29,"./reactGUI/LiterallyCanvas":32,"./reactGUI/initDOM":42,"./tools/Ellipse":43,"./tools/Eraser":44,"./tools/Eyedropper":45,"./tools/Line":46,"./tools/Pan":47,"./tools/Pencil":48,"./tools/Polygon":49,"./tools/Rectangle":50,"./tools/SelectShape":51,"./tools/Text":52,"./tools/base":53}],23:[function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z;for(h=a("../reactGUI/React-shim"),l=a("./optionsStyles").defineOptionsStyle,k=a("../core/localization")._,i=[["Arial",'Arial,"Helvetica Neue",Helvetica,sans-serif'],["Arial Black",'"Arial Black","Arial Bold",Gadget,sans-serif'],["Arial Narrow",'"Arial Narrow",Arial,sans-serif'],["Gill Sans",'"Gill Sans","Gill Sans MT",Calibri,sans-serif'],["Helvetica",'"Helvetica Neue",Helvetica,Arial,sans-serif'],["Impact",'Impact,Haettenschweiler,"Franklin Gothic Bold",Charcoal,"Helvetica Inserat","Bitstream Vera Sans Bold","Arial Black",sans-serif'],["Tahoma","Tahoma,Verdana,Segoe,sans-serif"],["Trebuchet MS",'"Trebuchet MS","Lucida Grande","Lucida Sans Unicode","Lucida Sans",Tahoma,sans-serif'],["Verdana","Verdana,Geneva,sans-serif"]].map(function(a){var b,c;return b=a[0],c=a[1],{name:k(b),value:c}}),j=[["Baskerville",'Baskerville,"Baskerville Old Face","Hoefler Text",Garamond,"Times New Roman",serif'],["Garamond",'Garamond,Baskerville,"Baskerville Old Face","Hoefler Text","Times New Roman",serif'],["Georgia",'Georgia,Times,"Times New Roman",serif'],["Hoefler Text",'"Hoefler Text","Baskerville Old Face",Garamond,"Times New Roman",serif'],["Lucida Bright",'"Lucida Bright",Georgia,serif'],["Palatino",'Palatino,"Palatino Linotype","Palatino LT STD","Book Antiqua",Georgia,serif'],["Times New Roman",'TimesNewRoman,"Times New Roman",Times,Baskerville,Georgia,serif']].map(function(a){var b,c;return b=a[0],c=a[1],{name:k(b),value:c}}),f=[["Consolas/Monaco",'Consolas,monaco,"Lucida Console",monospace'],["Courier New",'"Courier New",Courier,"Lucida Sans Typewriter","Lucida Typewriter",monospace'],["Lucida Sans Typewriter",'"Lucida Sans Typewriter","Lucida Console",monaco,"Bitstream Vera Sans Mono",monospace']].map(function(a){var b,c;return b=a[0],c=a[1],{name:k(b),value:c}}),g=[["Copperplate",'Copperplate,"Copperplate Gothic Light",fantasy'],["Papyrus","Papyrus,fantasy"],["Script",'"Brush Script MT",cursive']].map(function(a){var b,c;return b=a[0],c=a[1],{name:k(b),value:c}}),d=[[k("Sans Serif"),i],[k("Serif"),j],[k("Monospace"),f],[k("Other"),g]],e={},m=0,p=i.length;p>m;m++)v=i[m],u=v.name,z=v.value,e[u]=z;for(n=0,q=j.length;q>n;n++)w=j[n],u=w.name,z=w.value,e[u]=z;for(o=0,r=f.length;r>o;o++)x=f[o],u=x.name,z=x.value,e[u]=z;for(t=0,s=g.length;s>t;t++)y=g[t],u=y.name,z=y.value,e[u]=z;l("font",h.createClass({displayName:"FontOptions",getInitialState:function(){return{isItalic:!1,isBold:!1,fontName:"Helvetica",fontSizeIndex:4}},getFontSizes:function(){return[9,10,12,14,18,24,36,48,64,72,96,144,288]},updateTool:function(a){var b,c,d;null==a&&(a={});for(d in this.state)d in a||(a[d]=this.state[d]);return b=this.getFontSizes()[a.fontSizeIndex],c=[],a.isItalic&&c.push("italic"),a.isBold&&c.push("bold"),c.push(b+"px"),c.push(e[a.fontName]),this.props.lc.tool.font=c.join(" "),this.props.lc.trigger("setFont",c.join(" "))},handleFontSize:function(a){var b;return b={fontSizeIndex:a.target.value},this.setState(b),this.updateTool(b)},handleFontFamily:function(a){var b;return b={fontName:a.target.selectedOptions[0].innerHTML},this.setState(b),this.updateTool(b)},handleItalic:function(a){var b;return b={isItalic:!this.state.isItalic},this.setState(b),this.updateTool(b)},handleBold:function(a){var b;return b={isBold:!this.state.isBold},this.setState(b),this.updateTool(b)},componentDidMount:function(){return this.updateTool()},render:function(){var a,b,c,e,f,g,i,j,l,m;return f=this.props.lc,j=h.DOM,b=j.div,c=j.input,l=j.select,i=j.option,a=j.br,e=j.label,m=j.span,g=j.optgroup,b({className:"lc-font-settings"},l({value:this.state.fontSizeIndex,onChange:this.handleFontSize},this.getFontSizes().map(function(a){return function(a,b){return i({value:b,key:b},a+"px")}}(this))),l({value:this.state.fontName,onChange:this.handleFontFamily},d.map(function(a){return function(a){var b,c;return c=a[0],b=a[1],g({key:c,label:c},b.map(function(a,b){return i({value:a.name,key:b},a.name)}))}}(this))),m({},e({htmlFor:"italic"},k("italic")),c({type:"checkbox",id:"italic",checked:this.state.isItalic,onChange:this.handleItalic})),m({},e({htmlFor:"bold"},k("bold")),c({type:"checkbox",id:"bold",checked:this.state.isBold,onChange:this.handleBold})))}})),b.exports={}},{"../core/localization":13,"../reactGUI/React-shim":35,"./optionsStyles":26}],24:[function(a,b,c){var d,e,f,g,h;d=a("../reactGUI/React-shim"),h=a("./optionsStyles").defineOptionsStyle,e=d.createFactory(a("../reactGUI/StrokeWidthPicker")),g=a("../reactGUI/createSetStateOnEventMixin"),f=a("../core/util").classSet,h("line-options-and-stroke-width",d.createClass({displayName:"LineOptionsAndStrokeWidth",getState:function(){return{strokeWidth:this.props.tool.strokeWidth,isDashed:this.props.tool.isDashed,hasEndArrow:this.props.tool.hasEndArrow}},getInitialState:function(){return this.getState()},mixins:[g("toolChange")],render:function(){var a,b,c,g,h,i,j,k,l,m;return i=d.DOM,c=i.div,m=i.ul,h=i.li,g=i.img,k=function(a){return function(){return a.props.tool.isDashed=!a.props.tool.isDashed,a.setState(a.getState())}}(this),l=function(a){return function(){return a.props.tool.hasEndArrow=!a.props.tool.hasEndArrow,a.setState(a.getState())}}(this),b=f({"square-toolbar-button":!0,selected:this.state.isDashed}),a=f({"square-toolbar-button":!0,selected:this.state.hasEndArrow}),j={"float":"left",margin:1},c({},c({className:b,onClick:k,style:j},g({src:this.props.imageURLPrefix+"/dashed-line.png"})),c({className:a,onClick:l,style:j},g({src:this.props.imageURLPrefix+"/line-with-arrow.png"})),e({tool:this.props.tool,lc:this.props.lc}))}})),b.exports={}},{"../core/util":19,"../reactGUI/React-shim":35,"../reactGUI/StrokeWidthPicker":37,"../reactGUI/createSetStateOnEventMixin":40,"./optionsStyles":26}],25:[function(a,b,c){var d,e;d=a("../reactGUI/React-shim"),e=a("./optionsStyles").defineOptionsStyle,e("null",d.createClass({displayName:"NoOptions",render:function(){return d.DOM.div()}})),b.exports={}},{"../reactGUI/React-shim":35,"./optionsStyles":26}],26:[function(a,b,c){var d,e,f;d=a("../reactGUI/React-shim"),f={},e=function(a,b){return f[a]=d.createFactory(b)},b.exports={optionsStyles:f,defineOptionsStyle:e}},{"../reactGUI/React-shim":35}],27:[function(a,b,c){var d,e,f,g;d=a("../reactGUI/React-shim"),g=a("./optionsStyles").defineOptionsStyle,e=d.createFactory(a("../reactGUI/StrokeWidthPicker")),f=a("../reactGUI/createSetStateOnEventMixin"),g("polygon-and-stroke-width",d.createClass({displayName:"PolygonAndStrokeWidth",getState:function(){return{strokeWidth:this.props.tool.strokeWidth,inProgress:!1}},getInitialState:function(){return this.getState()},mixins:[f("toolChange")],componentDidMount:function(){var a,b,c;
return c=[],this.unsubscribe=function(a){return function(){var a,b,d,e;for(e=[],b=0,d=c.length;d>b;b++)a=c[b],e.push(a());return e}}(this),b=function(a){return function(){return a.state.inProgress?void 0:a.setState({inProgress:!0})}}(this),a=function(a){return function(){return a.setState({inProgress:!1})}}(this),c.push(this.props.lc.on("lc-polygon-started",b)),c.push(this.props.lc.on("lc-polygon-stopped",a))},componentWillUnmount:function(){return this.unsubscribe()},render:function(){var a,b,c,f,g,h,i,j;return c=this.props.lc,j=d.DOM,a=j.div,b=j.img,h=function(a){return function(){return c.trigger("lc-polygon-finishopen")}}(this),g=function(a){return function(){return c.trigger("lc-polygon-finishclosed")}}(this),f=function(a){return function(){return c.trigger("lc-polygon-cancel")}}(this),i={},this.state.inProgress||(i={display:"none"}),a({},a({className:"polygon-toolbar horz-toolbar",style:i},a({className:"square-toolbar-button",onClick:h},b({src:this.props.imageURLPrefix+"/polygon-open.png"})),a({className:"square-toolbar-button",onClick:g},b({src:this.props.imageURLPrefix+"/polygon-closed.png"})),a({className:"square-toolbar-button",onClick:f},b({src:this.props.imageURLPrefix+"/polygon-cancel.png"}))),a({},e({tool:this.props.tool,lc:this.props.lc})))}})),b.exports={}},{"../reactGUI/React-shim":35,"../reactGUI/StrokeWidthPicker":37,"../reactGUI/createSetStateOnEventMixin":40,"./optionsStyles":26}],28:[function(a,b,c){"use strict";var d=a("../reactGUI/React-shim"),e=a("./optionsStyles"),f=e.defineOptionsStyle,g=a("../reactGUI/createSetStateOnEventMixin"),h=a("../core/localization")._;f("stroke-or-fill",d.createClass({displayName:"StrokeOrFillPicker",getState:function(){return{strokeOrFill:"stroke"}},getInitialState:function(){return this.getState()},mixins:[g("toolChange")],onChange:function(a){"stroke-or-fill-stroke"==a.target.id?this.props.lc.tool.strokeOrFill="stroke":this.props.lc.tool.strokeOrFill="fill",this.setState(this.getState())},render:function(){var a=this.props.lc;return d.createElement("form",null,d.createElement("span",null," ",h("Color to change:")," "),d.createElement("span",null,d.createElement("input",{type:"radio",name:"stroke-or-fill",value:"stroke",id:"stroke-or-fill-stroke",onChange:this.onChange,checked:"stroke"==a.tool.strokeOrFill}),d.createElement("label",{htmlFor:"stroke-or-fill-stroke",className:"label"}," ",h("stroke"))),d.createElement("span",null,d.createElement("input",{type:"radio",name:"stroke-or-fill",value:"fill",id:"stroke-or-fill-fill",onChange:this.onChange,checked:"fill"==a.tool.strokeOrFill}),d.createElement("label",{htmlFor:"stroke-or-fill-fill",className:"label"}," ",h("fill"))))}})),b.exports={}},{"../core/localization":13,"../reactGUI/React-shim":35,"../reactGUI/createSetStateOnEventMixin":40,"./optionsStyles":26}],29:[function(a,b,c){var d,e;e=a("./optionsStyles").defineOptionsStyle,d=a("../reactGUI/StrokeWidthPicker"),e("stroke-width",d),b.exports={}},{"../reactGUI/StrokeWidthPicker":37,"./optionsStyles":26}],30:[function(a,b,c){var d,e,f,g,h;e=a("./React-shim"),h=a("./createSetStateOnEventMixin"),f=a("../core/localization")._,g=a("../core/util").classSet,d=e.createClass({displayName:"ClearButton",getState:function(){return{isEnabled:this.props.lc.canUndo()}},getInitialState:function(){return this.getState()},mixins:[h("drawingChange")],render:function(){var a,b,c,d;return b=e.DOM.div,c=this.props.lc,a=g({"lc-clear":!0,"toolbar-button":!0,"fat-button":!0,disabled:!this.state.isEnabled}),d=c.canUndo()?function(a){return function(){return c.clear()}}(this):function(){},b({className:a,onClick:d},f("Clear"))}}),b.exports=d},{"../core/localization":13,"../core/util":19,"./React-shim":35,"./createSetStateOnEventMixin":40}],31:[function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o;g=a("./React-shim"),f=a("react-addons-pure-render-mixin"),n=a("../core/util"),j=n.classSet,o=n.requestAnimationFrame,i=n.cancelAnimationFrame,h=a("../core/localization")._,m=function(a){var b,c,d,e;return"transparent"===a?{hue:0,sat:0,light:0,alpha:0}:"hsla"!==(null!=a?a.substring(0,4):void 0)?null:(c=a.indexOf("("),e=a.indexOf(")"),d=a.substring(c+1,e-c+4),b=function(){var b,c,e,f;for(e=d.split(","),f=[],b=0,c=e.length;c>b;b++)a=e[b],f.push(a.trim());return f}(),{hue:parseInt(b[0],10),sat:parseInt(b[1].substring(0,b[1].length-1),10),light:parseInt(b[2].substring(0,b[2].length-1),10),alpha:parseFloat(b[3])})},k=function(a){var b,c,d,e;return c=a.hue,e=a.sat,d=a.light,b=a.alpha,"hsla("+c+", "+e+"%, "+d+"%, "+b+")"},l=function(a){var b,c,d;return b=a.hue,d=a.sat,c=a.light,"hsl("+b+", "+d+"%, "+c+"%)"},d=g.createFactory(g.createClass({displayName:"ColorGrid",mixins:[f],render:function(){var a;return(a=g.DOM.div)({},this.props.rows.map(function(b){return function(c,d){return a({className:"color-row",key:d,style:{width:20*c.length}},c.map(function(c,d){var e,f,g,h,i,l,m,n;return i=c.hue,m=c.sat,l=c.light,e=c.alpha,g=k(c),h="hsl("+i+", "+m+"%, "+l+"%)",f=j({"color-cell":!0,selected:b.props.selectedColor===g}),n=function(a){return b.props.onChange(c,g),a.stopPropagation(),a.preventDefault()},a({className:f,onTouchStart:n,onTouchMove:n,onClick:n,style:{backgroundColor:h},key:d})}))}}(this)))}})),e=g.createClass({displayName:"ColorWell",mixins:[f],getInitialState:function(){var a,b;return a=this.props.lc.colors[this.props.colorName],b=m(a),null==b&&(b={}),null==b.alpha&&(b.alpha=1),null==b.sat&&(b.sat=100),null==b.hue&&(b.hue=0),null==b.light&&(b.light=50),{colorString:a,alpha:b.alpha,sat:0===b.sat?100:b.sat,isPickerVisible:!1,hsla:b}},componentDidMount:function(){return this.unsubscribe=this.props.lc.on(this.props.colorName+"ColorChange",function(a){return function(){var b;return b=a.props.lc.colors[a.props.colorName],a.setState({colorString:b}),a.setHSLAFromColorString(b)}}(this))},componentWillUnmount:function(){return this.unsubscribe()},setHSLAFromColorString:function(a){var b;return b=m(a),b?this.setState({hsla:b,alpha:b.alpha,sat:b.sat}):this.setState({hsla:null,alpha:1,sat:100})},closePicker:function(){return this.setState({isPickerVisible:!1})},togglePicker:function(){var a,b;return a=!this.state.isPickerVisible,b=a&&0===this.state.sat,this.setHSLAFromColorString(this.state.colorString),this.setState({isPickerVisible:a,sat:b?100:this.state.sat})},setColor:function(a){return this.setState({colorString:a}),this.setHSLAFromColorString(a),this.props.lc.setColor(this.props.colorName,a)},setAlpha:function(a){var b;return this.setState({alpha:a}),this.state.hsla?(b=this.state.hsla,b.alpha=a,this.setState({hsla:b}),this.setColor(k(b))):void 0},setSat:function(a){var b;if(this.setState({sat:a}),isNaN(a))throw"SAT";return this.state.hsla?(b=this.state.hsla,b.sat=a,this.setState({hsla:b}),this.setColor(k(b))):void 0},render:function(){var a,b,c,d;return d=g.DOM,b=d.div,c=d.label,a=d.br,b({className:j({"color-well":!0,open:this.state.isPickerVisible}),onMouseLeave:this.closePicker,style:{"float":"left",textAlign:"center"}},c({"float":"left"},this.props.label),a({}),b({className:j({"color-well-color-container":!0,selected:this.state.isPickerVisible}),style:{backgroundColor:"white"},onClick:this.togglePicker},b({className:"color-well-checker color-well-checker-top-left"}),b({className:"color-well-checker color-well-checker-bottom-right",style:{left:"50%",top:"50%"}}),b({className:"color-well-color",style:{backgroundColor:this.state.colorString}}," ")),this.renderPicker())},renderPicker:function(){var a,b,c,e,f,i,j,k,l,m,n,o,p;if(l=g.DOM,a=l.div,i=l.label,e=l.input,!this.state.isPickerVisible)return null;for(o=function(b){return function(b){return a({className:"color-row label",key:b,style:{lineHeight:"20px",height:16}},b)}}(this),n=function(b){return function(){var c;return c=b.props.lc.opts.imageURLPrefix+"/checkerboard-8x8.png",a({className:"color-row",key:"color",style:{position:"relative",backgroundImage:"url("+c+")",backgroundRepeat:"repeat",height:24}},a({style:{position:"absolute",top:0,right:0,bottom:0,left:0,backgroundColor:b.state.colorString}}))}}(this),p=[],p.push(function(){var a,b;for(b=[],c=a=0;100>=a;c=a+=10)b.push({hue:0,sat:0,light:c,alpha:this.state.alpha});return b}.call(this)),m=[0,30,60,90,120,150,180,210,240,270,300,330],f=0,j=m.length;j>f;f++)b=m[f],p.push(function(){var a,d;for(d=[],c=a=10;90>=a;c=a+=8)d.push({hue:b,sat:this.state.sat,light:c,alpha:this.state.alpha});return d}.call(this));return k=function(a){return function(b,c){return a.setColor(c)}}(this),a({className:"color-picker-popup"},n(),o(h("alpha")),e({type:"range",min:0,max:1,step:.01,value:this.state.alpha,onChange:function(a){return function(b){return a.setAlpha(parseFloat(b.target.value))}}(this)}),o(h("saturation")),e({type:"range",min:0,max:100,value:this.state.sat,max:100,onChange:function(a){return function(b){return a.setSat(parseInt(b.target.value,10))}}(this)}),d({rows:p,selectedColor:this.state.colorString,onChange:k}))}}),b.exports=e},{"../core/localization":13,"../core/util":19,"./React-shim":35,"react-addons-pure-render-mixin":2}],32:[function(a,b,c){"use strict";var d=a("../reactGUI/React-shim"),e=a("../reactGUI/ReactDOM-shim"),f=e.findDOMNode,g=a("../core/util"),h=g.classSet,i=a("./Picker"),j=a("./Options"),k=a("./createToolButton"),l=a("../core/LiterallyCanvas"),m=a("../core/defaultOptions");a("../optionsStyles/font"),a("../optionsStyles/stroke-width"),a("../optionsStyles/line-options-and-stroke-width"),a("../optionsStyles/polygon-and-stroke-width"),a("../optionsStyles/null");var n=d.createClass({displayName:"CanvasContainer",shouldComponentUpdate:function(){return!1},render:function(){return d.createElement("div",{key:"literallycanvas",className:"lc-drawing with-gui"})}}),o=d.createClass({displayName:"LiterallyCanvas",getDefaultProps:function(){return m},bindToModel:function(){var a=f(this.canvas);this.props,this.lc.bindToElement(a),"function"==typeof this.lc.opts.onInit&&this.lc.opts.onInit(this.lc)},componentWillMount:function(){var a=this;this.lc||(this.props.lc?this.lc=this.props.lc:this.lc=new l(this.props),this.toolButtonComponents=this.lc.opts.tools.map(function(b){return k(new b(a.lc))}))},componentDidMount:function(){this.lc.isBound||this.bindToModel()},componentWillUnmount:function(){this.lc&&this.lc._teardown()},render:function(){var a=this,b=this.lc,c=this.toolButtonComponents,e=(this.props,this.lc.opts),f=e.imageURLPrefix,g=e.toolbarPosition,k={lc:b,toolButtonComponents:c,imageURLPrefix:f},l=h({"toolbar-at-top":"top"===g,"toolbar-at-bottom":"bottom"===g,"toolbar-hidden":"hidden"===g});return d.createElement("div",{className:"literally "+l},d.createElement(n,{ref:function(b){return a.canvas=b}}),d.createElement(i,k),d.createElement(j,{lc:b,imageURLPrefix:f}))}});b.exports=o},{"../core/LiterallyCanvas":5,"../core/defaultOptions":10,"../core/util":19,"../optionsStyles/font":23,"../optionsStyles/line-options-and-stroke-width":24,"../optionsStyles/null":25,"../optionsStyles/polygon-and-stroke-width":27,"../optionsStyles/stroke-width":29,"../reactGUI/React-shim":35,"../reactGUI/ReactDOM-shim":36,"./Options":33,"./Picker":34,"./createToolButton":41}],33:[function(a,b,c){var d,e,f,g;e=a("./React-shim"),f=a("./createSetStateOnEventMixin"),g=a("../optionsStyles/optionsStyles").optionsStyles,d=e.createClass({displayName:"Options",getState:function(){var a;return{style:null!=(a=this.props.lc.tool)?a.optionsStyle:void 0,tool:this.props.lc.tool}},getInitialState:function(){return this.getState()},mixins:[f("toolChange")],renderBody:function(){var a;return a=""+this.state.style,g[a]&&g[a]({lc:this.props.lc,tool:this.state.tool,imageURLPrefix:this.props.imageURLPrefix})},render:function(){var a;return(a=e.DOM.div)({className:"lc-options horz-toolbar"},this.renderBody())}}),b.exports=d},{"../optionsStyles/optionsStyles":26,"./React-shim":35,"./createSetStateOnEventMixin":40}],34:[function(a,b,c){var d,e,f,g,h,i,j,k;h=a("./React-shim"),d=h.createFactory(a("./ClearButton")),i=h.createFactory(a("./UndoRedoButtons")),j=h.createFactory(a("./ZoomButtons")),k=a("../core/localization")._,f=h.createFactory(a("./ColorWell")),e=h.createFactory(h.createClass({displayName:"ColorPickers",render:function(){var a,b;return b=this.props.lc,(a=h.DOM.div)({className:"lc-color-pickers"},f({lc:b,colorName:"primary",label:k("stroke")}),f({lc:b,colorName:"secondary",label:k("fill")}),f({lc:b,colorName:"background",label:k("bg")}))}})),g=h.createClass({displayName:"Picker",getInitialState:function(){return{selectedToolIndex:0}},renderBody:function(){var a,b,c,f,g;return a=h.DOM.div,f=this.props,g=f.toolButtonComponents,c=f.lc,b=f.imageURLPrefix,a({className:"lc-picker-contents"},g.map(function(a){return function(d,e){return d({lc:c,imageURLPrefix:b,key:e,isSelected:e===a.state.selectedToolIndex,onSelect:function(b){return c.setTool(b),a.setState({selectedToolIndex:e})}})}}(this)),g.length%2!==0?a({className:"toolbar-button thin-button disabled"}):void 0,a({style:{position:"absolute",bottom:0,left:0,right:0}},e({lc:this.props.lc}),i({lc:c,imageURLPrefix:b}),j({lc:c,imageURLPrefix:b}),d({lc:c})))},render:function(){var a;return(a=h.DOM.div)({className:"lc-picker"},this.renderBody())}}),b.exports=g},{"../core/localization":13,"./ClearButton":30,"./ColorWell":31,"./React-shim":35,"./UndoRedoButtons":38,"./ZoomButtons":39}],35:[function(a,b,c){var d;try{d=a("react")}catch(e){d=window.React}if(null==d)throw"Can't find React";b.exports=d},{react:"react"}],36:[function(a,b,c){var d;try{d=a("react-dom")}catch(e){d=window.ReactDOM}if(null==d)try{d=a("react")}catch(f){d=window.React}if(null==d)throw"Can't find ReactDOM";b.exports=d},{react:"react","react-dom":"react-dom"}],37:[function(a,b,c){var d,e,f;d=a("./React-shim"),f=a("../reactGUI/createSetStateOnEventMixin"),e=a("../core/util").classSet,b.exports=d.createClass({displayName:"StrokeWidthPicker",getState:function(a){return null==a&&(a=this.props.tool),{strokeWidth:a.strokeWidth}},getInitialState:function(){return this.getState()},mixins:[f("toolDidUpdateOptions")],componentWillReceiveProps:function(a){return this.setState(this.getState(a.tool))},render:function(){var a,b,c,f,g,h,i;return f=d.DOM,i=f.ul,c=f.li,h=f.svg,a=f.circle,b=f.div,g=this.props.lc.opts.strokeWidths,b({},g.map(function(c){return function(d,f){var g,i;return g=e({"square-toolbar-button":!0,selected:d===c.state.strokeWidth}),i=28,b({key:d},b({className:g,onClick:function(){return c.props.lc.trigger("setStrokeWidth",d)}},h({width:i-2,height:i-2,viewPort:"0 0 "+d+" "+d,version:"1.1",xmlns:"http://www.w3.org/2000/svg"},a({cx:Math.ceil(i/2-1),cy:Math.ceil(i/2-1),r:d/2}))))}}(this)))}})},{"../core/util":19,"../reactGUI/createSetStateOnEventMixin":40,"./React-shim":35}],38:[function(a,b,c){var d,e,f,g,h,i,j;d=a("./React-shim"),i=a("./createSetStateOnEventMixin"),h=a("../core/util").classSet,j=function(a){return d.createClass({displayName:"undo"===a?"UndoButton":"RedoButton",getState:function(){return{isEnabled:function(){switch(!1){case"undo"!==a:return this.props.lc.canUndo();case"redo"!==a:return this.props.lc.canRedo()}}.call(this)}},getInitialState:function(){return this.getState()},mixins:[i("drawingChange")],render:function(){var b,c,e,f,g,i,j,k,l,m,n;return j=d.DOM,c=j.div,f=j.img,k=this.props,g=k.lc,e=k.imageURLPrefix,n="undo"===a?"Undo":"Redo",b="lc-"+a+" "+h({"toolbar-button":!0,"thin-button":!0,disabled:!this.state.isEnabled}),i=function(){switch(!1){case!!this.state.isEnabled:return function(){};case"undo"!==a:return function(){return g.undo()};case"redo"!==a:return function(){return g.redo()}}}.call(this),l=e+"/"+a+".png",m={backgroundImage:"url("+l+")"},c({className:b,onClick:i,title:n,style:m})}})},f=d.createFactory(j("undo")),e=d.createFactory(j("redo")),g=d.createClass({displayName:"UndoRedoButtons",render:function(){var a;return(a=d.DOM.div)({className:"lc-undo-redo"},f(this.props),e(this.props))}}),b.exports=g},{"../core/util":19,"./React-shim":35,"./createSetStateOnEventMixin":40}],39:[function(a,b,c){var d,e,f,g,h,i,j;d=a("./React-shim"),i=a("./createSetStateOnEventMixin"),h=a("../core/util").classSet,j=function(a){return d.createClass({displayName:"in"===a?"ZoomInButton":"ZoomOutButton",getState:function(){return{isEnabled:function(){switch(!1){case"in"!==a:return this.props.lc.scale<this.props.lc.config.zoomMax;case"out"!==a:return this.props.lc.scale>this.props.lc.config.zoomMin}}.call(this)}},getInitialState:function(){return this.getState()},mixins:[i("zoom")],render:function(){var b,c,e,f,g,i,j,k,l,m,n;return j=d.DOM,c=j.div,f=j.img,k=this.props,g=k.lc,e=k.imageURLPrefix,n="in"===a?"Zoom in":"Zoom out",b="lc-zoom-"+a+" "+h({"toolbar-button":!0,"thin-button":!0,disabled:!this.state.isEnabled}),i=function(){switch(!1){case!!this.state.isEnabled:return function(){};case"in"!==a:return function(){return g.zoom(g.config.zoomStep)};case"out"!==a:return function(){return g.zoom(-g.config.zoomStep)}}}.call(this),l=e+"/zoom-"+a+".png",m={backgroundImage:"url("+l+")"},c({className:b,onClick:i,title:n,style:m})}})},g=d.createFactory(j("out")),f=d.createFactory(j("in")),e=d.createClass({displayName:"ZoomButtons",render:function(){var a;return(a=d.DOM.div)({className:"lc-zoom"},g(this.props),f(this.props))}}),b.exports=e},{"../core/util":19,"./React-shim":35,"./createSetStateOnEventMixin":40}],40:[function(a,b,c){var d,e;d=a("./React-shim"),b.exports=e=function(a){return{componentDidMount:function(){return this.unsubscribe=this.props.lc.on(a,function(a){return function(){return a.setState(a.getState())}}(this))},componentWillUnmount:function(){return this.unsubscribe()}}}},{"./React-shim":35}],41:[function(a,b,c){var d,e,f,g;d=a("./React-shim"),f=a("../core/util").classSet,e=a("../core/localization")._,g=function(a){var b,c;return b=a.name,c=a.iconName,d.createFactory(d.createClass({displayName:b,getDefaultProps:function(){return{isSelected:!1,lc:null}},componentWillMount:function(){return this.props.isSelected?this.props.lc.setTool(a):void 0},render:function(){var g,h,i,j,k,l,m,n,o;return m=d.DOM,h=m.div,j=m.img,n=this.props,i=n.imageURLPrefix,k=n.isSelected,l=n.onSelect,g=f({"lc-pick-tool":!0,"toolbar-button":!0,"thin-button":!0,selected:k}),o=i+"/"+c+".png",h({className:g,style:{backgroundImage:"url("+o+")"},onClick:function(){return l(a)},title:e(b)})}}))},b.exports=g},{"../core/localization":13,"../core/util":19,"./React-shim":35}],42:[function(a,b,c){"use strict";function d(a,b){var c=a.className,d=new g(b);return f.render(e.createElement(h,{lc:d}),a),d.teardown=function(){d._teardown();for(var b=0;b<a.children.length;b++)a.removeChild(a.children[b]);a.className=c},d}var e=a("./React-shim"),f=a("./ReactDOM-shim"),g=a("../core/LiterallyCanvas"),h=a("./LiterallyCanvas");b.exports=d},{"../core/LiterallyCanvas":5,"./LiterallyCanvas":32,"./React-shim":35,"./ReactDOM-shim":36}],43:[function(a,b,c){var d,e,f,g=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},h={}.hasOwnProperty;e=a("./base").ToolWithStroke,f=a("../core/shapes").createShape,b.exports=d=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return g(b,a),b.prototype.name="Ellipse",b.prototype.iconName="ellipse",b.prototype.begin=function(a,b,c){return this.currentShape=f("Ellipse",{x:a,y:b,strokeWidth:this.strokeWidth,strokeColor:c.getColor("primary"),fillColor:c.getColor("secondary")})},b.prototype["continue"]=function(a,b,c){return this.currentShape.width=a-this.currentShape.x,this.currentShape.height=b-this.currentShape.y,c.drawShapeInProgress(this.currentShape)},b.prototype.end=function(a,b,c){return c.saveShape(this.currentShape)},b}(e)},{"../core/shapes":17,"./base":53}],44:[function(a,b,c){var d,e,f,g=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},h={}.hasOwnProperty;e=a("./Pencil"),f=a("../core/shapes").createShape,b.exports=d=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return g(b,a),b.prototype.name="Eraser",b.prototype.iconName="eraser",b.prototype.makePoint=function(a,b,c){return f("Point",{x:a,y:b,size:this.strokeWidth,color:"#000"})},b.prototype.makeShape=function(){return f("ErasedLinePath")},b}(e)},{"../core/shapes":17,"./Pencil":48}],45:[function(a,b,c){var d,e,f,g=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},h={}.hasOwnProperty;e=a("./base").Tool,f=function(a,b){var c,d,e;return d=b.x,e=b.y,c=a.getImageData(d,e,1,1).data,c[3]?"rgb("+c[0]+", "+c[1]+", "+c[2]+")":null},b.exports=d=function(a){function b(a){b.__super__.constructor.call(this,a),this.strokeOrFill="stroke"}return g(b,a),b.prototype.name="Eyedropper",b.prototype.iconName="eyedropper",b.prototype.optionsStyle="stroke-or-fill",b.prototype.readColor=function(a,b,c){var d,e,g,h;return h=c.getDefaultImageRect(),d=c.getImage(),g=f(d.getContext("2d"),{x:a-h.x,y:b-h.y}),e=g||c.getColor("background"),"stroke"===this.strokeOrFill?c.setColor("primary",g):c.setColor("secondary",g)},b.prototype.begin=function(a,b,c){return this.readColor(a,b,c)},b.prototype["continue"]=function(a,b,c){return this.readColor(a,b,c)},b}(e)},{"./base":53}],46:[function(a,b,c){var d,e,f,g=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},h={}.hasOwnProperty;e=a("./base").ToolWithStroke,f=a("../core/shapes").createShape,b.exports=d=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return g(b,a),b.prototype.name="Line",b.prototype.iconName="line",b.prototype.optionsStyle="line-options-and-stroke-width",b.prototype.begin=function(a,b,c){return this.currentShape=f("Line",{x1:a,y1:b,x2:a,y2:b,strokeWidth:this.strokeWidth,dash:function(){switch(!1){case!this.isDashed:return[2*this.strokeWidth,4*this.strokeWidth];default:return null}}.call(this),endCapShapes:this.hasEndArrow?[null,"arrow"]:null,color:c.getColor("primary")})},b.prototype["continue"]=function(a,b,c){return this.currentShape.x2=a,this.currentShape.y2=b,c.drawShapeInProgress(this.currentShape)},b.prototype.end=function(a,b,c){return c.saveShape(this.currentShape)},b}(e)},{"../core/shapes":17,"./base":53}],47:[function(a,b,c){var d,e,f,g=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},h={}.hasOwnProperty;e=a("./base").Tool,f=a("../core/shapes").createShape,b.exports=d=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return g(b,a),b.prototype.name="Pan",b.prototype.iconName="pan",b.prototype.usesSimpleAPI=!1,b.prototype.didBecomeActive=function(a){var b;return b=[],this.unsubscribe=function(a){return function(){var a,c,d,e;for(e=[],c=0,d=b.length;d>c;c++)a=b[c],e.push(a());return e}}(this),b.push(a.on("lc-pointerdown",function(b){return function(c){var d,e;return d=c.rawX,e=c.rawY,b.oldPosition=a.position,b.pointerStart={x:d,y:e}}}(this))),b.push(a.on("lc-pointerdrag",function(b){return function(c){var d,e,f;return e=c.rawX,f=c.rawY,d={x:(e-b.pointerStart.x)*a.backingScale,y:(f-b.pointerStart.y)*a.backingScale},a.setPan(b.oldPosition.x+d.x,b.oldPosition.y+d.y)}}(this)))},b.prototype.willBecomeInactive=function(a){return this.unsubscribe()},b}(e)},{"../core/shapes":17,"./base":53}],48:[function(a,b,c){var d,e,f,g=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},h={}.hasOwnProperty;e=a("./base").ToolWithStroke,f=a("../core/shapes").createShape,b.exports=d=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return g(b,a),b.prototype.name="Pencil",b.prototype.iconName="pencil",b.prototype.eventTimeThreshold=10,b.prototype.begin=function(a,b,c){return this.color=c.getColor("primary"),this.currentShape=this.makeShape(),this.currentShape.addPoint(this.makePoint(a,b,c)),this.lastEventTime=Date.now()},b.prototype["continue"]=function(a,b,c){var d;return d=Date.now()-this.lastEventTime,d>this.eventTimeThreshold?(this.lastEventTime+=d,this.currentShape.addPoint(this.makePoint(a,b,c)),c.drawShapeInProgress(this.currentShape)):void 0},b.prototype.end=function(a,b,c){return c.saveShape(this.currentShape),this.currentShape=void 0},b.prototype.makePoint=function(a,b,c){return f("Point",{x:a,y:b,size:this.strokeWidth,color:this.color})},b.prototype.makeShape=function(){return f("LinePath")},b}(e)},{"../core/shapes":17,"./base":53}],49:[function(a,b,c){var d,e,f,g=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},h={}.hasOwnProperty;e=a("./base").ToolWithStroke,f=a("../core/shapes").createShape,b.exports=d=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return g(b,a),b.prototype.name="Polygon",b.prototype.iconName="polygon",b.prototype.usesSimpleAPI=!1,b.prototype.didBecomeActive=function(a){var c,d,e,f,g,h,i;return b.__super__.didBecomeActive.call(this,a),i=[],this.polygonUnsubscribe=function(a){return function(){var a,b,c,d;for(d=[],b=0,c=i.length;c>b;b++)a=i[b],d.push(a());return d}}(this),this.points=null,this.maybePoint=null,e=function(b){return function(){return b._getWillFinish()?b._close(a):(a.trigger("lc-polygon-started"),b.points?b.points.push(b.maybePoint):b.points=[b.maybePoint],b.maybePoint={x:b.maybePoint.x,y:b.maybePoint.y},a.setShapesInProgress(b._getShapes(a)),a.repaintLayer("main"))}}(this),d=function(b){return function(c){var d,e;return d=c.x,e=c.y,b.maybePoint?(b.maybePoint.x=d,b.maybePoint.y=e,a.setShapesInProgress(b._getShapes(a)),a.repaintLayer("main")):void 0}}(this),c=function(b){return function(c){var d,e;return d=c.x,e=c.y,b.maybePoint={x:d,y:e},a.setShapesInProgress(b._getShapes(a)),a.repaintLayer("main")}}(this),h=function(b){return function(){return b.maybePoint={x:1/0,y:1/0},b._close(a)}}(this),g=function(b){return function(){return b.maybePoint=b.points[0],b._close(a)}}(this),f=function(b){return function(){return b._cancel(a)}}(this),i.push(a.on("drawingChange",function(b){return function(){return b._cancel(a)}}(this))),i.push(a.on("lc-pointerdown",c)),i.push(a.on("lc-pointerdrag",d)),i.push(a.on("lc-pointermove",d)),i.push(a.on("lc-pointerup",e)),i.push(a.on("lc-polygon-finishopen",h)),i.push(a.on("lc-polygon-finishclosed",g)),i.push(a.on("lc-polygon-cancel",f))},b.prototype.willBecomeInactive=function(a){return b.__super__.willBecomeInactive.call(this,a),(this.points||this.maybePoint)&&this._cancel(a),this.polygonUnsubscribe()},b.prototype._getArePointsClose=function(a,b){return Math.abs(a.x-b.x)+Math.abs(a.y-b.y)<10},b.prototype._getWillClose=function(){return!!(this.points&&this.points.length>1&&this.maybePoint)&&this._getArePointsClose(this.points[0],this.maybePoint)},b.prototype._getWillFinish=function(){return!!(this.points&&this.points.length>1&&this.maybePoint)&&(this._getArePointsClose(this.points[0],this.maybePoint)||this._getArePointsClose(this.points[this.points.length-1],this.maybePoint))},b.prototype._cancel=function(a){return a.trigger("lc-polygon-stopped"),this.maybePoint=null,this.points=null,a.setShapesInProgress([]),a.repaintLayer("main")},b.prototype._close=function(a){return a.trigger("lc-polygon-stopped"),a.setShapesInProgress([]),this.points.length>2&&a.saveShape(this._getShape(a,!1)),this.maybePoint=null,this.points=null},b.prototype._getShapes=function(a,b){var c;return null==b&&(b=!0),c=this._getShape(a,b),c?[c]:[]},b.prototype._getShape=function(a,b){var c;return null==b&&(b=!0),c=[],this.points&&(c=c.concat(this.points)),!b&&c.length<3?null:(b&&this.maybePoint&&c.push(this.maybePoint),c.length>1?f("Polygon",{isClosed:this._getWillClose(),strokeColor:a.getColor("primary"),fillColor:a.getColor("secondary"),strokeWidth:this.strokeWidth,points:c.map(function(a){return f("Point",a)})}):null)},b.prototype.optionsStyle="polygon-and-stroke-width",b}(e)},{"../core/shapes":17,"./base":53}],50:[function(a,b,c){var d,e,f,g=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},h={}.hasOwnProperty;e=a("./base").ToolWithStroke,f=a("../core/shapes").createShape,b.exports=d=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return g(b,a),b.prototype.name="Rectangle",b.prototype.iconName="rectangle",b.prototype.begin=function(a,b,c){return this.currentShape=f("Rectangle",{x:a,y:b,strokeWidth:this.strokeWidth,strokeColor:c.getColor("primary"),fillColor:c.getColor("secondary")})},b.prototype["continue"]=function(a,b,c){return this.currentShape.width=a-this.currentShape.x,this.currentShape.height=b-this.currentShape.y,c.drawShapeInProgress(this.currentShape)},b.prototype.end=function(a,b,c){return c.saveShape(this.currentShape)},b}(e)},{"../core/shapes":17,"./base":53}],51:[function(a,b,c){var d,e,f,g=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},h={}.hasOwnProperty;e=a("./base").Tool,f=a("../core/shapes").createShape,b.exports=d=function(a){function b(a){this.selectCanvas=document.createElement("canvas"),this.selectCanvas.style["background-color"]="transparent",this.selectCtx=this.selectCanvas.getContext("2d")}return g(b,a),b.prototype.name="SelectShape",b.prototype.usesSimpleAPI=!1,b.prototype.didBecomeActive=function(a){var b,c,d,e;return e=[],this._selectShapeUnsubscribe=function(a){return function(){var a,b,c,d;for(d=[],b=0,c=e.length;c>b;b++)a=e[b],d.push(a());return d}}(this),b=function(b){return function(c){var d,e,g,h;return g=c.x,h=c.y,b.didDrag=!1,e=b._getPixel(g,h,a,b.selectCtx),b.selectedShape=a.shapes[e],null!=b.selectedShape?(a.trigger("shapeSelected",{selectedShape:b.selectedShape}),a.setShapesInProgress([b.selectedShape,f("SelectionBox",{shape:b.selectedShape,handleSize:0})]),a.repaintLayer("main"),d=b.selectedShape.getBoundingRect(),b.dragOffset={x:g-d.x,y:h-d.y}):void 0}}(this),c=function(b){return function(c){var d,e;return d=c.x,e=c.y,null!=b.selectedShape?(b.didDrag=!0,b.selectedShape.setUpperLeft({x:d-b.dragOffset.x,y:e-b.dragOffset.y}),a.setShapesInProgress([b.selectedShape,f("SelectionBox",{shape:b.selectedShape,handleSize:0})]),a.repaintLayer("main")):void 0}}(this),d=function(b){return function(c){var d,e;return d=c.x,e=c.y,b.didDrag?(b.didDrag=!1,a.trigger("shapeMoved",{shape:b.selectedShape}),a.trigger("drawingChange",{}),a.repaintLayer("main"),b._drawSelectCanvas(a)):void 0}}(this),e.push(a.on("lc-pointerdown",b)),e.push(a.on("lc-pointerdrag",c)),e.push(a.on("lc-pointerup",d)),this._drawSelectCanvas(a)},b.prototype.willBecomeInactive=function(a){return this._selectShapeUnsubscribe(),a.setShapesInProgress([])},b.prototype._drawSelectCanvas=function(a){var b;return this.selectCanvas.width=a.canvas.width,this.selectCanvas.height=a.canvas.height,this.selectCtx.clearRect(0,0,this.selectCanvas.width,this.selectCanvas.height),b=a.shapes.map(function(a){return function(b,c){return f("SelectionBox",{shape:b,handleSize:0,backgroundColor:"#"+a._intToHex(c)})}}(this)),a.draw(b,this.selectCtx)},b.prototype._intToHex=function(a){return("000000"+a.toString(16)).slice(-6)},b.prototype._getPixel=function(a,b,c,d){var e,f;return e=c.drawingCoordsToClientCoords(a,b),f=d.getImageData(e.x,e.y,1,1).data,f[3]?parseInt(this._rgbToHex(f[0],f[1],f[2]),16):null},b.prototype._componentToHex=function(a){var b;return b=a.toString(16),("0"+b).slice(-2)},b.prototype._rgbToHex=function(a,b,c){return""+this._componentToHex(a)+this._componentToHex(b)+this._componentToHex(c)},b}(e)},{"../core/shapes":17,"./base":53}],52:[function(a,b,c){var d,e,f,g,h=function(a,b){function c(){this.constructor=a}for(var d in b)i.call(b,d)&&(a[d]=b[d]);
return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},i={}.hasOwnProperty;e=a("./base").Tool,f=a("../core/shapes").createShape,g=function(a,b){return!(a.x<b.x)&&(!(a.y<b.y)&&(!(a.x>b.x+b.width)&&!(a.y>b.y+b.height)))},b.exports=d=function(a){function b(){this.text="",this.font="bold 18px sans-serif",this.currentShape=null,this.currentShapeState=null,this.initialShapeBoundingRect=null,this.dragAction=null,this.didDrag=!1}return h(b,a),b.prototype.name="Text",b.prototype.iconName="text",b.prototype.didBecomeActive=function(a){var b,c,d;return c=[],this.unsubscribe=function(a){return function(){var a,b,d,e;for(e=[],b=0,d=c.length;d>b;b++)a=c[b],e.push(a());return e}}(this),b=function(b){return function(){return b._ensureNotEditing(a),b._clearCurrentShape(a),a.repaintLayer("main")}}(this),d=function(b){return function(){return b._updateInputEl(a)}}(this),c.push(a.on("drawingChange",b)),c.push(a.on("zoom",d)),c.push(a.on("imageSizeChange",d)),c.push(a.on("snapshotLoad",function(b){return function(){return b._clearCurrentShape(a),a.repaintLayer("main")}}(this))),c.push(a.on("primaryColorChange",function(b){return function(c){return b.currentShape?(b.currentShape.color=c,b._updateInputEl(a),a.repaintLayer("main")):void 0}}(this))),c.push(a.on("setFont",function(b){return function(c){return b.currentShape?(b.font=c,b.currentShape.setFont(c),b._setShapesInProgress(a),b._updateInputEl(a),a.repaintLayer("main")):void 0}}(this)))},b.prototype.willBecomeInactive=function(a){return this.currentShape&&(this._ensureNotEditing(a),this.commit(a)),this.unsubscribe()},b.prototype.setText=function(a){return this.text=a},b.prototype._ensureNotEditing=function(a){return"editing"===this.currentShapeState?this._exitEditingState(a):void 0},b.prototype._clearCurrentShape=function(a){return this.currentShape=null,this.initialShapeBoundingRect=null,this.currentShapeState=null,a.setShapesInProgress([])},b.prototype.commit=function(a){return this.currentShape.text&&a.saveShape(this.currentShape),this._clearCurrentShape(a),a.repaintLayer("main")},b.prototype._getSelectionShape=function(a,b){return null==b&&(b=null),f("SelectionBox",{shape:this.currentShape,ctx:a,backgroundColor:b})},b.prototype._setShapesInProgress=function(a){switch(this.currentShapeState){case"selected":return a.setShapesInProgress([this._getSelectionShape(a.ctx),this.currentShape]);case"editing":return a.setShapesInProgress([this._getSelectionShape(a.ctx,"#fff")]);default:return a.setShapesInProgress([this.currentShape])}},b.prototype.begin=function(a,b,c){var d,e,h,i;return this.dragAction="none",this.didDrag=!1,"selected"===this.currentShapeState||"editing"===this.currentShapeState?(d=this.currentShape.getBoundingRect(c.ctx),i=this._getSelectionShape(c.ctx),h=i.getBoundingRect(),e={x:a,y:b},g(e,d)&&(this.dragAction="move"),g(e,i.getBottomRightHandleRect())&&(this.dragAction="resizeBottomRight"),g(e,i.getTopLeftHandleRect())&&(this.dragAction="resizeTopLeft"),g(e,i.getBottomLeftHandleRect())&&(this.dragAction="resizeBottomLeft"),g(e,i.getTopRightHandleRect())&&(this.dragAction="resizeTopRight"),"none"===this.dragAction&&"editing"===this.currentShapeState&&(this.dragAction="stop-editing",this._exitEditingState(c))):(this.color=c.getColor("primary"),this.currentShape=f("Text",{x:a,y:b,text:this.text,color:this.color,font:this.font,v:1}),this.dragAction="place",this.currentShapeState="selected"),"none"===this.dragAction?void this.commit(c):(this.initialShapeBoundingRect=this.currentShape.getBoundingRect(c.ctx),this.dragOffset={x:a-this.initialShapeBoundingRect.x,y:b-this.initialShapeBoundingRect.y},this._setShapesInProgress(c),c.repaintLayer("main"))},b.prototype["continue"]=function(a,b,c){var d,e,f;if("none"!==this.dragAction){switch(d=this.initialShapeBoundingRect,f=d.x+d.width,e=d.y+d.height,this.dragAction){case"place":this.currentShape.x=a,this.currentShape.y=b,this.didDrag=!0;break;case"move":this.currentShape.x=a-this.dragOffset.x,this.currentShape.y=b-this.dragOffset.y,this.didDrag=!0;break;case"resizeBottomRight":this.currentShape.setSize(a-(this.dragOffset.x-this.initialShapeBoundingRect.width)-d.x,b-(this.dragOffset.y-this.initialShapeBoundingRect.height)-d.y);break;case"resizeTopLeft":this.currentShape.setSize(f-a+this.dragOffset.x,e-b+this.dragOffset.y),this.currentShape.setPosition(a-this.dragOffset.x,b-this.dragOffset.y);break;case"resizeBottomLeft":this.currentShape.setSize(f-a+this.dragOffset.x,b-(this.dragOffset.y-this.initialShapeBoundingRect.height)-d.y),this.currentShape.setPosition(a-this.dragOffset.x,this.currentShape.y);break;case"resizeTopRight":this.currentShape.setSize(a-(this.dragOffset.x-this.initialShapeBoundingRect.width)-d.x,e-b+this.dragOffset.y),this.currentShape.setPosition(this.currentShape.x,b-this.dragOffset.y)}return this._setShapesInProgress(c),c.repaintLayer("main"),this._updateInputEl(c)}},b.prototype.end=function(a,b,c){return this.currentShape?(this.currentShape.setSize(this.currentShape.forcedWidth,0),"selected"===this.currentShapeState&&("place"===this.dragAction||"move"===this.dragAction&&!this.didDrag)&&this._enterEditingState(c),this._setShapesInProgress(c),c.repaintLayer("main"),this._updateInputEl(c)):void 0},b.prototype._enterEditingState=function(a){var b;if(this.currentShapeState="editing",this.inputEl)throw"State error";return this.inputEl=document.createElement("textarea"),this.inputEl.className="text-tool-input",this.inputEl.style.position="absolute",this.inputEl.style.transformOrigin="0px 0px",this.inputEl.style.backgroundColor="transparent",this.inputEl.style.border="none",this.inputEl.style.outline="none",this.inputEl.style.margin="0",this.inputEl.style.padding="4px",this.inputEl.style.zIndex="1000",this.inputEl.style.overflow="hidden",this.inputEl.style.resize="none",this.inputEl.value=this.currentShape.text,this.inputEl.addEventListener("mousedown",function(a){return a.stopPropagation()}),this.inputEl.addEventListener("touchstart",function(a){return a.stopPropagation()}),b=function(b){return function(c){return b.currentShape.setText(c.target.value),b.currentShape.enforceMaxBoundingRect(a),b._setShapesInProgress(a),a.repaintLayer("main"),b._updateInputEl(a),c.stopPropagation()}}(this),this.inputEl.addEventListener("keydown",function(b){return function(){return b._updateInputEl(a,!0)}}(this)),this.inputEl.addEventListener("keyup",b),this.inputEl.addEventListener("change",b),this._updateInputEl(a),a.containerEl.appendChild(this.inputEl),this.inputEl.focus(),this._setShapesInProgress(a)},b.prototype._exitEditingState=function(a){return this.currentShapeState="selected",a.containerEl.removeChild(this.inputEl),this.inputEl=null,this._setShapesInProgress(a),a.repaintLayer("main")},b.prototype._updateInputEl=function(a,b){var c,d;return null==b&&(b=!1),this.inputEl?(c=this.currentShape.getBoundingRect(a.ctx,!0),this.inputEl.style.font=this.currentShape.font,this.inputEl.style.color=this.currentShape.color,this.inputEl.style.left=a.position.x/a.backingScale+c.x*a.scale-4+"px",this.inputEl.style.top=a.position.y/a.backingScale+c.y*a.scale-4+"px",b&&!this.currentShape.forcedWidth?this.inputEl.style.width=c.width+10+this.currentShape.renderer.emDashWidth+"px":this.inputEl.style.width=c.width+12+"px",b?this.inputEl.style.height=c.height+10+this.currentShape.renderer.metrics.leading+"px":this.inputEl.style.height=c.height+10+"px",d="scale("+a.scale+")",this.inputEl.style.transform=d,this.inputEl.style.webkitTransform=d,this.inputEl.style.MozTransform=d,this.inputEl.style.msTransform=d,this.inputEl.style.OTransform=d):void 0},b.prototype.optionsStyle="font",b}(e)},{"../core/shapes":17,"./base":53}],53:[function(a,b,c){var d,e,f,g=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},h={}.hasOwnProperty;f={},f.Tool=d=function(){function a(){}return a.prototype.name=null,a.prototype.iconName=null,a.prototype.usesSimpleAPI=!0,a.prototype.begin=function(a,b,c){},a.prototype["continue"]=function(a,b,c){},a.prototype.end=function(a,b,c){},a.prototype.optionsStyle=null,a.prototype.didBecomeActive=function(a){},a.prototype.willBecomeInactive=function(a){},a}(),f.ToolWithStroke=e=function(a){function b(a){this.strokeWidth=a.opts.defaultStrokeWidth}return g(b,a),b.prototype.optionsStyle="stroke-width",b.prototype.didBecomeActive=function(a){var b;return b=[],this.unsubscribe=function(a){return function(){var a,c,d,e;for(e=[],c=0,d=b.length;d>c;c++)a=b[c],e.push(a());return e}}(this),b.push(a.on("setStrokeWidth",function(b){return function(c){return b.strokeWidth=c,a.trigger("toolDidUpdateOptions")}}(this)))},b.prototype.willBecomeInactive=function(a){return this.unsubscribe()},b}(d),b.exports=f},{}]},{},[22])(22)});