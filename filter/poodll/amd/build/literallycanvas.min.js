function _defineProperty(e,t,o){if(t in e){Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0})}else{e[t]=o}return e}function _typeof(e){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(e){return typeof e}}else{_typeof=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return _typeof(e)}!function(o){if("object"==("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module)module.exports=o();else if("function"==typeof define&&define.amd)define ("filter_poodll/literallycanvas",[],o);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.LC=o()}}(function(){return function p(d,e,t){function a(o,r){if(!e[o]){if(!d[o]){var i="function"==typeof require&&require;if(!r&&i)return i(o,!0);if(n)return n(o,!0);var s=new Error("Cannot find module '"+o+"'");throw s.code="MODULE_NOT_FOUND",s}var l=e[o]={exports:{}};d[o][0].call(l.exports,function(e){var t=d[o][1][e];return a(t?t:e)},l,l.exports,p,d,e,t)}return e[o].exports}for(var n="function"==typeof require&&require,o=0;o<t.length;o++){a(t[o])}return a}({1:[function(o,t){"use strict";function e(r,t){if(r===t)return!0;if("object"!=_typeof(r)||null===r||"object"!=_typeof(t)||null===t)return!1;var e=Object.keys(r),n=Object.keys(t);if(e.length!==n.length)return!1;for(var i=a.bind(t),o=0;o<e.length;o++){if(!i(e[o])||r[e[o]]!==t[e[o]])return!1}return!0}var a=Object.prototype.hasOwnProperty;t.exports=e},{}],2:[function(o,t){t.exports=o("react/lib/ReactComponentWithPureRenderMixin")},{"react/lib/ReactComponentWithPureRenderMixin":3}],3:[function(o,t){"use strict";var a=o("./shallowCompare");t.exports={shouldComponentUpdate:function shouldComponentUpdate(o,t){return a(this,o,t)}}},{"./shallowCompare":4}],4:[function(o,t){"use strict";var a=o("fbjs/lib/shallowEqual");t.exports=function(o,t,e){return!a(o.props,t)||!a(o.state,e)}},{"fbjs/lib/shallowEqual":1}],5:[function(n,t){var k,b,e,C,w,P,R,_,E,I,T,L,z,O,N,B=function(o,t){return function(){return o.apply(t,arguments)}},S=[].slice,v=[].indexOf||function(o){for(var t=0,a=this.length;a>t;t++){if(t in this&&this[t]===o)return t}return-1};w=n("./actions"),P=n("./bindEvents"),_=n("./math"),E=n("./shapes"),R=E.createShape,O=E.shapeToJSON,b=E.JSONToShape,I=n("./canvasRenderer").renderShapeToContext,T=n("./svgRenderer").renderShapeToSVG,L=n("./renderSnapshotToImage"),z=n("./renderSnapshotToSVG"),C=n("../tools/Pencil"),N=n("./util"),k="infinite",t.exports=e=function(){function e(o,t){this.setImageSize=B(this.setImageSize,this);var e,a;a=null,e=null,o instanceof HTMLElement?(e=o,a=t):a=o,this.opts=a||{},this.config={zoomMin:a.zoomMin||.2,zoomMax:a.zoomMax||4,zoomStep:a.zoomStep||.2},this.colors={primary:a.primaryColor||"#000",secondary:a.secondaryColor||"#fff",background:a.backgroundColor||"transparent"},this.watermarkImage=a.watermarkImage,this.watermarkScale=a.watermarkScale||1,this.backgroundCanvas=document.createElement("canvas"),this.backgroundCtx=this.backgroundCanvas.getContext("2d"),this.canvas=document.createElement("canvas"),this.canvas.style["background-color"]="transparent",this.buffer=document.createElement("canvas"),this.buffer.style["background-color"]="transparent",this.ctx=this.canvas.getContext("2d"),this.bufferCtx=this.buffer.getContext("2d"),this.backingScale=N.getBackingScale(this.ctx),this.backgroundShapes=a.backgroundShapes||[],this._shapesInProgress=[],this.shapes=[],this.undoStack=[],this.redoStack=[],this.isDragging=!1,this.position={x:0,y:0},this.scale=1,this.setTool(new this.opts.tools[0](this)),this.width=a.imageSize.width||k,this.height=a.imageSize.height||k,this.setZoom(this.scale),a.snapshot&&this.loadSnapshot(a.snapshot),this.isBound=!1,e&&this.bindToElement(e),this.respondToSizeChange=function(){}}return e.prototype.bindToElement=function(o){var t,a;return this.containerEl?void console.warn("Trying to bind Literally Canvas to a DOM element more than once is unsupported."):(this.containerEl=o,this._unsubscribeEvents=P(this,this.containerEl,this.opts.keyboardShortcuts),this.containerEl.style["background-color"]=this.colors.background,this.containerEl.appendChild(this.backgroundCanvas),this.containerEl.appendChild(this.canvas),this.isBound=!0,a=function(e){return function(){return e.keepPanInImageBounds(),e.repaintAllLayers()}}(this),this.respondToSizeChange=N.matchElementSize(this.containerEl,[this.backgroundCanvas,this.canvas],this.backingScale,a),this.watermarkImage&&(this.watermarkImage.onload=function(e){return function(){return e.repaintLayer("background")}}(this)),null!=(t=this.tool)&&t.didBecomeActive(this),a())},e.prototype._teardown=function(){var e;return null!=(e=this.tool)&&e.willBecomeInactive(this),"function"==typeof this._unsubscribeEvents&&this._unsubscribeEvents(),this.tool=null,this.containerEl=null,this.isBound=!1},e.prototype.trigger=function(o,t){return this.canvas.dispatchEvent(new CustomEvent(o,{detail:t})),null},e.prototype.on=function(o,a){var t;return t=function(e){return a(e.detail)},this.canvas.addEventListener(o,t),function(a){return function(){return a.canvas.removeEventListener(o,t)}}(this)},e.prototype.getRenderScale=function(){return this.scale*this.backingScale},e.prototype.clientCoordsToDrawingCoords=function(o,t){return{x:(o*this.backingScale-this.position.x)/this.getRenderScale(),y:(t*this.backingScale-this.position.y)/this.getRenderScale()}},e.prototype.drawingCoordsToClientCoords=function(o,t){return{x:o*this.getRenderScale()+this.position.x,y:t*this.getRenderScale()+this.position.y}},e.prototype.setImageSize=function(o,t){return this.width=o||k,this.height=t||k,this.keepPanInImageBounds(),this.repaintAllLayers(),this.trigger("imageSizeChange",{width:this.width,height:this.height})},e.prototype.setTool=function(o){var t;return this.isBound&&null!=(t=this.tool)&&t.willBecomeInactive(this),this.tool=o,this.trigger("toolChange",{tool:o}),this.isBound?this.tool.didBecomeActive(this):void 0},e.prototype.setShapesInProgress=function(e){return this._shapesInProgress=e},e.prototype.pointerDown=function(o,t){var e;return e=this.clientCoordsToDrawingCoords(o,t),this.tool.usesSimpleAPI?(this.tool.begin(e.x,e.y,this),this.isDragging=!0,this.trigger("drawStart",{tool:this.tool})):(this.isDragging=!0,this.trigger("lc-pointerdown",{tool:this.tool,x:e.x,y:e.y,rawX:o,rawY:t}))},e.prototype.pointerMove=function(o,t){return N.requestAnimationFrame(function(e){return function(){var a,n;return a=e.clientCoordsToDrawingCoords(o,t),(null!=(n=e.tool)?n.usesSimpleAPI:0)?e.isDragging?(e.tool["continue"](a.x,a.y,e),e.trigger("drawContinue",{tool:e.tool})):void 0:e.isDragging?e.trigger("lc-pointerdrag",{tool:e.tool,x:a.x,y:a.y,rawX:o,rawY:t}):e.trigger("lc-pointermove",{tool:e.tool,x:a.x,y:a.y,rawX:o,rawY:t})}}(this))},e.prototype.pointerUp=function(o,t){var e;return e=this.clientCoordsToDrawingCoords(o,t),this.tool.usesSimpleAPI?this.isDragging?(this.tool.end(e.x,e.y,this),this.isDragging=!1,this.trigger("drawEnd",{tool:this.tool})):void 0:(this.isDragging=!1,this.trigger("lc-pointerup",{tool:this.tool,x:e.x,y:e.y,rawX:o,rawY:t}))},e.prototype.setColor=function(o,t){if(this.colors[o]=t,this.isBound){switch(o){case"background":this.containerEl.style.backgroundColor=this.colors.background,this.repaintLayer("background");break;case"primary":this.repaintLayer("main");break;case"secondary":this.repaintLayer("main");}return this.trigger(o+"ColorChange",this.colors[o]),"background"===o?this.trigger("drawingChange"):void 0}},e.prototype.getColor=function(e){return this.colors[e]},e.prototype.saveShape=function(o,t,a){return null==t&&(t=!0),null==a&&(a=null),a||(a=this.shapes.length?this.shapes[this.shapes.length-1].id:null),this.execute(new w.AddShapeAction(this,o,a)),t&&this.trigger("shapeSave",{shape:o,previousShapeId:a}),this.trigger("drawingChange")},e.prototype.pan=function(o,t){return this.setPan(this.position.x-o,this.position.y-t)},e.prototype.keepPanInImageBounds=function(){var o,a,i,s;return a=this.getRenderScale(),o=this.position,i=o.x,s=o.y,this.width!==k&&(i=this.canvas.width>this.width*a?(this.canvas.width-this.width*a)/2:Math.max(Math.min(0,i),this.canvas.width-this.width*a)),this.height!==k&&(s=this.canvas.height>this.height*a?(this.canvas.height-this.height*a)/2:Math.max(Math.min(0,s),this.canvas.height-this.height*a)),this.position={x:i,y:s}},e.prototype.setPan=function(o,t){return this.position={x:o,y:t},this.keepPanInImageBounds(),this.repaintAllLayers(),this.trigger("pan",{x:this.position.x,y:this.position.y})},e.prototype.zoom=function(o){var t;return t=this.scale+o,t=Math.max(t,this.config.zoomMin),t=Math.min(t,this.config.zoomMax),t=Math.round(100*t)/100,this.setZoom(t)},e.prototype.setZoom=function(o){var t;return t=this.scale,this.scale=o,this.position.x=_.scalePositionScalar(this.position.x,this.canvas.width,t,this.scale),this.position.y=_.scalePositionScalar(this.position.y,this.canvas.height,t,this.scale),this.keepPanInImageBounds(),this.repaintAllLayers(),this.trigger("zoom",{oldScale:t,newScale:this.scale})},e.prototype.setWatermarkImage=function(e){return this.watermarkImage=e,N.addImageOnload(e,function(e){return function(){return e.repaintLayer("background")}}(this)),e.width?this.repaintLayer("background"):void 0},e.prototype.repaintAllLayers=function(){var o,a,r,s;for(s=["background","main"],o=0,r=s.length;r>o;o++){a=s[o],this.repaintLayer(a)}return null},e.prototype.repaintLayer=function(o,t){var a;if(null==t&&(t="main"===o),this.isBound){switch(o){case"background":this.backgroundCtx.clearRect(0,0,this.backgroundCanvas.width,this.backgroundCanvas.height),a=function(e){return function(){return e.repaintLayer("background")}}(this),this.watermarkImage&&this._renderWatermark(this.backgroundCtx,!0,a),this.draw(this.backgroundShapes,this.backgroundCtx,a);break;case"main":a=function(e){return function(){return e.repaintLayer("main",!0)}}(this),t&&(this.buffer.width=this.canvas.width,this.buffer.height=this.canvas.height,this.bufferCtx.clearRect(0,0,this.buffer.width,this.buffer.height),this.draw(this.shapes,this.bufferCtx,a)),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),0<this.canvas.width&&0<this.canvas.height&&(this.ctx.fillStyle="#ccc",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.clipped(function(e){return function(){return e.ctx.clearRect(0,0,e.canvas.width,e.canvas.height),e.ctx.drawImage(e.buffer,0,0)}}(this),this.ctx),this.clipped(function(a){return function(){return a.transformed(function(){var t,s,l,p,d;for(l=a._shapesInProgress,p=[],t=0,s=l.length;s>t;t++){d=l[t],p.push(I(a.ctx,d,{bufferCtx:a.bufferCtx,shouldOnlyDrawLatest:!0}))}return p},a.ctx,a.bufferCtx)}}(this),this.ctx,this.bufferCtx));}return this.trigger("repaint",{layerKey:o})}},e.prototype._renderWatermark=function(o,t,a){return null==t&&(t=!0),this.watermarkImage.width?(o.save(),o.translate(o.canvas.width/2,o.canvas.height/2),o.scale(this.watermarkScale,this.watermarkScale),t&&o.scale(this.backingScale,this.backingScale),o.drawImage(this.watermarkImage,-this.watermarkImage.width/2,-this.watermarkImage.height/2),o.restore()):void(this.watermarkImage.onload=a)},e.prototype.drawShapeInProgress=function(o){return this.repaintLayer("main",!1),this.clipped(function(t){return function(){return t.transformed(function(){return I(t.ctx,o,{bufferCtx:t.bufferCtx,shouldOnlyDrawLatest:!0})},t.ctx,t.bufferCtx)}}(this),this.ctx,this.bufferCtx)},e.prototype.draw=function(a,r,e){var o;if(a.length)return o=function(){return function(){var t,n,l,p;for(l=[],t=0,n=a.length;n>t;t++){p=a[t],l.push(I(r,p,{retryCallback:e}))}return l}}(this),this.clipped(function(e){return function(){return e.transformed(o,r)}}(this),r)},e.prototype.clipped=function(){var i,d,g,m,y,f,x,b,C,w,v,P;for(g=arguments[0],i=2<=arguments.length?S.call(arguments,1):[],v=this.width===k?0:this.position.x,P=this.height===k?0:this.position.y,w=function(){switch(this.width){case k:return this.canvas.width;default:return this.width*this.getRenderScale();}}.call(this),m=function(){switch(this.height){case k:return this.canvas.height;default:return this.height*this.getRenderScale();}}.call(this),y=0,x=i.length;x>y;y++){d=i[y],d.save(),d.beginPath(),d.rect(v,P,w,m),d.clip()}for(g(),C=[],f=0,b=i.length;b>f;f++){d=i[f],C.push(d.restore())}return C},e.prototype.transformed=function(){var l,p,d,c,g,u,m,y,f;for(d=arguments[0],l=2<=arguments.length?S.call(arguments,1):[],c=0,u=l.length;u>c;c++){p=l[c],p.save(),p.translate(Math.floor(this.position.x),Math.floor(this.position.y)),f=this.getRenderScale(),p.scale(f,f)}for(d(),y=[],g=0,m=l.length;m>g;g++){p=l[g],y.push(p.restore())}return y},e.prototype.clear=function(o){var a,r;return null==o&&(o=!0),r=this.shapes,a=[],this.setShapesInProgress([]),this.execute(new w.ClearAction(this,r,a)),this.repaintLayer("main"),o&&this.trigger("clear",null),this.trigger("drawingChange",{})},e.prototype.execute=function(e){return this.undoStack.push(e),e["do"](),this.redoStack=[]},e.prototype.undo=function(){var e;if(this.undoStack.length)return e=this.undoStack.pop(),e.undo(),this.redoStack.push(e),this.trigger("undo",{action:e}),this.trigger("drawingChange",{})},e.prototype.redo=function(){var e;if(this.redoStack.length)return e=this.redoStack.pop(),this.undoStack.push(e),e["do"](),this.trigger("redo",{action:e}),this.trigger("drawingChange",{})},e.prototype.canUndo=function(){return!!this.undoStack.length},e.prototype.canRedo=function(){return!!this.redoStack.length},e.prototype.getPixel=function(o,t){var e,a;return e=this.drawingCoordsToClientCoords(o,t),a=this.ctx.getImageData(e.x,e.y,1,1).data,a[3]?"rgb("+a[0]+", "+a[1]+", "+a[2]+")":null},e.prototype.getContentBounds=function(){return N.getBoundingRect(this.shapes.concat(this.backgroundShapes).map(function(e){return e.getBoundingRect()}),this.width===k?0:this.width,this.height===k?0:this.height)},e.prototype.getDefaultImageRect=function(o,a){var s;return null==o&&(o={width:0,height:0}),null==a&&(a={top:0,right:0,bottom:0,left:0}),N.getDefaultImageRect(function(){var o,a,n,l;for(n=this.shapes.concat(this.backgroundShapes),l=[],o=0,a=n.length;a>o;o++){s=n[o],l.push(s.getBoundingRect(this.ctx))}return l}.call(this),o,a)},e.prototype.getImage=function(e){return null==e&&(e={}),null==e.includeWatermark&&(e.includeWatermark=!0),null==e.scaleDownRetina&&(e.scaleDownRetina=!0),null==e.scale&&(e.scale=1),e.scaleDownRetina||(e.scale*=this.backingScale),e.includeWatermark&&(e.watermarkImage=this.watermarkImage,e.watermarkScale=this.watermarkScale,e.scaleDownRetina||(e.watermarkScale*=this.backingScale)),L(this.getSnapshot(),e)},e.prototype.canvasForExport=function(){return this.repaintAllLayers(),N.combineCanvases(this.backgroundCanvas,this.canvas)},e.prototype.canvasWithBackground=function(e){return N.combineCanvases(e,this.canvasForExport())},e.prototype.getSnapshot=function(a){var l,p,d,c,h,g;for(null==a&&(a=null),null==a&&(a=["shapes","imageSize","colors","position","scale","backgroundShapes"]),g={},c=["colors","position","scale"],l=0,d=c.length;d>l;l++){p=c[l],0<=v.call(a,p)&&(g[p]=this[p])}return 0<=v.call(a,"shapes")&&(g.shapes=function(){var o,a,r,s;for(r=this.shapes,s=[],o=0,a=r.length;a>o;o++){h=r[o],s.push(O(h))}return s}.call(this)),0<=v.call(a,"backgroundShapes")&&(g.backgroundShapes=function(){var o,a,r,s;for(r=this.backgroundShapes,s=[],o=0,a=r.length;a>o;o++){h=r[o],s.push(O(h))}return s}.call(this)),0<=v.call(a,"imageSize")&&(g.imageSize={width:this.width,height:this.height}),g},e.prototype.getSnapshotJSON=function(){return console.warn("lc.getSnapshotJSON() is deprecated. use JSON.stringify(lc.getSnapshot()) instead."),JSON.stringify(this.getSnapshot())},e.prototype.getSVGString=function(e){return null==e&&(e={}),z(this.getSnapshot(),e)},e.prototype.loadSnapshot=function(a){var t,r,d,g,m,y,S,f,x,k;if(a){if(a.colors)for(y=["primary","secondary","background"],t=0,g=y.length;g>t;t++){d=y[t],this.setColor(d,a.colors[d])}if(a.shapes)for(this.shapes=[],S=a.shapes,r=0,m=S.length;m>r;r++){k=S[r],x=b(k),x&&this.execute(new w.AddShapeAction(this,x))}return a.backgroundShapes&&(this.backgroundShapes=function(){var t,r,s,l;for(s=a.backgroundShapes,l=[],t=0,r=s.length;r>t;t++){f=s[t],l.push(b(f))}return l}()),a.imageSize&&(this.width=a.imageSize.width,this.height=a.imageSize.height),a.position&&(this.position=a.position),a.scale&&(this.scale=a.scale),this.repaintAllLayers(),this.trigger("snapshotLoad"),this.trigger("drawingChange",{})}},e.prototype.loadSnapshotJSON=function(e){return console.warn("lc.loadSnapshotJSON() is deprecated. use lc.loadSnapshot(JSON.parse(snapshot)) instead."),this.loadSnapshot(JSON.parse(e))},e}()},{"../tools/Pencil":48,"./actions":7,"./bindEvents":8,"./canvasRenderer":9,"./math":14,"./renderSnapshotToImage":15,"./renderSnapshotToSVG":16,"./shapes":17,"./svgRenderer":18,"./util":19}],6:[function(a,t){var e,p,d,c;a("./fontmetrics.js"),c=function(l){var t,p,d,c,g,u,m,y;for(p=l.split(" "),d=0,g=0,u=p.length;u>g;g++){c=p[g],m=parseInt(c.replace("px",""),10),isNaN(m)||(d=m)}if(!d)throw"Font size not found";return y=l.substring(p[0].length+1).replace("bold ","").replace("italic ","").replace("underline ",""),t=y,{fontSize:d,fontFamily:t}},d=function(d,t,e){var n,g,m,y,S,f,x,k,b,C;if(!t.length)return["",""];for(g=0,f=0,x=0,C=!1;;){if(g+=1,m=g>=t.length,S=!m&&t[g].match(/\s/),y=S||m,b=t.substring(0,g),n=e?d.measureTextWidth(b).width<=e:!0,n&&(x=g),y&&C&&(C=!1,n&&(f=g)),C=!S,m||!n){if(n)return[t,""];if(0<f){for(k=f+1;k<t.length&&t[k].match("/s/");){k+=1}return[t.substring(0,f),t.substring(k)]}return[t.substring(0,x),t.substring(x)]}}},p=function(o,t,e){var n,g,m,y,S,f,x,k,b;for(b=t.split(/\r\n|\r|\n/g),m=[],n=0,g=b.length;g>n;n++){if(k=b[n],S=d(o,k,e),y=S[0],x=S[1],y)for(;y;){m.push(y),f=d(o,x,e),y=f[0],x=f[1]}else m.push(k)}return m},e=function(){function e(r,t,e,n,i){var o,s,d;this.text=t,this.font=e,this.forcedWidth=n,this.forcedHeight=i,d=c(this.font),o=d.fontFamily,s=d.fontSize,r.font=this.font,r.textBaseline="baseline",this.emDashWidth=r.measureTextWidth("\u2014",s,o).width,this.caratWidth=r.measureTextWidth("|",s,o).width,this.lines=p(r,this.text,this.forcedWidth),this.metricses=this.lines.map(function(t){return function(e){return r.measureText2(e||"X",s,t.font)}}(this)),this.metrics={ascent:Math.max.apply(Math,this.metricses.map(function(o){var t;return t=o.ascent})),descent:Math.max.apply(Math,this.metricses.map(function(o){var t;return t=o.descent})),fontsize:Math.max.apply(Math,this.metricses.map(function(o){var t;return t=o.fontsize})),leading:Math.max.apply(Math,this.metricses.map(function(o){var t;return t=o.leading})),width:Math.max.apply(Math,this.metricses.map(function(o){var t;return t=o.width})),height:Math.max.apply(Math,this.metricses.map(function(o){var t;return t=o.height})),bounds:{minx:Math.min.apply(Math,this.metricses.map(function(o){var t;return t=o.bounds,t.minx})),miny:Math.min.apply(Math,this.metricses.map(function(o){var t;return t=o.bounds,t.miny})),maxx:Math.max.apply(Math,this.metricses.map(function(o){var t;return t=o.bounds,t.maxx})),maxy:Math.max.apply(Math,this.metricses.map(function(o){var t;return t=o.bounds,t.maxy}))}},this.boundingBoxWidth=Math.ceil(this.metrics.width)}return e.prototype.draw=function(l,t,e){var n,p,d,c,g,u;for(l.textBaseline="top",l.font=this.font,n=0,g=this.lines,u=[],p=0,d=g.length;d>p;p++){c=g[p],l.fillText(c,t,e+n*this.metrics.leading),u.push(n+=1)}return u},e.prototype.getWidth=function(e){return null==e&&(e=!1),this.forcedWidth?this.forcedWidth:e?this.metrics.bounds.maxx+this.caratWidth:this.metrics.bounds.maxx},e.prototype.getHeight=function(){return this.forcedHeight||this.metrics.leading*this.lines.length},e}(),t.exports=e},{"./fontmetrics.js":11}],7:[function(o,t){var e,a;a=function(){function e(o,t,e){this.lc=o,this.oldShapes=t,this.newShapes=e}return e.prototype["do"]=function(){return this.lc.shapes=this.newShapes,this.lc.repaintLayer("main")},e.prototype.undo=function(){return this.lc.shapes=this.oldShapes,this.lc.repaintLayer("main")},e}(),e=function(){function e(o,t,e){this.lc=o,this.shape=t,this.previousShapeId=null!=e?e:null}return e.prototype["do"]=function(){var a,s,l,p,d,c;if(this.lc.shapes.length&&this.lc.shapes[this.lc.shapes.length-1].id!==this.previousShapeId&&null!==this.previousShapeId){for(p=[],a=!1,d=this.lc.shapes,s=0,l=d.length;l>s;s++){c=d[s],p.push(c),c.id===this.previousShapeId&&(p.push(this.shape),a=!0)}a||p.push(this.shape),this.lc.shapes=p}else this.lc.shapes.push(this.shape);return this.lc.repaintLayer("main")},e.prototype.undo=function(){var o,a,s,l,p;if(this.lc.shapes[this.lc.shapes.length-1].id===this.shape.id)this.lc.shapes.pop();else{for(s=[],l=this.lc.shapes,o=0,a=l.length;a>o;o++){p=l[o],p.id!==this.shape.id&&s.push(p)}lc.shapes=s}return this.lc.repaintLayer("main")},e}(),t.exports={ClearAction:a,AddShapeAction:e}},{}],8:[function(a,t){var e,n,p,l;p=function(o,t){var e,a,s;return a=t.changedTouches[0].clientX,s=t.changedTouches[0].clientY,e=o.getBoundingClientRect(),[a-e.left,s-e.top]},l=function(o,t){var e;return e=o.getBoundingClientRect(),{left:t.clientX-e.left,top:t.clientY-e.top}},n=function(e){return null!=e.buttons?1===e.buttons:0<e.which},t.exports=e=function(s,t,e){var o,d,h,g,u,m;return null==e&&(e=!1),m=[],d=function(){return function(e){var o;return e.preventDefault(),o=l(t,e),s.pointerMove(o.left,o.top)}}(this),h=function(){return function(e){var o;return e.preventDefault(),t.onselectstart=function(){return!0},o=l(t,e),s.pointerUp(o.left,o.top),document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",h),t.addEventListener("mousemove",d)}}(this),t.addEventListener("mousedown",function(){return function(e){var a,n;if("canvas"===e.target.tagName.toLowerCase())return a=!0,e.preventDefault(),t.onselectstart=function(){return!1},n=l(t,e),s.pointerDown(n.left,n.top),t.removeEventListener("mousemove",d),document.addEventListener("mousemove",d),document.addEventListener("mouseup",h)}}(this)),u=function(e){return e.preventDefault(),s.pointerMove.apply(s,p(t,e))},g=function h(e){return e.preventDefault(),s.pointerUp.apply(s,p(t,e)),document.removeEventListener("touchmove",u),document.removeEventListener("touchend",g),document.removeEventListener("touchcancel",g)},t.addEventListener("touchstart",function(e){return"canvas"===e.target.tagName.toLowerCase()?(e.preventDefault(),1===e.touches.length?(s.pointerDown.apply(s,p(t,e)),document.addEventListener("touchmove",u),document.addEventListener("touchend",g),document.addEventListener("touchcancel",g)):s.pointerMove.apply(s,p(t,e))):void 0}),e&&(console.warn("Keyboard panning is deprecated."),o=function(t){switch(t.keyCode){case 37:s.pan(-10,0);break;case 38:s.pan(0,-10);break;case 39:s.pan(10,0);break;case 40:s.pan(0,10);}return s.repaintAllLayers()},document.addEventListener("keydown",o),m.push(function(){return document.removeEventListener(o)})),function(){var o,a,r,s;for(s=[],a=0,r=m.length;r>a;a++){o=m[a],s.push(o())}return s}}},{}],9:[function(n,t){var g,e,m,y,S,f,x,k,b,C,w;x=n("./lineEndCapShapes"),w={},e=function(o,t,e){return w[o]={drawFunc:t,drawLatestFunc:e}},k=function(){},C=function(o,t,e){var a;if(null==e&&(e={}),null==e.shouldIgnoreUnsupportedShapes&&(e.shouldIgnoreUnsupportedShapes=!1),null==e.retryCallback&&(e.retryCallback=k),null==e.shouldOnlyDrawLatest&&(e.shouldOnlyDrawLatest=!1),null==e.bufferCtx&&(e.bufferCtx=null),a=e.bufferCtx,w[t.className])return e.shouldOnlyDrawLatest&&w[t.className].drawLatestFunc?w[t.className].drawLatestFunc(o,a,t,e.retryCallback):w[t.className].drawFunc(o,t,e.retryCallback);if(e.shouldIgnoreUnsupportedShapes)return console.warn("Can't render shape of type "+t.className+" to canvas");throw"Can't render shape of type "+t.className+" to canvas"},b=function(o,t,e){return C(o.getContext("2d"),t,e)},e("Rectangle",function(o,t){var e,a;return e=t.x,a=t.y,0!=t.strokeWidth%2&&(e+=.5,a+=.5),o.fillStyle=t.fillColor,o.fillRect(e,a,t.width,t.height),o.lineWidth=t.strokeWidth,o.strokeStyle=t.strokeColor,o.strokeRect(e,a,t.width,t.height)}),e("Ellipse",function(a,t){var e,s,l,p;return a.save(),p=Math.floor(t.width/2),l=Math.floor(t.height/2),e=t.x+p,s=t.y+l,a.translate(e,s),a.scale(1,Math.abs(t.height/t.width)),a.beginPath(),a.arc(0,0,Math.abs(p),0,2*Math.PI),a.closePath(),a.restore(),a.fillStyle=t.fillColor,a.fill(),a.lineWidth=t.strokeWidth,a.strokeStyle=t.strokeColor,a.stroke()}),e("SelectionBox",function(){var o;return o=function(t,o,e){var a,n;return a=o.x,n=o.y,0!==e?(t.fillStyle="#fff",t.fillRect(a,n,e,e),t.strokeStyle="#000",t.strokeRect(a,n,e,e)):void 0},function(t,e){return o(t,e.getTopLeftHandleRect(),e.handleSize),o(t,e.getTopRightHandleRect(),e.handleSize),o(t,e.getBottomLeftHandleRect(),e.handleSize),o(t,e.getBottomRightHandleRect(),e.handleSize),e.backgroundColor&&(t.fillStyle=e.backgroundColor,t.fillRect(e._br.x-e.margin,e._br.y-e.margin,e._br.width+2*e.margin,e._br.height+2*e.margin)),t.lineWidth=1,t.strokeStyle="#000",t.setLineDash([2,4]),t.strokeRect(e._br.x-e.margin,e._br.y-e.margin,e._br.width+2*e.margin,e._br.height+2*e.margin),t.setLineDash([])}}()),e("Image",function(o,t,e){return t.image.width?1===t.scale?o.drawImage(t.image,t.x,t.y):o.drawImage(t.image,t.x,t.y,t.image.width*t.scale,t.image.height*t.scale):e?t.image.onload=e:void 0}),e("Line",function(a,t){var e,l,p,d,c;if(t.x1!==t.x2||t.y1!==t.y2)return l=t.x1,p=t.x2,d=t.y1,c=t.y2,0!=t.strokeWidth%2&&(l+=.5,p+=.5,d+=.5,c+=.5),a.lineWidth=t.strokeWidth,a.strokeStyle=t.color,a.lineCap=t.capStyle,t.dash&&a.setLineDash(t.dash),a.beginPath(),a.moveTo(l,d),a.lineTo(p,c),a.stroke(),t.dash&&a.setLineDash([]),e=Math.max(2.2*t.strokeWidth,5),t.endCapShapes[0]&&x[t.endCapShapes[0]].drawToCanvas(a,l,d,Math.atan2(d-c,l-p),e,t.color),t.endCapShapes[1]?x[t.endCapShapes[1]].drawToCanvas(a,p,c,Math.atan2(c-d,p-l),e,t.color):void 0}),g=function(i,t,e,l){var p,d,c,h;if(null==e&&(e=!1),null==l&&(l="round"),t.length){for(i.lineCap=l,i.strokeStyle=t[0].color,i.lineWidth=t[0].size,i.beginPath(),0==t[0].size%2?i.moveTo(t[0].x,t[0].y):i.moveTo(t[0].x+.5,t[0].y+.5),h=t.slice(1),p=0,d=h.length;d>p;p++){c=h[p],0==t[0].size%2?i.lineTo(c.x,c.y):i.lineTo(c.x+.5,c.y+.5)}return e?i.closePath():void 0}},S=function(o,t){return g(o,t.smoothedPoints),o.stroke()},f=function(a,t,e){var n,i,l;return e.tail?(l=e.smoothedPoints.length-e.segmentSize*e.tailSize,i=l<2*e.segmentSize?0:l,n=l+e.segmentSize+1,g(t,e.smoothedPoints.slice(i,n)),t.stroke()):(g(t,e.smoothedPoints),t.stroke())},e("LinePath",S,f),m=function(o,t){return o.save(),o.globalCompositeOperation="destination-out",S(o,t),o.restore()},y=function(o,t,e){return o.save(),o.globalCompositeOperation="destination-out",t.save(),t.globalCompositeOperation="destination-out",f(o,t,e),o.restore(),t.restore()},e("ErasedLinePath",m,y),e("Text",function(o,t){return t.renderer||t._makeRenderer(o),o.fillStyle=t.color,t.renderer.draw(o,t.x,t.y)}),e("Polygon",function(o,t){return o.fillStyle=t.fillColor,g(o,t.points,t.isClosed,"butt"),o.fill(),o.stroke()}),t.exports={defineCanvasRenderer:e,renderShapeToCanvas:b,renderShapeToContext:C}},{"./lineEndCapShapes":12}],10:[function(o,t){"use strict";t.exports={imageURLPrefix:"lib/img",primaryColor:"hsla(0, 0%, 0%, 1)",secondaryColor:"hsla(0, 0%, 100%, 1)",backgroundColor:"transparent",strokeWidths:[1,2,5,10,20,30],defaultStrokeWidth:5,toolbarPosition:"top",keyboardShortcuts:!1,imageSize:{width:"infinite",height:"infinite"},backgroundShapes:[],watermarkImage:null,watermarkScale:1,zoomMin:.2,zoomMax:4,zoomStep:.2,snapshot:null,onInit:function onInit(){},tools:[o("../tools/Pencil"),o("../tools/Eraser"),o("../tools/Line"),o("../tools/Rectangle"),o("../tools/Ellipse"),o("../tools/Text"),o("../tools/Polygon"),o("../tools/Pan"),o("../tools/Eyedropper")]}},{"../tools/Ellipse":43,"../tools/Eraser":44,"../tools/Eyedropper":45,"../tools/Line":46,"../tools/Pan":47,"../tools/Pencil":48,"../tools/Polygon":49,"../tools/Rectangle":50,"../tools/Text":52}],11:[function(){"use strict";!function(){if(!document.defaultView.getComputedStyle)throw"ERROR: 'document.defaultView.getComputedStyle' not found. This library only works in browsers that can report computed CSS values.";CanvasRenderingContext2D.prototype.measureTextWidth=CanvasRenderingContext2D.prototype.measureText;var l=function(t,o){return document.defaultView.getComputedStyle(t,null).getPropertyValue(o)};CanvasRenderingContext2D.prototype.measureText2=function(t,e,n){var i=this.measureTextWidth(t),r=!/\S/.test(t);i.fontsize=e;var o=document.createElement("div");o.style.position="absolute",o.style.opacity=0,o.style.font=n,o.innerHTML=t+"<br/>"+t,document.body.appendChild(o),i.leading=1.2*e;var s=l(o,"height");if(s=s.replace("px",""),s>=2*e&&(i.leading=0|s/2),document.body.removeChild(o),r)i.ascent=0,i.descent=0,i.bounds={minx:0,maxx:i.width,miny:0,maxy:0},i.height=0;else{var b=document.createElement("canvas");b.width=i.width+100,b.height=3*e,b.style.opacity=1,b.style.font=n;var h=b.getContext("2d");h.font=n;var c=b.width,u=b.height,p=u/2;h.fillStyle="white",h.fillRect(-1,-1,c+2,u+2),h.fillStyle="black",h.fillText(t,50,p);for(var d=h.getImageData(0,0,c,u).data,f=0,C=4*c,m=d.length;++f<m&&255===d[f];){}var y=0|f/C;for(f=m-1;0<--f&&255===d[f];){}var S=0|f/C;for(f=0;m>f&&255===d[f];){f+=C,f>=m&&(f=f-m+4)}var v=0|f%C/4,x=1;for(f=m-3;0<=f&&255===d[f];){f-=C,0>f&&(f=m-3-4*x++)}var P=0|f%C/4+1;i.ascent=p-y,i.descent=S-p,i.bounds={minx:v-50,maxx:P-50,miny:0,maxy:S-y},i.height=1+(S-y)}return i}}()},{}],12:[function(o,t){t.exports={arrow:function(){var l;return l=function(t,o,e,a,n){return[{x:t+Math.cos(e+Math.PI/2)*a/2,y:o+Math.sin(e+Math.PI/2)*a/2},{x:t+Math.cos(e)*n,y:o+Math.sin(e)*n},{x:t+Math.cos(e-Math.PI/2)*a/2,y:o+Math.sin(e-Math.PI/2)*a/2}]},{drawToCanvas:function drawToCanvas(t,e,n,i,r,o,s){var p;return null==s&&(s=0),s=s||r,t.fillStyle=o,t.lineWidth=0,t.strokeStyle="transparent",t.beginPath(),p=l(e,n,i,r,s),t.moveTo(p[0].x,p[0].y),t.lineTo(p[1].x,p[1].y),t.lineTo(p[2].x,p[2].y),t.fill()},svg:function svg(t,e,n,i,r,o){var p;return null==o&&(o=0),o=o||i,p=l(t,e,n,i,o),"<polygon fill='"+r+"' stroke='none' points='"+p.map(function(e){return e.x+","+e.y})+"' />"}}}()}},{}],13:[function(a,t){var e,n,s;s={},n=function(e){return s=e},e=function(o){var t;return t=s[o],t||o},t.exports={localize:n,_:e}},{}],14:[function(n,t){var e,r,l,p,d,c;e=n("./shapes").Point,c=n("./util"),l={},l.toPoly=function(s){var t,d,c,g,u,m,y;for(m=[],y=[],d=0,t=0,c=s.length;c>t;t++){u=s[t],g=p(u,r(s,d)),m=m.concat([g[0]]),y=[g[1]].concat(y),d+=1}return m.concat(y)},r=function r(o,t){var e;return 3>o.length&&(e={x:0,y:0}),e=0===t?r(o,t+1):t===o.length-1?r(o,t-1):l.diff(o[t-1],o[t+1])},l.diff=function(o,t){return{x:t.x-o.x,y:t.y-o.y}},d=function(o){var t;return t=l.len(o),{x:o.x/t,y:o.y/t}},p=function(o,t){return t=d(t),t.x=t.x*o.size/2,t.y=t.y*o.size/2,[{x:o.x-t.y,y:o.y+t.x,color:o.color},{x:o.x+t.y,y:o.y-t.x,color:o.color}]},l.len=function(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))},l.scalePositionScalar=function(a,t,e,n){var i,s;return s=t*e,i=t*n,a+(s-i)/2},t.exports=l},{"./shapes":17,"./util":19}],15:[function(a,t){var g,n,m,y;y=a("./util"),n=a("./shapes").JSONToShape,g="infinite",m=function(o,t,e){return t.width?(o.save(),o.translate(o.canvas.width/2,o.canvas.height/2),o.scale(e,e),o.drawImage(t,-t.width/2,-t.height/2),o.restore()):void 0},t.exports=function(r,t){var o,i,s,S,f,x,k,b;return null==t&&(t={}),null==t.scale&&(t.scale=1),x=function(){var t,a,s,l;for(s=r.shapes,l=[],t=0,a=s.length;a>t;t++){f=s[t],l.push(n(f))}return l}(),i=[],r.backgroundShapes&&(i=function(){var t,a,s,l;for(s=r.backgroundShapes,l=[],t=0,a=s.length;a>t;t++){f=s[t],l.push(n(f))}return l}()),null==t.margin&&(t.margin={top:0,right:0,bottom:0,left:0}),S=r.imageSize||{width:g,height:g},s=r.colors||{background:"transparent"},o=x.concat(i),k=document.createElement("canvas"),b=k.getContext("2d"),t.rect?(t.rect.x-=t.margin.left,t.rect.y-=t.margin.top,t.rect.width+=t.margin.left+t.margin.right,t.rect.height+=t.margin.top+t.margin.bottom):t.rect=y.getDefaultImageRect(function(){var a,n,r;for(r=[],a=0,n=o.length;n>a;a++){f=o[a],r.push(f.getBoundingRect(b))}return r}(),S,t.margin),k.width=t.rect.width*t.scale,k.height=t.rect.height*t.scale,b.fillStyle=s.background,b.fillRect(0,0,k.width,k.height),t.rect.width&&t.rect.height?(t.watermarkImage&&m(b,t.watermarkImage,t.watermarkScale),y.combineCanvases(k,y.renderShapes(i,t.rect,t.scale),y.renderShapes(x,t.rect,t.scale))):null}},{"./shapes":17,"./util":19}],16:[function(a,t){var d,n,g;g=a("./util"),n=a("./shapes").JSONToShape,d="infinite",t.exports=function(r,t){var o,i,m,y,S,f,x,k;return null==t&&(t={}),k=function(){var t,a,s,l;for(s=r.shapes,l=[],t=0,a=s.length;a>t;t++){x=s[t],l.push(n(x))}return l}(),i=[],r.backgroundShapes&&(i=function(){var t,a,s,l;for(s=r.backgroundShapes,l=[],t=0,a=s.length;a>t;t++){x=s[t],l.push(n(x))}return l}()),null==t.margin&&(t.margin={top:0,right:0,bottom:0,left:0}),f=r.imageSize||{width:d,height:d},m=r.colors||{background:"transparent"},o=k.concat(i),S=document.createElement("canvas"),y=S.getContext("2d"),t.rect?(t.rect.x-=t.margin.left,t.rect.y-=t.margin.top,t.rect.width+=t.margin.left+t.margin.right,t.rect.height+=t.margin.top+t.margin.bottom):t.rect=g.getDefaultImageRect(function(){var a,n,r;for(r=[],a=0,n=o.length;n>a;a++){x=o[a],r.push(x.getBoundingRect(y))}return r}(),f,t.margin),LC.renderShapesToSVG(i.concat(k),t.rect,m.background)}},{"./shapes":17,"./util":19}],17:[function(n,t){var u,e,P,R,_,E,I,T,L,z,O,N,B,W,D,U,A,M,F,G,H,J;J=n("./util"),P=n("./TextRenderer"),W=n("./lineEndCapShapes"),U=n("./canvasRenderer"),O=U.defineCanvasRenderer,M=U.renderShapeToContext,A=n("./svgRenderer"),N=A.defineSVGRenderer,F=A.renderShapeToSVG,H={},B=function(p,y){var e,t,d,c,g,u,m,S;e=function(e,t,n,i,r,o,s,a,h,l,c,u,p,d,S,g){return y.constructor.call(this,e,t,n,i,r,o,s,a,h,l,c,u,p,d,S,g),this},e.prototype.className=p,e.fromJSON=y.fromJSON,y.draw&&(g=y.draw,u=y.draw||function(o,t,e){return this.draw(o,t,e)},t=function(o,t,e){return g.call(t,o,e)},d=function(o,t,e,a){return u.call(e,o,t,a)},delete y.draw,y.drawLatest&&delete y.drawLatest,O(p,t,d)),y.toSVG&&(m=y.toSVG,S=function(e){return m.call(e)},delete y.toSVG,N(p,S)),e.prototype.draw=function(o,t){return M(o,this,{retryCallback:t})},e.prototype.drawLatest=function(o,t,e){return M(o,this,{retryCallback:e,bufferCtx:t,shouldOnlyDrawLatest:!0})},e.prototype.toSVG=function(){return F(this)};for(c in y){"fromJSON"!==c&&(e.prototype[c]=y[c])}return H[p]=e,e},z=function(p,t,e,n,i,r,o,s,a,h,l,c,u,S,d,f,g){var m;return m=new H[p](t,e,n,i,r,o,s,a,h,l,c,u,S,d,f,g),m.id=J.getGUID(),m},u=function(o){var t,a,s,l;return t=o.className,a=o.data,s=o.id,t in H?(l=H[t].fromJSON(a),l?(s&&(l.id=s),l):(console.log("Unreadable shape:",t,a),null)):(console.log("Unknown shape:",t,a),null)},G=function(e){return{className:e.className,data:e.toJSON(),id:e.id}},L=function u(o,t){return t?L(E(E(T(o))),t-1):o},T=function(a){var s,l,p,d,c;for(a=[a[0]].concat(a).concat(J.last(a)),c=[],s=0,d=0,l=a.length;l>d;d++){p=a[d],c[2*s]=p,a[s+1]&&(c[2*s+1]=I(p,a[s+1])),s+=1}return c},E=function(a){var t,s,l,p,d;for(t=[],s=0,d=0,l=a.length;l>d;d++){p=a[d],a[s+1]&&(t[s]=I(p,a[s+1])),s+=1}return t},I=function(o,t){return z("Point",{x:o.x+(t.x-o.x)/2,y:o.y+(t.y-o.y)/2,size:o.size+(t.size-o.size)/2,color:o.color})},B("Image",{constructor:function constructor(e){return null==e&&(e={}),this.x=e.x||0,this.y=e.y||0,this.scale=e.scale||1,this.image=e.image||null},getBoundingRect:function getBoundingRect(){return{x:this.x,y:this.y,width:this.image.width*this.scale,height:this.image.height*this.scale}},toJSON:function toJSON(){return{x:this.x,y:this.y,imageSrc:this.image.src,imageObject:this.image,scale:this.scale}},fromJSON:function fromJSON(o){var t,a;return t=null,(null!=(a=o.imageObject)?a.width:void 0)?t=o.imageObject:(t=new Image,t.src=o.imageSrc),z("Image",{x:o.x,y:o.y,image:t,scale:o.scale})},move:function move(e){return null==e&&(e={}),this.x=this.x-e.xDiff,this.y=this.y-e.yDiff},setUpperLeft:function setUpperLeft(e){return null==e&&(e={}),this.x=e.x,this.y=e.y}}),B("Rectangle",{constructor:function constructor(e){return null==e&&(e={}),this.x=e.x||0,this.y=e.y||0,this.width=e.width||0,this.height=e.height||0,this.strokeWidth=e.strokeWidth||1,this.strokeColor=e.strokeColor||"black",this.fillColor=e.fillColor||"transparent"},getBoundingRect:function getBoundingRect(){return{x:this.x-this.strokeWidth/2,y:this.y-this.strokeWidth/2,width:this.width+this.strokeWidth,height:this.height+this.strokeWidth}},toJSON:function toJSON(){return{x:this.x,y:this.y,width:this.width,height:this.height,strokeWidth:this.strokeWidth,strokeColor:this.strokeColor,fillColor:this.fillColor}},fromJSON:function fromJSON(e){return z("Rectangle",e)},move:function move(e){return null==e&&(e={}),this.x=this.x-e.xDiff,this.y=this.y-e.yDiff},setUpperLeft:function setUpperLeft(e){return null==e&&(e={}),this.x=e.x,this.y=e.y}}),B("Ellipse",{constructor:function constructor(e){return null==e&&(e={}),this.x=e.x||0,this.y=e.y||0,this.width=e.width||0,this.height=e.height||0,this.strokeWidth=e.strokeWidth||1,this.strokeColor=e.strokeColor||"black",this.fillColor=e.fillColor||"transparent"},getBoundingRect:function getBoundingRect(){return{x:this.x-this.strokeWidth/2,y:this.y-this.strokeWidth/2,width:this.width+this.strokeWidth,height:this.height+this.strokeWidth}},toJSON:function toJSON(){return{x:this.x,y:this.y,width:this.width,height:this.height,strokeWidth:this.strokeWidth,strokeColor:this.strokeColor,fillColor:this.fillColor}},fromJSON:function fromJSON(e){return z("Ellipse",e)},move:function move(e){return null==e&&(e={}),this.x=this.x-e.xDiff,this.y=this.y-e.yDiff},setUpperLeft:function setUpperLeft(e){return null==e&&(e={}),this.x=e.x,this.y=e.y}}),B("Line",{constructor:function constructor(e){return null==e&&(e={}),this.x1=e.x1||0,this.y1=e.y1||0,this.x2=e.x2||0,this.y2=e.y2||0,this.strokeWidth=e.strokeWidth||1,this.color=e.color||"black",this.capStyle=e.capStyle||"round",this.endCapShapes=e.endCapShapes||[null,null],this.dash=e.dash||null},getBoundingRect:function getBoundingRect(){return{x:Math.min(this.x1,this.x2)-this.strokeWidth/2,y:Math.min(this.y1,this.y2)-this.strokeWidth/2,width:Math.abs(this.x2-this.x1)+this.strokeWidth/2,height:Math.abs(this.y2-this.y1)+this.strokeWidth/2}},toJSON:function toJSON(){return{x1:this.x1,y1:this.y1,x2:this.x2,y2:this.y2,strokeWidth:this.strokeWidth,color:this.color,capStyle:this.capStyle,dash:this.dash,endCapShapes:this.endCapShapes}},fromJSON:function fromJSON(e){return z("Line",e)},move:function move(e){return null==e&&(e={}),this.x1=this.x1-e.xDiff,this.y1=this.y1-e.yDiff,this.x2=this.x2-e.xDiff,this.y2=this.y2-e.yDiff},setUpperLeft:function setUpperLeft(o){var a,r,s;return null==o&&(o={}),a=this.getBoundingRect(),r=a.x-o.x,s=a.y-o.y,this.move({xDiff:r,yDiff:s})}}),_=function(a){var t,s,l,p,d;if(!a.length)return!1;for(d=a[0].size,t=a[0].color,p=0,s=a.length;s>p;p++){if(l=a[p],l.size===d&&l.color===t||console.log(d,t,l.size,l.color),l.size!==d||l.color!==t)return!1}return!0},R=function(i,l){var e,t,p,d,c;return t=null,l.points?t=function(){var a,n,i,p;for(i=l.points,p=[],n=0,a=i.length;a>n;n++){e=i[n],p.push(u(e))}return p}():l.pointCoordinatePairs&&(t=function(){var e,a,i,s,p;for(i=l.pointCoordinatePairs,p=[],a=0,e=i.length;e>a;a++){s=i[a],d=s[0],c=s[1],p.push(u({className:"Point",data:{x:d,y:c,size:l.pointSize,color:l.pointColor,smooth:l.smooth}}))}return p}()),p=null,l.smoothedPointCoordinatePairs&&(p=function(){var e,a,i,s,p;for(i=l.smoothedPointCoordinatePairs,p=[],a=0,e=i.length;e>a;a++){s=i[a],d=s[0],c=s[1],p.push(u({className:"Point",data:{x:d,y:c,size:l.pointSize,color:l.pointColor,smooth:l.smooth}}))}return p}()),t[0]?z(i,{points:t,smoothedPoints:p,order:l.order,tailSize:l.tailSize,smooth:l.smooth}):null},D={constructor:function constructor(a){var s,l,p,d,c;if(null==a&&(a={}),p=a.points||[],this.order=a.order||3,this.tailSize=a.tailSize||3,this.smooth="smooth"in a?a.smooth:!0,this.segmentSize=Math.pow(2,this.order),this.sampleSize=this.tailSize+1,a.smoothedPoints)return this.points=a.points,this.smoothedPoints=a.smoothedPoints;for(this.points=[],c=[],d=0,s=p.length;s>d;d++){l=p[d],c.push(this.addPoint(l))}return c},getBoundingRect:function getBoundingRect(){return J.getBoundingRect(this.points.map(function(e){return{x:e.x-e.size/2,y:e.y-e.size/2,width:e.size,height:e.size}}))},toJSON:function toJSON(){var o,a;return _(this.points)?{order:this.order,tailSize:this.tailSize,smooth:this.smooth,pointCoordinatePairs:function(){var e,o,s,l;for(s=this.points,l=[],o=0,e=s.length;e>o;o++){a=s[o],l.push([a.x,a.y])}return l}.call(this),smoothedPointCoordinatePairs:function(){var e,o,s,l;for(s=this.smoothedPoints,l=[],o=0,e=s.length;e>o;o++){a=s[o],l.push([a.x,a.y])}return l}.call(this),pointSize:this.points[0].size,pointColor:this.points[0].color}:{order:this.order,tailSize:this.tailSize,smooth:this.smooth,points:function(){var t,a,s,l;for(s=this.points,l=[],a=0,t=s.length;t>a;a++){o=s[a],l.push(G(o))}return l}.call(this)}},fromJSON:function fromJSON(e){return R("LinePath",e)},addPoint:function addPoint(e){return this.points.push(e),this.smooth?!this.smoothedPoints||this.points.length<this.sampleSize?this.smoothedPoints=L(this.points,this.order):(this.tail=J.last(L(J.last(this.points,this.sampleSize),this.order),this.segmentSize*this.tailSize),this.smoothedPoints=this.smoothedPoints.slice(0,this.smoothedPoints.length-this.segmentSize*(this.tailSize-1)).concat(this.tail)):void(this.smoothedPoints=this.points)},move:function move(o){var a,s,l,p;for(null==o&&(o={}),l=this.smooth?this.smoothedPoints:this.points,p=0,a=l.length;a>p;p++){s=l[p],s.move(o)}return this.points=this.smoothedPoints},setUpperLeft:function setUpperLeft(o){var a,r,s;return null==o&&(o={}),a=this.getBoundingRect(),r=a.x-o.x,s=a.y-o.y,this.move({xDiff:r,yDiff:s})}},e=B("LinePath",D),B("ErasedLinePath",{constructor:D.constructor,toJSON:D.toJSON,addPoint:D.addPoint,getBoundingRect:D.getBoundingRect,fromJSON:function fromJSON(e){return R("ErasedLinePath",e)}}),B("Point",{constructor:function constructor(e){return null==e&&(e={}),this.x=e.x||0,this.y=e.y||0,this.size=e.size||0,this.color=e.color||""},getBoundingRect:function getBoundingRect(){return{x:this.x-this.size/2,y:this.y-this.size/2,width:this.size,height:this.size}},toJSON:function toJSON(){return{x:this.x,y:this.y,size:this.size,color:this.color}},fromJSON:function fromJSON(e){return z("Point",e)},move:function move(e){return null==e&&(e={}),this.x=this.x-e.xDiff,this.y=this.y-e.yDiff},setUpperLeft:function setUpperLeft(e){return null==e&&(e={}),this.x=e.x,this.y=e.y}}),B("Polygon",{constructor:function constructor(a){var s,l,p,d,c;for(null==a&&(a={}),this.points=a.points,this.fillColor=a.fillColor||"white",this.strokeColor=a.strokeColor||"black",this.strokeWidth=a.strokeWidth,this.dash=a.dash||null,null==a.isClosed&&(a.isClosed=!0),this.isClosed=a.isClosed,d=this.points,c=[],p=0,s=d.length;s>p;p++){l=d[p],l.color=this.strokeColor,c.push(l.size=this.strokeWidth)}return c},addPoint:function addPoint(o,t){return this.points.push(LC.createShape("Point",{x:o,y:t}))},getBoundingRect:function getBoundingRect(){return J.getBoundingRect(this.points.map(function(e){return e.getBoundingRect()}))},toJSON:function toJSON(){return{strokeWidth:this.strokeWidth,fillColor:this.fillColor,strokeColor:this.strokeColor,dash:this.dash,isClosed:this.isClosed,pointCoordinatePairs:this.points.map(function(e){return[e.x,e.y]})}},fromJSON:function fromJSON(o){return o.points=o.pointCoordinatePairs.map(function(t){var e,a;return e=t[0],a=t[1],z("Point",{x:e,y:a,size:o.strokeWidth,color:o.strokeColor})}),z("Polygon",o)},move:function move(a){var s,l,p,d,c;for(null==a&&(a={}),d=this.points,c=[],p=0,s=d.length;s>p;p++){l=d[p],c.push(l.move(a))}return c},setUpperLeft:function setUpperLeft(o){var a,r,s;return null==o&&(o={}),a=this.getBoundingRect(),r=a.x-o.x,s=a.y-o.y,this.move({xDiff:r,yDiff:s})}}),B("Text",{constructor:function constructor(e){return null==e&&(e={}),this.x=e.x||0,this.y=e.y||0,this.v=e.v||0,this.text=e.text||"",this.color=e.color||"black",this.font=e.font||"18px sans-serif",this.forcedWidth=e.forcedWidth||null,this.forcedHeight=e.forcedHeight||null},_makeRenderer:function _makeRenderer(e){return e.lineHeight=1.2,this.renderer=new P(e,this.text,this.font,this.forcedWidth,this.forcedHeight),1>this.v?(console.log("repairing baseline"),this.v=1,this.x-=this.renderer.metrics.bounds.minx,this.y-=this.renderer.metrics.leading-this.renderer.metrics.descent):void 0},setText:function setText(e){return this.text=e,this.renderer=null},setFont:function setFont(e){return this.font=e,this.renderer=null},setPosition:function setPosition(o,t){return this.x=o,this.y=t},setSize:function setSize(o,t){return this.forcedWidth=Math.max(o,0),this.forcedHeight=Math.max(t,0),this.renderer=null},enforceMaxBoundingRect:function enforceMaxBoundingRect(o){var t,a,r;return t=this.getBoundingRect(o.ctx),r={x:-o.position.x/o.scale,y:-o.position.y/o.scale,width:o.canvas.width/o.scale,height:o.canvas.height/o.scale},t.x+t.width>r.x+r.width?(a=t.x-r.x,this.forcedWidth=r.width-a-10,this.renderer=null):void 0},getBoundingRect:function getBoundingRect(o,t){if(null==t&&(t=!1),!this.renderer){if(!o)throw"Must pass ctx if text hasn't been rendered yet";this._makeRenderer(o)}return{x:Math.floor(this.x),y:Math.floor(this.y),width:Math.ceil(this.renderer.getWidth(!0)),height:Math.ceil(this.renderer.getHeight())}},toJSON:function toJSON(){return{x:this.x,y:this.y,text:this.text,color:this.color,font:this.font,forcedWidth:this.forcedWidth,forcedHeight:this.forcedHeight,v:this.v}},fromJSON:function fromJSON(e){return z("Text",e)},move:function move(e){return null==e&&(e={}),this.x=this.x-e.xDiff,this.y=this.y-e.yDiff},setUpperLeft:function setUpperLeft(e){return null==e&&(e={}),this.x=e.x,this.y=e.y}}),B("SelectionBox",{constructor:function constructor(e){return null==e&&(e={}),this.shape=e.shape,null!=e.handleSize?this.handleSize=e.handleSize:this.handleSize=10,this.margin=4,this.backgroundColor=e.backgroundColor||null,this._br=this.shape.getBoundingRect(e.ctx)},toJSON:function toJSON(){return{shape:G(this.shape),backgroundColor:this.backgroundColor}},fromJSON:function fromJSON(a){var t,i,s,l;return l=a.shape,i=a.handleSize,s=a.margin,t=a.backgroundColor,z("SelectionBox",{shape:u(l),backgroundColor:t})},getTopLeftHandleRect:function getTopLeftHandleRect(){return{x:this._br.x-this.handleSize-this.margin,y:this._br.y-this.handleSize-this.margin,width:this.handleSize,height:this.handleSize}},getBottomLeftHandleRect:function getBottomLeftHandleRect(){return{x:this._br.x-this.handleSize-this.margin,y:this._br.y+this._br.height+this.margin,width:this.handleSize,height:this.handleSize}},getTopRightHandleRect:function getTopRightHandleRect(){return{x:this._br.x+this._br.width+this.margin,y:this._br.y-this.handleSize-this.margin,width:this.handleSize,height:this.handleSize}},getBottomRightHandleRect:function getBottomRightHandleRect(){return{x:this._br.x+this._br.width+this.margin,y:this._br.y+this._br.height+this.margin,width:this.handleSize,height:this.handleSize}},getBoundingRect:function getBoundingRect(){return{x:this._br.x-this.margin,y:this._br.y-this.margin,width:this._br.width+2*this.margin,height:this._br.height+2*this.margin}}}),t.exports={defineShape:B,createShape:z,JSONToShape:u,shapeToJSON:G}},{"./TextRenderer":6,"./canvasRenderer":9,"./lineEndCapShapes":12,"./svgRenderer":18,"./util":19}],18:[function(a,t){var e,l,n,p;l=a("./lineEndCapShapes"),p={},e=function(o,t){return p[o]=t},n=function(o,t){if(null==t&&(t={}),null==t.shouldIgnoreUnsupportedShapes&&(t.shouldIgnoreUnsupportedShapes=!1),p[o.className])return p[o.className](o);if(t.shouldIgnoreUnsupportedShapes)return console.warn("Can't render shape of type "+o.className+" to SVG"),"";throw"Can't render shape of type "+o.className+" to SVG"},e("Rectangle",function(l){var t,p,d,c,g,u,m,y;return c=l.x,m=l.y,g=l.x+l.width,y=l.y+l.height,d=Math.min(c,g),u=Math.min(m,y),p=Math.max(c,g)-d,t=Math.max(m,y)-u,0!=l.strokeWidth%2&&(d+=.5,u+=.5),"<rect x='"+d+"' y='"+u+"' width='"+p+"' height='"+t+"' stroke='"+l.strokeColor+"' fill='"+l.fillColor+"' stroke-width='"+l.strokeWidth+"' />"}),e("SelectionBox",function(){return""}),e("Ellipse",function(o){var t,a,s,l;return l=Math.floor(o.width/2),s=Math.floor(o.height/2),t=o.x+l,a=o.y+s,"<ellipse cx='"+t+"' cy='"+a+"' rx='"+Math.abs(l)+"' ry='"+Math.abs(s)+"' stroke='"+o.strokeColor+"' fill='"+o.fillColor+"' stroke-width='"+o.strokeWidth+"' />"}),e("Image",function(e){return"<image x='"+e.x+"' y='"+e.y+"' width='"+e.image.naturalWidth*e.scale+"' height='"+e.image.naturalHeight*e.scale+"' xlink:href='"+e.image.src+"' />"}),e("Line",function(r){var t,p,d,c,g,u,m;return d=r.dash?"stroke-dasharray='"+r.dash.join(", ")+"'":"",p="",t=Math.max(2.2*r.strokeWidth,5),c=r.x1,g=r.x2,u=r.y1,m=r.y2,0!=r.strokeWidth%2&&(c+=.5,g+=.5,u+=.5,m+=.5),r.endCapShapes[0]&&(p+=l[r.endCapShapes[0]].svg(c,u,Math.atan2(u-m,c-g),t,r.color)),r.endCapShapes[1]&&(p+=l[r.endCapShapes[1]].svg(g,m,Math.atan2(m-u,g-c),t,r.color)),"<g> <line x1='"+c+"' y1='"+u+"' x2='"+g+"' y2='"+m+"' "+d+" stroke-linecap='"+r.capStyle+"' stroke='"+r.color+" 'stroke-width='"+r.strokeWidth+"' /> "+p+" </g>"}),e("LinePath",function(e){return"<polyline fill='none' points='"+e.smoothedPoints.map(function(o){var t;return t=0==o.strokeWidth%2?0:.5,o.x+t+","+(o.y+t)}).join(" ")+"' stroke='"+e.points[0].color+"' stroke-linecap='round' stroke-width='"+e.points[0].size+"' />"}),e("ErasedLinePath",function(){return""}),e("Polygon",function(e){return e.isClosed?"<polygon fill='"+e.fillColor+"' points='"+e.points.map(function(o){var t;return t=0==o.strokeWidth%2?0:.5,o.x+t+","+(o.y+t)}).join(" ")+"' stroke='"+e.strokeColor+"' stroke-width='"+e.strokeWidth+"' />":"<polyline fill='"+e.fillColor+"' points='"+e.points.map(function(o){var t;return t=0==o.strokeWidth%2?0:.5,o.x+t+","+(o.y+t)}).join(" ")+"' stroke='none' /> <polyline fill='none' points='"+e.points.map(function(o){var t;return t=0==o.strokeWidth%2?0:.5,o.x+t+","+(o.y+t)}).join(" ")+"' stroke='"+e.strokeColor+"' stroke-width='"+e.strokeWidth+"' />"}),e("Text",function(o){var t,a,r;return r=o.forcedWidth?"width='"+o.forcedWidth+"px'":"",t=o.forcedHeight?"height='"+o.forcedHeight+"px'":"",a=o.text.split(/\r\n|\r|\n/g),o.renderer&&(a=o.renderer.lines),"<text x='"+o.x+"' y='"+o.y+"' "+r+" "+t+" fill='"+o.color+"' style='font: "+o.font+";'> "+a.map(function(){return function(t,e){var a;return a=0===e?0:"1.2em","<tspan x='"+o.x+"' dy='"+a+"' alignment-baseline='text-before-edge'> "+t+" </tspan>"}}(this)).join("")+" </text>"}),t.exports={defineSVGRenderer:e,renderShapeToSVG:n}},{"./lineEndCapShapes":12}],19:[function(n,t){var e,l,p,d,c,h=[].slice;d=Array.prototype.slice,l=n("./canvasRenderer").renderShapeToContext,p=n("./svgRenderer").renderShapeToSVG,c=(e={addImageOnload:function addImageOnload(o,t){var e;return e=o.onload,o.onload=function(){return"function"==typeof e&&e(),t()},o},last:function last(o,t){return null==t&&(t=null),t?d.call(o,Math.max(o.length-t,0)):o[o.length-1]},classSet:function classSet(o){var t,a;t=[];for(a in o){o[a]&&t.push(a)}return t.join(" ")},matchElementSize:function matchElementSize(a,t,e,n){var o;return null==n&&(n=function(){}),o=function(){return function(){var i,l,p;for(l=0,p=t.length;p>l;l++){i=t[l],i.style.width=a.offsetWidth+"px",i.style.height=a.offsetHeight+"px",null!=i.width&&(i.setAttribute("width",i.offsetWidth*e),i.setAttribute("height",i.offsetHeight*e))}return n()}}(this),a.addEventListener("resize",o),window.addEventListener("resize",o),window.addEventListener("orientationchange",o),o(),o},combineCanvases:function combineCanvases(){var a,l,p,d,c,g,u,m;for(p=1<=arguments.length?h.call(arguments,0):[],a=document.createElement("canvas"),a.width=p[0].width,a.height=p[0].height,c=0,u=p.length;u>c;c++){l=p[c],a.width=Math.max(l.width,a.width),a.height=Math.max(l.height,a.height)}for(d=a.getContext("2d"),g=0,m=p.length;m>g;g++){l=p[g],d.drawImage(l,0,0)}return a},renderShapes:function renderShapes(i,t,e,p){var d,c,g,u;for(null==e&&(e=1),null==p&&(p=null),p=p||document.createElement("canvas"),p.width=t.width*e,p.height=t.height*e,d=p.getContext("2d"),d.translate(-t.x*e,-t.y*e),d.scale(e,e),c=0,g=i.length;g>c;c++){u=i[c],l(d,u)}return p},renderShapesToSVG:function renderShapesToSVG(r,t,e){var n,l,d,c;return d=t.x,c=t.y,l=t.width,n=t.height,("<svg xmlns='http://www.w3.org/2000/svg' width='"+l+"' height='"+n+"' viewBox='0 0 "+l+" "+n+"'> <rect width='"+l+"' height='"+n+"' x='0' y='0' fill='"+e+"' /> <g transform='translate("+-d+", "+-c+")'> "+r.map(p).join("")+" </g> </svg>").replace(/(\r\n|\n|\r)/gm,"")},getBoundingRect:function getBoundingRect(p,t,e){var n,d,c,g,u,m,y;if(!p.length)return{x:0,y:0,width:t,height:e};for(u=p[0].x,m=p[0].y,c=p[0].x+p[0].width,g=p[0].y+p[0].height,n=0,d=p.length;d>n;n++){y=p[n],u=Math.floor(Math.min(y.x,u)),m=Math.floor(Math.min(y.y,m)),c=Math.ceil(Math.max(c,y.x+y.width)),g=Math.ceil(Math.max(g,y.y+y.height))}return u=t?0:u,m=e?0:m,c=t||c,g=e||g,{x:u,y:m,width:c-u,height:g-m}},getDefaultImageRect:function getDefaultImageRect(a,t,s){var l,p,d;return null==t&&(t={width:0,height:0}),null==s&&(s={top:0,right:0,bottom:0,left:0}),d=t.width,l=t.height,p=c.getBoundingRect(a,"infinite"===d?0:d,"infinite"===l?0:l),p.x-=s.left,p.y-=s.top,p.width+=s.left+s.right,p.height+=s.top+s.bottom,p},getBackingScale:function getBackingScale(){return null==window.devicePixelRatio?1:1<window.devicePixelRatio?window.devicePixelRatio:1},requestAnimationFrame:(window.requestAnimationFrame||window.setTimeout).bind(window),getGUID:function(){var e;return e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},function(){return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}}()},_defineProperty(e,"requestAnimationFrame",function requestAnimationFrame(e){return window.requestAnimationFrame?window.requestAnimationFrame(e):window.webkitRequestAnimationFrame?window.webkitRequestAnimationFrame(e):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(e):setTimeout(e,0)}),_defineProperty(e,"cancelAnimationFrame",function cancelAnimationFrame(e){return window.cancelAnimationFrame?window.cancelAnimationFrame(e):window.webkitCancelRequestAnimationFrame?window.webkitCancelRequestAnimationFrame(e):window.webkitCancelAnimationFrame?window.webkitCancelAnimationFrame(e):window.mozCancelAnimationFrame?window.mozCancelAnimationFrame(e):clearTimeout(e)}),e),t.exports=c},{"./canvasRenderer":9,"./svgRenderer":18}],20:[function(){"use strict";!function(){function e(o,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var a=document.createEvent("CustomEvent");return a.initCustomEvent(o,t.bubbles,t.cancelable,t.detail),a}e.prototype=window.CustomEvent.prototype,window.CustomEvent=e}()},{}],21:[function(o,t){"use strict";var e=!1;CanvasRenderingContext2D.prototype.setLineDash||(CanvasRenderingContext2D.prototype.setLineDash=function(){e||(console.warn("context2D.setLineDash is a no-op in this browser."),e=!0)}),t.exports=null},{}],22:[function(C,t){var P,e,n,R,_,E,I,T,L,z,O,N,B,W,D,U,A,M,F,G,H;C("./ie_customevent"),C("./ie_setLineDash"),P=C("./core/LiterallyCanvas"),I=C("./core/defaultOptions"),R=C("./core/canvasRenderer"),F=C("./core/svgRenderer"),M=C("./core/shapes"),H=C("./core/util"),D=C("./core/renderSnapshotToImage"),U=C("./core/renderSnapshotToSVG"),B=C("./core/localization").localize,e=C("./reactGUI/LiterallyCanvas"),O=C("./reactGUI/initDOM"),C("./optionsStyles/font"),C("./optionsStyles/stroke-width"),C("./optionsStyles/line-options-and-stroke-width"),C("./optionsStyles/polygon-and-stroke-width"),C("./optionsStyles/stroke-or-fill"),C("./optionsStyles/null"),L=C("./optionsStyles/optionsStyles").defineOptionsStyle,_={snapshotToShapes:function snapshotToShapes(a){var t,s,l,p,d;for(l=a.shapes,p=[],t=0,s=l.length;s>t;t++){d=l[t],p.push(M.JSONToShape(d))}return p},snapshotJSONToShapes:function snapshotJSONToShapes(e){return _.snapshotToShapes(JSON.parse(e))}},n=C("./tools/base"),G={Pencil:C("./tools/Pencil"),Eraser:C("./tools/Eraser"),Line:C("./tools/Line"),Rectangle:C("./tools/Rectangle"),Ellipse:C("./tools/Ellipse"),Text:C("./tools/Text"),Polygon:C("./tools/Polygon"),Pan:C("./tools/Pan"),Eyedropper:C("./tools/Eyedropper"),SelectShape:C("./tools/SelectShape"),Tool:n.Tool,ToolWithStroke:n.ToolWithStroke},T=I.tools,E=I.imageURLPrefix,A=function(e){return E=e,I.imageURLPrefix=e},z=function(t,e){var l,p,d,c,h;null==e&&(e={});for(c in I){c in e||(e[c]=I[c])}for(h=t.children,p=0,d=h.length;d>p;p++){l=h[p],t.removeChild(l)}return C("./reactGUI/initDOM")(t,e)},N=function(a,t){var e,l,p;return p=a.className,-1===[" "," "].join(a.className).indexOf(" literally ")&&(a.className=a.className+" literally"),a.className=a.className+" toolbar-hidden",e=document.createElement("div"),e.className="lc-drawing",a.appendChild(e),l=new P(e,t),l.teardown=function(){var t,o,r,d;for(l._teardown(),d=a.children,o=0,r=d.length;r>o;o++){t=d[o],a.removeChild(t)}return a.className=p},"onInit"in t&&t.onInit(l),l},W=function(e){return e.fn.literallycanvas=function(o){return null==o&&(o={}),this.each(function(){return function(t,e){return e.literallycanvas=z(e,o)}}(this)),this}},"undefined"!=typeof window&&(window.LC={init:z},window.$&&W(window.$)),t.exports={init:z,registerJQueryPlugin:W,util:H,tools:G,setDefaultImageURLPrefix:A,defaultTools:T,defineOptionsStyle:L,LiterallyCanvasReactComponent:e,defineShape:M.defineShape,createShape:M.createShape,JSONToShape:M.JSONToShape,shapeToJSON:M.shapeToJSON,defineCanvasRenderer:R.defineCanvasRenderer,renderShapeToContext:R.renderShapeToContext,renderShapeToCanvas:R.renderShapeToCanvas,renderShapesToCanvas:H.renderShapes,defineSVGRenderer:F.defineSVGRenderer,renderShapeToSVG:F.renderShapeToSVG,renderShapesToSVG:H.renderShapesToSVG,snapshotToShapes:_.snapshotToShapes,snapshotJSONToShapes:_.snapshotJSONToShapes,renderSnapshotToImage:D,renderSnapshotToSVG:U,localize:B}},{"./core/LiterallyCanvas":5,"./core/canvasRenderer":9,"./core/defaultOptions":10,"./core/localization":13,"./core/renderSnapshotToImage":15,"./core/renderSnapshotToSVG":16,"./core/shapes":17,"./core/svgRenderer":18,"./core/util":19,"./ie_customevent":20,"./ie_setLineDash":21,"./optionsStyles/font":23,"./optionsStyles/line-options-and-stroke-width":24,"./optionsStyles/null":25,"./optionsStyles/optionsStyles":26,"./optionsStyles/polygon-and-stroke-width":27,"./optionsStyles/stroke-or-fill":28,"./optionsStyles/stroke-width":29,"./reactGUI/LiterallyCanvas":32,"./reactGUI/initDOM":42,"./tools/Ellipse":43,"./tools/Eraser":44,"./tools/Eyedropper":45,"./tools/Line":46,"./tools/Pan":47,"./tools/Pencil":48,"./tools/Polygon":49,"./tools/Rectangle":50,"./tools/SelectShape":51,"./tools/Text":52,"./tools/base":53}],23:[function(n,t){var R,_,e,E,I,T,L,z,O,N,B,W,D,U,A,M,F,G,H,J,V,q,j;for(I=n("../reactGUI/React-shim"),O=n("./optionsStyles").defineOptionsStyle,z=n("../core/localization")._,T=[["Arial","Arial,\"Helvetica Neue\",Helvetica,sans-serif"],["Arial Black","\"Arial Black\",\"Arial Bold\",Gadget,sans-serif"],["Arial Narrow","\"Arial Narrow\",Arial,sans-serif"],["Gill Sans","\"Gill Sans\",\"Gill Sans MT\",Calibri,sans-serif"],["Helvetica","\"Helvetica Neue\",Helvetica,Arial,sans-serif"],["Impact","Impact,Haettenschweiler,\"Franklin Gothic Bold\",Charcoal,\"Helvetica Inserat\",\"Bitstream Vera Sans Bold\",\"Arial Black\",sans-serif"],["Tahoma","Tahoma,Verdana,Segoe,sans-serif"],["Trebuchet MS","\"Trebuchet MS\",\"Lucida Grande\",\"Lucida Sans Unicode\",\"Lucida Sans\",Tahoma,sans-serif"],["Verdana","Verdana,Geneva,sans-serif"]].map(function(o){var t,a;return t=o[0],a=o[1],{name:z(t),value:a}}),L=[["Baskerville","Baskerville,\"Baskerville Old Face\",\"Hoefler Text\",Garamond,\"Times New Roman\",serif"],["Garamond","Garamond,Baskerville,\"Baskerville Old Face\",\"Hoefler Text\",\"Times New Roman\",serif"],["Georgia","Georgia,Times,\"Times New Roman\",serif"],["Hoefler Text","\"Hoefler Text\",\"Baskerville Old Face\",Garamond,\"Times New Roman\",serif"],["Lucida Bright","\"Lucida Bright\",Georgia,serif"],["Palatino","Palatino,\"Palatino Linotype\",\"Palatino LT STD\",\"Book Antiqua\",Georgia,serif"],["Times New Roman","TimesNewRoman,\"Times New Roman\",Times,Baskerville,Georgia,serif"]].map(function(o){var t,a;return t=o[0],a=o[1],{name:z(t),value:a}}),e=[["Consolas/Monaco","Consolas,monaco,\"Lucida Console\",monospace"],["Courier New","\"Courier New\",Courier,\"Lucida Sans Typewriter\",\"Lucida Typewriter\",monospace"],["Lucida Sans Typewriter","\"Lucida Sans Typewriter\",\"Lucida Console\",monaco,\"Bitstream Vera Sans Mono\",monospace"]].map(function(o){var t,a;return t=o[0],a=o[1],{name:z(t),value:a}}),E=[["Copperplate","Copperplate,\"Copperplate Gothic Light\",fantasy"],["Papyrus","Papyrus,fantasy"],["Script","\"Brush Script MT\",cursive"]].map(function(o){var t,a;return t=o[0],a=o[1],{name:z(t),value:a}}),R=[[z("Sans Serif"),T],[z("Serif"),L],[z("Monospace"),e],[z("Other"),E]],_={},N=0,D=T.length;D>N;N++){H=T[N],G=H.name,j=H.value,_[G]=j}for(B=0,U=L.length;U>B;B++){J=L[B],G=J.name,j=J.value,_[G]=j}for(W=0,A=e.length;A>W;W++){V=e[W],G=V.name,j=V.value,_[G]=j}for(F=0,M=E.length;M>F;F++){q=E[F],G=q.name,j=q.value,_[G]=j}O("font",I.createClass({displayName:"FontOptions",getInitialState:function getInitialState(){return{isItalic:!1,isBold:!1,fontName:"Helvetica",fontSizeIndex:4}},getFontSizes:function getFontSizes(){return[9,10,12,14,18,24,36,48,64,72,96,144,288]},updateTool:function updateTool(o){var a,r,s;null==o&&(o={});for(s in this.state){s in o||(o[s]=this.state[s])}return a=this.getFontSizes()[o.fontSizeIndex],r=[],o.isItalic&&r.push("italic"),o.isBold&&r.push("bold"),r.push(a+"px"),r.push(_[o.fontName]),this.props.lc.tool.font=r.join(" "),this.props.lc.trigger("setFont",r.join(" "))},handleFontSize:function handleFontSize(o){var t;return t={fontSizeIndex:o.target.value},this.setState(t),this.updateTool(t)},handleFontFamily:function handleFontFamily(o){var t;return t={fontName:o.target.selectedOptions[0].innerHTML},this.setState(t),this.updateTool(t)},handleItalic:function handleItalic(){var t;return t={isItalic:!this.state.isItalic},this.setState(t),this.updateTool(t)},handleBold:function handleBold(){var t;return t={isBold:!this.state.isBold},this.setState(t),this.updateTool(t)},componentDidMount:function componentDidMount(){return this.updateTool()},render:function render(){var a,i,d,c,g,m,y,S,f,x;return g=this.props.lc,S=I.DOM,i=S.div,d=S.input,f=S.select,y=S.option,a=S.br,c=S.label,x=S.span,m=S.optgroup,i({className:"lc-font-settings"},f({value:this.state.fontSizeIndex,onChange:this.handleFontSize},this.getFontSizes().map(function(){return function(o,t){return y({value:t,key:t},o+"px")}}(this))),f({value:this.state.fontName,onChange:this.handleFontFamily},R.map(function(){return function(o){var t,a;return a=o[0],t=o[1],m({key:a,label:a},t.map(function(o,t){return y({value:o.name,key:t},o.name)}))}}(this))),x({},c({htmlFor:"italic"},z("italic")),d({type:"checkbox",id:"italic",checked:this.state.isItalic,onChange:this.handleItalic})),x({},c({htmlFor:"bold"},z("bold")),d({type:"checkbox",id:"bold",checked:this.state.isBold,onChange:this.handleBold})))}})),t.exports={}},{"../core/localization":13,"../reactGUI/React-shim":35,"./optionsStyles":26}],24:[function(n,t){var d,g,m,e,l;d=n("../reactGUI/React-shim"),l=n("./optionsStyles").defineOptionsStyle,g=d.createFactory(n("../reactGUI/StrokeWidthPicker")),e=n("../reactGUI/createSetStateOnEventMixin"),m=n("../core/util").classSet,l("line-options-and-stroke-width",d.createClass({displayName:"LineOptionsAndStrokeWidth",getState:function getState(){return{strokeWidth:this.props.tool.strokeWidth,isDashed:this.props.tool.isDashed,hasEndArrow:this.props.tool.hasEndArrow}},getInitialState:function getInitialState(){return this.getState()},mixins:[e("toolChange")],render:function render(){var o,r,i,y,S,f,x,k,b,C;return f=d.DOM,i=f.div,C=f.ul,S=f.li,y=f.img,k=function(e){return function(){return e.props.tool.isDashed=!e.props.tool.isDashed,e.setState(e.getState())}}(this),b=function(e){return function(){return e.props.tool.hasEndArrow=!e.props.tool.hasEndArrow,e.setState(e.getState())}}(this),r=m({"square-toolbar-button":!0,selected:this.state.isDashed}),o=m({"square-toolbar-button":!0,selected:this.state.hasEndArrow}),x={float:"left",margin:1},i({},i({className:r,onClick:k,style:x},y({src:this.props.imageURLPrefix+"/dashed-line.png"})),i({className:o,onClick:b,style:x},y({src:this.props.imageURLPrefix+"/line-with-arrow.png"})),g({tool:this.props.tool,lc:this.props.lc}))}})),t.exports={}},{"../core/util":19,"../reactGUI/React-shim":35,"../reactGUI/StrokeWidthPicker":37,"../reactGUI/createSetStateOnEventMixin":40,"./optionsStyles":26}],25:[function(o,t){var e,a;e=o("../reactGUI/React-shim"),a=o("./optionsStyles").defineOptionsStyle,a("null",e.createClass({displayName:"NoOptions",render:function render(){return e.DOM.div()}})),t.exports={}},{"../reactGUI/React-shim":35,"./optionsStyles":26}],26:[function(a,t){var n,e,s;n=a("../reactGUI/React-shim"),s={},e=function(o,t){return s[o]=n.createFactory(t)},t.exports={optionsStyles:s,defineOptionsStyle:e}},{"../reactGUI/React-shim":35}],27:[function(a,t){var p,d,e,n;p=a("../reactGUI/React-shim"),n=a("./optionsStyles").defineOptionsStyle,d=p.createFactory(a("../reactGUI/StrokeWidthPicker")),e=a("../reactGUI/createSetStateOnEventMixin"),n("polygon-and-stroke-width",p.createClass({displayName:"PolygonAndStrokeWidth",getState:function getState(){return{strokeWidth:this.props.tool.strokeWidth,inProgress:!1}},getInitialState:function getInitialState(){return this.getState()},mixins:[e("toolChange")],componentDidMount:function componentDidMount(){var o,a,s;return s=[],this.unsubscribe=function(){return function(){var o,a,n,l;for(l=[],a=0,n=s.length;n>a;a++){o=s[a],l.push(o())}return l}}(this),a=function(e){return function(){return e.state.inProgress?void 0:e.setState({inProgress:!0})}}(this),o=function(e){return function(){return e.setState({inProgress:!1})}}(this),s.push(this.props.lc.on("lc-polygon-started",a)),s.push(this.props.lc.on("lc-polygon-stopped",o))},componentWillUnmount:function componentWillUnmount(){return this.unsubscribe()},render:function render(){var r,i,c,g,u,m,y,S;return c=this.props.lc,S=p.DOM,r=S.div,i=S.img,m=function(){return function(){return c.trigger("lc-polygon-finishopen")}}(this),u=function(){return function(){return c.trigger("lc-polygon-finishclosed")}}(this),g=function(){return function(){return c.trigger("lc-polygon-cancel")}}(this),y={},this.state.inProgress||(y={display:"none"}),r({},r({className:"polygon-toolbar horz-toolbar",style:y},r({className:"square-toolbar-button",onClick:m},i({src:this.props.imageURLPrefix+"/polygon-open.png"})),r({className:"square-toolbar-button",onClick:u},i({src:this.props.imageURLPrefix+"/polygon-closed.png"})),r({className:"square-toolbar-button",onClick:g},i({src:this.props.imageURLPrefix+"/polygon-cancel.png"}))),r({},d({tool:this.props.tool,lc:this.props.lc})))}})),t.exports={}},{"../reactGUI/React-shim":35,"../reactGUI/StrokeWidthPicker":37,"../reactGUI/createSetStateOnEventMixin":40,"./optionsStyles":26}],28:[function(n,t){"use strict";var e=n("../reactGUI/React-shim"),i=n("./optionsStyles"),r=i.defineOptionsStyle,o=n("../reactGUI/createSetStateOnEventMixin"),s=n("../core/localization")._;r("stroke-or-fill",e.createClass({displayName:"StrokeOrFillPicker",getState:function getState(){return{strokeOrFill:"stroke"}},getInitialState:function getInitialState(){return this.getState()},mixins:[o("toolChange")],onChange:function onChange(e){"stroke-or-fill-stroke"==e.target.id?this.props.lc.tool.strokeOrFill="stroke":this.props.lc.tool.strokeOrFill="fill",this.setState(this.getState())},render:function render(){var o=this.props.lc;return e.createElement("form",null,e.createElement("span",null," ",s("Color to change:")," "),e.createElement("span",null,e.createElement("input",{type:"radio",name:"stroke-or-fill",value:"stroke",id:"stroke-or-fill-stroke",onChange:this.onChange,checked:"stroke"==o.tool.strokeOrFill}),e.createElement("label",{htmlFor:"stroke-or-fill-stroke",className:"label"}," ",s("stroke"))),e.createElement("span",null,e.createElement("input",{type:"radio",name:"stroke-or-fill",value:"fill",id:"stroke-or-fill-fill",onChange:this.onChange,checked:"fill"==o.tool.strokeOrFill}),e.createElement("label",{htmlFor:"stroke-or-fill-fill",className:"label"}," ",s("fill"))))}})),t.exports={}},{"../core/localization":13,"../reactGUI/React-shim":35,"../reactGUI/createSetStateOnEventMixin":40,"./optionsStyles":26}],29:[function(o,t){var e,a;a=o("./optionsStyles").defineOptionsStyle,e=o("../reactGUI/StrokeWidthPicker"),a("stroke-width",e),t.exports={}},{"../reactGUI/StrokeWidthPicker":37,"./optionsStyles":26}],30:[function(n,t){var e,l,p,d,c;l=n("./React-shim"),c=n("./createSetStateOnEventMixin"),p=n("../core/localization")._,d=n("../core/util").classSet,e=l.createClass({displayName:"ClearButton",getState:function getState(){return{isEnabled:this.props.lc.canUndo()}},getInitialState:function getInitialState(){return this.getState()},mixins:[c("drawingChange")],render:function render(){var o,a,r,s;return a=l.DOM.div,r=this.props.lc,o=d({"lc-clear":!0,"toolbar-button":!0,"fat-button":!0,disabled:!this.state.isEnabled}),s=r.canUndo()?function(){return function(){return r.clear()}}(this):function(){},a({className:o,onClick:s},p("Clear"))}}),t.exports=e},{"../core/localization":13,"../core/util":19,"./React-shim":35,"./createSetStateOnEventMixin":40}],31:[function(n,t){var m,e,g,y,S,x,k,b,C,w,v,P;y=n("./React-shim"),g=n("react-addons-pure-render-mixin"),v=n("../core/util"),k=v.classSet,P=v.requestAnimationFrame,x=v.cancelAnimationFrame,S=n("../core/localization")._,w=function(a){var o,s,l,p;return"transparent"===a?{hue:0,sat:0,light:0,alpha:0}:"hsla"!==(null!=a?a.substring(0,4):void 0)?null:(s=a.indexOf("("),p=a.indexOf(")"),l=a.substring(s+1,p-s+4),o=function(){var t,i,s,p;for(s=l.split(","),p=[],t=0,i=s.length;i>t;t++){a=s[t],p.push(a.trim())}return p}(),{hue:parseInt(o[0],10),sat:parseInt(o[1].substring(0,o[1].length-1),10),light:parseInt(o[2].substring(0,o[2].length-1),10),alpha:parseFloat(o[3])})},b=function(o){var t,a,s,l;return a=o.hue,l=o.sat,s=o.light,t=o.alpha,"hsla("+a+", "+l+"%, "+s+"%, "+t+")"},C=function(o){var t,a,r;return t=o.hue,r=o.sat,a=o.light,"hsl("+t+", "+r+"%, "+a+"%)"},m=y.createFactory(y.createClass({displayName:"ColorGrid",mixins:[g],render:function render(){var l;return(l=y.DOM.div)({},this.props.rows.map(function(c){return function(e,t){return l({className:"color-row",key:t,style:{width:20*e.length}},e.map(function(e,t){var n,i,g,m,y,S,f,x;return y=e.hue,f=e.sat,S=e.light,n=e.alpha,g=b(e),m="hsl("+y+", "+f+"%, "+S+"%)",i=k({"color-cell":!0,selected:c.props.selectedColor===g}),x=function(o){return c.props.onChange(e,g),o.stopPropagation(),o.preventDefault()},l({className:i,onTouchStart:x,onTouchMove:x,onClick:x,style:{backgroundColor:m},key:t})}))}}(this)))}})),e=y.createClass({displayName:"ColorWell",mixins:[g],getInitialState:function getInitialState(){var o,a;return o=this.props.lc.colors[this.props.colorName],a=w(o),null==a&&(a={}),null==a.alpha&&(a.alpha=1),null==a.sat&&(a.sat=100),null==a.hue&&(a.hue=0),null==a.light&&(a.light=50),{colorString:o,alpha:a.alpha,sat:0===a.sat?100:a.sat,isPickerVisible:!1,hsla:a}},componentDidMount:function componentDidMount(){return this.unsubscribe=this.props.lc.on(this.props.colorName+"ColorChange",function(o){return function(){var t;return t=o.props.lc.colors[o.props.colorName],o.setState({colorString:t}),o.setHSLAFromColorString(t)}}(this))},componentWillUnmount:function componentWillUnmount(){return this.unsubscribe()},setHSLAFromColorString:function setHSLAFromColorString(o){var t;return t=w(o),t?this.setState({hsla:t,alpha:t.alpha,sat:t.sat}):this.setState({hsla:null,alpha:1,sat:100})},closePicker:function closePicker(){return this.setState({isPickerVisible:!1})},togglePicker:function togglePicker(){var o,a;return o=!this.state.isPickerVisible,a=o&&0===this.state.sat,this.setHSLAFromColorString(this.state.colorString),this.setState({isPickerVisible:o,sat:a?100:this.state.sat})},setColor:function setColor(e){return this.setState({colorString:e}),this.setHSLAFromColorString(e),this.props.lc.setColor(this.props.colorName,e)},setAlpha:function setAlpha(o){var t;return this.setState({alpha:o}),this.state.hsla?(t=this.state.hsla,t.alpha=o,this.setState({hsla:t}),this.setColor(b(t))):void 0},setSat:function setSat(o){var t;if(this.setState({sat:o}),isNaN(o))throw"SAT";return this.state.hsla?(t=this.state.hsla,t.sat=o,this.setState({hsla:t}),this.setColor(b(t))):void 0},render:function render(){var o,a,r,s;return s=y.DOM,a=s.div,r=s.label,o=s.br,a({className:k({"color-well":!0,open:this.state.isPickerVisible}),onMouseLeave:this.closePicker,style:{float:"left",textAlign:"center"}},r({float:"left"},this.props.label),o({}),a({className:k({"color-well-color-container":!0,selected:this.state.isPickerVisible}),style:{backgroundColor:"white"},onClick:this.togglePicker},a({className:"color-well-checker color-well-checker-top-left"}),a({className:"color-well-checker color-well-checker-bottom-right",style:{left:"50%",top:"50%"}}),a({className:"color-well-color",style:{backgroundColor:this.state.colorString}}," ")),this.renderPicker())},renderPicker:function renderPicker(){var a,i,s,x,k,b,C,w,v,P,R,_,E,I;if(P=y.DOM,i=P.div,C=P.label,k=P.input,!this.state.isPickerVisible)return null;for(E=function(){return function(t){return i({className:"color-row label",key:t,style:{lineHeight:"20px",height:16}},t)}}(this),_=function(t){return function(){var e;return e=t.props.lc.opts.imageURLPrefix+"/checkerboard-8x8.png",i({className:"color-row",key:"color",style:{position:"relative",backgroundImage:"url("+e+")",backgroundRepeat:"repeat",height:24}},i({style:{position:"absolute",top:0,right:0,bottom:0,left:0,backgroundColor:t.state.colorString}}))}}(this),I=[],I.push(function(){var o,a;for(a=[],x=o=0;100>=o;x=o+=10){a.push({hue:0,sat:0,light:x,alpha:this.state.alpha})}return a}.call(this)),R=[0,30,60,90,120,150,180,210,240,270,300,330],b=0,w=R.length;w>b;b++){s=R[b],I.push(function(){var e,o;for(o=[],x=e=10;90>=e;x=e+=8){o.push({hue:s,sat:this.state.sat,light:x,alpha:this.state.alpha})}return o}.call(this))}return v=function(o){return function(t,e){return o.setColor(e)}}(this),i({className:"color-picker-popup"},_(),E(S("alpha")),k({type:"range",min:0,max:1,step:.01,value:this.state.alpha,onChange:function(o){return function(t){return o.setAlpha(parseFloat(t.target.value))}}(this)}),E(S("saturation")),k((a={type:"range",min:0,max:100,value:this.state.sat},_defineProperty(a,"max",100),_defineProperty(a,"onChange",function(o){return function(t){return o.setSat(parseInt(t.target.value,10))}}(this)),a)),m({rows:I,selectedColor:this.state.colorString,onChange:v}))}}),t.exports=e},{"../core/localization":13,"../core/util":19,"./React-shim":35,"react-addons-pure-render-mixin":2}],32:[function(n,t){"use strict";var g=n("../reactGUI/React-shim"),e=n("../reactGUI/ReactDOM-shim"),r=e.findDOMNode,o=n("../core/util"),i=o.classSet,a=n("./Picker"),h=n("./Options"),s=n("./createToolButton"),l=n("../core/LiterallyCanvas"),c=n("../core/defaultOptions");n("../optionsStyles/font"),n("../optionsStyles/stroke-width"),n("../optionsStyles/line-options-and-stroke-width"),n("../optionsStyles/polygon-and-stroke-width"),n("../optionsStyles/null");var p=g.createClass({displayName:"CanvasContainer",shouldComponentUpdate:function shouldComponentUpdate(){return!1},render:function render(){return g.createElement("div",{key:"literallycanvas",className:"lc-drawing with-gui"})}}),d=g.createClass({displayName:"LiterallyCanvas",getDefaultProps:function getDefaultProps(){return c},bindToModel:function bindToModel(){var e=r(this.canvas);this.props;this.lc.bindToElement(e),"function"==typeof this.lc.opts.onInit&&this.lc.opts.onInit(this.lc)},componentWillMount:function componentWillMount(){var o=this;this.lc||(this.props.lc?this.lc=this.props.lc:this.lc=new l(this.props),this.toolButtonComponents=this.lc.opts.tools.map(function(t){return s(new t(o.lc))}))},componentDidMount:function componentDidMount(){this.lc.isBound||this.bindToModel()},componentWillUnmount:function componentWillUnmount(){this.lc&&this.lc._teardown()},render:function render(){var l=this,t=this.lc,e=this.toolButtonComponents,n=(this.props,this.lc.opts),r=n.imageURLPrefix,o=n.toolbarPosition,s=i({"toolbar-at-top":"top"===o,"toolbar-at-bottom":"bottom"===o,"toolbar-hidden":"hidden"===o});return g.createElement("div",{className:"literally "+s},g.createElement(p,{ref:function ref(t){return l.canvas=t}}),g.createElement(a,{lc:t,toolButtonComponents:e,imageURLPrefix:r}),g.createElement(h,{lc:t,imageURLPrefix:r}))}});t.exports=d},{"../core/LiterallyCanvas":5,"../core/defaultOptions":10,"../core/util":19,"../optionsStyles/font":23,"../optionsStyles/line-options-and-stroke-width":24,"../optionsStyles/null":25,"../optionsStyles/polygon-and-stroke-width":27,"../optionsStyles/stroke-width":29,"../reactGUI/React-shim":35,"../reactGUI/ReactDOM-shim":36,"./Options":33,"./Picker":34,"./createToolButton":41}],33:[function(a,t){var e,n,l,p;n=a("./React-shim"),l=a("./createSetStateOnEventMixin"),p=a("../optionsStyles/optionsStyles").optionsStyles,e=n.createClass({displayName:"Options",getState:function getState(){var e;return{style:null!=(e=this.props.lc.tool)?e.optionsStyle:void 0,tool:this.props.lc.tool}},getInitialState:function getInitialState(){return this.getState()},mixins:[l("toolChange")],renderBody:function renderBody(){var e;return e=""+this.state.style,p[e]&&p[e]({lc:this.props.lc,tool:this.state.tool,imageURLPrefix:this.props.imageURLPrefix})},render:function render(){var e;return(e=n.DOM.div)({className:"lc-options horz-toolbar"},this.renderBody())}}),t.exports=e},{"../optionsStyles/optionsStyles":26,"./React-shim":35,"./createSetStateOnEventMixin":40}],34:[function(n,t){var p,d,g,e,u,m,y,S;u=n("./React-shim"),p=u.createFactory(n("./ClearButton")),m=u.createFactory(n("./UndoRedoButtons")),y=u.createFactory(n("./ZoomButtons")),S=n("../core/localization")._,g=u.createFactory(n("./ColorWell")),d=u.createFactory(u.createClass({displayName:"ColorPickers",render:function render(){var o,a;return a=this.props.lc,(o=u.DOM.div)({className:"lc-color-pickers"},g({lc:a,colorName:"primary",label:S("stroke")}),g({lc:a,colorName:"secondary",label:S("fill")}),g({lc:a,colorName:"background",label:S("bg")}))}})),e=u.createClass({displayName:"Picker",getInitialState:function getInitialState(){return{selectedToolIndex:0}},renderBody:function renderBody(){var a,l,c,r,i;return a=u.DOM.div,r=this.props,i=r.toolButtonComponents,c=r.lc,l=r.imageURLPrefix,a({className:"lc-picker-contents"},i.map(function(o){return function(e,t){return e({lc:c,imageURLPrefix:l,key:t,isSelected:t===o.state.selectedToolIndex,onSelect:function onSelect(a){return c.setTool(a),o.setState({selectedToolIndex:t})}})}}(this)),0!=i.length%2?a({className:"toolbar-button thin-button disabled"}):void 0,a({style:{position:"absolute",bottom:0,left:0,right:0}},d({lc:this.props.lc}),m({lc:c,imageURLPrefix:l}),y({lc:c,imageURLPrefix:l}),p({lc:c})))},render:function render(){var e;return(e=u.DOM.div)({className:"lc-picker"},this.renderBody())}}),t.exports=e},{"../core/localization":13,"./ClearButton":30,"./ColorWell":31,"./React-shim":35,"./UndoRedoButtons":38,"./ZoomButtons":39}],35:[function(o,t){var e;try{e=o("react")}catch(t){e=window.React}if(null==e)throw"Can't find React";t.exports=e},{react:"react"}],36:[function(o,t){var e;try{e=o("react-dom")}catch(t){e=window.ReactDOM}if(null==e)try{e=o("react")}catch(t){e=window.React}if(null==e)throw"Can't find ReactDOM";t.exports=e},{react:"react","react-dom":"react-dom"}],37:[function(a,t){var l,p,e;l=a("./React-shim"),e=a("../reactGUI/createSetStateOnEventMixin"),p=a("../core/util").classSet,t.exports=l.createClass({displayName:"StrokeWidthPicker",getState:function getState(e){return null==e&&(e=this.props.tool),{strokeWidth:e.strokeWidth}},getInitialState:function getInitialState(){return this.getState()},mixins:[e("toolDidUpdateOptions")],componentWillReceiveProps:function componentWillReceiveProps(e){return this.setState(this.getState(e.tool))},render:function render(){var r,d,i,c,g,u,m;return c=l.DOM,m=c.ul,i=c.li,u=c.svg,r=c.circle,d=c.div,g=this.props.lc.opts.strokeWidths,d({},g.map(function(e){return function(t){var o,a;return o=p({"square-toolbar-button":!0,selected:t===e.state.strokeWidth}),a=28,d({key:t},d({className:o,onClick:function onClick(){return e.props.lc.trigger("setStrokeWidth",t)}},u({width:a-2,height:a-2,viewPort:"0 0 "+t+" "+t,version:"1.1",xmlns:"http://www.w3.org/2000/svg"},r({cx:Math.ceil(a/2-1),cy:Math.ceil(a/2-1),r:t/2}))))}}(this)))}})},{"../core/util":19,"../reactGUI/createSetStateOnEventMixin":40,"./React-shim":35}],38:[function(n,t){var g,e,p,d,m,c,u;g=n("./React-shim"),c=n("./createSetStateOnEventMixin"),m=n("../core/util").classSet,u=function(a){return g.createClass({displayName:"undo"===a?"UndoButton":"RedoButton",getState:function getState(){return{isEnabled:function(){switch(!1){case"undo"!==a:return this.props.lc.canUndo();case"redo"!==a:return this.props.lc.canRedo();}}.call(this)}},getInitialState:function getInitialState(){return this.getState()},mixins:[c("drawingChange")],render:function render(){var t,i,y,S,f,x,k,b,C,w,v;return k=g.DOM,i=k.div,S=k.img,b=this.props,f=b.lc,y=b.imageURLPrefix,v="undo"===a?"Undo":"Redo",t="lc-"+a+" "+m({"toolbar-button":!0,"thin-button":!0,disabled:!this.state.isEnabled}),x=function(){switch(!1){case!!this.state.isEnabled:return function(){};case"undo"!==a:return function(){return f.undo()};case"redo"!==a:return function(){return f.redo()};}}.call(this),C=y+"/"+a+".png",w={backgroundImage:"url("+C+")"},i({className:t,onClick:x,title:v,style:w})}})},p=g.createFactory(u("undo")),e=g.createFactory(u("redo")),d=g.createClass({displayName:"UndoRedoButtons",render:function render(){var o;return(o=g.DOM.div)({className:"lc-undo-redo"},p(this.props),e(this.props))}}),t.exports=d},{"../core/util":19,"./React-shim":35,"./createSetStateOnEventMixin":40}],39:[function(n,t){var g,e,p,d,m,c,u;g=n("./React-shim"),c=n("./createSetStateOnEventMixin"),m=n("../core/util").classSet,u=function(a){return g.createClass({displayName:"in"===a?"ZoomInButton":"ZoomOutButton",getState:function getState(){return{isEnabled:function(){switch(!1){case"in"!==a:return this.props.lc.scale<this.props.lc.config.zoomMax;case"out"!==a:return this.props.lc.scale>this.props.lc.config.zoomMin;}}.call(this)}},getInitialState:function getInitialState(){return this.getState()},mixins:[c("zoom")],render:function render(){var t,i,y,S,f,x,k,b,C,w,v;return k=g.DOM,i=k.div,S=k.img,b=this.props,f=b.lc,y=b.imageURLPrefix,v="in"===a?"Zoom in":"Zoom out",t="lc-zoom-"+a+" "+m({"toolbar-button":!0,"thin-button":!0,disabled:!this.state.isEnabled}),x=function(){switch(!1){case!!this.state.isEnabled:return function(){};case"in"!==a:return function(){return f.zoom(f.config.zoomStep)};case"out"!==a:return function(){return f.zoom(-f.config.zoomStep)};}}.call(this),C=y+"/zoom-"+a+".png",w={backgroundImage:"url("+C+")"},i({className:t,onClick:x,title:v,style:w})}})},d=g.createFactory(u("out")),p=g.createFactory(u("in")),e=g.createClass({displayName:"ZoomButtons",render:function render(){var e;return(e=g.DOM.div)({className:"lc-zoom"},d(this.props),p(this.props))}}),t.exports=e},{"../core/util":19,"./React-shim":35,"./createSetStateOnEventMixin":40}],40:[function(o,t){var e,a;e=o("./React-shim"),t.exports=a=function(e){return{componentDidMount:function componentDidMount(){return this.unsubscribe=this.props.lc.on(e,function(e){return function(){return e.setState(e.getState())}}(this))},componentWillUnmount:function componentWillUnmount(){return this.unsubscribe()}}}},{"./React-shim":35}],41:[function(a,t){var g,m,y,e;g=a("./React-shim"),y=a("../core/util").classSet,m=a("../core/localization")._,e=function(o){var t,r;return t=o.name,r=o.iconName,g.createFactory(g.createClass({displayName:t,getDefaultProps:function getDefaultProps(){return{isSelected:!1,lc:null}},componentWillMount:function componentWillMount(){return this.props.isSelected?this.props.lc.setTool(o):void 0},render:function render(){var e,n,i,S,x,k,b,C,w;return b=g.DOM,n=b.div,S=b.img,C=this.props,i=C.imageURLPrefix,x=C.isSelected,k=C.onSelect,e=y({"lc-pick-tool":!0,"toolbar-button":!0,"thin-button":!0,selected:x}),w=i+"/"+r+".png",n({className:e,style:{backgroundImage:"url("+w+")"},onClick:function onClick(){return k(o)},title:m(t)})}}))},t.exports=e},{"../core/localization":13,"../core/util":19,"./React-shim":35}],42:[function(n,t){"use strict";function e(a,t){var p=a.className,n=new o(t);return r.render(l.createElement(s,{lc:n}),a),n.teardown=function(){n._teardown();for(var t=0;t<a.children.length;t++){a.removeChild(a.children[t])}a.className=p},n}var l=n("./React-shim"),r=n("./ReactDOM-shim"),o=n("../core/LiterallyCanvas"),s=n("./LiterallyCanvas");t.exports=e},{"../core/LiterallyCanvas":5,"./LiterallyCanvas":32,"./React-shim":35,"./ReactDOM-shim":36}],43:[function(n,t){var e,l,p,d=function(o,t){function e(){this.constructor=o}for(var a in t){s.call(t,a)&&(o[a]=t[a])}return e.prototype=t.prototype,o.prototype=new e,o.__super__=t.prototype,o},s={}.hasOwnProperty;l=n("./base").ToolWithStroke,p=n("../core/shapes").createShape,t.exports=e=function(o){function t(){return t.__super__.constructor.apply(this,arguments)}return d(t,o),t.prototype.name="Ellipse",t.prototype.iconName="ellipse",t.prototype.begin=function(o,t,e){return this.currentShape=p("Ellipse",{x:o,y:t,strokeWidth:this.strokeWidth,strokeColor:e.getColor("primary"),fillColor:e.getColor("secondary")})},t.prototype["continue"]=function(o,t,e){return this.currentShape.width=o-this.currentShape.x,this.currentShape.height=t-this.currentShape.y,e.drawShapeInProgress(this.currentShape)},t.prototype.end=function(o,t,e){return e.saveShape(this.currentShape)},t}(l)},{"../core/shapes":17,"./base":53}],44:[function(n,t){var e,l,p,d=function(o,t){function e(){this.constructor=o}for(var a in t){s.call(t,a)&&(o[a]=t[a])}return e.prototype=t.prototype,o.prototype=new e,o.__super__=t.prototype,o},s={}.hasOwnProperty;l=n("./Pencil"),p=n("../core/shapes").createShape,t.exports=e=function(o){function t(){return t.__super__.constructor.apply(this,arguments)}return d(t,o),t.prototype.name="Eraser",t.prototype.iconName="eraser",t.prototype.makePoint=function(o,t){return p("Point",{x:o,y:t,size:this.strokeWidth,color:"#000"})},t.prototype.makeShape=function(){return p("ErasedLinePath")},t}(l)},{"../core/shapes":17,"./Pencil":48}],45:[function(n,t){var e,l,p,d=function(o,t){function e(){this.constructor=o}for(var a in t){s.call(t,a)&&(o[a]=t[a])}return e.prototype=t.prototype,o.prototype=new e,o.__super__=t.prototype,o},s={}.hasOwnProperty;l=n("./base").Tool,p=function(o,t){var e,a,s;return a=t.x,s=t.y,e=o.getImageData(a,s,1,1).data,e[3]?"rgb("+e[0]+", "+e[1]+", "+e[2]+")":null},t.exports=e=function(o){function a(e){a.__super__.constructor.call(this,e),this.strokeOrFill="stroke"}return d(a,o),a.prototype.name="Eyedropper",a.prototype.iconName="eyedropper",a.prototype.optionsStyle="stroke-or-fill",a.prototype.readColor=function(o,t,e){var n,l,d,c;return c=e.getDefaultImageRect(),n=e.getImage(),d=p(n.getContext("2d"),{x:o-c.x,y:t-c.y}),l=d||e.getColor("background"),"stroke"===this.strokeOrFill?e.setColor("primary",d):e.setColor("secondary",d)},a.prototype.begin=function(o,t,e){return this.readColor(o,t,e)},a.prototype["continue"]=function(o,t,e){return this.readColor(o,t,e)},a}(l)},{"./base":53}],46:[function(n,t){var e,l,p,d=function(o,t){function e(){this.constructor=o}for(var a in t){s.call(t,a)&&(o[a]=t[a])}return e.prototype=t.prototype,o.prototype=new e,o.__super__=t.prototype,o},s={}.hasOwnProperty;l=n("./base").ToolWithStroke,p=n("../core/shapes").createShape,t.exports=e=function(o){function t(){return t.__super__.constructor.apply(this,arguments)}return d(t,o),t.prototype.name="Line",t.prototype.iconName="line",t.prototype.optionsStyle="line-options-and-stroke-width",t.prototype.begin=function(o,t,e){return this.currentShape=p("Line",{x1:o,y1:t,x2:o,y2:t,strokeWidth:this.strokeWidth,dash:function(){switch(!1){case!this.isDashed:return[2*this.strokeWidth,4*this.strokeWidth];default:return null;}}.call(this),endCapShapes:this.hasEndArrow?[null,"arrow"]:null,color:e.getColor("primary")})},t.prototype["continue"]=function(o,t,e){return this.currentShape.x2=o,this.currentShape.y2=t,e.drawShapeInProgress(this.currentShape)},t.prototype.end=function(o,t,e){return e.saveShape(this.currentShape)},t}(l)},{"../core/shapes":17,"./base":53}],47:[function(n,t){var e,l,p,d=function(o,t){function e(){this.constructor=o}for(var a in t){s.call(t,a)&&(o[a]=t[a])}return e.prototype=t.prototype,o.prototype=new e,o.__super__=t.prototype,o},s={}.hasOwnProperty;l=n("./base").Tool,p=n("../core/shapes").createShape,t.exports=e=function(o){function t(){return t.__super__.constructor.apply(this,arguments)}return d(t,o),t.prototype.name="Pan",t.prototype.iconName="pan",t.prototype.usesSimpleAPI=!1,t.prototype.didBecomeActive=function(a){var o;return o=[],this.unsubscribe=function(){return function(){var e,a,s,l;for(l=[],a=0,s=o.length;s>a;a++){e=o[a],l.push(e())}return l}}(this),o.push(a.on("lc-pointerdown",function(t){return function(e){var o,n;return o=e.rawX,n=e.rawY,t.oldPosition=a.position,t.pointerStart={x:o,y:n}}}(this))),o.push(a.on("lc-pointerdrag",function(t){return function(e){var n,s,l;return s=e.rawX,l=e.rawY,n={x:(s-t.pointerStart.x)*a.backingScale,y:(l-t.pointerStart.y)*a.backingScale},a.setPan(t.oldPosition.x+n.x,t.oldPosition.y+n.y)}}(this)))},t.prototype.willBecomeInactive=function(){return this.unsubscribe()},t}(l)},{"../core/shapes":17,"./base":53}],48:[function(n,t){var e,l,p,d=function(o,t){function e(){this.constructor=o}for(var a in t){s.call(t,a)&&(o[a]=t[a])}return e.prototype=t.prototype,o.prototype=new e,o.__super__=t.prototype,o},s={}.hasOwnProperty;l=n("./base").ToolWithStroke,p=n("../core/shapes").createShape,t.exports=e=function(o){function t(){return t.__super__.constructor.apply(this,arguments)}return d(t,o),t.prototype.name="Pencil",t.prototype.iconName="pencil",t.prototype.eventTimeThreshold=10,t.prototype.begin=function(o,t,e){return this.color=e.getColor("primary"),this.currentShape=this.makeShape(),this.currentShape.addPoint(this.makePoint(o,t,e)),this.lastEventTime=Date.now()},t.prototype["continue"]=function(o,t,e){var a;return a=Date.now()-this.lastEventTime,a>this.eventTimeThreshold?(this.lastEventTime+=a,this.currentShape.addPoint(this.makePoint(o,t,e)),e.drawShapeInProgress(this.currentShape)):void 0},t.prototype.end=function(o,t,e){return e.saveShape(this.currentShape),this.currentShape=void 0},t.prototype.makePoint=function(o,t){return p("Point",{x:o,y:t,size:this.strokeWidth,color:this.color})},t.prototype.makeShape=function(){return p("LinePath")},t}(l)},{"../core/shapes":17,"./base":53}],49:[function(n,t){var e,l,p,d=function(o,t){function e(){this.constructor=o}for(var a in t){s.call(t,a)&&(o[a]=t[a])}return e.prototype=t.prototype,o.prototype=new e,o.__super__=t.prototype,o},s={}.hasOwnProperty;l=n("./base").ToolWithStroke,p=n("../core/shapes").createShape,t.exports=e=function(o){function l(){return l.__super__.constructor.apply(this,arguments)}return d(l,o),l.prototype.name="Polygon",l.prototype.iconName="polygon",l.prototype.usesSimpleAPI=!1,l.prototype.didBecomeActive=function(p){var e,t,d,c,g,u,m;return l.__super__.didBecomeActive.call(this,p),m=[],this.polygonUnsubscribe=function(){return function(){var o,a,r,s;for(s=[],a=0,r=m.length;r>a;a++){o=m[a],s.push(o())}return s}}(this),this.points=null,this.maybePoint=null,d=function(t){return function(){return t._getWillFinish()?t._close(p):(p.trigger("lc-polygon-started"),t.points?t.points.push(t.maybePoint):t.points=[t.maybePoint],t.maybePoint={x:t.maybePoint.x,y:t.maybePoint.y},p.setShapesInProgress(t._getShapes(p)),p.repaintLayer("main"))}}(this),t=function(t){return function(e){var o,a;return o=e.x,a=e.y,t.maybePoint?(t.maybePoint.x=o,t.maybePoint.y=a,p.setShapesInProgress(t._getShapes(p)),p.repaintLayer("main")):void 0}}(this),e=function(t){return function(e){var o,a;return o=e.x,a=e.y,t.maybePoint={x:o,y:a},p.setShapesInProgress(t._getShapes(p)),p.repaintLayer("main")}}(this),u=function(t){return function(){return t.maybePoint={x:1/0,y:1/0},t._close(p)}}(this),g=function(t){return function(){return t.maybePoint=t.points[0],t._close(p)}}(this),c=function(t){return function(){return t._cancel(p)}}(this),m.push(p.on("drawingChange",function(t){return function(){return t._cancel(p)}}(this))),m.push(p.on("lc-pointerdown",e)),m.push(p.on("lc-pointerdrag",t)),m.push(p.on("lc-pointermove",t)),m.push(p.on("lc-pointerup",d)),m.push(p.on("lc-polygon-finishopen",u)),m.push(p.on("lc-polygon-finishclosed",g)),m.push(p.on("lc-polygon-cancel",c))},l.prototype.willBecomeInactive=function(e){return l.__super__.willBecomeInactive.call(this,e),(this.points||this.maybePoint)&&this._cancel(e),this.polygonUnsubscribe()},l.prototype._getArePointsClose=function(o,t){return 10>Math.abs(o.x-t.x)+Math.abs(o.y-t.y)},l.prototype._getWillClose=function(){return this.points&&1<this.points.length&&this.maybePoint?this._getArePointsClose(this.points[0],this.maybePoint):!1},l.prototype._getWillFinish=function(){return this.points&&1<this.points.length&&this.maybePoint?this._getArePointsClose(this.points[0],this.maybePoint)||this._getArePointsClose(this.points[this.points.length-1],this.maybePoint):!1},l.prototype._cancel=function(e){return e.trigger("lc-polygon-stopped"),this.maybePoint=null,this.points=null,e.setShapesInProgress([]),e.repaintLayer("main")},l.prototype._close=function(e){return e.trigger("lc-polygon-stopped"),e.setShapesInProgress([]),2<this.points.length&&e.saveShape(this._getShape(e,!1)),this.maybePoint=null,this.points=null},l.prototype._getShapes=function(o,t){var a;return null==t&&(t=!0),a=this._getShape(o,t),a?[a]:[]},l.prototype._getShape=function(o,t){var a;return null==t&&(t=!0),a=[],this.points&&(a=a.concat(this.points)),!t&&3>a.length?null:(t&&this.maybePoint&&a.push(this.maybePoint),1<a.length?p("Polygon",{isClosed:this._getWillClose(),strokeColor:o.getColor("primary"),fillColor:o.getColor("secondary"),strokeWidth:this.strokeWidth,points:a.map(function(e){return p("Point",e)})}):null)},l.prototype.optionsStyle="polygon-and-stroke-width",l}(l)},{"../core/shapes":17,"./base":53}],50:[function(n,t){var e,l,p,d=function(o,t){function e(){this.constructor=o}for(var a in t){s.call(t,a)&&(o[a]=t[a])}return e.prototype=t.prototype,o.prototype=new e,o.__super__=t.prototype,o},s={}.hasOwnProperty;l=n("./base").ToolWithStroke,p=n("../core/shapes").createShape,t.exports=e=function(o){function t(){return t.__super__.constructor.apply(this,arguments)}return d(t,o),t.prototype.name="Rectangle",t.prototype.iconName="rectangle",t.prototype.begin=function(o,t,e){return this.currentShape=p("Rectangle",{x:o,y:t,strokeWidth:this.strokeWidth,strokeColor:e.getColor("primary"),fillColor:e.getColor("secondary")})},t.prototype["continue"]=function(o,t,e){return this.currentShape.width=o-this.currentShape.x,this.currentShape.height=t-this.currentShape.y,e.drawShapeInProgress(this.currentShape)},t.prototype.end=function(o,t,e){return e.saveShape(this.currentShape)},t}(l)},{"../core/shapes":17,"./base":53}],51:[function(n,t){var e,l,p,d=function(o,t){function e(){this.constructor=o}for(var a in t){s.call(t,a)&&(o[a]=t[a])}return e.prototype=t.prototype,o.prototype=new e,o.__super__=t.prototype,o},s={}.hasOwnProperty;l=n("./base").Tool,p=n("../core/shapes").createShape,t.exports=e=function(o){function t(){this.selectCanvas=document.createElement("canvas"),this.selectCanvas.style["background-color"]="transparent",this.selectCtx=this.selectCanvas.getContext("2d")}return d(t,o),t.prototype.name="SelectShape",t.prototype.usesSimpleAPI=!1,t.prototype.didBecomeActive=function(o){var t,a,s,l;return l=[],this._selectShapeUnsubscribe=function(){return function(){var o,a,r,s;for(s=[],a=0,r=l.length;r>a;a++){o=l[a],s.push(o())}return s}}(this),t=function(t){return function(e){var n,l,d,c;return d=e.x,c=e.y,t.didDrag=!1,l=t._getPixel(d,c,o,t.selectCtx),t.selectedShape=o.shapes[l],null!=t.selectedShape?(o.trigger("shapeSelected",{selectedShape:t.selectedShape}),o.setShapesInProgress([t.selectedShape,p("SelectionBox",{shape:t.selectedShape,handleSize:0})]),o.repaintLayer("main"),n=t.selectedShape.getBoundingRect(),t.dragOffset={x:d-n.x,y:c-n.y}):void 0}}(this),a=function(t){return function(e){var a,n;return a=e.x,n=e.y,null!=t.selectedShape?(t.didDrag=!0,t.selectedShape.setUpperLeft({x:a-t.dragOffset.x,y:n-t.dragOffset.y}),o.setShapesInProgress([t.selectedShape,p("SelectionBox",{shape:t.selectedShape,handleSize:0})]),o.repaintLayer("main")):void 0}}(this),s=function(t){return function(e){var a,n;return a=e.x,n=e.y,t.didDrag?(t.didDrag=!1,o.trigger("shapeMoved",{shape:t.selectedShape}),o.trigger("drawingChange",{}),o.repaintLayer("main"),t._drawSelectCanvas(o)):void 0}}(this),l.push(o.on("lc-pointerdown",t)),l.push(o.on("lc-pointerdrag",a)),l.push(o.on("lc-pointerup",s)),this._drawSelectCanvas(o)},t.prototype.willBecomeInactive=function(e){return this._selectShapeUnsubscribe(),e.setShapesInProgress([])},t.prototype._drawSelectCanvas=function(o){var t;return this.selectCanvas.width=o.canvas.width,this.selectCanvas.height=o.canvas.height,this.selectCtx.clearRect(0,0,this.selectCanvas.width,this.selectCanvas.height),t=o.shapes.map(function(o){return function(t,e){return p("SelectionBox",{shape:t,handleSize:0,backgroundColor:"#"+o._intToHex(e)})}}(this)),o.draw(t,this.selectCtx)},t.prototype._intToHex=function(e){return("000000"+e.toString(16)).slice(-6)},t.prototype._getPixel=function(a,t,e,n){var i,s;return i=e.drawingCoordsToClientCoords(a,t),s=n.getImageData(i.x,i.y,1,1).data,s[3]?parseInt(this._rgbToHex(s[0],s[1],s[2]),16):null},t.prototype._componentToHex=function(o){var t;return t=o.toString(16),("0"+t).slice(-2)},t.prototype._rgbToHex=function(o,t,e){return""+this._componentToHex(o)+this._componentToHex(t)+this._componentToHex(e)},t}(l)},{"../core/shapes":17,"./base":53}],52:[function(n,t){var e,l,p,d,c=function(o,t){function e(){this.constructor=o}for(var n in t){a.call(t,n)&&(o[n]=t[n])}return e.prototype=t.prototype,o.prototype=new e,o.__super__=t.prototype,o},a={}.hasOwnProperty;l=n("./base").Tool,p=n("../core/shapes").createShape,d=function(o,t){return o.x<t.x?!1:o.y<t.y?!1:o.x>t.x+t.width?!1:!(o.y>t.y+t.height)},t.exports=e=function(o){function t(){this.text="",this.font="bold 18px sans-serif",this.currentShape=null,this.currentShapeState=null,this.initialShapeBoundingRect=null,this.dragAction=null,this.didDrag=!1}return c(t,o),t.prototype.name="Text",t.prototype.iconName="text",t.prototype.didBecomeActive=function(o){var t,a,r;return a=[],this.unsubscribe=function(){return function(){var o,n,s,l;for(l=[],n=0,s=a.length;s>n;n++){o=a[n],l.push(o())}return l}}(this),t=function(t){return function(){return t._ensureNotEditing(o),t._clearCurrentShape(o),o.repaintLayer("main")}}(this),r=function(t){return function(){return t._updateInputEl(o)}}(this),a.push(o.on("drawingChange",t)),a.push(o.on("zoom",r)),a.push(o.on("imageSizeChange",r)),a.push(o.on("snapshotLoad",function(t){return function(){return t._clearCurrentShape(o),o.repaintLayer("main")}}(this))),a.push(o.on("primaryColorChange",function(t){return function(e){return t.currentShape?(t.currentShape.color=e,t._updateInputEl(o),o.repaintLayer("main")):void 0}}(this))),a.push(o.on("setFont",function(t){return function(e){return t.currentShape?(t.font=e,t.currentShape.setFont(e),t._setShapesInProgress(o),t._updateInputEl(o),o.repaintLayer("main")):void 0}}(this)))},t.prototype.willBecomeInactive=function(e){return this.currentShape&&(this._ensureNotEditing(e),this.commit(e)),this.unsubscribe()},t.prototype.setText=function(e){return this.text=e},t.prototype._ensureNotEditing=function(e){return"editing"===this.currentShapeState?this._exitEditingState(e):void 0},t.prototype._clearCurrentShape=function(e){return this.currentShape=null,this.initialShapeBoundingRect=null,this.currentShapeState=null,e.setShapesInProgress([])},t.prototype.commit=function(e){return this.currentShape.text&&e.saveShape(this.currentShape),this._clearCurrentShape(e),e.repaintLayer("main")},t.prototype._getSelectionShape=function(o,t){return null==t&&(t=null),p("SelectionBox",{shape:this.currentShape,ctx:o,backgroundColor:t})},t.prototype._setShapesInProgress=function(e){switch(this.currentShapeState){case"selected":return e.setShapesInProgress([this._getSelectionShape(e.ctx),this.currentShape]);case"editing":return e.setShapesInProgress([this._getSelectionShape(e.ctx,"#fff")]);default:return e.setShapesInProgress([this.currentShape]);}},t.prototype.begin=function(o,t,e){var n,s,l,c;return this.dragAction="none",this.didDrag=!1,"selected"===this.currentShapeState||"editing"===this.currentShapeState?(n=this.currentShape.getBoundingRect(e.ctx),c=this._getSelectionShape(e.ctx),l=c.getBoundingRect(),s={x:o,y:t},d(s,n)&&(this.dragAction="move"),d(s,c.getBottomRightHandleRect())&&(this.dragAction="resizeBottomRight"),d(s,c.getTopLeftHandleRect())&&(this.dragAction="resizeTopLeft"),d(s,c.getBottomLeftHandleRect())&&(this.dragAction="resizeBottomLeft"),d(s,c.getTopRightHandleRect())&&(this.dragAction="resizeTopRight"),"none"===this.dragAction&&"editing"===this.currentShapeState&&(this.dragAction="stop-editing",this._exitEditingState(e))):(this.color=e.getColor("primary"),this.currentShape=p("Text",{x:o,y:t,text:this.text,color:this.color,font:this.font,v:1}),this.dragAction="place",this.currentShapeState="selected"),"none"===this.dragAction?void this.commit(e):(this.initialShapeBoundingRect=this.currentShape.getBoundingRect(e.ctx),this.dragOffset={x:o-this.initialShapeBoundingRect.x,y:t-this.initialShapeBoundingRect.y},this._setShapesInProgress(e),e.repaintLayer("main"))},t.prototype["continue"]=function(a,t,e){var n,s,l;if("none"!==this.dragAction){switch(n=this.initialShapeBoundingRect,l=n.x+n.width,s=n.y+n.height,this.dragAction){case"place":this.currentShape.x=a,this.currentShape.y=t,this.didDrag=!0;break;case"move":this.currentShape.x=a-this.dragOffset.x,this.currentShape.y=t-this.dragOffset.y,this.didDrag=!0;break;case"resizeBottomRight":this.currentShape.setSize(a-(this.dragOffset.x-this.initialShapeBoundingRect.width)-n.x,t-(this.dragOffset.y-this.initialShapeBoundingRect.height)-n.y);break;case"resizeTopLeft":this.currentShape.setSize(l-a+this.dragOffset.x,s-t+this.dragOffset.y),this.currentShape.setPosition(a-this.dragOffset.x,t-this.dragOffset.y);break;case"resizeBottomLeft":this.currentShape.setSize(l-a+this.dragOffset.x,t-(this.dragOffset.y-this.initialShapeBoundingRect.height)-n.y),this.currentShape.setPosition(a-this.dragOffset.x,this.currentShape.y);break;case"resizeTopRight":this.currentShape.setSize(a-(this.dragOffset.x-this.initialShapeBoundingRect.width)-n.x,s-t+this.dragOffset.y),this.currentShape.setPosition(this.currentShape.x,t-this.dragOffset.y);}return this._setShapesInProgress(e),e.repaintLayer("main"),this._updateInputEl(e)}},t.prototype.end=function(o,t,e){return this.currentShape?(this.currentShape.setSize(this.currentShape.forcedWidth,0),"selected"===this.currentShapeState&&("place"===this.dragAction||"move"===this.dragAction&&!this.didDrag)&&this._enterEditingState(e),this._setShapesInProgress(e),e.repaintLayer("main"),this._updateInputEl(e)):void 0},t.prototype._enterEditingState=function(o){var t;if(this.currentShapeState="editing",this.inputEl)throw"State error";return this.inputEl=document.createElement("textarea"),this.inputEl.className="text-tool-input",this.inputEl.style.position="absolute",this.inputEl.style.transformOrigin="0px 0px",this.inputEl.style.backgroundColor="transparent",this.inputEl.style.border="none",this.inputEl.style.outline="none",this.inputEl.style.margin="0",this.inputEl.style.padding="4px",this.inputEl.style.zIndex="1000",this.inputEl.style.overflow="hidden",this.inputEl.style.resize="none",this.inputEl.value=this.currentShape.text,this.inputEl.addEventListener("mousedown",function(e){return e.stopPropagation()}),this.inputEl.addEventListener("touchstart",function(e){return e.stopPropagation()}),t=function(t){return function(e){return t.currentShape.setText(e.target.value),t.currentShape.enforceMaxBoundingRect(o),t._setShapesInProgress(o),o.repaintLayer("main"),t._updateInputEl(o),e.stopPropagation()}}(this),this.inputEl.addEventListener("keydown",function(t){return function(){return t._updateInputEl(o,!0)}}(this)),this.inputEl.addEventListener("keyup",t),this.inputEl.addEventListener("change",t),this._updateInputEl(o),o.containerEl.appendChild(this.inputEl),this.inputEl.focus(),this._setShapesInProgress(o)},t.prototype._exitEditingState=function(e){return this.currentShapeState="selected",e.containerEl.removeChild(this.inputEl),this.inputEl=null,this._setShapesInProgress(e),e.repaintLayer("main")},t.prototype._updateInputEl=function(o,t){var a,r;return null==t&&(t=!1),this.inputEl?(a=this.currentShape.getBoundingRect(o.ctx,!0),this.inputEl.style.font=this.currentShape.font,this.inputEl.style.color=this.currentShape.color,this.inputEl.style.left=o.position.x/o.backingScale+a.x*o.scale-4+"px",this.inputEl.style.top=o.position.y/o.backingScale+a.y*o.scale-4+"px",t&&!this.currentShape.forcedWidth?this.inputEl.style.width=a.width+10+this.currentShape.renderer.emDashWidth+"px":this.inputEl.style.width=a.width+12+"px",t?this.inputEl.style.height=a.height+10+this.currentShape.renderer.metrics.leading+"px":this.inputEl.style.height=a.height+10+"px",r="scale("+o.scale+")",this.inputEl.style.transform=r,this.inputEl.style.webkitTransform=r,this.inputEl.style.MozTransform=r,this.inputEl.style.msTransform=r,this.inputEl.style.OTransform=r):void 0},t.prototype.optionsStyle="font",t}(l)},{"../core/shapes":17,"./base":53}],53:[function(n,t){var e,l,p,d=function(o,t){function e(){this.constructor=o}for(var a in t){s.call(t,a)&&(o[a]=t[a])}return e.prototype=t.prototype,o.prototype=new e,o.__super__=t.prototype,o},s={}.hasOwnProperty;p={},p.Tool=e=function(){function e(){}return e.prototype.name=null,e.prototype.iconName=null,e.prototype.usesSimpleAPI=!0,e.prototype.begin=function(){},e.prototype["continue"]=function(){},e.prototype.end=function(){},e.prototype.optionsStyle=null,e.prototype.didBecomeActive=function(){},e.prototype.willBecomeInactive=function(){},e}(),p.ToolWithStroke=l=function(o){function t(e){this.strokeWidth=e.opts.defaultStrokeWidth}return d(t,o),t.prototype.optionsStyle="stroke-width",t.prototype.didBecomeActive=function(o){var a;return a=[],this.unsubscribe=function(){return function(){var e,o,s,l;for(l=[],o=0,s=a.length;s>o;o++){e=a[o],l.push(e())}return l}}(this),a.push(o.on("setStrokeWidth",function(t){return function(e){return t.strokeWidth=e,o.trigger("toolDidUpdateOptions")}}(this)))},t.prototype.willBecomeInactive=function(){return this.unsubscribe()},t}(e),t.exports=p},{}]},{},[22])(22)});
//# sourceMappingURL=literallycanvas.min.js.map
