define(["jquery","core/log","filter_poodll/utils_amd","filter_poodll/upskin_bar"],(function($,log,utils,upskin_bar){return log.debug("PoodLL Scenario Skin: initialising"),{instanceprops:null,pmr:null,uploaded:!1,recorded:!1,played:!1,mustResetResourcePlayer:!1,clone:function(){return $.extend(!0,{},this)},init:function(ip,pmr){this.instanceprops=ip,this.pmr=pmr},fetch_instanceprops:function(){return this.instanceprops},onUploadSuccess:function(controlbarid){$("#"+controlbarid+" > .poodll_save-recording").hide(),$("#"+controlbarid+" > .poodll_savedsuccessfully").show()},onUploadFailure:function(controlbarid){},fetch_status_bar:function(skin){return'<div class="poodll_status_'+skin+'"></div>'},fetch_preview_audio:function(skin){return'<audio class="poodll_checkplayer_'+skin+' hide" controls playsinline="playsinline"></audio>'},fetch_preview_video:function(skin){return'<video class="poodll_checkplayer_'+skin+'" width="320" height="240" playsinline="playsinline"></video>'},fetch_resource_audio:function(skin){return'<audio class="poodll_resourceplayer_'+skin+' hide" src="@@RESOURCEURL@@" playsinline controls></audio>'},fetch_resource_video:function(skin){return'<video class="poodll_resourceplayer_'+skin+' hide" src="@@RESOURCEURL@@" playsinline="playsinline"></video>'},fetch_uploader_skin:function(controlbarid,element){var ip=this.fetch_instanceprops(controlbarid),upskin=upskin_bar.clone();return upskin.init(ip.config,element,ip.controlbar.split_progresscanvas,ip.controlbar.status),upskin},onMediaError:function(e){console.error("media error",e)},onMediaSuccess_video:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.controlbar.stopbutton.attr("disabled",!1),ip.controlbar.savebutton.attr("disabled",!1)},onMediaSuccess_audio:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.controlbar.checkplayer.attr("src",null),ip.controlbar.stopbutton.attr("disabled",!1),ip.controlbar.savebutton.attr("disabled",!1)},handle_timer_update:function(controlbarid){if(this.played||this.recorded){var ip=this.fetch_instanceprops(controlbarid),recordingstring=M.util.get_string("recui_recording","filter_poodll");this.update_status(controlbarid,recordingstring+ip.timer.fetch_display_time()),0==ip.timer.seconds&&ip.timer.initseconds>0&&ip.controlbar.stopbutton.click()}},update_status:function(controlbarid,text){this.fetch_instanceprops(controlbarid).controlbar.status.html(text)},set_visual_mode:function(mode,ip){switch(mode){case"recordingmode":this.disable_button(ip.controlbar.resourceplaybutton),ip.controlbar.resourceplaybutton.empty(),ip.controlbar.resourceplaybutton.html('<span class="fa fa-microphone fa-3x"></span>'),ip.controlbar.resourceplaybutton.addClass("poodll_mediarecorderholder_scenario_recordcolor"),ip.controlbar.status.addClass("poodll_mediarecorderholder_scenario_recordcolor"),this.handle_timer_update(ip.controlbarid),this.enable_button(ip.controlbar.stopbutton);break;case"resourceplayingmode":this.disable_button(ip.controlbar.resourceplaybutton),this.disable_button(ip.controlbar.stopbutton);break;case"neverrecordedmode":ip.controlbar.resourceplaybutton.empty(),ip.controlbar.resourceplaybutton.html('<p style="margin-bottom: 0px; font-size: 24px;">Start</p>'),this.enable_button(ip.controlbar.resourceplaybutton),this.disable_button(ip.controlbar.stopbutton),this.update_status(ip.controlbarid,M.util.get_string("recui_ready","filter_poodll"));break;case"allstoppedmode":this.disable_button(ip.controlbar.resourceplaybutton),this.disable_button(ip.controlbar.stopbutton),ip.controlbar.resourceplaybutton.empty(),ip.controlbar.resourceplaybutton.html('<span class="fa fa-check fa-3x"></span>'),ip.controlbar.resourceplaybutton.removeClass("poodll_mediarecorderholder_scenario_recordcolor"),ip.controlbar.status.removeClass("poodll_mediarecorderholder_scenario_recordcolor"),this.update_status(ip.controlbarid,M.util.get_string("recui_finished","filter_poodll"))}},insert_controlbar_video:function(element,controlbarid,checkplayer,resourceplayer){return this.prepare_controlbar(element,controlbarid,checkplayer,resourceplayer,"video")},insert_controlbar_audio:function(element,controlbarid,checkplayer,resourceplayer){return this.prepare_controlbar(element,controlbarid,checkplayer,resourceplayer,"audio")},prepare_controlbar:function(element,controlbarid,checkplayer,resourceplayer,mediatype){var ip=this.fetch_instanceprops(controlbarid),controls='<div class="poodll_mediarecorderholder_scenario '+("video"==mediatype?"poodll_mediarecorder_video":"poodll_mediarecorder_audio")+'" id="holder_'+controlbarid+'">';controls+='<div class="poodll_mediarecorderbox_scenario" id="'+controlbarid+'">',controls+='<div class="style-holder '+ip.config.media_skin_style+'">',controls+=checkplayer,controls+=resourceplayer=resourceplayer.replace("@@RESOURCEURL@@",ip.config.resource),controls+='<button type="button" class="poodll_mediarecorder_button_scenario poodll_start-recording_scenario hide"><span class="fa fa-microphone fa-3x"></span></button>',controls+=' <button type="button" class="poodll_mediarecorder_button_scenario poodll_playback-recording_scenario hide"><span class="fa fa-play-circle fa-3x"></span></button>',controls+=' <button type="button" class="poodll_mediarecorder_button_scenario poodll_stopplayback-recording_scenario hide"><span class="fa fa-stop-circle fa-3x"></span></button>',controls+='<button type="button" class="poodll_save-recording_scenario pmr_disabled hide">'+this.pmr.fetch_strings().recui_save+"</button></div>",controls+='<div class="poodll_mediarecorderholder_scenario"><button type="button" class="poodll_mediarecorder_button_scenario poodll_stop-recording_scenario pmr_disabled" disabled><p style="margin-bottom: 0px;font-size: 24px;">Submit</p></button></div>',controls+='<div class="poodll_statusholder_scenario" >',controls+='<canvas class="scenario_range"></canvas>',controls+=this.fetch_status_bar("scenario"),controls+="</div>",controls+="</div></div></div>",$(element).append(controls);return $(".qtext").prepend("<hr />"),$(".qtext").prepend('<div class="poodll_mediarecorderholder_scenario poodll_mediarecorder_scenario_topscenario"><button type="button" class="poodll_mediarecorder_button_scenario poodll_play-resource_scenario"><p style="margin-bottom: 0px; font-size: 24px;">Start</p></button></div>'),{scenario_progresscanvas:$("#"+controlbarid+" .scenario_range"),marker:$("#"+controlbarid+"  .marker"),resourceplayer:$("#"+controlbarid+"  .poodll_resourceplayer_scenario"),checkplayer:$("#"+controlbarid+"  .poodll_checkplayer_scenario"),stopbutton:$("#"+controlbarid+"  .poodll_stop-recording_scenario"),resourcestopbutton:$("#"+controlbarid+"  .poodll_stop-resource_scenario"),startbutton:$("#"+controlbarid+"  .poodll_start-recording_scenario"),playbackbutton:$("#"+controlbarid+"  .poodll_playback-recording_scenario"),stopplaybackbutton:$("#"+controlbarid+"  .poodll_stopplayback-recording_scenario"),savebutton:$("#"+controlbarid+"  .poodll_save-recording_scenario"),resourceplaybutton:$(".poodll_mediarecorder_button_scenario.poodll_play-resource_scenario"),status:$(".poodll_status_scenario")}},register_controlbar_events_video:function(onMediaSuccess,controlbarid){return this.register_controlbar_events_audio(onMediaSuccess,controlbarid)},do_callback:function(args){if("filesubmitted"===args[1]){var filenamecontrol=document.getElementById(args[3]);null==filenamecontrol&&(filenamecontrol=parent.document.getElementById(args[3])),filenamecontrol&&(filenamecontrol.value=args[2]),$("#responseform input[name=next]").attr("disabled",!1)}},register_controlbar_events_audio:function(onMediaSuccess,controlbarid){var self=this,pmr=this.pmr,ip=this.fetch_instanceprops(controlbarid);this.set_visual_mode("neverrecordedmode",ip),ip.config.callbackjs=self.do_callback,$("#responseform input[name=next]").attr("disabled",!0),ip.controlbar.startbutton.click((function(){pmr.do_start_audio(ip,onMediaSuccess),self.recorded=!0,ip.timer.reset(),ip.timer.start(),self.set_visual_mode("recordingmode",ip)})),ip.controlbar.stopbutton.click((function(){self.do_stop_resource(ip),pmr.do_stop_audio(ip),self.disable_button(this),setTimeout((function(){ip.controlbar.savebutton.click()}),100),ip.timer.stop(),self.set_visual_mode("allstoppedmode",ip)})),ip.controlbar.resourceplaybutton.click((function(){navigator.mediaDevices.getUserMedia({audio:!0}).then((function(stream){ip.controlbar.startbutton.trigger("click"),self.played=!0,""!=ip.config.resource&&self.do_play_resource(ip)})).catch((function(err){alert(err)}))})),ip.controlbar.resourcestopbutton.click((function(){self.do_stop_resource(ip),self.recorded?self.set_visual_mode("allstoppedmode",ip):self.set_visual_mode("neverrecordedmode",ip)})),ip.controlbar.savebutton.click((function(){return self.disable_button(this),ip.blobs&&ip.blobs.length>0?(pmr.do_save_audio(ip),self.uploaded=!0,self.disable_button(ip.controlbar.startbutton)):ip.uploader.Output(M.util.get_string("recui_nothingtosaveerror","filter_poodll")),!1}))},set_completion:function(completed,ip){},do_stop_resource:function(ip){console.log("stopped the resource");var resourceplayer=ip.controlbar.resourceplayer.get(0);if(resourceplayer.pause(),resourceplayer.currentTime=0,ip.mustResetResourcePlayer){ip.mustResetResourcePlayer=!1,resourceplayer.src=ip.config.resource;resourceplayer.load()}},do_play_resource:function(ip){var resourceplayer=ip.controlbar.resourceplayer.get(0);resourceplayer.play(),resourceplayer.currentTime=0},enable_button:function(button){$(button).attr("disabled",!1),$(button).removeClass("pmr_disabled")},disable_button:function(button){$(button).attr("disabled",!0),$(button).addClass("pmr_disabled")}}}));

//# sourceMappingURL=poodll_scenariomediaskin.min.js.map