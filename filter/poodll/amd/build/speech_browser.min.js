define(["jquery","core/log"],function(a,b){"use strict";return b.debug("speech_browser: initialising"),{recognition:null,recognizing:!1,ignore_onend:!1,final_transcript:"",start_timestamp:0,lang:"en-US",clone:function(){return a.extend(!0,{},this)},will_work_ok:function(a){var b="undefined"!=typeof navigator.brave;if(b)return!1;var c=navigator.userAgent.toLowerCase().indexOf("edg/")>-1;return!c&&("webkitSpeechRecognition"in window||"SpeechRecognition"in window)},init:function(a){var b=b||webkitSpeechRecognition;this.recognition=new b,this.recognition.continuous=!0,this.recognition.interimResults=!0,this.lang=a.language?a.language:"en-US",this.register_events()},set_grammar:function(a){var b=b||webkitSpeechGrammarList;if(b){var c=new b;c.addFromString(a,1),this.recognition.grammars=c}},start:function(a){this.recognizing||(this.recognizing=!0,this.final_transcript="",this.recognition.lang=this.lang,this.recognition.start(),this.ignore_onend=!1,this.start_timestamp=Date.now())},stop:function(){this.recognizing=!1,this.recognition.stop()},register_events:function(){var a=this.recognition,c=this;a.onstart=function(){c.recognizing=!0},a.onerror=function(a){"no-speech"==a.error&&(b.debug("info_no_speech"),c.ignore_onend=!0),"audio-capture"==a.error&&(b.debug("info_no_microphone"),c.ignore_onend=!0),"not-allowed"==a.error&&(a.timeStamp-c.start_timestamp<100?b.debug("info_blocked"):b.debug("info_denied"),c.ignore_onend=!0)},a.onend=function(){0!=c.recognizing&&(c.ignore_onend?c.recognizing=!1:a.start())},a.onresult=function(a){for(var b="",d=a.resultIndex;d<a.results.length;++d)a.results[d].isFinal?(c.final_transcript+=a.results[d][0].transcript,c.onfinalspeechcapture(c.final_transcript,JSON.stringify(a.results)),c.final_transcript=""):(b+=a.results[d][0].transcript,c.oninterimspeechcapture(b))}},onfinalspeechcapture:function(a,c){b.debug(a)},oninterimspeechcapture:function(a){}}});