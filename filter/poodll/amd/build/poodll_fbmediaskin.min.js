define(["jquery","core/log","filter_poodll/utils_amd"],(function($,log,utils){return log.debug("PoodLL Fluencybuilder Skin: initialising"),{instanceprops:null,pmr:null,uploaded:!1,clone:function(){return $.extend(!0,{},this)},init:function(ip,pmr){this.instanceprops=ip,this.instanceprops.warmedup=!1,this.pmr=pmr},fetch_instanceprops:function(){return this.instanceprops},onUploadSuccess:function(controlbarid){$("#"+controlbarid+" > .poodll_save-recording").hide(),$("#"+controlbarid+" > .poodll_savedsuccessfully").show()},onUploadFailure:function(controlbarid){},fetch_status_bar:function(skin){return'<div class="poodll_status_'+skin+' hide"></div>'},fetch_preview_audio:function(skin){return'<audio class="poodll_checkplayer_'+skin+' hide" playsinline="playsinline" muted></audio>'},fetch_model_audio:function(){return'<audio class="poodll_modelplayer_fluencybuilder hide" src="'+M.cfg.wwwroot+'/filter/poodll/ding.mp3" playsinline="playsinline"></audio>'},fetch_preview_video:function(skin){return'<video class="poodll_checkplayer_'+skin+'" width="320" height="240" playsinline="playsinline" muted></video>'},fetch_resource_audio:function(skin){return'<audio class="poodll_resourceplayer_'+skin+' hide" src="'+M.cfg.wwwroot+'/filter/poodll/ding.mp3" playsinline="playsinline"></audio>'},fetch_resource_video:function(skin){return'<video class="poodll_resourceplayer_'+skin+' hide" src="@@RESOURCEURLx@@" playsinline="playsinline"></video>'},fetch_uploader_skin:function(controlbarid,element){return!1},fetch_ding_player:function(){return'<audio class="poodll_dingplayer_fluencybuilder hide"  src="'+M.cfg.wwwroot+'/filter/poodll/ding.mp3" ></audio>'},onMediaError:function(e){console.error("media error",e)},onMediaSuccess_video:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);this.highlight_button("bwrapper_start-recording",controlbarid),ip.uploader.Output(""),ip.timer.reset(),ip.timer.start(),this.update_status(controlbarid),ip.controlbar.stopbutton.attr("disabled",!1),ip.controlbar.savebutton.attr("disabled",!1)},onMediaSuccess_audio:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);ip.controlbar.checkplayer.attr("src",null),this.pmr.do_pause_audio(ip)},handle_timer_update:function(controlbarid){var ip=this.fetch_instanceprops(controlbarid);this.update_status(controlbarid),0==ip.timer.seconds&&ip.timer.initseconds>0&&ip.controlbar.stoprecbutton.click()},update_status:function(controlbarid){},insert_controlbar_video:function(element,controlbarid,checkplayer,resourceplayer){return this.prepare_controlbar(element,controlbarid,checkplayer,resourceplayer,"video")},insert_controlbar_audio:function(element,controlbarid,checkplayer,resourceplayer){return this.prepare_controlbar(element,controlbarid,checkplayer,resourceplayer,"audio")},prepare_controlbar:function(element,controlbarid,checkplayer,resourceplayer,mediatype){var ip=this.fetch_instanceprops(controlbarid),skin_style=ip.config.media_skin_style,recorder_class="video"==mediatype?"poodll_mediarecorder_video":"poodll_mediarecorder_audio",modelplayer=(resourceplayer=resourceplayer.replace("@@RESOURCEURL@@",ip.config.resource),this.fetch_model_audio());modelplayer=modelplayer.replace("@@MODELURL@@",ip.config.resource2);var dingplayer=this.fetch_ding_player(),status=this.fetch_status_bar("fluencybuilder"),size_class="poodll_mediarecorder_size_auto";switch(ip.config.size){case"small":size_class="poodll_mediarecorder_size_small";break;case"big":size_class="poodll_mediarecorder_size_big";break;case"auto":size_class="poodll_mediarecorder_size_auto"}var controls='<div class="poodll_mediarecorderholder_fluencybuilder '+recorder_class+" "+size_class+'" id="holder_'+controlbarid+'">';return controls+='<div class="poodll_mediarecorderbox_fluencybuilder" id="'+controlbarid+'">',controls+='<div class="style-holder '+skin_style+'">',controls+=status,controls+=dingplayer,controls+=modelplayer,controls+=checkplayer,controls+=resourceplayer,controls+='<div class="fb_bwrapper bwrapper_play-resource mod_fluencybuilder_autobutton_inactive"><button type="button" class="poodll_mediarecorder_button_fluencybuilder poodll_play-resource_fluencybuilder"><i class="fa fa-assistive-listening-systems" aria-hidden="true"></i></button></div>',controls+='<div class="fb_bwrapper bwrapper_start-recording mod_fluencybuilder_autobutton_inactive"><button type="button" class="poodll_mediarecorder_button_fluencybuilder poodll_start-recording_fluencybuilder" disabled><i class="fa fa-microphone" aria-hidden="true"></i></button></div>',controls+='<div class="fb_bwrapper bwrapper_play-model mod_fluencybuilder_autobutton_inactive"> <button type="button" class="poodll_mediarecorder_button_fluencybuilder poodll_play-model_fluencybuilder" disabled><i class="fa fa-play-circle" aria-hidden="true"></i></button></div>',controls+='<button type="button" class="poodll_mediarecorder_button_fluencybuilder poodll_play-recording_fluencybuilder hide">'+M.util.get_string("recui_play","filter_poodll")+"</button>",controls+='<button type="button" class="poodll_mediarecorder_button_fluencybuilder poodll_stop-playing_fluencybuilder hide">stopplay</button>',controls+='<button type="button" class="poodll_mediarecorder_button_fluencybuilder poodll_stop-recording_fluencybuilder hide">'+M.util.get_string("recui_stop","filter_poodll")+"</button>",controls+='<button type="button" class="poodll_save-recording_fluencybuilder pmr_disabled hide">'+M.util.get_string("recui_save","filter_poodll")+"</button>",controls+="</div></div></div>",$(element).prepend(controls),{status:$("#"+controlbarid+"  .poodll_status_fluencybuilder"),dingplayer:$("#"+controlbarid+"  .poodll_dingplayer_fluencybuilder"),modelplayer:$("#"+controlbarid+"  .poodll_modelplayer_fluencybuilder"),resourceplayer:$("#"+controlbarid+"  .poodll_resourceplayer_fluencybuilder"),checkplayer:$("#"+controlbarid+"  .poodll_checkplayer_fluencybuilder"),resourcebutton:$("#"+controlbarid+"  .poodll_play-resource_fluencybuilder"),startbutton:$("#"+controlbarid+"  .poodll_start-recording_fluencybuilder"),stoprecbutton:$("#"+controlbarid+"  .poodll_stop-recording_fluencybuilder"),stopbutton:$("#"+controlbarid+"  .poodll_stop-playing_fluencybuilder"),playbutton:$("#"+controlbarid+"  .poodll_play-recording_fluencybuilder"),playmodelbutton:$("#"+controlbarid+"  .poodll_play-model_fluencybuilder"),savebutton:$("#"+controlbarid+"  .poodll_save-recording_fluencybuilder"),resourcewrapper:$("#"+controlbarid+"  .bwrapper_play-resource"),startrecwrapper:$("#"+controlbarid+"  .bwrapper_start-recording"),playmodelwrapper:$("#"+controlbarid+"  .bwrapper_play-model")}},register_controlbar_events_video:function(onMediaSuccess,controlbarid){return this.register_controlbar_events_audio(onMediaSuccess,controlbarid)},play_ding:function(action,controlbarid){var ip=this.fetch_instanceprops(controlbarid);switch(ip.controlbar.dingplayer[0].play(),action){case"click_start":ip.controlbar.startbutton.click();break;case"click_play":ip.controlbar.playmodelbutton.click();break;case"show_dialog":alert("dialog");break;default:ip.controlbar.dingplayer[0].onended=null}},highlight_button:function(highlightwrapper,controlbarid){var wrappers=$("#"+controlbarid+"  .fb_bwrapper");$(wrappers).each((function(index){$(this).hasClass(highlightwrapper)?($(this).removeClass("mod_fluencybuilder_autobutton_inactive"),$(this).addClass("mod_fluencybuilder_autobutton_active")):($(this).removeClass("mod_fluencybuilder_autobutton_active"),$(this).addClass("mod_fluencybuilder_autobutton_inactive"))}))},warmup_recorder:function(controlbarid,onMediaSuccess){var ip=this.fetch_instanceprops(controlbarid);this.pmr.warmup_context(ip),this.pmr.warmup_preview(ip),this.pmr.do_start_audio(ip,onMediaSuccess);var model=ip.controlbar.modelplayer.get(0),ding=ip.controlbar.dingplayer.get(0),resource=ip.controlbar.resourceplayer.get(0);if(!ip.warmedup)try{resource.play(),ding.play(),model.play(),resource.pause(),ding.pause(),model.pause()}catch(e){}var dingurl=M.cfg.wwwroot+"/filter/poodll/ding.mp3";$(model).attr("src",ip.config.resource2),$(ding).attr("src",dingurl),$(resource).attr("src",ip.config.resource),ip.warmedup=!0},register_controlbar_events_audio:function(onMediaSuccess,controlbarid){var self=this,pmr=this.pmr,ip=this.fetch_instanceprops(controlbarid);ip.controlbar.resourceplayer.on("ended",(function(){ip.warmedup&&self.play_ding("click_start",controlbarid)})),ip.controlbar.modelplayer.on("ended",(function(){self.highlight_button("",controlbarid)})),ip.controlbar.startbutton.click((function(){pmr.do_resume_audio(ip),self.highlight_button("bwrapper_start-recording",controlbarid),ip.uploader.Output(""),ip.timer.reset(),ip.timer.start(),self.update_status(controlbarid),ip.controlbar.stopbutton.attr("disabled",!1),ip.controlbar.savebutton.attr("disabled",!1)})),ip.controlbar.stoprecbutton.click((function(){pmr.do_stop_audio(ip),self.play_ding("click_play",controlbarid),ip.timer.stop(),self.update_status(controlbarid)})),ip.controlbar.stopbutton.click((function(){self.highlight_button("none",controlbarid),ip.timer.stop(),self.update_status(controlbarid)})),ip.controlbar.playmodelbutton.click((function(){ip.controlbar.modelplayer.get(0).play(),self.highlight_button("bwrapper_play-model",controlbarid)})),ip.controlbar.playbutton.click((function(){var checkplayer=ip.controlbar.checkplayer.get(0);pmr.do_play_audio(ip,checkplayer)})),ip.controlbar.resourcebutton.click((function(){self.warmup_recorder(controlbarid,onMediaSuccess),self.disable_button(this),ip.controlbar.resourceplayer.get(0).play(),self.highlight_button("bwrapper_play-resource",controlbarid)})),ip.controlbar.savebutton.click((function(){return self.disable_button(this),ip.blobs&&ip.blobs.length>0?(pmr.do_save_audio(ip),self.uploaded=!0,self.disable_button(ip.controlbar.startbutton)):ip.uploader.Output(M.util.get_string("recui_nothingtosaveerror","filter_poodll")),!1})),window.onbeforeunload=function(){self.enable_button(ip.controlbar.startbutton);var checkplayer=ip.controlbar.checkplayer;checkplayer&&checkplayer.get(0)&&checkplayer.get(0).pause()}},enable_button:function(button){$(button).prop("disabled",!1)},disable_button:function(button){$(button).prop("disabled",!0)},show_button:function(button){button.show()},hide_button:function(button){button.hide()}}}));

//# sourceMappingURL=poodll_fbmediaskin.min.js.map