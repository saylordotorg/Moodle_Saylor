{"version":3,"sources":["../src/poodll_snapshotrecorder.js"],"names":["define","$","log","utils","uploader","Webcam","debug","instanceprops","fetch_instance_props","widgetid","init_instance_props","imagefile","htmlthings","config","supports_current_browser","iOS","is_ios","mediatype","embed","element","ip","clone","init","insert_controls","register_events","camera","preview","snapbutton","savebutton","cancelbutton","controls","M","util","get_string","prepend","set","cfg","wwwroot","attach","on","imageblob","dataURItoBlob","uploadFile","Output","addClass","html","removeClass","snap","data_uri"],"mappings":"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","sourcesContent":["/* jshint ignore:start */\ndefine(['jquery', 'core/log', 'filter_poodll/utils_amd', 'filter_poodll/uploader', 'filter_poodll/webcam'], function ($, log, utils, uploader, Webcam) {\n\n    \"use strict\"; // jshint ;_;\n\n    log.debug('PoodLL Snapshot Recorder: initialising');\n\n    return {\n\n        instanceprops: [],\n\n        fetch_instance_props: function (widgetid) {\n            return this.instanceprops[widgetid];\n        },\n\n        init_instance_props: function (widgetid) {\n            var props = {};\n            props.imagefile = false;\n            props.htmlthings = '';\n            props.config = null;\n            props.uploader = null;\n            this.instanceprops[widgetid] = props\n        },\n\n        // This recorder supports the current browser\n        supports_current_browser: function (config) {\n            var iOS = utils.is_ios();\n            if (iOS) {\n                return false;\n            } else {\n                if (config.mediatype != 'snapshot') {\n                    return false;\n                }\n\n                log.debug('PoodLL Snapshot Recorder: supports this browser');\n                return true;\n            }\n        },\n\n        // Perform the embed of this recorder on the page\n        //into the element passed in. with config\n        embed: function (element, config) {\n            this.init_instance_props(config.widgetid);\n            var ip = this.fetch_instance_props(config.widgetid);\n            //set config\n            ip.config = config;\n\n            //set uploader\n            ip.uploader = uploader.clone();\n            ip.uploader.init(element, config);\n\n            this.insert_controls(element, config.widgetid);\n            this.register_events(config.widgetid);\n        },\n\n        insert_controls: function (element, widgetid) {\n            var ip = this.fetch_instance_props(widgetid);\n\n            //for now.\n            var acceptmedia = '';\n            var config = ip.config;\n\n\n            var htmlthings = {\n                camera: config.widgetid + '_poodll_snapshot_camera',\n                preview: config.widgetid + '_poodll_snapshot_preview',\n                snapbutton: config.widgetid + '_poodll_take-snapshot',\n                savebutton: config.widgetid + '_poodll_save-snapshot',\n                cancelbutton: config.widgetid + '_poodll_cancel-snapshot'\n            };\n            ip.htmlthings = htmlthings;\n\n\n            //html5 snapshot maker proper\n            //camera\n            var controls = '<div id=\"' + htmlthings.camera + '\" style=\"width:320px; height:240px;\"></div>';\n            //preview\n            controls += '<div id=\"' + htmlthings.preview + '\" class=\"hide\" style=\"width:320px; height:240px;\"></div>';\n            //snap button\n            controls += '<button type=\"button\" class=\"poodll_take-snapshot\" id=\"' + htmlthings.snapbutton + '\">' +\n                M.util.get_string('recui_takesnapshot', 'filter_poodll') +\n                '</button>';\n            //cancel button\n            controls += '<button type=\"button\" class=\"poodll_cancel-snapshot\" id=\"' + htmlthings.cancelbutton + '\">' +\n                M.util.get_string('recui_cancelsnapshot', 'filter_poodll') +\n                '</button>';\n            //save button\n            controls += '<button type=\"button\" class=\"poodll_save-recording\" id=\"' + htmlthings.savebutton + '\">' +\n                M.util.get_string('recui_save', 'filter_poodll') +\n                '</button>';\n            $(element).prepend(controls);\n        },\n\n        // handle image file uploads for Mobile\n        register_events: function (widgetid) {\n\n            var ip = this.fetch_instance_props(widgetid);\n            var config = ip.config;\n\n            Webcam.set('swfURL', M.cfg.wwwroot + '/filter/poodll/3rdparty/webcam/webcam.swf');\n            Webcam.attach('#' + ip.htmlthings.camera);\n\n            $('#' + ip.htmlthings.savebutton).on('click', function (e) {\n                if (ip.imagefile) {\n                    var mimetype = 'image/jpeg';\n                    var imageblob = ip.uploader.dataURItoBlob(ip.imagefile, mimetype);\n                    ip.uploader.uploadFile(imageblob, mimetype);\n                } else {\n                    ip.uploader.Output(M.util.get_string('recui_nothingtosaveerror', 'filter_poodll'));\n                }//end of if ip.imagefile\t\t\n            });\n\n            $('#' + ip.htmlthings.cancelbutton).on('click', function (e) {\n                ip.imagefile = false;\n                $('#' + ip.htmlthings.preview).addClass('hide').html('');\n                $('#' + ip.htmlthings.camera).removeClass('hide');\n            });\n\n            $('#' + ip.htmlthings.snapbutton).on('click', function (e) {\n                Webcam.snap(function (data_uri) {\n                    ip.imagefile = data_uri;\n                    $('#' + ip.htmlthings.preview).html('<img src=\"' + data_uri + '\"/>').removeClass('hide');\n                    $('#' + ip.htmlthings.camera).addClass('hide');\n                });\n            });\n\n        }\n    }//end of returned object\n});//total end\n"],"file":"poodll_snapshotrecorder.min.js"}