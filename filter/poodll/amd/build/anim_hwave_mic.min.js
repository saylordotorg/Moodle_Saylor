define(["jquery","core/log"],function(a,b){"use strict";return b.debug("anim_horizontal_wave_mic: initialising"),{analyser:null,cvs:null,cvsctx:null,sounddetected:!1,imgone:null,imgoneloaded:!1,drawparams:{micColor:"#CCCCCC",wavColor:"#CCCCCC",lineWidth:2},clone:function(){return a.extend(!0,{},this)},setDrawParam:function(a,b){this.drawparams[a]=b},init:function(a,b){this.cvs=b,this.cvsctx=b.getContext("2d"),this.cvsctx.textAlign="center",this.analyser=a;var c=this;this.imgone=new Image,this.imgone.addEventListener("load",function(){c.imgoneloaded=!0}),this.imgone.src=M.cfg.wwwroot+"/filter/poodll/pix/svg/mic.svg"},clear:function(){if(!this.imgoneloaded){var a=this;return void this.imgone.addEventListener("load",function(){a.imgoneloaded=!0,a.clear()})}this.cvsctx.clearRect(0,0,this.cvs.width,this.cvs.height),this.cvsctx.beginPath(),this.cvsctx.lineWidth=this.drawparams.lineWidth,this.cvsctx.strokeStyle=this.drawparams.wavColor,this.cvsctx.moveTo(0,this.cvs.height/2),this.cvsctx.lineTo(this.cvs.width,this.cvs.height/2),this.cvsctx.stroke(),this.drawMic(this.cvsctx,this.cvs.width,this.cvs.height,this.imgone)},drawMic:function(a,b,c,d){var e=(b-d.width)/2,f=(c-d.height)/2;a.drawImage(d,e,f)},start:function(){this.analyser.core.fftSize=2048;var a=this.analyser.core.fftSize,b=new Uint8Array(a),c=this.cvs.width,d=this.cvs.height,e=this.cvsctx,f=this.analyser,g=this;this.clear();var h=function(){requestAnimationFrame(h);if(f.theinterval){f.core.getByteTimeDomainData(b),e.clearRect(0,0,c,d),e.lineWidth=g.drawparams.lineWidth,e.strokeStyle=g.drawparams.wavColor,e.beginPath();var i=2*c/a,j=0,k=0;if(a>0){var l=b[a-1];128!=l&&(g.sounddetected=!0)}for(var m=0;m<a;m++){var n=b[m]/128,o=n*d/2;0===m?e.moveTo(j,o):e.lineTo(j,o),k=o,j+=i}e.lineTo(c,d/2),e.stroke(),g.drawMic(e,c,d,g.imgone)}};h()}}});