define(["jquery","core/log"],(function($,log){return log.debug("anim_horizontal_wave_mic: initialising"),{analyser:null,cvs:null,cvsctx:null,sounddetected:!1,imgone:null,imgoneloaded:!1,drawparams:{micColor:"#CCCCCC",wavColor:"#CCCCCC",lineWidth:2},clone:function(){return $.extend(!0,{},this)},setDrawParam:function(paramkey,paramvalue){this.drawparams[paramkey]=paramvalue},init:function(analyser,cvs){this.cvs=cvs,this.cvsctx=cvs.getContext("2d"),this.cvsctx.textAlign="center",this.analyser=analyser;var that=this;this.imgone=new Image,this.imgone.addEventListener("load",(function(){that.imgoneloaded=!0})),this.imgone.src=M.cfg.wwwroot+"/filter/poodll/pix/svg/mic.svg"},clear:function(){if(this.imgoneloaded)this.cvsctx.clearRect(0,0,this.cvs.width,this.cvs.height),this.cvsctx.beginPath(),this.cvsctx.lineWidth=this.drawparams.lineWidth,this.cvsctx.strokeStyle=this.drawparams.wavColor,this.cvsctx.moveTo(0,this.cvs.height/2),this.cvsctx.lineTo(this.cvs.width,this.cvs.height/2),this.cvsctx.stroke(),this.drawMic(this.cvsctx,this.cvs.width,this.cvs.height,this.imgone);else{var that=this;this.imgone.addEventListener("load",(function(){that.imgoneloaded=!0,that.clear()}))}},drawMic:function(ctx,cwidth,cheight,mic){var x=(cwidth-mic.width)/2,y=(cheight-mic.height)/2;ctx.drawImage(mic,x,y)},start:function(){this.analyser.core.fftSize=2048;var bufferLength=this.analyser.core.fftSize,dataArray=new Uint8Array(bufferLength),cwidth=this.cvs.width,cheight=this.cvs.height,canvasCtx=this.cvsctx,analyser=this.analyser,that=this;this.clear();!function draw(){requestAnimationFrame(draw);if(analyser.theinterval){analyser.core.getByteTimeDomainData(dataArray),canvasCtx.clearRect(0,0,cwidth,cheight),canvasCtx.lineWidth=that.drawparams.lineWidth,canvasCtx.strokeStyle=that.drawparams.wavColor,canvasCtx.beginPath();var sliceWidth=2*cwidth/bufferLength,x=0;if(bufferLength>0)128!=dataArray[bufferLength-1]&&(that.sounddetected=!0);for(var i=0;i<bufferLength;i++){var y=dataArray[i]/128*cheight/2;0===i?canvasCtx.moveTo(x,y):canvasCtx.lineTo(x,y),y,x+=sliceWidth}canvasCtx.lineTo(cwidth,cheight/2),canvasCtx.stroke(),that.drawMic(canvasCtx,cwidth,cheight,that.imgone)}}()}}}));

//# sourceMappingURL=anim_hwave_mic.min.js.map