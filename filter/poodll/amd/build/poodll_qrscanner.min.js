define ("filter_poodll/poodll_qrscanner",["jquery","core/log"],function(e,t){"use strict";t.debug("poodll_qrscanner is now loaded");var P={checkAndNudgePoints:function(e,t){for(var i=I.width,o=I.height,r=!0,a=0;a<t.length&&r;a+=2){var n=Math.floor(t[a]),d=Math.floor(t[a+1]);if(-1>n||n>i||-1>d||d>o){throw"Error.checkAndNudgePoints "}r=!1;if(-1==n){t[a]=0;r=!0}else if(n==i){t[a]=i-1;r=!0}if(-1==d){t[a+1]=0;r=!0}else if(d==o){t[a+1]=o-1;r=!0}}r=!0;for(var a=t.length-2;0<=a&&r;a-=2){var n=Math.floor(t[a]),d=Math.floor(t[a+1]);if(-1>n||n>i||-1>d||d>o){throw"Error.checkAndNudgePoints "}r=!1;if(-1==n){t[a]=0;r=!0}else if(n==i){t[a]=i-1;r=!0}if(-1==d){t[a+1]=0;r=!0}else if(d==o){t[a+1]=o-1;r=!0}}}};P.sampleGrid3=function(e,t,i){for(var o=new c(t),r=Array(t<<1),a=0;a<t;a++){for(var n=r.length,d=a+.5,s=0;s<n;s+=2){r[s]=(s>>1)+.5;r[s+1]=d}i.transformPoints1(r);P.checkAndNudgePoints(e,r);try{for(var s=0,l;s<n;s+=2){l=e[Math.floor(r[s])+I.width*Math.floor(r[s+1])];if(l)o.set_Renamed(s>>1,a)}}catch(e){throw"Error.checkAndNudgePoints"}}return o};P.sampleGridx=function(e,t,i,o,r,n,d,s,l,c,f,g,u,h,m,b,C,_){var p=a.quadrilateralToQuadrilateral(i,o,r,n,d,s,l,c,f,g,u,h,m,b,C,_);return P.sampleGrid3(e,t,p)};function i(e,t){this.count=e;this.dataCodewords=t;this.__defineGetter__("Count",function(){return this.count});this.__defineGetter__("DataCodewords",function(){return this.dataCodewords})}function o(e,t,i){this.ecCodewordsPerBlock=e;if(i)this.ecBlocks=[t,i];else this.ecBlocks=Array(t);this.__defineGetter__("ECCodewordsPerBlock",function(){return this.ecCodewordsPerBlock});this.__defineGetter__("TotalECCodewords",function(){return this.ecCodewordsPerBlock*this.NumBlocks});this.__defineGetter__("NumBlocks",function(){for(var e=0,t=0;t<this.ecBlocks.length;t++){e+=this.ecBlocks[t].length}return e});this.getECBlocks=function(){return this.ecBlocks}}function r(e,t,o,r,a,n){this.versionNumber=e;this.alignmentPatternCenters=t;this.ecBlocks=[o,r,a,n];for(var d=0,s=o.ECCodewordsPerBlock,l=o.getECBlocks(),f=0,g;f<l.length;f++){g=l[f];d+=g.Count*(g.DataCodewords+s)}this.totalCodewords=d;this.__defineGetter__("VersionNumber",function(){return this.versionNumber});this.__defineGetter__("AlignmentPatternCenters",function(){return this.alignmentPatternCenters});this.__defineGetter__("TotalCodewords",function(){return this.totalCodewords});this.__defineGetter__("DimensionForVersion",function(){return 17+4*this.versionNumber});this.buildFunctionPattern=function(){var e=this.DimensionForVersion,t=new c(e);t.setRegion(0,0,9,9);t.setRegion(e-8,0,8,9);t.setRegion(0,e-8,9,8);for(var o=this.alignmentPatternCenters.length,r=0,a;r<o;r++){a=this.alignmentPatternCenters[r]-2;for(var n=0;n<o;n++){if(0==r&&(0==n||n==o-1)||r==o-1&&0==n){continue}t.setRegion(this.alignmentPatternCenters[n]-2,a,5,5)}}t.setRegion(6,9,1,e-17);t.setRegion(9,6,e-17,1);if(6<this.versionNumber){t.setRegion(e-11,0,3,6);t.setRegion(0,e-11,6,3)}return t};this.getECBlocksForLevel=function(e){return this.ecBlocks[e.ordinal()]}}r.VERSION_DECODE_INFO=[31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017];r.VERSIONS=function(){return[new r(1,[],new o(7,new i(1,19)),new o(10,new i(1,16)),new o(13,new i(1,13)),new o(17,new i(1,9))),new r(2,[6,18],new o(10,new i(1,34)),new o(16,new i(1,28)),new o(22,new i(1,22)),new o(28,new i(1,16))),new r(3,[6,22],new o(15,new i(1,55)),new o(26,new i(1,44)),new o(18,new i(2,17)),new o(22,new i(2,13))),new r(4,[6,26],new o(20,new i(1,80)),new o(18,new i(2,32)),new o(26,new i(2,24)),new o(16,new i(4,9))),new r(5,[6,30],new o(26,new i(1,108)),new o(24,new i(2,43)),new o(18,new i(2,15),new i(2,16)),new o(22,new i(2,11),new i(2,12))),new r(6,[6,34],new o(18,new i(2,68)),new o(16,new i(4,27)),new o(24,new i(4,19)),new o(28,new i(4,15))),new r(7,[6,22,38],new o(20,new i(2,78)),new o(18,new i(4,31)),new o(18,new i(2,14),new i(4,15)),new o(26,new i(4,13),new i(1,14))),new r(8,[6,24,42],new o(24,new i(2,97)),new o(22,new i(2,38),new i(2,39)),new o(22,new i(4,18),new i(2,19)),new o(26,new i(4,14),new i(2,15))),new r(9,[6,26,46],new o(30,new i(2,116)),new o(22,new i(3,36),new i(2,37)),new o(20,new i(4,16),new i(4,17)),new o(24,new i(4,12),new i(4,13))),new r(10,[6,28,50],new o(18,new i(2,68),new i(2,69)),new o(26,new i(4,43),new i(1,44)),new o(24,new i(6,19),new i(2,20)),new o(28,new i(6,15),new i(2,16))),new r(11,[6,30,54],new o(20,new i(4,81)),new o(30,new i(1,50),new i(4,51)),new o(28,new i(4,22),new i(4,23)),new o(24,new i(3,12),new i(8,13))),new r(12,[6,32,58],new o(24,new i(2,92),new i(2,93)),new o(22,new i(6,36),new i(2,37)),new o(26,new i(4,20),new i(6,21)),new o(28,new i(7,14),new i(4,15))),new r(13,[6,34,62],new o(26,new i(4,107)),new o(22,new i(8,37),new i(1,38)),new o(24,new i(8,20),new i(4,21)),new o(22,new i(12,11),new i(4,12))),new r(14,[6,26,46,66],new o(30,new i(3,115),new i(1,116)),new o(24,new i(4,40),new i(5,41)),new o(20,new i(11,16),new i(5,17)),new o(24,new i(11,12),new i(5,13))),new r(15,[6,26,48,70],new o(22,new i(5,87),new i(1,88)),new o(24,new i(5,41),new i(5,42)),new o(30,new i(5,24),new i(7,25)),new o(24,new i(11,12),new i(7,13))),new r(16,[6,26,50,74],new o(24,new i(5,98),new i(1,99)),new o(28,new i(7,45),new i(3,46)),new o(24,new i(15,19),new i(2,20)),new o(30,new i(3,15),new i(13,16))),new r(17,[6,30,54,78],new o(28,new i(1,107),new i(5,108)),new o(28,new i(10,46),new i(1,47)),new o(28,new i(1,22),new i(15,23)),new o(28,new i(2,14),new i(17,15))),new r(18,[6,30,56,82],new o(30,new i(5,120),new i(1,121)),new o(26,new i(9,43),new i(4,44)),new o(28,new i(17,22),new i(1,23)),new o(28,new i(2,14),new i(19,15))),new r(19,[6,30,58,86],new o(28,new i(3,113),new i(4,114)),new o(26,new i(3,44),new i(11,45)),new o(26,new i(17,21),new i(4,22)),new o(26,new i(9,13),new i(16,14))),new r(20,[6,34,62,90],new o(28,new i(3,107),new i(5,108)),new o(26,new i(3,41),new i(13,42)),new o(30,new i(15,24),new i(5,25)),new o(28,new i(15,15),new i(10,16))),new r(21,[6,28,50,72,94],new o(28,new i(4,116),new i(4,117)),new o(26,new i(17,42)),new o(28,new i(17,22),new i(6,23)),new o(30,new i(19,16),new i(6,17))),new r(22,[6,26,50,74,98],new o(28,new i(2,111),new i(7,112)),new o(28,new i(17,46)),new o(30,new i(7,24),new i(16,25)),new o(24,new i(34,13))),new r(23,[6,30,54,74,102],new o(30,new i(4,121),new i(5,122)),new o(28,new i(4,47),new i(14,48)),new o(30,new i(11,24),new i(14,25)),new o(30,new i(16,15),new i(14,16))),new r(24,[6,28,54,80,106],new o(30,new i(6,117),new i(4,118)),new o(28,new i(6,45),new i(14,46)),new o(30,new i(11,24),new i(16,25)),new o(30,new i(30,16),new i(2,17))),new r(25,[6,32,58,84,110],new o(26,new i(8,106),new i(4,107)),new o(28,new i(8,47),new i(13,48)),new o(30,new i(7,24),new i(22,25)),new o(30,new i(22,15),new i(13,16))),new r(26,[6,30,58,86,114],new o(28,new i(10,114),new i(2,115)),new o(28,new i(19,46),new i(4,47)),new o(28,new i(28,22),new i(6,23)),new o(30,new i(33,16),new i(4,17))),new r(27,[6,34,62,90,118],new o(30,new i(8,122),new i(4,123)),new o(28,new i(22,45),new i(3,46)),new o(30,new i(8,23),new i(26,24)),new o(30,new i(12,15),new i(28,16))),new r(28,[6,26,50,74,98,122],new o(30,new i(3,117),new i(10,118)),new o(28,new i(3,45),new i(23,46)),new o(30,new i(4,24),new i(31,25)),new o(30,new i(11,15),new i(31,16))),new r(29,[6,30,54,78,102,126],new o(30,new i(7,116),new i(7,117)),new o(28,new i(21,45),new i(7,46)),new o(30,new i(1,23),new i(37,24)),new o(30,new i(19,15),new i(26,16))),new r(30,[6,26,52,78,104,130],new o(30,new i(5,115),new i(10,116)),new o(28,new i(19,47),new i(10,48)),new o(30,new i(15,24),new i(25,25)),new o(30,new i(23,15),new i(25,16))),new r(31,[6,30,56,82,108,134],new o(30,new i(13,115),new i(3,116)),new o(28,new i(2,46),new i(29,47)),new o(30,new i(42,24),new i(1,25)),new o(30,new i(23,15),new i(28,16))),new r(32,[6,34,60,86,112,138],new o(30,new i(17,115)),new o(28,new i(10,46),new i(23,47)),new o(30,new i(10,24),new i(35,25)),new o(30,new i(19,15),new i(35,16))),new r(33,[6,30,58,86,114,142],new o(30,new i(17,115),new i(1,116)),new o(28,new i(14,46),new i(21,47)),new o(30,new i(29,24),new i(19,25)),new o(30,new i(11,15),new i(46,16))),new r(34,[6,34,62,90,118,146],new o(30,new i(13,115),new i(6,116)),new o(28,new i(14,46),new i(23,47)),new o(30,new i(44,24),new i(7,25)),new o(30,new i(59,16),new i(1,17))),new r(35,[6,30,54,78,102,126,150],new o(30,new i(12,121),new i(7,122)),new o(28,new i(12,47),new i(26,48)),new o(30,new i(39,24),new i(14,25)),new o(30,new i(22,15),new i(41,16))),new r(36,[6,24,50,76,102,128,154],new o(30,new i(6,121),new i(14,122)),new o(28,new i(6,47),new i(34,48)),new o(30,new i(46,24),new i(10,25)),new o(30,new i(2,15),new i(64,16))),new r(37,[6,28,54,80,106,132,158],new o(30,new i(17,122),new i(4,123)),new o(28,new i(29,46),new i(14,47)),new o(30,new i(49,24),new i(10,25)),new o(30,new i(24,15),new i(46,16))),new r(38,[6,32,58,84,110,136,162],new o(30,new i(4,122),new i(18,123)),new o(28,new i(13,46),new i(32,47)),new o(30,new i(48,24),new i(14,25)),new o(30,new i(42,15),new i(32,16))),new r(39,[6,26,54,82,110,138,166],new o(30,new i(20,117),new i(4,118)),new o(28,new i(40,47),new i(7,48)),new o(30,new i(43,24),new i(22,25)),new o(30,new i(10,15),new i(67,16))),new r(40,[6,30,58,86,114,142,170],new o(30,new i(19,118),new i(6,119)),new o(28,new i(18,47),new i(31,48)),new o(30,new i(34,24),new i(34,25)),new o(30,new i(20,15),new i(61,16)))]}();r.getVersionForNumber=function(e){if(1>e||40<e){throw"ArgumentException"}return r.VERSIONS[e-1]};r.getProvisionalVersionForDimension=function(e){if(1!=e%4){throw"Error getProvisionalVersionForDimension"}try{return r.getVersionForNumber(e-17>>2)}catch(e){throw"Error getVersionForNumber"}};r.decodeVersionInformation=function(e){for(var t=4294967295,o=0,a=0,n;a<r.VERSION_DECODE_INFO.length;a++){n=r.VERSION_DECODE_INFO[a];if(n==e){return this.getVersionForNumber(a+7)}var d=s.numBitsDiffering(e,n);if(d<t){o=a+7;t=d}}if(3>=t){return this.getVersionForNumber(o)}return null};function a(e,t,i,o,r,n,d,s,l){this.a11=e;this.a12=o;this.a13=d;this.a21=t;this.a22=r;this.a23=s;this.a31=i;this.a32=n;this.a33=l;this.transformPoints1=function(e){for(var t=e.length,o=this.a11,r=this.a12,a=this.a13,n=this.a21,d=this.a22,s=this.a23,l=this.a31,c=this.a32,f=this.a33,g=0;g<t;g+=2){var u=e[g],h=e[g+1],m=a*u+s*h+f;e[g]=(o*u+n*h+l)/m;e[g+1]=(r*u+d*h+c)/m}};this.transformPoints2=function(e,t){for(var o=e.length,r=0;r<o;r++){var a=e[r],n=t[r],d=this.a13*a+this.a23*n+this.a33;e[r]=(this.a11*a+this.a21*n+this.a31)/d;t[r]=(this.a12*a+this.a22*n+this.a32)/d}};this.buildAdjoint=function(){return new a(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)};this.times=function(e){return new a(this.a11*e.a11+this.a21*e.a12+this.a31*e.a13,this.a11*e.a21+this.a21*e.a22+this.a31*e.a23,this.a11*e.a31+this.a21*e.a32+this.a31*e.a33,this.a12*e.a11+this.a22*e.a12+this.a32*e.a13,this.a12*e.a21+this.a22*e.a22+this.a32*e.a23,this.a12*e.a31+this.a22*e.a32+this.a32*e.a33,this.a13*e.a11+this.a23*e.a12+this.a33*e.a13,this.a13*e.a21+this.a23*e.a22+this.a33*e.a23,this.a13*e.a31+this.a23*e.a32+this.a33*e.a33)}}a.quadrilateralToQuadrilateral=function(e,t,i,o,r,a,n,d,s,l,c,f,g,u,h,m){var b=this.quadrilateralToSquare(e,t,i,o,r,a,n,d),C=this.squareToQuadrilateral(s,l,c,f,g,u,h,m);return C.times(b)};a.squareToQuadrilateral=function(e,t,i,o,r,n,d,s){var l=s-n,c=t-o+n-s;if(0==l&&0==c){return new a(i-e,r-i,e,o-t,n-o,t,0,0,1)}else{var f=i-r,g=d-r,u=e-i+r-d,h=o-n,m=f*l-g*h,b=(u*l-g*c)/m,C=(f*c-u*h)/m;return new a(i-e+b*i,d-e+C*d,e,o-t+b*o,s-t+C*s,t,b,C,1)}};a.quadrilateralToSquare=function(e,t,i,o,r,a,n,d){return this.squareToQuadrilateral(e,t,i,o,r,a,n,d).buildAdjoint()};function n(e,t){this.bits=e;this.points=t}function d(e){this.image=e;this.resultPointCallback=null;this.sizeOfBlackWhiteBlackRun=function(e,t,i,o){var r=Math.abs(o-t)>Math.abs(i-e);if(r){var a=e;e=t;t=a;a=i;i=o;o=a}for(var n=Math.abs(i-e),d=Math.abs(o-t),s=-n>>1,l=t<o?1:-1,c=e<i?1:-1,f=0,g=e,u=t;g!=i;g+=c){var h=r?u:g,m=r?g:u;if(1==f){if(this.image[h+m*I.width]){f++}}else{if(!this.image[h+m*I.width]){f++}}if(3==f){var b=g-e,C=u-t;return Math.sqrt(b*b+C*C)}s+=d;if(0<s){if(u==o){break}u+=l;s-=n}}var _=i-e,p=o-t;return Math.sqrt(_*_+p*p)};this.sizeOfBlackWhiteBlackRunBothWays=function(e,t,i,o){var r=this.sizeOfBlackWhiteBlackRun(e,t,i,o),a=1,n=e-(i-e);if(0>n){a=e/(e-n);n=0}else if(n>=I.width){a=(I.width-1-e)/(n-e);n=I.width-1}var d=Math.floor(t-(o-t)*a);a=1;if(0>d){a=t/(t-d);d=0}else if(d>=I.height){a=(I.height-1-t)/(d-t);d=I.height-1}n=Math.floor(e+(n-e)*a);r+=this.sizeOfBlackWhiteBlackRun(e,t,n,d);return r-1};this.calculateModuleSizeOneWay=function(e,t){var i=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(e.X),Math.floor(e.Y),Math.floor(t.X),Math.floor(t.Y)),o=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(t.X),Math.floor(t.Y),Math.floor(e.X),Math.floor(e.Y));if(isNaN(i)){return o/7}if(isNaN(o)){return i/7}return(i+o)/14};this.calculateModuleSize=function(e,t,i){return(this.calculateModuleSizeOneWay(e,t)+this.calculateModuleSizeOneWay(e,i))/2};this.distance=function(e,t){var i=e.X-t.X,o=e.Y-t.Y;return Math.sqrt(i*i+o*o)};this.computeDimension=function(e,t,i,o){var r=Math.round(this.distance(e,t)/o),a=Math.round(this.distance(e,i)/o),n=(r+a>>1)+7;switch(3&n){case 0:n++;break;case 2:n--;break;case 3:throw"Error";}return n};this.findAlignmentInRegion=function(e,t,i,o){var r=Math.floor(o*e),a=Math.max(0,t-r),n=Math.min(I.width-1,t+r);if(n-a<3*e){throw"Error"}var d=Math.max(0,i-r),s=Math.min(I.height-1,i+r),l=new k(this.image,a,d,n-a,s-d,e,this.resultPointCallback);return l.find()};this.createTransform=function(e,t,i,o,r){var n=r-3.5,d,s,l,c;if(null!=o){d=o.X;s=o.Y;l=c=n-3}else{d=t.X-e.X+i.X;s=t.Y-e.Y+i.Y;l=c=n}var f=a.quadrilateralToQuadrilateral(3.5,3.5,n,3.5,l,c,3.5,n,e.X,e.Y,t.X,t.Y,d,s,i.X,i.Y);return f};this.sampleGrid=function(e,t,i){return P.sampleGrid3(e,i,t)};this.processFinderPatternInfo=function(e){var t=e.TopLeft,o=e.TopRight,a=e.BottomLeft,d=this.calculateModuleSize(t,o,a);if(1>d){throw"Error"}var s=this.computeDimension(t,o,a,d),l=r.getProvisionalVersionForDimension(s),c=l.DimensionForVersion-7,f=null;if(0<l.AlignmentPatternCenters.length){for(var g=o.X-t.X+a.X,u=o.Y-t.Y+a.Y,h=1-3/c,m=Math.floor(t.X+h*(g-t.X)),b=Math.floor(t.Y+h*(u-t.Y)),C=4;16>=C;C<<=1){f=this.findAlignmentInRegion(d,m,b,C);break}}var _=this.createTransform(t,o,a,f,s),p=this.sampleGrid(this.image,_,s),k;if(null==f){k=[a,t,o]}else{k=[a,t,o,f]}return new n(p,k)};this.detect=function(){var e=new _().findFinderPattern(this.image);return this.processFinderPatternInfo(e)}}var S=[[21522,0],[20773,1],[24188,2],[23371,3],[17913,4],[16590,5],[20375,6],[19104,7],[30660,8],[29427,9],[32170,10],[30877,11],[26159,12],[25368,13],[27713,14],[26998,15],[5769,16],[5054,17],[7399,18],[6608,19],[1890,20],[597,21],[3340,22],[2107,23],[13663,24],[12392,25],[16177,26],[14854,27],[9396,28],[8579,29],[11994,30],[11245,31]],B=[0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,4];function s(e){this.errorCorrectionLevel=l.forBits(3&e>>3);this.dataMask=7&e;this.__defineGetter__("ErrorCorrectionLevel",function(){return this.errorCorrectionLevel});this.__defineGetter__("DataMask",function(){return this.dataMask});this.GetHashCode=function(){return this.errorCorrectionLevel.ordinal()<<3|this.dataMask};this.Equals=function(e){var t=e;return this.errorCorrectionLevel==t.errorCorrectionLevel&&this.dataMask==t.dataMask}}s.numBitsDiffering=function(e,t){e^=t;return B[15&e]+B[15&m(e,4)]+B[15&m(e,8)]+B[15&m(e,12)]+B[15&m(e,16)]+B[15&m(e,20)]+B[15&m(e,24)]+B[15&m(e,28)]};s.decodeFormatInformation=function(e){var t=s.doDecodeFormatInformation(e);if(null!=t){return t}return s.doDecodeFormatInformation(e^21522)};s.doDecodeFormatInformation=function(e){for(var t=4294967295,o=0,r=0;r<S.length;r++){var a=S[r],n=a[0];if(n==e){return new s(a[1])}var d=this.numBitsDiffering(e,n);if(d<t){o=a[1];t=d}}if(3>=t){return new s(o)}return null};function l(e,t,i){this.ordinal_Renamed_Field=e;this.bits=t;this.name=i;this.__defineGetter__("Bits",function(){return this.bits});this.__defineGetter__("Name",function(){return this.name});this.ordinal=function(){return this.ordinal_Renamed_Field}}l.forBits=function(e){if(0>e||e>=D.length){throw"ArgumentException"}return D[e]};var E=new l(0,1,"L"),x=new l(1,0,"M"),M=new l(2,3,"Q"),y=new l(3,2,"H"),D=[x,E,y,M];function c(e,t){if(!t)t=e;if(1>e||1>t){throw"Both dimensions must be greater than 0"}this.width=e;this.height=t;var o=e>>5;if(0!=(31&e)){o++}this.rowSize=o;this.bits=Array(o*t);for(var r=0;r<this.bits.length;r++){this.bits[r]=0}this.__defineGetter__("Width",function(){return this.width});this.__defineGetter__("Height",function(){return this.height});this.__defineGetter__("Dimension",function(){if(this.width!=this.height){throw"Can't call getDimension() on a non-square matrix"}return this.width});this.get_Renamed=function(e,t){var i=t*this.rowSize+(e>>5);return 0!=(1&m(this.bits[i],31&e))};this.set_Renamed=function(e,t){var i=t*this.rowSize+(e>>5);this.bits[i]|=1<<(31&e)};this.flip=function(e,t){var i=t*this.rowSize+(e>>5);this.bits[i]^=1<<(31&e)};this.clear=function(){for(var e=this.bits.length,t=0;t<e;t++){this.bits[t]=0}};this.setRegion=function(e,t,i,o){if(0>t||0>e){throw"Left and top must be nonnegative"}if(1>o||1>i){throw"Height and width must be at least 1"}var r=e+i,a=t+o;if(a>this.height||r>this.width){throw"The region must fit inside the matrix"}for(var n=t,d;n<a;n++){d=n*this.rowSize;for(var s=e;s<r;s++){this.bits[d+(s>>5)]|=1<<(31&s)}}}}function f(e,t){this.numDataCodewords=e;this.codewords=t;this.__defineGetter__("NumDataCodewords",function(){return this.numDataCodewords});this.__defineGetter__("Codewords",function(){return this.codewords})}f.getDataBlocks=function(e,t,o){if(e.length!=t.TotalCodewords){throw"ArgumentException"}for(var r=t.getECBlocksForLevel(o),a=0,n=r.getECBlocks(),d=0;d<n.length;d++){a+=n[d].Count}for(var s=Array(a),l=0,c=0,g;c<n.length;c++){g=n[c];for(var d=0;d<g.Count;d++){var u=g.DataCodewords,h=r.ECCodewordsPerBlock+u;s[l++]=new f(u,Array(h))}}var m=s[0].codewords.length,b=s.length-1;while(0<=b){var C=s[b].codewords.length;if(C==m){break}b--}b++;for(var _=m-r.ECCodewordsPerBlock,p=0,d=0;d<_;d++){for(var c=0;c<l;c++){s[c].codewords[d]=e[p++]}}for(var c=b;c<l;c++){s[c].codewords[_]=e[p++]}for(var k=s[0].codewords.length,d=_;d<k;d++){for(var c=0,w;c<l;c++){w=c<b?d:d+1;s[c].codewords[w]=e[p++]}}return s};function g(e){var t=e.Dimension;if(21>t||1!=(3&t)){throw"Error BitMatrixParser"}this.bitMatrix=e;this.parsedVersion=null;this.parsedFormatInfo=null;this.copyBit=function(e,t,i){return this.bitMatrix.get_Renamed(e,t)?1|i<<1:i<<1};this.readFormatInformation=function(){if(null!=this.parsedFormatInfo){return this.parsedFormatInfo}for(var e=0,t=0;6>t;t++){e=this.copyBit(t,8,e)}e=this.copyBit(7,8,e);e=this.copyBit(8,8,e);e=this.copyBit(8,7,e);for(var o=5;0<=o;o--){e=this.copyBit(8,o,e)}this.parsedFormatInfo=s.decodeFormatInformation(e);if(null!=this.parsedFormatInfo){return this.parsedFormatInfo}var r=this.bitMatrix.Dimension;e=0;for(var t=r-1;t>=r-8;t--){e=this.copyBit(t,8,e)}for(var o=r-7;o<r;o++){e=this.copyBit(8,o,e)}this.parsedFormatInfo=s.decodeFormatInformation(e);if(null!=this.parsedFormatInfo){return this.parsedFormatInfo}throw"Error readFormatInformation"};this.readVersion=function(){if(null!=this.parsedVersion){return this.parsedVersion}var e=this.bitMatrix.Dimension,t=e-17>>2;if(6>=t){return r.getVersionForNumber(t)}for(var o=0,a=e-11,n=5;0<=n;n--){for(var d=e-9;d>=a;d--){o=this.copyBit(d,n,o)}}this.parsedVersion=r.decodeVersionInformation(o);if(null!=this.parsedVersion&&this.parsedVersion.DimensionForVersion==e){return this.parsedVersion}o=0;for(var d=5;0<=d;d--){for(var n=e-9;n>=a;n--){o=this.copyBit(d,n,o)}}this.parsedVersion=r.decodeVersionInformation(o);if(null!=this.parsedVersion&&this.parsedVersion.DimensionForVersion==e){return this.parsedVersion}throw"Error readVersion"};this.readCodewords=function(){var e=this.readFormatInformation(),t=this.readVersion(),o=v.forReference(e.DataMask),r=this.bitMatrix.Dimension;o.unmaskBitMatrix(this.bitMatrix,r);for(var a=t.buildFunctionPattern(),n=!0,d=Array(t.TotalCodewords),s=0,l=0,c=0,f=r-1;0<f;f-=2){if(6==f){f--}for(var g=0,u;g<r;g++){u=n?r-1-g:g;for(var h=0;2>h;h++){if(!a.get_Renamed(f-h,u)){c++;l<<=1;if(this.bitMatrix.get_Renamed(f-h,u)){l|=1}if(8==c){d[s++]=l;c=0;l=0}}}}n^=!0}if(s!=t.TotalCodewords){throw"Error readCodewords"}return d}}var v={};v.forReference=function(e){if(0>e||7<e){throw"System.ArgumentException"}return v.DATA_MASKS[e]};v.DATA_MASKS=[new function(){this.unmaskBitMatrix=function(e,t){for(var o=0;o<t;o++){for(var r=0;r<t;r++){if(this.isMasked(o,r)){e.flip(r,o)}}}};this.isMasked=function(e,t){return 0==(1&e+t)}},new function(){this.unmaskBitMatrix=function(e,t){for(var o=0;o<t;o++){for(var r=0;r<t;r++){if(this.isMasked(o,r)){e.flip(r,o)}}}};this.isMasked=function(e){return 0==(1&e)}},new function(){this.unmaskBitMatrix=function(e,t){for(var o=0;o<t;o++){for(var r=0;r<t;r++){if(this.isMasked(o,r)){e.flip(r,o)}}}};this.isMasked=function(e,t){return 0==t%3}},new function(){this.unmaskBitMatrix=function(e,t){for(var o=0;o<t;o++){for(var r=0;r<t;r++){if(this.isMasked(o,r)){e.flip(r,o)}}}};this.isMasked=function(e,t){return 0==(e+t)%3}},new function(){this.unmaskBitMatrix=function(e,t){for(var o=0;o<t;o++){for(var r=0;r<t;r++){if(this.isMasked(o,r)){e.flip(r,o)}}}};this.isMasked=function(e,t){return 0==(1&m(e,1)+t/3)}},new function(){this.unmaskBitMatrix=function(e,t){for(var o=0;o<t;o++){for(var r=0;r<t;r++){if(this.isMasked(o,r)){e.flip(r,o)}}}};this.isMasked=function(e,t){var i=e*t;return 0==(1&i)+i%3}},new function(){this.unmaskBitMatrix=function(e,t){for(var o=0;o<t;o++){for(var r=0;r<t;r++){if(this.isMasked(o,r)){e.flip(r,o)}}}};this.isMasked=function(e,t){var i=e*t;return 0==(1&(1&i)+i%3)}},new function(){this.unmaskBitMatrix=function(e,t){for(var o=0;o<t;o++){for(var r=0;r<t;r++){if(this.isMasked(o,r)){e.flip(r,o)}}}};this.isMasked=function(e,t){return 0==(1&(1&e+t)+e*t%3)}}];function u(e,t){if(null==t||0==t.length){throw"System.ArgumentException"}this.field=e;var o=t.length;if(1<o&&0==t[0]){var r=1;while(r<o&&0==t[r]){r++}if(r==o){this.coefficients=e.Zero.coefficients}else{this.coefficients=Array(o-r);for(var a=0;a<this.coefficients.length;a++){this.coefficients[a]=0}for(var n=0;n<this.coefficients.length;n++){this.coefficients[n]=t[r+n]}}}else{this.coefficients=t}this.__defineGetter__("Zero",function(){return 0==this.coefficients[0]});this.__defineGetter__("Degree",function(){return this.coefficients.length-1});this.__defineGetter__("Coefficients",function(){return this.coefficients});this.getCoefficient=function(e){return this.coefficients[this.coefficients.length-1-e]};this.evaluateAt=function(e){if(0==e){return this.getCoefficient(0)}var t=this.coefficients.length;if(1==e){for(var o=0,r=0;r<t;r++){o=h.addOrSubtract(o,this.coefficients[r])}return o}for(var a=this.coefficients[0],r=1;r<t;r++){a=h.addOrSubtract(this.field.multiply(e,a),this.coefficients[r])}return a};this.addOrSubtract=function(t){if(this.field!=t.field){throw"GF256Polys do not have same GF256 field"}if(this.Zero){return t}if(t.Zero){return this}var o=this.coefficients,r=t.coefficients;if(o.length>r.length){var a=o;o=r;r=a}for(var n=Array(r.length),d=r.length-o.length,s=0;s<d;s++){n[s]=r[s]}for(var l=d;l<r.length;l++){n[l]=h.addOrSubtract(o[l-d],r[l])}return new u(e,n)};this.multiply1=function(e){if(this.field!=e.field){throw"GF256Polys do not have same GF256 field"}if(this.Zero||e.Zero){return this.field.Zero}for(var t=this.coefficients,o=t.length,r=e.coefficients,a=r.length,n=Array(o+a-1),d=0,s;d<o;d++){s=t[d];for(var l=0;l<a;l++){n[d+l]=h.addOrSubtract(n[d+l],this.field.multiply(s,r[l]))}}return new u(this.field,n)};this.multiply2=function(e){if(0==e){return this.field.Zero}if(1==e){return this}for(var t=this.coefficients.length,o=Array(t),r=0;r<t;r++){o[r]=this.field.multiply(this.coefficients[r],e)}return new u(this.field,o)};this.multiplyByMonomial=function(e,t){if(0>e){throw"System.ArgumentException"}if(0==t){return this.field.Zero}for(var o=this.coefficients.length,r=Array(o+e),a=0;a<r.length;a++){r[a]=0}for(var a=0;a<o;a++){r[a]=this.field.multiply(this.coefficients[a],t)}return new u(this.field,r)};this.divide=function(e){if(this.field!=e.field){throw"GF256Polys do not have same GF256 field"}if(e.Zero){throw"Divide by 0"}var t=this.field.Zero,i=this,o=e.getCoefficient(e.Degree),r=this.field.inverse(o);while(i.Degree>=e.Degree&&!i.Zero){var a=i.Degree-e.Degree,n=this.field.multiply(i.getCoefficient(i.Degree),r),d=e.multiplyByMonomial(a,n),s=this.field.buildMonomial(a,n);t=t.addOrSubtract(s);i=i.addOrSubtract(d)}return[t,i]}}function h(e){this.expTable=Array(256);this.logTable=Array(256);for(var t=1,o=0;256>o;o++){this.expTable[o]=t;t<<=1;if(256<=t){t^=e}}for(var o=0;255>o;o++){this.logTable[this.expTable[o]]=o}var r=[,];r[0]=0;this.zero=new u(this,Array(r));var a=[,];a[0]=1;this.one=new u(this,Array(a));this.__defineGetter__("Zero",function(){return this.zero});this.__defineGetter__("One",function(){return this.one});this.buildMonomial=function(e,t){if(0>e){throw"System.ArgumentException"}if(0==t){return this.zero}for(var o=Array(e+1),r=0;r<o.length;r++){o[r]=0}o[0]=t;return new u(this,o)};this.exp=function(e){return this.expTable[e]};this.log=function(e){if(0==e){throw"System.ArgumentException"}return this.logTable[e]};this.inverse=function(e){if(0==e){throw"System.ArithmeticException"}return this.expTable[255-this.logTable[e]]};this.multiply=function(e,t){if(0==e||0==t){return 0}if(1==e){return t}if(1==t){return e}return this.expTable[(this.logTable[e]+this.logTable[t])%255]}}h.QR_CODE_FIELD=new h(285);h.DATA_MATRIX_FIELD=new h(301);h.addOrSubtract=function(e,t){return e^t};var F={rsDecoder:new function(e){this.field=e;this.decode=function(e,t){for(var o=new u(this.field,e),r=Array(t),a=0;a<r.length;a++){r[a]=0}for(var n=!1,d=!0,a=0,s;a<t;a++){s=o.evaluateAt(this.field.exp(n?a+1:a));r[r.length-1-a]=s;if(0!=s){d=!1}}if(d){return}for(var l=new u(this.field,r),c=this.runEuclideanAlgorithm(this.field.buildMonomial(t,1),l,t),f=c[0],g=c[1],m=this.findErrorLocations(f),b=this.findErrorMagnitudes(g,m,n),a=0,C;a<m.length;a++){C=e.length-1-this.field.log(m[a]);if(0>C){throw"ReedSolomonException Bad error location"}e[C]=h.addOrSubtract(e[C],b[a])}};this.runEuclideanAlgorithm=function(e,i,o){if(e.Degree<i.Degree){var n=e;e=i;i=n}var d=e,l=i,c=this.field.One,f=this.field.Zero,g=this.field.Zero,u=this.field.One;while(l.Degree>=Math.floor(o/2)){var h=d,m=c,C=g;d=l;c=f;g=u;if(d.Zero){throw"r_{i-1} was zero"}l=h;var _=this.field.Zero,p=d.getCoefficient(d.Degree),k=this.field.inverse(p);while(l.Degree>=d.Degree&&!l.Zero){var w=l.Degree-d.Degree,P=this.field.multiply(l.getCoefficient(l.Degree),k);_=_.addOrSubtract(this.field.buildMonomial(w,P));l=l.addOrSubtract(d.multiplyByMonomial(w,P))}f=_.multiply1(c).addOrSubtract(m);u=_.multiply1(g).addOrSubtract(C)}var S=u.getCoefficient(0);if(0==S){throw"ReedSolomonException sigmaTilde(0) was zero"}var B=this.field.inverse(S),M=u.multiply2(B),E=l.multiply2(B);return[M,E]};this.findErrorLocations=function(t){var o=t.Degree;if(1==o){return Array(t.getCoefficient(1))}for(var r=Array(o),a=0,n=1;256>n&&a<o;n++){if(0==t.evaluateAt(n)){r[a]=this.field.inverse(n);a++}}if(a!=o){throw"Error locator degree does not match number of roots"}return r};this.findErrorMagnitudes=function(e,t,o){for(var r=t.length,a=Array(r),n=0;n<r;n++){for(var d=this.field.inverse(t[n]),s=1,l=0;l<r;l++){if(n!=l){s=this.field.multiply(s,h.addOrSubtract(1,this.field.multiply(t[l],d)))}}a[n]=this.field.multiply(e.evaluateAt(d),this.field.inverse(s));if(o){a[n]=this.field.multiply(a[n],d)}}return a}}(h.QR_CODE_FIELD)};F.correctErrors=function(e,t){for(var o=e.length,r=Array(o),a=0;a<o;a++){r[a]=255&e[a]}var n=e.length-t;try{F.rsDecoder.decode(r,n)}catch(e){throw e}for(var a=0;a<t;a++){e[a]=r[a]}};F.decode=function(e){for(var t=new g(e),o=t.readVersion(),r=t.readFormatInformation().ErrorCorrectionLevel,a=t.readCodewords(),n=f.getDataBlocks(a,o,r),d=0,s=0;s<n.length;s++){d+=n[s].NumDataCodewords}for(var l=Array(d),c=0,u=0;u<n.length;u++){var h=n[u],m=h.Codewords,b=h.NumDataCodewords;F.correctErrors(m,b);for(var s=0;s<b;s++){l[c++]=m[s]}}var C=new w(l,o.VersionNumber,r.Bits);return C};var I={imagedata:null,video:!1,width:0,height:0,qrCodeSymbol:null,debug:!1,maxImgSize:1048576,interval:500,sizeOfDataLengthInfo:[[10,9,8,8],[12,11,16,10],[14,13,16,12]],callback:null};I.startWebCam=function(e){I.videoId=e;I.video=document.getElementById(I.videoId);var t=I.video.play();if(t!==void 0){t.then(function(){}).catch(function(){})}if(navigator.getUserMedia){navigator.getUserMedia({audio:!1,video:{facingMode:"environment"}},I.webCamSuccess,I.webCamError)}};I.stopWebCam=function(){I.video.pause()};I.webCamSuccess=function(e){I.localstream=e;I.video.srcObject=e;I.video.controls=!1;I.video.volume=0};I.webCamError=function(){I.stopScan()};I.startScan=function(e){I.canvasid="qr-canvas"+e;var i=document.getElementById(e);I.canvas_qr2=document.createElement("canvas");I.canvas_qr2.id=I.canvasid;I.qrcontext2=I.canvas_qr2.getContext("2d");I.canvas_qr2.width=I.video.videoWidth;I.canvas_qr2.height=I.video.videoHeight;I.gUM=!0;var o=function(){if(I.gUM){try{if(0==i.videoWidth){setTimeout(o,I.interval);return}else{I.canvas_qr2.width=i.videoWidth;I.canvas_qr2.height=i.videoHeight}I.qrcontext2.drawImage(i,0,0);try{I.decode()}catch(i){t.debug(i);setTimeout(o,I.interval)}}catch(i){t.debug(i);setTimeout(o,I.interval)}}};o()};I.stopScan=function(){I.gUM=!1};I.decode=function(e){if(e){var t=e,i=I.canvas_qr2.getContext("2d")}else{var t=I.canvas_qr2,i=I.qrcontext2}I.width=t.width;I.height=t.height;I.imagedata=i.getImageData(0,0,I.width,I.height);I.result=I.process(i);if(null!=I.callback)I.callback(I.result);return I.result};I.isUrl=function(e){return /(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(e)};I.decode_url=function(i){var o="";try{o=escape(i)}catch(r){t.debug(r);o=i}var r="";try{r=decodeURIComponent(o)}catch(i){t.debug(i);r=o}return r};I.decode_utf8=function(e){if(I.isUrl(e))return I.decode_url(e);else return e};I.process=function(e){var o=new Date().getTime(),r=I.grayScaleToBitmap(I.grayscale());if(I.debug){for(var a=0;a<I.height;a++){for(var n=0,s;n<I.width;n++){s=4*n+4*(a*I.width);I.imagedata.data[s]=r[n+a*I.width]?0:0;I.imagedata.data[s+1]=r[n+a*I.width]?0:0;I.imagedata.data[s+2]=r[n+a*I.width]?255:0}}e.putImageData(I.imagedata,0,0)}var l=new d(r),c=l.detect();if(I.debug){for(var a=0;a<c.bits.Height;a++){for(var n=0,s;n<c.bits.Width;n++){s=2*(4*n)+4*(2*a*I.width);I.imagedata.data[s]=c.bits.get_Renamed(n,a)?0:0;I.imagedata.data[s+1]=c.bits.get_Renamed(n,a)?0:0;I.imagedata.data[s+2]=c.bits.get_Renamed(n,a)?255:0}}e.putImageData(I.imagedata,0,0)}for(var f=F.decode(c.bits),g=f.DataByte,u="",h=0;h<g.length;h++){for(var m=0;m<g[h].length;m++){u+=String.fromCharCode(g[h][m])}}var b=new Date().getTime();t.debug(b-o);return I.decode_utf8(u)};I.getPixel=function(e,t){if(I.width<e){throw"point error"}if(I.height<t){throw"point error"}var i=4*e+4*(t*I.width),o=(33*I.imagedata.data[i]+34*I.imagedata.data[i+1]+33*I.imagedata.data[i+2])/100;return o};I.binarize=function(e){for(var t=Array(I.width*I.height),i=0;i<I.height;i++){for(var o=0,r;o<I.width;o++){r=I.getPixel(o,i);t[o+i*I.width]=r<=e?!0:!1}}return t};I.getMiddleBrightnessPerArea=function(e){for(var t=4,o=Math.floor(I.width/t),r=Math.floor(I.height/t),a=Array(t),n=0;n<t;n++){a[n]=Array(t);for(var d=0;d<t;d++){a[n][d]=[0,0]}}for(var s=0;s<t;s++){for(var l=0;l<t;l++){a[l][s][0]=255;for(var c=0;c<r;c++){for(var f=0,g;f<o;f++){g=e[o*l+f+(r*s+c)*I.width];if(g<a[l][s][0])a[l][s][0]=g;if(g>a[l][s][1])a[l][s][1]=g}}}}for(var u=Array(t),h=0;h<t;h++){u[h]=Array(t)}for(var s=0;s<t;s++){for(var l=0;l<t;l++){u[l][s]=Math.floor((a[l][s][0]+a[l][s][1])/2)}}return u};I.grayScaleToBitmap=function(e){for(var t=I.getMiddleBrightnessPerArea(e),i=t.length,o=Math.floor(I.width/i),r=Math.floor(I.height/i),a=new ArrayBuffer(I.width*I.height),n=new Uint8Array(a),d=0;d<i;d++){for(var s=0;s<i;s++){for(var l=0;l<r;l++){for(var c=0;c<o;c++){n[o*s+c+(r*d+l)*I.width]=e[o*s+c+(r*d+l)*I.width]<t[s][d]?!0:!1}}}}return n};I.grayscale=function(){for(var e=new ArrayBuffer(I.width*I.height),t=new Uint8Array(e),i=0;i<I.height;i++){for(var o=0,r;o<I.width;o++){r=I.getPixel(o,i);t[o+i*I.width]=r}}return t};function m(e,t){if(0<=e)return e>>t;else return(e>>t)+(2<<~t)}var R=8,G=2;I.orderBestPatterns=function(e){function t(e,t){var i=e.X-t.X,o=e.Y-t.Y;return Math.sqrt(i*i+o*o)}function i(e,t,i){var o=t.x,r=t.y;return(i.x-o)*(e.y-r)-(i.y-r)*(e.x-o)}var o=t(e[0],e[1]),r=t(e[1],e[2]),a=t(e[0],e[2]),n,d,s;if(r>=o&&r>=a){d=e[0];n=e[1];s=e[2]}else if(a>=r&&a>=o){d=e[1];n=e[0];s=e[2]}else{d=e[2];n=e[0];s=e[1]}if(0>i(n,d,s)){var l=n;n=s;s=l}e[0]=n;e[1]=d;e[2]=s};function b(e,t,i){this.x=e;this.y=t;this.count=1;this.estimatedModuleSize=i;this.__defineGetter__("EstimatedModuleSize",function(){return this.estimatedModuleSize});this.__defineGetter__("Count",function(){return this.count});this.__defineGetter__("X",function(){return this.x});this.__defineGetter__("Y",function(){return this.y});this.incrementCount=function(){this.count++};this.aboutEquals=function(e,t,i){if(Math.abs(t-this.y)<=e&&Math.abs(i-this.x)<=e){var o=Math.abs(e-this.estimatedModuleSize);return 1>=o||1>=o/this.estimatedModuleSize}return!1}}function C(e){this.bottomLeft=e[0];this.topLeft=e[1];this.topRight=e[2];this.__defineGetter__("BottomLeft",function(){return this.bottomLeft});this.__defineGetter__("TopLeft",function(){return this.topLeft});this.__defineGetter__("TopRight",function(){return this.topRight})}function _(){this.image=null;this.possibleCenters=[];this.hasSkipped=!1;this.crossCheckStateCount=[0,0,0,0,0];this.resultPointCallback=null;this.__defineGetter__("CrossCheckStateCount",function(){this.crossCheckStateCount[0]=0;this.crossCheckStateCount[1]=0;this.crossCheckStateCount[2]=0;this.crossCheckStateCount[3]=0;this.crossCheckStateCount[4]=0;return this.crossCheckStateCount});this.foundPatternCross=function(e){for(var t=0,o=0,r;5>o;o++){r=e[o];if(0==r){return!1}t+=r}if(7>t){return!1}var a=Math.floor((t<<R)/7),n=Math.floor(a/2);return Math.abs(a-(e[0]<<R))<n&&Math.abs(a-(e[1]<<R))<n&&Math.abs(3*a-(e[2]<<R))<3*n&&Math.abs(a-(e[3]<<R))<n&&Math.abs(a-(e[4]<<R))<n};this.centerFromEnd=function(e,t){return t-e[4]-e[3]-e[2]/2};this.crossCheckVertical=function(e,t,o,r){var a=this.image,n=I.height,d=this.CrossCheckStateCount,s=e;while(0<=s&&a[t+s*I.width]){d[2]++;s--}if(0>s){return NaN}while(0<=s&&!a[t+s*I.width]&&d[1]<=o){d[1]++;s--}if(0>s||d[1]>o){return NaN}while(0<=s&&a[t+s*I.width]&&d[0]<=o){d[0]++;s--}if(d[0]>o){return NaN}s=e+1;while(s<n&&a[t+s*I.width]){d[2]++;s++}if(s==n){return NaN}while(s<n&&!a[t+s*I.width]&&d[3]<o){d[3]++;s++}if(s==n||d[3]>=o){return NaN}while(s<n&&a[t+s*I.width]&&d[4]<o){d[4]++;s++}if(d[4]>=o){return NaN}var l=d[0]+d[1]+d[2]+d[3]+d[4];if(5*Math.abs(l-r)>=2*r){return NaN}return this.foundPatternCross(d)?this.centerFromEnd(d,s):NaN};this.crossCheckHorizontal=function(e,t,i,o){var r=this.image,a=I.width,n=this.CrossCheckStateCount,d=e;while(0<=d&&r[d+t*I.width]){n[2]++;d--}if(0>d){return NaN}while(0<=d&&!r[d+t*I.width]&&n[1]<=i){n[1]++;d--}if(0>d||n[1]>i){return NaN}while(0<=d&&r[d+t*I.width]&&n[0]<=i){n[0]++;d--}if(n[0]>i){return NaN}d=e+1;while(d<a&&r[d+t*I.width]){n[2]++;d++}if(d==a){return NaN}while(d<a&&!r[d+t*I.width]&&n[3]<i){n[3]++;d++}if(d==a||n[3]>=i){return NaN}while(d<a&&r[d+t*I.width]&&n[4]<i){n[4]++;d++}if(n[4]>=i){return NaN}var s=n[0]+n[1]+n[2]+n[3]+n[4];if(5*Math.abs(s-o)>=o){return NaN}return this.foundPatternCross(n)?this.centerFromEnd(n,d):NaN};this.handlePossibleCenter=function(e,t,i){var o=e[0]+e[1]+e[2]+e[3]+e[4],r=this.centerFromEnd(e,i),a=this.crossCheckVertical(t,Math.floor(r),e[2],o);if(!isNaN(a)){r=this.crossCheckHorizontal(Math.floor(r),Math.floor(a),e[2],o);if(!isNaN(r)){for(var n=o/7,d=!1,s=this.possibleCenters.length,l=0,c;l<s;l++){c=this.possibleCenters[l];if(c.aboutEquals(n,a,r)){c.incrementCount();d=!0;break}}if(!d){var f=new b(r,a,n);this.possibleCenters.push(f);if(null!=this.resultPointCallback){this.resultPointCallback.foundPossibleResultPoint(f)}}return!0}}return!1};this.selectBestPatterns=function(){var e=this.possibleCenters.length;if(3>e){throw"Couldn't find enough finder patterns (found "+e+")"}if(3<e){for(var t=0,o=0,r=0,a;r<e;r++){a=this.possibleCenters[r].EstimatedModuleSize;t+=a;o+=a*a}var n=t/e;this.possibleCenters.sort(function(e,t){var i=Math.abs(t.EstimatedModuleSize-n),o=Math.abs(e.EstimatedModuleSize-n);if(i<o){return-1}else if(i==o){return 0}else{return 1}});for(var d=Math.sqrt(o/e-n*n),s=Math.max(.2*n,d),r=this.possibleCenters.length-1,l;0<=r;r--){l=this.possibleCenters[r];if(Math.abs(l.EstimatedModuleSize-n)>s){this.possibleCenters.splice(r,1)}}}if(3<this.possibleCenters.length){this.possibleCenters.sort(function(e,t){if(e.count>t.count){return-1}if(e.count<t.count){return 1}return 0})}return[this.possibleCenters[0],this.possibleCenters[1],this.possibleCenters[2]]};this.findRowSkip=function(){var e=this.possibleCenters.length;if(1>=e){return 0}for(var t=null,o=0,r;o<e;o++){r=this.possibleCenters[o];if(r.Count>=G){if(null==t){t=r}else{this.hasSkipped=!0;return Math.floor((Math.abs(t.X-r.X)-Math.abs(t.Y-r.Y))/2)}}}return 0};this.haveMultiplyConfirmedCenters=function(){for(var e=0,t=0,o=this.possibleCenters.length,r=0,a;r<o;r++){a=this.possibleCenters[r];if(a.Count>=G){e++;t+=a.EstimatedModuleSize}}if(3>e){return!1}for(var n=t/o,d=0,r=0;r<o;r++){a=this.possibleCenters[r];d+=Math.abs(a.EstimatedModuleSize-n)}return d<=.05*t};this.findFinderPattern=function(e){this.image=e;var t=I.height,o=I.width,r=Math.floor(3*t/(4*57));if(r<3||!1){r=3}for(var a=!1,n=[,,,,,],d=r-1;d<t&&!a;d+=r){n[0]=0;n[1]=0;n[2]=0;n[3]=0;n[4]=0;for(var s=0,l=0;l<o;l++){if(e[l+d*I.width]){if(1==(1&s)){s++}n[s]++}else{if(0==(1&s)){if(4==s){if(this.foundPatternCross(n)){var c=this.handlePossibleCenter(n,d,l);if(c){r=2;if(this.hasSkipped){a=this.haveMultiplyConfirmedCenters()}else{var f=this.findRowSkip();if(f>n[2]){d+=f-n[2]-r;l=o-1}}}else{do{l++}while(l<o&&!e[l+d*I.width]);l--}s=0;n[0]=0;n[1]=0;n[2]=0;n[3]=0;n[4]=0}else{n[0]=n[2];n[1]=n[3];n[2]=n[4];n[3]=1;n[4]=0;s=3}}else{n[++s]++}}else{n[s]++}}}if(this.foundPatternCross(n)){var c=this.handlePossibleCenter(n,d,o);if(c){r=n[0];if(this.hasSkipped){a=this.haveMultiplyConfirmedCenters()}}}}var g=this.selectBestPatterns();I.orderBestPatterns(g);return new C(g)}}function p(e,t,i){this.x=e;this.y=t;this.count=1;this.estimatedModuleSize=i;this.__defineGetter__("EstimatedModuleSize",function(){return this.estimatedModuleSize});this.__defineGetter__("Count",function(){return this.count});this.__defineGetter__("X",function(){return Math.floor(this.x)});this.__defineGetter__("Y",function(){return Math.floor(this.y)});this.incrementCount=function(){this.count++};this.aboutEquals=function(e,t,i){if(Math.abs(t-this.y)<=e&&Math.abs(i-this.x)<=e){var o=Math.abs(e-this.estimatedModuleSize);return 1>=o||1>=o/this.estimatedModuleSize}return!1}}function k(e,t,o,r,a,n,d){this.image=e;this.possibleCenters=[];this.startX=t;this.startY=o;this.width=r;this.height=a;this.moduleSize=n;this.crossCheckStateCount=[0,0,0];this.resultPointCallback=d;this.centerFromEnd=function(e,t){return t-e[2]-e[1]/2};this.foundPatternCross=function(e){for(var t=this.moduleSize,o=0;3>o;o++){if(Math.abs(t-e[o])>=t/2){return!1}}return!0};this.crossCheckVertical=function(e,t,o,r){var a=this.image,n=I.height,d=this.crossCheckStateCount;d[0]=0;d[1]=0;d[2]=0;var s=e;while(0<=s&&a[t+s*I.width]&&d[1]<=o){d[1]++;s--}if(0>s||d[1]>o){return NaN}while(0<=s&&!a[t+s*I.width]&&d[0]<=o){d[0]++;s--}if(d[0]>o){return NaN}s=e+1;while(s<n&&a[t+s*I.width]&&d[1]<=o){d[1]++;s++}if(s==n||d[1]>o){return NaN}while(s<n&&!a[t+s*I.width]&&d[2]<=o){d[2]++;s++}if(d[2]>o){return NaN}var l=d[0]+d[1]+d[2];if(5*Math.abs(l-r)>=2*r){return NaN}return this.foundPatternCross(d)?this.centerFromEnd(d,s):NaN};this.handlePossibleCenter=function(e,t,i){var o=e[0]+e[1]+e[2],r=this.centerFromEnd(e,i),a=this.crossCheckVertical(t,Math.floor(r),2*e[1],o);if(!isNaN(a)){for(var n=(e[0]+e[1]+e[2])/3,d=this.possibleCenters.length,s=0,l;s<d;s++){l=this.possibleCenters[s];if(l.aboutEquals(n,a,r)){return new p(r,a,n)}}var c=new p(r,a,n);this.possibleCenters.push(c);if(null!=this.resultPointCallback){this.resultPointCallback.foundPossibleResultPoint(c)}}return null};this.find=function(){for(var t=this.startX,a=this.height,n=t+r,d=[0,0,0],s=0,l;s<a;s++){l=o+(a>>1)+(0==(1&s)?s+1>>1:-(s+1>>1));d[0]=0;d[1]=0;d[2]=0;var c=t;while(c<n&&!e[c+I.width*l]){c++}var f=0;while(c<n){if(e[c+l*I.width]){if(1==f){d[f]++}else{if(2==f){if(this.foundPatternCross(d)){var g=this.handlePossibleCenter(d,l,c);if(null!=g){return g}}d[0]=d[2];d[1]=1;d[2]=0;f=1}else{d[++f]++}}}else{if(1==f){f++}d[f]++}c++}if(this.foundPatternCross(d)){var g=this.handlePossibleCenter(d,l,n);if(null!=g){return g}}}if(!(0==this.possibleCenters.length)){return this.possibleCenters[0]}throw"Couldn't find enough alignment patterns"}}function w(e,t,i){this.blockPointer=0;this.bitPointer=7;this.dataLength=0;this.blocks=e;this.numErrorCorrectionCode=i;if(9>=t)this.dataLengthMode=0;else if(10<=t&&26>=t)this.dataLengthMode=1;else if(27<=t&&40>=t)this.dataLengthMode=2;this.getNextBits=function(e){var t=0;if(e<this.bitPointer+1){for(var o=0,r=0;r<e;r++){o+=1<<r}o<<=this.bitPointer-e+1;t=(this.blocks[this.blockPointer]&o)>>this.bitPointer-e+1;this.bitPointer-=e;return t}else if(e<this.bitPointer+1+8){for(var a=0,r=0;r<this.bitPointer+1;r++){a+=1<<r}t=(this.blocks[this.blockPointer]&a)<<e-(this.bitPointer+1);this.blockPointer++;t+=this.blocks[this.blockPointer]>>8-(e-(this.bitPointer+1));this.bitPointer=this.bitPointer-e%8;if(0>this.bitPointer){this.bitPointer=8+this.bitPointer}return t}else if(e<this.bitPointer+1+16){for(var a=0,n=0,r=0;r<this.bitPointer+1;r++){a+=1<<r}var d=(this.blocks[this.blockPointer]&a)<<e-(this.bitPointer+1);this.blockPointer++;var s=this.blocks[this.blockPointer]<<e-(this.bitPointer+1+8);this.blockPointer++;for(var r=0;r<e-(this.bitPointer+1+8);r++){n+=1<<r}n<<=8-(e-(this.bitPointer+1+8));var l=(this.blocks[this.blockPointer]&n)>>8-(e-(this.bitPointer+1+8));t=d+s+l;this.bitPointer=this.bitPointer-(e-8)%8;if(0>this.bitPointer){this.bitPointer=8+this.bitPointer}return t}else{return 0}};this.NextMode=function(){if(this.blockPointer>this.blocks.length-this.numErrorCorrectionCode-2)return 0;else return this.getNextBits(4)};this.getDataLength=function(e){var t=0;while(!0){if(1==e>>t)break;t++}return this.getNextBits(I.sizeOfDataLengthInfo[this.dataLengthMode][t])};this.getRomanAndFigureString=function(e){var t=e,i=0,o="",r=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];do{if(1<t){i=this.getNextBits(11);var a=Math.floor(i/45),n=i%45;o+=r[a];o+=r[n];t-=2}else if(1==t){i=this.getNextBits(6);o+=r[i];t-=1}}while(0<t);return o};this.getFigureString=function(e){var t=e,i=0,o="";do{if(3<=t){i=this.getNextBits(10);if(100>i)o+="0";if(10>i)o+="0";t-=3}else if(2==t){i=this.getNextBits(7);if(10>i)o+="0";t-=2}else if(1==t){i=this.getNextBits(4);t-=1}o+=i}while(0<t);return o};this.get8bitByteArray=function(e){var t=e,i=0,o=[];do{i=this.getNextBits(8);o.push(i);t--}while(0<t);return o};this.getKanjiString=function(e){var t=e,i=0,o="";do{i=this.getNextBits(13);var r=i%192,a=i/192,n=(a<<8)+r,d=0;if(40956>=n+33088){d=n+33088}else{d=n+49472}o+=String.fromCharCode(d);t--}while(0<t);return o};this.parseECIValue=function(){var e=0,t=this.getNextBits(8);if(0==(128&t)){e=127&t}if(128==(192&t)){var i=this.getNextBits(8);e=(63&t)<<8|i}if(192==(224&t)){var o=this.getNextBits(8);e=(31&t)<<16|o}return e};this.__defineGetter__("DataByte",function(){var e=[],t=1,i=2,o=4,r=7,a=8;do{var n=this.NextMode();if(0==n){if(0<e.length)break;else throw"Empty data block"}if(n!=t&&n!=i&&n!=o&&n!=a&&n!=r){throw"Invalid mode: "+n+" in (block:"+this.blockPointer+" bit:"+this.bitPointer+")"}if(n==r){var d=this.parseECIValue()}else{var s=this.getDataLength(n);if(1>s)throw"Invalid data length: "+s;switch(n){case t:for(var l=this.getFigureString(s),c=Array(l.length),f=0;f<l.length;f++){c[f]=l.charCodeAt(f)}e.push(c);break;case i:for(var l=this.getRomanAndFigureString(s),c=Array(l.length),f=0;f<l.length;f++){c[f]=l.charCodeAt(f)}e.push(c);break;case o:var d=this.get8bitByteArray(s);e.push(d);break;case a:var l=this.getKanjiString(s);e.push(l);break;}}}while(!0);return e})}return{startWebCam:function startWebCam(e){I.startWebCam(e)},stopWebCam:function stopWebCam(){I.stopWebCam()},startScan:function startScan(e){I.startScan(e)},stopScan:function stopScan(){I.stopScan()},setCallback:function setCallback(e){I.callback=e},decode:function decode(e){I.decode(e)}}});
//# sourceMappingURL=poodll_qrscanner.min.js.map
