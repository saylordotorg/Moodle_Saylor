{"version":3,"sources":["../src/poodll_mediarecorder.js"],"names":["define","$","log","utils","adapter","uploader","hermes","timer","audioanalyser","poodll_msr","errordialog","downloaddialog","speechrecognition","mediaskins","debug","instanceprops","skins","laststream","fetch_instanceprops","controlbarid","fetch_skin","is_ios","supports_current_browser","config","protocol_ok","M","cfg","wwwroot","indexOf","mediatype","ret","can_html5_record","xxxxsupports_current_browser","navigator","mediaDevices","getUserMedia","is_safari","html5ondsafari","IsEdge","is_edge","msSaveBlob","msSaveOrOpenBlob","IsSafari","embed","element","that","widgetid","init_instance_props","ip","hideupload","showupload","timeinterval","media_timeinterval","audiomimetype","media_audiomimetype","videorecordertype","media_videorecordertype","videocaptureheight","media_videocaptureheight","clone","init","id","allowedURL","iframeembed","theskin","init_skin","media_skin","speechevents","speechrec","will_work_ok","language","onfinalspeechcapture","speechtext","speechresults","postMessage","type","capturedspeech","hasOwnProperty","onuploadsuccess","onUploadSuccess","onuploadfailure","onUploadFailure","preview","fetch_preview_audio","resource","fetch_resource_audio","controlbar","fetch_controlbar_audio","upskin","fetch_uploader_skin","register_events_audio","then","catch","err","open","fetch_preview_video","fetch_resource_video","fetch_controlbar_video","register_events_video","stream","restream_preview_video_player","timelimit","handle_timer_update","recorded_index","mediaRecorder","blobs","videocapturewidth","previewvolume","uploaded","useraudiodeviceid","uservideodeviceid","devices","AudioContext","window","webkitAudioContext","poodllmediarecorder_actx","ac","poodllmediarecorder_actx_cnt","audioctx","aa","previewstillcold","skinname","fetch_skin_clone","pmr","onMediaError","e","error","captureUserMedia","mediaConstraints","successCallback","errorCallback","warmup_context","ctx","state","resume","buffer","createBuffer","source","createBufferSource","connect","destination","start","warmup_preview","get","pPromise","play","do_start_audio","onMediaSuccess","muted","fetch_audio_constraints","fetch_video_constraints","do_start_video","do_stopplay_audio","pause","hide","livepreview","show","do_play_audio","length","doConcatenateBlobs","concatenatedBlob","mediaurl","URL","createObjectURL","insertAfter","src","controls","volume","bind","stopbutton","click","ppromise","do_play_video","do_save_audio","uploadBlob","startbutton","attr","do_save_video","do_stop_audio","stop","action","do_stop_video","do_pause_audio","do_pause_video","do_resume_audio","do_resume_video","audio","is_opera","video","videodeviceid","valueOf","constraints","deviceId","exact","audiodeviceid","self","skin","register_controlbar_events_audio","encoder","mimeType","audioChannels","ondataavailable","blob","push","onMediaSuccess_audio","register_controlbar_events_video","recorderType","MediaRecorderWrapper","videoWidth","videoHeight","onMediaSuccess_video","tidy_old_stream","getTracks","forEach","track","init_video_preview","is_android","enumerateDevices","srcObject","update_status","status","html","fetch_display_time","insert_controlbar_audio","insert_controlbar_video","fetch_strings","ss","each","index","key","util","get_string"],"mappings":"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","sourcesContent":["/* jshint ignore:start */\ndefine(['jquery', 'core/log', 'filter_poodll/utils_amd',\n    'filter_poodll/adapter', 'filter_poodll/uploader', 'filter_poodll/hermes', 'filter_poodll/timer',\n    'filter_poodll/audioanalyser',\n    'filter_poodll/msr_poodll',\n    'filter_poodll/dlg_errordisplay',\n    'filter_poodll/dlg_download',\n    'filter_poodll/speech_poodll',\n    'filter_poodll/poodll_mediaskins'], function ($, log, utils, adapter, uploader, hermes, timer, audioanalyser,\n                                                  poodll_msr, errordialog, downloaddialog, speechrecognition, mediaskins) {\n\n    \"use strict\"; // jshint ;_;\n\n    log.debug('PoodLL Media Recorder: initialising');\n\n    return {\n\n        instanceprops: [],\n        skins: [],\n        laststream: [],\n\n        fetch_instanceprops: function (controlbarid) {\n            return this.instanceprops[controlbarid];\n        },\n\n        fetch_skin: function (controlbarid) {\n            return this.skins[controlbarid];\n        },\n\n        is_ios: function () {\n            return utils.is_ios();\n        },\n\n        // This recorder supports the current browser\n        supports_current_browser: function (config) {\n\n            var protocol_ok = M.cfg.wwwroot.indexOf('https:') == 0 ||\n                M.cfg.wwwroot.indexOf('http://localhost') == 0;\n            if(!protocol_ok){return false;}\n\n            if (config.mediatype != 'audio' && config.mediatype != 'video') {\n                return false;\n            }\n\n            var ret = utils.can_html5_record(config.mediatype);\n            if (ret) {\n                log.debug('PoodLL Media Recorder: supports this browser');\n            }\n            return ret;\n        },\n\n        // This recorder supports the current browser\n        xxxxsupports_current_browser: function (config) {\n\n            if (config.mediatype != 'audio' && config.mediatype != 'video') {\n                return false;\n            }\n            var protocol_ok = M.cfg.wwwroot.indexOf('https:') == 0 ||\n                M.cfg.wwwroot.indexOf('http://localhost') == 0;\n            if (protocol_ok\n                && navigator && navigator.mediaDevices\n                && navigator.mediaDevices.getUserMedia) {\n                var ret = false;\n                switch (config.mediatype) {\n                    case 'audio':\n                        // sadly desktop safari has a bug which prevents us enabling it\n                        if (utils.is_safari() && !(utils.is_ios()) && !config.html5ondsafari) {\n                            ret = false;\n                        } else {\n                            ret = true;\n                        }\n\n                        break;\n                    case 'video':\n                        var IsEdge = utils.is_edge() !== -1 &&\n                            (!!navigator.msSaveBlob || !!navigator.msSaveOrOpenBlob);\n                        var IsSafari = utils.is_safari();\n\n                        if (!IsEdge && !IsSafari) {\n                            ret = true;\n                        }\n                }\n                if (ret) {\n                    log.debug('PoodLL Media Recorder: supports this browser');\n                }\n                return ret;\n            } else {\n                return false;\n            }\n        },\n\n        // Perform the embed of this recorder on the page\n        // into the element passed in. with config\n        embed: function (element, config) {\n            var that = this;\n\n            var controlbarid = \"filter_poodll_controlbar_\" + config.widgetid;\n            this.init_instance_props(controlbarid);\n            var ip = this.fetch_instanceprops(controlbarid);\n            ip.config = config;\n            ip.controlbarid = controlbarid;\n            if (config.hideupload) {\n                ip.showupload = false;\n            } else {\n                ip.showupload = true;\n            }\n            ip.timeinterval = config.media_timeinterval;\n            ip.audiomimetype = config.media_audiomimetype;\n            ip.videorecordertype = config.media_videorecordertype;\n            ip.videocaptureheight = config.media_videocaptureheight;\n            ip.errordialog = errordialog.clone();\n            ip.errordialog.init(ip);\n            ip.downloaddialog = downloaddialog.clone();\n            ip.downloaddialog.init(this, ip);\n\n            //init the hermes\n            //putting it in config allows us to post messages from uploader and skin as required\n            ip.config.hermes = hermes.clone();\n            ip.config.hermes.init(config.id, config.allowedURL, config.iframeembed);\n\n            // init our skin\n            var theskin = this.init_skin(controlbarid, ip.config.media_skin, ip);\n\n            //Speech recognition\n            if (ip.config.speechevents && ip.speechrec.will_work_ok(ip.config)) {\n                if (!ip.config.language) {\n                    ip.config.language = 'en-US';\n                }\n                ip.speechrec.init(ip.config);\n                ip.speechrec.onfinalspeechcapture = function (speechtext,speechresults) {\n                    var messageObject = {};\n                    messageObject.type = \"speech\";\n                    messageObject.capturedspeech = speechtext;\n                    messageObject.speechresults = speechresults;\n                    ip.config.hermes.postMessage(messageObject);\n                    //send message to our skin\n                    if (theskin.hasOwnProperty('onfinalspeechcapture')) {\n                        theskin.onfinalspeechcapture(speechtext,speechresults);\n                    }\n                };\n            }else{\n                //just turn off speech events to make it easier to check later\n                log.debug('turning off speech events. not req. or not supported.');\n                ip.config.speechevents = false;\n            }\n\n            // add callbacks for uploadsuccess and upload failure\n            ip.config.onuploadsuccess = function (widgetid) {\n                that.onUploadSuccess(widgetid, theskin);\n            };\n            ip.config.onuploadfailure = function (widgetid) {\n                that.onUploadFailure(widgetid, theskin);\n            };\n\n            switch (config.mediatype) {\n                case 'audio':\n                    var preview = theskin.fetch_preview_audio(config.media_skin);\n                    var resource = theskin.fetch_resource_audio(config.media_skin);\n\n\n                    ip.controlbar = this.fetch_controlbar_audio(element, controlbarid, preview, resource);\n                    ip.uploader = uploader.clone();\n\n                    //init uploader skin and uploader\n                    //uploader skin(upskin) if set to false here will default to naff green bar\n                    //should be called after controlbar is created, because thats when canvas is created\n                    var upskin = theskin.fetch_uploader_skin(ip.controlbarid, element);\n                    ip.uploader.init(element, config, upskin);\n\n                    this.register_events_audio(controlbarid);\n\n                    //if this is the uploader skin, then we do not bother to get mediaDevices\n                    if (ip.config.media_skin == 'upload' || ip.config.media_skin == 'warning') {\n                        break;\n                    }\n\n                    // force permissions;\n                    navigator.mediaDevices.getUserMedia({\"audio\": true}).then(function (stream) {\n                        //do nothing\n                        log.debug('successfully forced permissions and got user media');\n\n                    }).catch(function (err) {\n                        log.debug('location 9998');\n                        log.debug(err);\n                        ip.errordialog.open(err);\n                    });\n\n\n                    break;\n                case 'video':\n                    var preview = theskin.fetch_preview_video(config.media_skin);\n                    var resource = theskin.fetch_resource_video(config.media_skin);\n                    ip.controlbar = this.fetch_controlbar_video(element, controlbarid, preview, resource);\n                    ip.uploader = uploader.clone();\n                    //init uploader skin and uploader\n                    //uploader skin(upskin) if set to false here will default to naff green bar\n                    //should be called after controlbar is created, because thats when canvas is created\n                    var upskin = theskin.fetch_uploader_skin(ip.controlbarid, element);\n                    ip.uploader.init(element, config, upskin);\n\n                    this.register_events_video(controlbarid);\n\n                    //if this is the uploader skin, then we do not bother to get mediaDevices\n                    if (ip.config.media_skin == 'upload' || ip.config.media_skin == 'warning') {\n                        break;\n                    }\n\n                    //force permissions and show in preview\n                    navigator.mediaDevices.getUserMedia({\"audio\": true, \"video\": true}).then(function (stream) {\n                        //stop any playing tracks of the current stream\n                        that.restream_preview_video_player(controlbarid, stream)\n\n                    }).catch(function (err) {\n                        log.debug('location 9999');\n                        log.debug(err);\n                    });\n                    break;\n\n            }\n\n\n            // init timer\n            ip.timer = timer.clone();\n            ip.timer.init(ip.config.timelimit, function () {\n                    theskin.handle_timer_update(controlbarid);\n                    // ip.controlbar.status.html(ip.timer.fetch_display_time());\n                }\n            );\n            theskin.handle_timer_update(controlbarid);\n\n            //in the case of an API embed, the caller might want a handle on the skin\n            return theskin;\n        },\n\n\n        init_instance_props: function (controlbarid) {\n            this.instanceprops[controlbarid] = {};\n            this.instanceprops[controlbarid].recorded_index = 0;\n            this.instanceprops[controlbarid].mediaRecorder = null;\n            this.instanceprops[controlbarid].blobs = [];\n            this.instanceprops[controlbarid].timeinterval = 5000;\n            this.instanceprops[controlbarid].audiomimetype = 'audio/webm';\n            this.instanceprops[controlbarid].videorecordertype = 'auto';// mediarec or webp\n            this.instanceprops[controlbarid].videocapturewidth = 320;\n            this.instanceprops[controlbarid].videocaptureheight = 240;\n            this.instanceprops[controlbarid].controlbar = '';\n            this.instanceprops[controlbarid].previewvolume = 1;\n            this.instanceprops[controlbarid].timer = {};\n            this.instanceprops[controlbarid].timer = {};\n            this.instanceprops[controlbarid].showupload = true;\n            this.instanceprops[controlbarid].uploader = {};\n            this.instanceprops[controlbarid].uploaded = false;\n\n            // we create the audio context object here because so its created in the init and passed around\n            // video context is associated with a player so it seems to be ok.\n            this.instanceprops[controlbarid].useraudiodeviceid = false;\n            this.instanceprops[controlbarid].uservideodeviceid = false;\n            this.instanceprops[controlbarid].devices = [];\n\n            //we only want one context per recorder, but beyond 6 we hit Chromes limit, so we reuse the first we stashed in\n            //window\n            var AudioContext = window.AudioContext // Default\n                || window.webkitAudioContext // Safari and old versions of Chrome\n                || false;\n            if (typeof window.poodllmediarecorder_actx === 'undefined') {\n                var ac = new AudioContext();\n                window.poodllmediarecorder_actx = ac;\n                window.poodllmediarecorder_actx_cnt = 1;\n            } else if (window.poodllmediarecorder_actx_cnt == 6) {\n                var ac = window.poodllmediarecorder_actx;\n                log.debug('More than 6 contexts, reusing first one. visualizations might go weird');\n            } else {\n                var ac = new AudioContext();\n                window.poodllmediarecorder_actx_cnt += 1;\n            }\n\n            this.instanceprops[controlbarid].audioctx = ac;\n\n            var aa = audioanalyser.clone();\n            aa.init(ac);\n            this.instanceprops[controlbarid].audioanalyser = aa;\n            this.instanceprops[controlbarid].previewstillcold = true;\n\n            //speech recognition\n            this.instanceprops[controlbarid].speechrec = speechrecognition.clone();\n\n        },\n\n        init_skin: function (controlbarid, skinname, instanceprops) {\n            this.skins[controlbarid] = mediaskins.fetch_skin_clone(skinname);\n            this.skins[controlbarid].init(instanceprops, this);\n            return this.skins[controlbarid];\n        },\n\n        onUploadSuccess: function (widgetid, theskin) {\n            log.debug('from poodllmediarecorder: uploadsuccess');\n            var controlbarid = 'filter_poodll_controlbar_' + widgetid;\n            theskin.onUploadSuccess(controlbarid);\n        },\n\n        onUploadFailure: function (widgetid, theskin) {\n            log.debug('from poodllmediarecorder: uploadfailure');\n            var controlbarid = 'filter_poodll_controlbar_' + widgetid;\n            theskin.onUploadFailure(controlbarid);\n            //if it failed we want to push the user to download this file\n            theskin.fetch_instanceprops().downloaddialog.open(theskin.pmr, theskin.instanceprops);\n        },\n\n\n        onMediaError: function (e, ip) {\n            if(ip.hasOwnProperty('errordialog')) {\n                ip.errordialog.open(e);\n            }\n            log.error('media error', e);\n        },\n\n        captureUserMedia: function (mediaConstraints, successCallback, errorCallback) {\n            navigator.mediaDevices.getUserMedia(mediaConstraints).then(successCallback).catch(errorCallback);\n\n        },\n\n        warmup_context: function (ip) {\n            var ctx = ip.audioctx;\n            //for chrome oct 2018\n            if (ctx.state == 'suspended') {\n                ctx.resume();\n            }\n\n            var buffer = ctx.createBuffer(1, 1, 22050);\n            var source = ctx.createBufferSource();\n            source.buffer = buffer;\n            source.connect(ctx.destination);\n            source.start(0);\n        },\n        warmup_preview: function (ip) {\n            var preview = ip.controlbar.preview;\n            if (ip.previewstillcold && preview && preview.get(0)) {\n                var pPromise = ip.controlbar.preview[0].play();\n                // the promise thing here is just to suppress console warnings\n                if (pPromise !== undefined) {\n                    pPromise.then(function () {\n                        // playback started we do not need to do anything\n                    }).catch(function (error) {\n                        log.debug(error);\n                    });\n                }\n                ip.previewstillcold = false;\n            }\n\n        },\n        do_start_audio: function (ip, onMediaSuccess) {\n\n            var that = this;\n            // we warm up the context object\n            this.warmup_context(ip);\n\n            // warmup. the preview object\n            this.warmup_preview(ip);\n\n            //mute the preview\n            ip.controlbar.preview[0].muted=true;\n\n            ip.blobs = [];\n            switch (ip.config.mediatype) {\n                case 'audio':\n                    var mediaConstraints = this.fetch_audio_constraints(ip);\n                    break;\n                case 'video':\n                    var mediaConstraints = this.fetch_video_constraints(ip);\n            }\n\n            //We always tidy up old streams before calling getUserMedia\n            //this.tidy_old_stream(ip.controlbarid);\n            this.captureUserMedia(mediaConstraints, onMediaSuccess, function (e) {\n                that.onMediaError(e, ip);\n            });\n\n        },\n        do_start_video: function (ip, onMediaSuccess) {\n\n        },\n\n        do_stopplay_audio: function (ip, preview) {\n            preview.pause();\n            preview.muted=false;\n\n            switch (ip.config.mediatype) {\n                case 'audio':\n                    //we already did everything we need to\n                    break;\n                case 'video':\n                    //Safari can not reuse the preview player, so we created a 'review' and now dispose of it\n                    if(ip.controlbar.hasOwnProperty('livepreview')){\n                        ip.controlbar.preview.hide();\n                        ip.controlbar.preview = ip.controlbar.livepreview;\n                        ip.controlbar.preview.show();\n                    }\n            }\n        },\n\n        do_play_audio: function (ip, preview_unused) {\n\n            if (ip.blobs && ip.blobs.length > 0) {\n                log.debug('playing type:' + ip.blobs[0].type);\n                utils.doConcatenateBlobs(ip.blobs, function (concatenatedBlob) {\n\n\n                    log.debug(concatenatedBlob);\n                    var mediaurl = URL.createObjectURL(concatenatedBlob);\n\n                    //Safari can not reuse the preview player [sigh]\n                    //audio is only used for review, so for video only we create a second video element\n                    switch (ip.config.mediatype) {\n                        case 'audio':\n                            var preview = ip.controlbar.preview[0];\n                            break;\n                        case 'video':\n                            ip.controlbar.livepreview = ip.controlbar.preview;\n                            ip.controlbar.preview = ip.controlbar.preview.clone().insertAfter(ip.controlbar.preview);\n                            var preview = ip.controlbar.preview[0];\n                            ip.controlbar.livepreview.hide();\n\n                    }\n                    preview.src = mediaurl;\n                    preview.controls = false;\n                    preview.volume = ip.previewvolume;\n                    preview.muted=false;\n\n                    // Click the stop button if playback ends;\n                    $(preview).bind('ended', function () {\n                        ip.controlbar.stopbutton.click();\n                    });\n\n                    var ppromise = preview.play();\n                    if (ppromise !== undefined) {\n                        ppromise.then(function () {\n                            // playback started we do not need to do anything\n                        }).catch(function (error) {\n                            log.debug('location: do_play_audio');\n                            log.debug(error);\n                        });\n                    }\n\n                });\n\n\n            }// end of if blobs\n        },\n        do_play_video: function (ip) {\n\n        },\n        do_save_audio: function (ip) {\n            // We do want to allow multiple submissions off one page load BUT\n            // this will require a new filename. The filename is the basis of the\n            // s3filename, s3uploadurl and filename for moodle. The problem with\n            // allowing multiple uploads is that once the placeholder is overwritten\n            // the subsequent submissions ad_hoc move task can no longer find the file to\n            // replace. So we need a whole new filename or to cancel the previous ad hoc move.\n            // This should probably be\n            // an ajax request from the uploader, or even a set of 10 filenames/s3uploadurls\n            // pulled down at PHP time ..\n            // this is one of those cases where a simple thing is hard ...J 20160919\n            if (ip.blobs && ip.blobs.length > 0) {\n                utils.doConcatenateBlobs(ip.blobs, function (concatenatedBlob) {\n                    ip.uploader.uploadBlob(concatenatedBlob, ip.blobs[0].type);\n                });\n                ip.uploaded = true;\n                ip.controlbar.startbutton.attr('disabled', true);\n            }// end of if self.blobs\n        },\n        do_save_video: function (ip) {\n\n        },\n        do_stop_audio: function (ip) {\n            //if its paused we need to resume it before stopping.\n            ip.mediaRecorder.resume();\n            ip.mediaRecorder.stop();\n\n            //stop Speech to text if doing that\n            if (ip.config.speechevents) {\n                ip.speechrec.stop();\n            }\n\n            //publish recording stopped event\n            var messageObject = {};\n            messageObject.type = \"recording\";\n            messageObject.action = 'stopped';\n            ip.config.hermes.postMessage(messageObject);\n        },\n        do_stop_video: function (ip) {\n\n        },\n        do_pause_audio: function (ip) {\n            //if its paused we need to resume it before pausing again.\n            //should never happen ...right?\n            ip.mediaRecorder.resume();\n            ip.mediaRecorder.pause();\n        },\n        do_pause_video: function (ip) {\n\n        },\n        do_resume_audio: function (ip) {\n            ip.mediaRecorder.resume();\n        },\n        do_resume_video: function (ip) {\n\n        },\n\n        /* fetch the audio constraints for passing to mediastream */\n        fetch_video_constraints: function (ip) {\n            var mediaConstraints = {\n                audio: !utils.is_opera() && !utils.is_edge(),\n                video: true\n            };\n\n            //set aspect ratio and I think the \"exact\" below should be \"ideal\"\n            //  mediaConstraints.video = {aspectRatio: 1920/1080};\n            //alert('set');\n\n            // check for a user video selected device\n            if (ip.uservideodeviceid) {\n                var videodeviceid = ip.uservideodeviceid.valueOf();\n                var constraints = {deviceId: videodeviceid ? {exact: videodeviceid} : undefined};\n\n                mediaConstraints.video = constraints;\n            }\n            // check for a user audio selected device\n            if (ip.useraudiodeviceid) {\n                var audiodeviceid = ip.useraudiodeviceid.valueOf();\n                var constraints = {deviceId: audiodeviceid ? {exact: audiodeviceid} : undefined};\n                mediaConstraints.audio = constraints;\n            }\n            return mediaConstraints;\n        },\n\n        /* fetch the audio constraints for passing to mediastream */\n        fetch_audio_constraints: function (ip) {\n\n            // really we need to deal with preferences properly\n            // this will get the available media constraints that need to be set like deviceid above\n            /*\n                var sc = navigator.mediaDevices.getSupportedConstraints();\n                log.debug(sc);\n            */\n\n            // init return object\n            var mediaConstraints = {\n                audio: true\n                //audio: {volume: 0.0}\n            };\n\n\n            // tried hard on safari to get the chosen devce, this but just gave up.\n            if (utils.is_safari() && !ip.useraudiodeviceid) {\n\n                // fix mime type to wav\n                ip.audiomimetype = 'audio/wav';\n\n                //this was code to select first safari audio device\n                /*\n                                // Select final audio device,\n                                navigator.mediaDevices.enumerateDevices()\n                                .then(function(devices) {\n                                  devices.forEach(function(device) {\n                                    if (device.kind == 'audioinput') {\n                                        ip.useraudiodeviceid = device.deviceId;\n                                    }\n                                  });\n                                  }).catch(function(err) {\n                                    log.debug(err);\n                                });\n                */\n            }// end of if Safari\n\n            // check for a user selected device\n            if (ip.useraudiodeviceid) {\n                var constraints = {\"deviceId\": ip.useraudiodeviceid};\n                mediaConstraints.audio = constraints;\n            }\n\n            return mediaConstraints;\n        },\n\n        /* register audio events, including those of skin*/\n        register_events_audio: function (controlbarid) {\n\n            var self = this;\n            var ip = this.fetch_instanceprops(controlbarid);\n            var skin = this.skins[controlbarid];\n\n            var onMediaSuccess = function (stream) {\n\n\n                //stop any playing tracks of the current stream\n                //DONT call this. caused problems\n                //self.tidy_old_stream(controlbarid);\n\n                //save a reference to the stream\n                self.laststream[controlbarid] = stream;\n\n                //set encoder\n                var encoder = 'auto';\n                if (ip.config.hasOwnProperty('encoder')) {\n                    encoder = ip.config.encoder;\n                }\n\n                // get blob after specific time interval\n                ip.mediaRecorder = poodll_msr;\n                ip.mediaRecorder.init(stream, ip.audioctx, ip.audioanalyser, ip.config.mediatype, encoder); // new MediaStreamRecorder(stream);\n                ip.mediaRecorder.mimeType = ip.audiomimetype;\n                ip.mediaRecorder.audioChannels = 1;\n\n                // we pass in the context object because it needs to be activated right on the event.\n                // so its created in the init and passed around\n                ip.mediaRecorder.start(ip.timeinterval, ip.audioctx);\n                ip.mediaRecorder.ondataavailable = function (blob) {\n                    log.debug(blob);\n                    ip.blobs.push(blob);\n                };\n\n                //publish recording start event\n                var messageObject = {};\n                messageObject.type = \"recording\";\n                messageObject.action = 'started';\n                ip.config.hermes.postMessage(messageObject);\n\n                //start  speech to text\n                if (ip.config.speechevents) {\n                    ip.speechrec.start(stream);\n                }\n\n                //defer to the skins code\n                skin.onMediaSuccess_audio(controlbarid);\n\n            };\n\n            skin.register_controlbar_events_audio(onMediaSuccess, controlbarid);\n\n        }, // end of register audio events\n\n        /* fetch the video events */\n        register_events_video: function (controlbarid) {\n\n            var self = this;\n            var ip = this.fetch_instanceprops(controlbarid);\n            var skin = this.skins[controlbarid];\n\n            var onMediaSuccess = function (stream) {\n\n                //restream preview video_player\n                self.restream_preview_video_player(controlbarid, stream);\n\n                //set encoder\n                var encoder = 'auto';\n                if (ip.config.hasOwnProperty('encoder')) {\n                    encoder = ip.config.encoder;\n                }\n\n                //choose and turn on the recorder\n                ip.mediaRecorder = poodll_msr;\n                ip.mediaRecorder.init(stream, ip.audioctx, ip.audioanalyser, ip.config.mediatype, encoder);\n\n\n                // set recorder type\n                if (ip.videorecordertype === 'mediarec') {\n                    ip.mediaRecorder.recorderType = MediaRecorderWrapper;\n                }\n\n                // set capture size\n                ip.mediaRecorder.videoWidth = ip.videocapturewidth;\n                ip.mediaRecorder.videoHeight = ip.videocaptureheight;\n\n                // start recording\n                ip.mediaRecorder.start(ip.timeinterval);\n                ip.mediaRecorder.ondataavailable = function (blob) {\n                    ip.blobs.push(blob);\n                    // log.debug('We got a blobby');\n                    // log.debug(URL.createObjectURL(blob));\n                };\n\n                //publish recording start event\n                var messageObject = {};\n                messageObject.type = \"recording\";\n                messageObject.action = 'started';\n                ip.config.hermes.postMessage(messageObject);\n\n                //start speech to text\n                if (ip.config.speechevents) {\n                    ip.speechrec.start(stream);\n                }\n\n                //defer to the skins code\n                skin.onMediaSuccess_video(controlbarid);\n\n            };\n\n            skin.register_controlbar_events_video(onMediaSuccess, controlbarid);\n        }, // end of register video events\n\n        //clear up the old stream\n        tidy_old_stream: function (controlbarid) {\n\n            //stop any playing tracks of the current stream\n            if (this.laststream[controlbarid]) {\n                this.laststream[controlbarid].getTracks().forEach(\n                    function (track) {\n                        track.stop();\n                    });\n            }\n        },\n\n        restream_preview_video_player: function (controlbarid, stream) {\n\n            //store new stream\n            this.laststream[controlbarid] = stream;\n            //play in preview\n            this.init_video_preview(controlbarid);\n\n            //do we need to do this? ..\n            //lets just do it for android and see how it works out it causes a flicker and few second delays\n            if (utils.is_android()) {\n                navigator.mediaDevices.enumerateDevices();\n            }\n\n        },\n\n        //play the stream in the preview\n        init_video_preview: function (controlbarid) {\n            var ip = this.fetch_instanceprops(controlbarid);\n            var preview = ip.controlbar.preview[0];\n\n            preview.srcObject = this.laststream[controlbarid];\n            preview.controls = false;\n            preview.volume = 0;\n            var ppromise = preview.play();\n            if (ppromise !== undefined) {\n                ppromise.then(function () {\n                    // playback started we do not need to do anything\n                }).catch(function (error) {\n                    log.debug('location: init_video_preview');\n                    log.debug(error);\n                });\n            }\n        },\n\n\n        update_status: function (controlbarid) {\n            var ip = this.fetch_instanceprops(controlbarid);\n            ip.controlbar.status.html(ip.timer.fetch_display_time());\n        },\n\n\n        fetch_controlbar_audio: function (element, controlbarid, preview, resource) {\n            var ip = this.fetch_instanceprops(controlbarid);\n            var skin = this.fetch_skin(controlbarid);\n            var controlbar = skin.insert_controlbar_audio(element, controlbarid, preview, resource);\n            return controlbar;\n        },\n\n        fetch_controlbar_video: function (element, controlbarid, preview, resource) {\n            var ip = this.fetch_instanceprops(controlbarid);\n            var skin = this.fetch_skin(controlbarid);\n            var controlbar = skin.insert_controlbar_video(element, controlbarid, preview, resource);\n            return controlbar;\n        },\n\n        fetch_strings: function () {\n            var ss = [];\n            var keys = ['record', 'play', 'pause', 'continue', 'stop', 'save', 'restart', 'testmic', 'upload', 'recordagain', 'readytorecord', 'downloadfile'];\n            $.each(keys, function (index, key) {\n                ss['recui_' + key] = M.util.get_string('recui_' + key, 'filter_poodll');\n                //log.debug(key + ':' + ss['recui_' + key]);\n                if (ss['recui_' + key].indexOf(',filter_poodll]]') > 1 || ss['recui_' + key] == '') {\n                    ss['recui_' + key] = key;\n                }\n            });\n            return ss;\n        }\n\n    };// end of returned object\n});// total end\n"],"file":"poodll_mediarecorder.min.js"}