{"version":3,"sources":["../src/poodll_mediarecorder.js"],"names":["define","$","log","utils","adapter","uploader","hermes","timer","audioanalyser","poodll_msr","errordialog","downloaddialog","speechrecognition","mediaskins","debug","instanceprops","skins","laststream","fetch_instanceprops","controlbarid","fetch_skin","is_ios","supports_current_browser","config","protocol_ok","M","cfg","wwwroot","indexOf","mediatype","ret","can_html5_record","embed","element","that","widgetid","init_instance_props","ip","hideupload","showupload","timeinterval","media_timeinterval","audiomimetype","media_audiomimetype","videorecordertype","media_videorecordertype","videocaptureheight","media_videocaptureheight","clone","init","id","allowedURL","iframeembed","theskin","init_skin","media_skin","speechevents","speechrec","will_work_ok","language","onfinalspeechcapture","speechtext","speechresults","postMessage","type","capturedspeech","hasOwnProperty","onuploadsuccess","onUploadSuccess","onuploadfailure","onUploadFailure","preview","fetch_preview_audio","resource","fetch_resource_audio","controlbar","fetch_controlbar_audio","upskin","fetch_uploader_skin","register_events_audio","navigator","mediaDevices","getUserMedia","then","catch","err","open","fetch_preview_video","fetch_resource_video","fetch_controlbar_video","register_events_video","stream","restream_preview_video_player","timelimit","handle_timer_update","recorded_index","mediaRecorder","blobs","videocapturewidth","previewvolume","uploaded","useraudiodeviceid","uservideodeviceid","devices","AudioContext","window","webkitAudioContext","poodllmediarecorder_actx","ac","poodllmediarecorder_actx_cnt","audioctx","aa","previewstillcold","skinname","fetch_skin_clone","pmr","onMediaError","e","error","captureUserMedia","mediaConstraints","successCallback","errorCallback","warmup_context","ctx","state","resume","buffer","createBuffer","source","createBufferSource","connect","destination","start","warmup_preview","get","pPromise","play","do_start_audio","onMediaSuccess","muted","fetch_audio_constraints","fetch_video_constraints","do_start_screen","audio","video","cursor","getDisplayMedia","displayStream","audiodeviceid","valueOf","deviceId","exact","voiceStream","tracks","getTracks","getAudioTracks","MediaStream","do_start_video","do_stopplay_audio","pause","hide","livepreview","show","do_play_audio","length","doConcatenateBlobs","concatenatedBlob","mediaurl","URL","createObjectURL","insertAfter","src","controls","volume","bind","stopbutton","click","ppromise","do_play_video","do_save_audio","uploadBlob","startbutton","attr","do_save_video","do_stop_audio","stop","action","do_stop_video","do_stop_screen","do_pause_audio","do_pause_video","do_resume_audio","do_resume_video","is_opera","is_edge","videodeviceid","constraints","fetch_screen_constraints","is_safari","self","skin","register_controlbar_events_audio","encoder","mimeType","audioChannels","ondataavailable","blob","push","callbackjs","callbackObject","filename","updatecontrol","s3filename","executeFunctionByName","onMediaSuccess_audio","register_controlbar_events_video","recorderType","MediaRecorderWrapper","videoWidth","videoHeight","onMediaSuccess_video","tidy_old_stream","forEach","track","init_video_preview","is_android","enumerateDevices","srcObject","update_status","status","html","fetch_display_time","insert_controlbar_audio","insert_controlbar_video","fetch_strings","ss","each","index","key","util","get_string"],"mappings":"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","sourcesContent":["/* jshint ignore:start */\ndefine(['jquery', 'core/log', 'filter_poodll/utils_amd',\n    'filter_poodll/adapter', 'filter_poodll/uploader', 'filter_poodll/hermes', 'filter_poodll/timer',\n    'filter_poodll/audioanalyser',\n    'filter_poodll/msr_poodll',\n    'filter_poodll/dlg_errordisplay',\n    'filter_poodll/dlg_download',\n    'filter_poodll/speech_poodll',\n    'filter_poodll/poodll_mediaskins'], function ($, log, utils, adapter, uploader, hermes, timer, audioanalyser,\n                                                  poodll_msr, errordialog, downloaddialog, speechrecognition, mediaskins) {\n\n    \"use strict\"; // jshint ;_;\n\n    log.debug('PoodLL Media Recorder: initialising');\n\n    return {\n\n        instanceprops: [],\n        skins: [],\n        laststream: [],\n\n        fetch_instanceprops: function (controlbarid) {\n            return this.instanceprops[controlbarid];\n        },\n\n        fetch_skin: function (controlbarid) {\n            return this.skins[controlbarid];\n        },\n\n        is_ios: function () {\n            return utils.is_ios();\n        },\n\n        // This recorder supports the current browser\n        supports_current_browser: function (config) {\n\n            var protocol_ok = M.cfg.wwwroot.indexOf('https:') == 0 ||\n                M.cfg.wwwroot.indexOf('http://localhost') == 0;\n            if(!protocol_ok){return false;}\n\n            if (config.mediatype != 'audio' && config.mediatype != 'video') {\n                return false;\n            }\n\n            var ret = utils.can_html5_record(config.mediatype);\n            if (ret) {\n                log.debug('PoodLL Media Recorder: supports this browser');\n            }\n            return ret;\n        },\n\n        // Perform the embed of this recorder on the page\n        // into the element passed in. with config\n        embed: function (element, config) {\n            var that = this;\n\n            var controlbarid = \"filter_poodll_controlbar_\" + config.widgetid;\n            this.init_instance_props(controlbarid);\n            var ip = this.fetch_instanceprops(controlbarid);\n            ip.config = config;\n            ip.controlbarid = controlbarid;\n            if (config.hideupload) {\n                ip.showupload = false;\n            } else {\n                ip.showupload = true;\n            }\n            ip.timeinterval = config.media_timeinterval;\n            ip.audiomimetype = config.media_audiomimetype;\n            ip.videorecordertype = config.media_videorecordertype;\n            ip.videocaptureheight = config.media_videocaptureheight;\n            ip.errordialog = errordialog.clone();\n            ip.errordialog.init(ip);\n            ip.downloaddialog = downloaddialog.clone();\n            ip.downloaddialog.init(this, ip);\n\n            //init the hermes\n            //putting it in config allows us to post messages from uploader and skin as required\n            ip.config.hermes = hermes.clone();\n            ip.config.hermes.init(config.id, config.allowedURL, config.iframeembed);\n\n            // init our skin\n            var theskin = this.init_skin(controlbarid, ip.config.media_skin, ip);\n\n            //Speech recognition\n            if (ip.config.speechevents && ip.speechrec.will_work_ok(ip.config)) {\n                if (!ip.config.language) {\n                    ip.config.language = 'en-US';\n                }\n                ip.speechrec.init(ip.config);\n                ip.speechrec.onfinalspeechcapture = function (speechtext,speechresults) {\n                    var messageObject = {};\n                    messageObject.type = \"speech\";\n                    messageObject.capturedspeech = speechtext;\n                    messageObject.speechresults = speechresults;\n                    ip.config.hermes.postMessage(messageObject);\n                    //send message to our skin\n                    if (theskin.hasOwnProperty('onfinalspeechcapture')) {\n                        theskin.onfinalspeechcapture(speechtext,speechresults);\n                    }\n                };\n            }else{\n                //just turn off speech events to make it easier to check later\n                log.debug('turning off speech events. not req. or not supported.');\n                ip.config.speechevents = false;\n            }\n\n            // add callbacks for uploadsuccess and upload failure\n            ip.config.onuploadsuccess = function (widgetid) {\n                that.onUploadSuccess(widgetid, theskin);\n            };\n            ip.config.onuploadfailure = function (widgetid) {\n                that.onUploadFailure(widgetid, theskin);\n            };\n\n            switch (config.mediatype) {\n                case 'audio':\n                    var preview = theskin.fetch_preview_audio(config.media_skin);\n                    var resource = theskin.fetch_resource_audio(config.media_skin);\n\n\n                    ip.controlbar = this.fetch_controlbar_audio(element, controlbarid, preview, resource);\n                    ip.uploader = uploader.clone();\n\n                    //init uploader skin and uploader\n                    //uploader skin(upskin) if set to false here will default to naff green bar\n                    //should be called after controlbar is created, because thats when canvas is created\n                    var upskin = theskin.fetch_uploader_skin(ip.controlbarid, element);\n                    ip.uploader.init(element, config, upskin);\n\n                    this.register_events_audio(controlbarid);\n\n                    //if this is the uploader skin, then we do not bother to get mediaDevices\n                    if (ip.config.media_skin == 'upload' || ip.config.media_skin == 'warning') {\n                        break;\n                    }\n\n                    // force permissions;\n                    navigator.mediaDevices.getUserMedia({\"audio\": true}).then(function (stream) {\n                        //do nothing\n                        log.debug('successfully forced permissions and got user media');\n\n                    }).catch(function (err) {\n                        log.debug('location 9998');\n                        log.debug(err);\n                        ip.errordialog.open(err);\n                    });\n\n\n                    break;\n                case 'video':\n                    var preview = theskin.fetch_preview_video(config.media_skin);\n                    var resource = theskin.fetch_resource_video(config.media_skin);\n                    ip.controlbar = this.fetch_controlbar_video(element, controlbarid, preview, resource);\n                    ip.uploader = uploader.clone();\n                    //init uploader skin and uploader\n                    //uploader skin(upskin) if set to false here will default to naff green bar\n                    //should be called after controlbar is created, because thats when canvas is created\n                    var upskin = theskin.fetch_uploader_skin(ip.controlbarid, element);\n                    ip.uploader.init(element, config, upskin);\n\n                    this.register_events_video(controlbarid);\n\n                    //if this is any of the uploader/warning/screen skins, then we do not bother to get mediaDevices\n                    if (ip.config.media_skin == 'upload' || ip.config.media_skin == 'warning' || ip.config.media_skin == 'screen') {\n                        break;\n                    }\n\n                    //force permissions and show in preview\n                    navigator.mediaDevices.getUserMedia({\"audio\": true, \"video\": true}).then(function (stream) {\n                        //stop any playing tracks of the current stream\n                        that.restream_preview_video_player(controlbarid, stream)\n\n                    }).catch(function (err) {\n                        log.debug('location 9999');\n                        log.debug(err);\n                    });\n                    break;\n\n            }\n\n\n            // init timer\n            ip.timer = timer.clone();\n            ip.timer.init(ip.config.timelimit, function () {\n                    theskin.handle_timer_update(controlbarid);\n                    // ip.controlbar.status.html(ip.timer.fetch_display_time());\n                }\n            );\n            theskin.handle_timer_update(controlbarid);\n\n            //in the case of an API embed, the caller might want a handle on the skin\n            return theskin;\n        },\n\n\n        init_instance_props: function (controlbarid) {\n            this.instanceprops[controlbarid] = {};\n            this.instanceprops[controlbarid].recorded_index = 0;\n            this.instanceprops[controlbarid].mediaRecorder = null;\n            this.instanceprops[controlbarid].blobs = [];\n            this.instanceprops[controlbarid].timeinterval = 1000;\n            this.instanceprops[controlbarid].audiomimetype = 'audio/webm';\n            this.instanceprops[controlbarid].videorecordertype = 'auto';// mediarec or webp\n            this.instanceprops[controlbarid].videocapturewidth = 320;\n            this.instanceprops[controlbarid].videocaptureheight = 240;\n            this.instanceprops[controlbarid].controlbar = '';\n            this.instanceprops[controlbarid].previewvolume = 1;\n            this.instanceprops[controlbarid].timer = {};\n            this.instanceprops[controlbarid].timer = {};\n            this.instanceprops[controlbarid].showupload = true;\n            this.instanceprops[controlbarid].uploader = {};\n            this.instanceprops[controlbarid].uploaded = false;\n\n            // we create the audio context object here because so its created in the init and passed around\n            // video context is associated with a player so it seems to be ok.\n            this.instanceprops[controlbarid].useraudiodeviceid = false;\n            this.instanceprops[controlbarid].uservideodeviceid = false;\n            this.instanceprops[controlbarid].devices = [];\n\n            //we only want one context per recorder, but beyond 6 we hit Chromes limit, so we reuse the first we stashed in\n            //window\n            var AudioContext = window.AudioContext // Default\n                || window.webkitAudioContext // Safari and old versions of Chrome\n                || false;\n            if (typeof window.poodllmediarecorder_actx === 'undefined') {\n                var ac = new AudioContext();\n                window.poodllmediarecorder_actx = ac;\n                window.poodllmediarecorder_actx_cnt = 1;\n            } else if (window.poodllmediarecorder_actx_cnt == 6) {\n                var ac = window.poodllmediarecorder_actx;\n                log.debug('More than 6 contexts, reusing first one. visualizations might go weird');\n            } else {\n                var ac = new AudioContext();\n                window.poodllmediarecorder_actx_cnt += 1;\n            }\n\n            this.instanceprops[controlbarid].audioctx = ac;\n\n            var aa = audioanalyser.clone();\n            aa.init(ac);\n            this.instanceprops[controlbarid].audioanalyser = aa;\n            this.instanceprops[controlbarid].previewstillcold = true;\n\n            //speech recognition\n            this.instanceprops[controlbarid].speechrec = speechrecognition.clone();\n\n        },\n\n        init_skin: function (controlbarid, skinname, instanceprops) {\n            this.skins[controlbarid] = mediaskins.fetch_skin_clone(skinname);\n            this.skins[controlbarid].init(instanceprops, this);\n            return this.skins[controlbarid];\n        },\n\n        onUploadSuccess: function (widgetid, theskin) {\n            log.debug('from poodllmediarecorder: uploadsuccess');\n            var controlbarid = 'filter_poodll_controlbar_' + widgetid;\n            theskin.onUploadSuccess(controlbarid);\n        },\n\n        onUploadFailure: function (widgetid, theskin) {\n            log.debug('from poodllmediarecorder: uploadfailure');\n            var controlbarid = 'filter_poodll_controlbar_' + widgetid;\n            theskin.onUploadFailure(controlbarid);\n            //if it failed we want to push the user to download this file\n            theskin.fetch_instanceprops().downloaddialog.open(theskin.pmr, theskin.instanceprops);\n        },\n\n\n        onMediaError: function (e, ip) {\n            if(ip.hasOwnProperty('errordialog')) {\n                ip.errordialog.open(e);\n            }\n            log.error('media error', e);\n        },\n\n        captureUserMedia: function (mediaConstraints, successCallback, errorCallback) {\n            navigator.mediaDevices.getUserMedia(mediaConstraints).then(successCallback).catch(errorCallback);\n\n        },\n\n\n        warmup_context: function (ip) {\n            var ctx = ip.audioctx;\n            //for chrome oct 2018\n            if (ctx.state == 'suspended') {\n                ctx.resume();\n            }\n\n            var buffer = ctx.createBuffer(1, 1, 22050);\n            var source = ctx.createBufferSource();\n            source.buffer = buffer;\n            source.connect(ctx.destination);\n            source.start(0);\n        },\n        warmup_preview: function (ip) {\n            var preview = ip.controlbar.preview;\n            if (ip.previewstillcold && preview && preview.get(0)) {\n                var pPromise = ip.controlbar.preview[0].play();\n                // the promise thing here is just to suppress console warnings\n                if (pPromise !== undefined) {\n                    pPromise.then(function () {\n                        // playback started we do not need to do anything\n                    }).catch(function (error) {\n                        log.debug(error);\n                    });\n                }\n                ip.previewstillcold = false;\n            }\n\n        },\n        do_start_audio: function (ip, onMediaSuccess) {\n\n            var that = this;\n            // we warm up the context object\n            this.warmup_context(ip);\n\n            // warmup. the preview object\n            this.warmup_preview(ip);\n\n            //mute the preview\n            ip.controlbar.preview[0].muted=true;\n\n            ip.blobs = [];\n            switch (ip.config.mediatype) {\n                case 'audio':\n                    var mediaConstraints = this.fetch_audio_constraints(ip);\n                    break;\n                case 'video':\n                    var mediaConstraints = this.fetch_video_constraints(ip);\n            }\n\n            //We always tidy up old streams before calling getUserMedia\n            //this.tidy_old_stream(ip.controlbarid);\n            this.captureUserMedia(mediaConstraints, onMediaSuccess, function (e) {\n                that.onMediaError(e, ip);\n            });\n\n        },\n\n\n        do_start_screen: function (ip, onMediaSuccess) {\n\n            var that = this;\n            // we warm up the context object\n            this.warmup_context(ip);\n\n            // warmup. the preview object\n            this.warmup_preview(ip);\n\n            //mute the preview\n            ip.controlbar.preview[0].muted=true;\n\n            ip.blobs = [];\n            //get media constraints\n            var mediaConstraints = {\n                audio: {'echoCancellation': true},\n                video: {cursor: \"motion\"}\n            };\n\n            //set aspect ratio and I think the \"exact\" below should be \"ideal\"\n            //  mediaConstraints.video = {aspectRatio: 1920/1080};\n\n\n            //do all our stream stuff\n            navigator.mediaDevices.getDisplayMedia(mediaConstraints)\n                .then(async function(displayStream){\n                    // check for a user audio selected device\n                    if (ip.useraudiodeviceid) {\n                        var audiodeviceid = ip.useraudiodeviceid.valueOf();\n                        mediaConstraints.audio.deviceId = audiodeviceid ? {exact: audiodeviceid} : undefined;\n                    }\n                    var voiceStream = await navigator.mediaDevices.getUserMedia({ audio: mediaConstraints.audio, video: false });\n                    var tracks = [...displayStream.getTracks(), ...voiceStream.getAudioTracks()]\n                    var stream = new MediaStream(tracks);\n                    onMediaSuccess(stream);\n                })\n                .catch(function (e) {\n                    that.onMediaError(e, ip);\n            });\n        },\n\n        do_start_video: function (ip, onMediaSuccess) {\n\n        },\n\n        do_stopplay_audio: function (ip, preview) {\n            preview.pause();\n            preview.muted=false;\n\n            switch (ip.config.mediatype) {\n                case 'audio':\n                    //we already did everything we need to\n                    break;\n                case 'video':\n                    //Safari can not reuse the preview player, so we created a 'review' and now dispose of it\n                    if(ip.controlbar.hasOwnProperty('livepreview')){\n                        ip.controlbar.preview.hide();\n                        ip.controlbar.preview = ip.controlbar.livepreview;\n                        ip.controlbar.preview.show();\n                    }\n            }\n        },\n\n        do_play_audio: function (ip, preview_unused) {\n\n            if (ip.blobs && ip.blobs.length > 0) {\n                log.debug('playing type:' + ip.blobs[0].type);\n                log.debug(ip.blobs);\n                utils.doConcatenateBlobs(ip.blobs, function (concatenatedBlob) {\n\n                    log.debug(concatenatedBlob);\n                    var mediaurl = URL.createObjectURL(concatenatedBlob);\n\n                    //Safari can not reuse the preview player [sigh]\n                    //audio is only used for review, so for video only we create a second video element\n                    switch (ip.config.mediatype) {\n                        case 'audio':\n                            var preview = ip.controlbar.preview[0];\n                            break;\n                        case 'video':\n                            ip.controlbar.livepreview = ip.controlbar.preview;\n                            ip.controlbar.preview = ip.controlbar.preview.clone().insertAfter(ip.controlbar.preview);\n                            var preview = ip.controlbar.preview[0];\n                            ip.controlbar.livepreview.hide();\n\n                    }\n                    preview.src = mediaurl;\n                    preview.controls = false;\n                    preview.volume = ip.previewvolume;\n                    preview.muted=false;\n\n                    // Click the stop button if playback ends;\n                    $(preview).bind('ended', function () {\n                        ip.controlbar.stopbutton.click();\n                    });\n\n                    var ppromise = preview.play();\n                    if (ppromise !== undefined) {\n                        ppromise.then(function () {\n                            // playback started we do not need to do anything\n                        }).catch(function (error) {\n                            log.debug('location: do_play_audio');\n                            log.debug(error);\n                        });\n                    }\n\n                });\n\n\n            }// end of if blobs\n        },\n        do_play_video: function (ip) {\n\n        },\n        do_save_audio: function (ip) {\n            // We do want to allow multiple submissions off one page load BUT\n            // this will require a new filename. The filename is the basis of the\n            // s3filename, s3uploadurl and filename for moodle. The problem with\n            // allowing multiple uploads is that once the placeholder is overwritten\n            // the subsequent submissions ad_hoc move task can no longer find the file to\n            // replace. So we need a whole new filename or to cancel the previous ad hoc move.\n            // This should probably be\n            // an ajax request from the uploader, or even a set of 10 filenames/s3uploadurls\n            // pulled down at PHP time ..\n            // this is one of those cases where a simple thing is hard ...J 20160919\n            if (ip.blobs && ip.blobs.length > 0) {\n                utils.doConcatenateBlobs(ip.blobs, function (concatenatedBlob) {\n                    ip.uploader.uploadBlob(concatenatedBlob, ip.blobs[0].type);\n                });\n                ip.uploaded = true;\n                ip.controlbar.startbutton.attr('disabled', true);\n            }// end of if self.blobs\n        },\n        do_save_video: function (ip) {\n\n        },\n        do_stop_audio: function (ip) {\n            //if its paused we need to resume it before stopping.\n            ip.mediaRecorder.resume();\n            ip.mediaRecorder.stop();\n\n            //stop Speech to text if doing that\n            if (ip.config.speechevents) {\n                ip.speechrec.stop();\n            }\n\n            //publish recording stopped event\n            var messageObject = {};\n            messageObject.type = \"recording\";\n            messageObject.action = 'stopped';\n            ip.config.hermes.postMessage(messageObject);\n        },\n        do_stop_video: function (ip) {\n            //just use do_stop_audio\n        },\n        do_stop_screen: function (ip) {\n         //just use do_stop_audio\n        },\n        do_pause_audio: function (ip) {\n            //if its paused we need to resume it before pausing again.\n            //should never happen ...right?\n            ip.mediaRecorder.resume();\n            ip.mediaRecorder.pause();\n        },\n        do_pause_video: function (ip) {\n\n        },\n        do_resume_audio: function (ip) {\n            ip.mediaRecorder.resume();\n        },\n        do_resume_video: function (ip) {\n\n        },\n\n        /* fetch the video constraints for passing to mediastream */\n        fetch_video_constraints: function (ip) {\n            var mediaConstraints = {\n                audio: !utils.is_opera() && !utils.is_edge(),\n                video: true\n            };\n\n            //set aspect ratio and I think the \"exact\" below should be \"ideal\"\n            //  mediaConstraints.video = {aspectRatio: 1920/1080};\n            //alert('set');\n\n            // check for a user video selected device\n            if (ip.uservideodeviceid) {\n                var videodeviceid = ip.uservideodeviceid.valueOf();\n                var constraints = {deviceId: videodeviceid ? {exact: videodeviceid} : undefined};\n\n                mediaConstraints.video = constraints;\n            }\n            // check for a user audio selected device\n            if (ip.useraudiodeviceid) {\n                var audiodeviceid = ip.useraudiodeviceid.valueOf();\n                var constraints = {deviceId: audiodeviceid ? {exact: audiodeviceid} : undefined};\n                mediaConstraints.audio = constraints;\n            }\n            return mediaConstraints;\n        },\n\n        /* fetch the screen constraints for passing to mediastream */\n        fetch_screen_constraints: function (ip) {\n            var mediaConstraints = {\n                audio: !utils.is_opera() && !utils.is_edge(),\n                video: true\n            };\n\n            //set aspect ratio and I think the \"exact\" below should be \"ideal\"\n            //  mediaConstraints.video = {aspectRatio: 1920/1080};\n            //alert('set');\n\n            // check for a user video selected device\n            if (ip.uservideodeviceid) {\n                var videodeviceid = ip.uservideodeviceid.valueOf();\n                var constraints = {deviceId: videodeviceid ? {exact: videodeviceid} : undefined};\n\n                mediaConstraints.video = constraints;\n            }\n            // check for a user audio selected device\n            if (ip.useraudiodeviceid) {\n                var audiodeviceid = ip.useraudiodeviceid.valueOf();\n                var constraints = {deviceId: audiodeviceid ? {exact: audiodeviceid} : undefined};\n                mediaConstraints.audio = constraints;\n            }\n            return mediaConstraints;\n        },\n\n        /* fetch the audio constraints for passing to mediastream */\n        fetch_audio_constraints: function (ip) {\n\n            // really we need to deal with preferences properly\n            // this will get the available media constraints that need to be set like deviceid above\n\n              //  var sc = navigator.mediaDevices.getSupportedConstraints();\n              //  log.debug(sc);\n\n\n            // init return object\n            var mediaConstraints = {\n                audio: true\n                //audio: {volume: 0.0}\n            };\n\n\n            // tried hard on safari to get the chosen devce, this but just gave up.\n            if (utils.is_safari() && !ip.useraudiodeviceid) {\n\n                // fix mime type to wav\n                ip.audiomimetype = 'audio/wav';\n\n\n            }// end of if Safari\n\n            // check for a user selected device\n            if (ip.useraudiodeviceid) {\n                var constraints = {\"deviceId\": ip.useraudiodeviceid};\n                mediaConstraints.audio = constraints;\n            }\n            // log.debug(mediaConstraints);\n\n            return mediaConstraints;\n        },\n\n        /* register audio events, including those of skin*/\n        register_events_audio: function (controlbarid) {\n\n            var self = this;\n            var ip = this.fetch_instanceprops(controlbarid);\n            var skin = this.skins[controlbarid];\n\n            var onMediaSuccess = function (stream) {\n\n\n                //stop any playing tracks of the current stream\n                //DONT call this. caused problems\n                //self.tidy_old_stream(controlbarid);\n\n                //save a reference to the stream\n                self.laststream[controlbarid] = stream;\n\n                //set encoder\n                var encoder = 'auto';\n                if (ip.config.hasOwnProperty('encoder')) {\n                    encoder = ip.config.encoder;\n                }\n\n                // get blob after specific time interval\n                ip.mediaRecorder = poodll_msr;\n                ip.mediaRecorder.init(stream, ip.audioctx, ip.audioanalyser, ip.config.mediatype, encoder);\n                //the following are really for stereoaudio  msr\n                ip.mediaRecorder.mimeType = ip.audiomimetype;\n                ip.mediaRecorder.audioChannels = 1;\n\n                // we pass in the context object because it needs to be activated right on the event.\n                // so its created in the init and passed around\n                ip.mediaRecorder.start(ip.timeinterval, ip.audioctx);\n                ip.mediaRecorder.ondataavailable = function (blob) {\n                    //log.debug(blob);\n                    ip.blobs.push(blob);\n                };\n\n\n\n                //We want to publish a \"started\" recording event.\n                //----------------------------------\n                //but non-iframe (Classic) and in-iframe (Cloud) events work a bit different\n                //this is for non-iframe (Classic)\n                if (!ip.config.iframeembed) {\n                    if (ip.config.callbackjs && ip.config.callbackjs != '') {\n\n                        //publish recording started event to non-iframe\n                        //For callbackjs and for postmessage we need an array of stuff\n                        var callbackObject = new Array();\n                        callbackObject[0] = ip.config.widgetid;\n                        callbackObject[1] = \"started\";\n                        callbackObject[2] = ip.config.filename;\n                        callbackObject[3] = ip.config.updatecontrol;\n                        callbackObject[4] = ip.config.s3filename;\n\n                        if (typeof(ip.config.callbackjs) === 'function') {\n                            ip.config.callbackjs(callbackObject);\n                        } else {\n                            uploader.executeFunctionByName(ip.config.callbackjs, window, callbackObject);\n                        }\n                    }\n                }\n\n                //this is for in-iframe (Cloud)\n                var messageObject = {};\n                messageObject.type = \"recording\";\n                messageObject.action = 'started';\n                ip.config.hermes.postMessage(messageObject);\n                //----------------------------------\n\n                //start  speech to text\n                if (ip.config.speechevents) {\n                    ip.speechrec.start(stream);\n                }\n\n                //defer to the skins code\n                skin.onMediaSuccess_audio(controlbarid);\n\n            };\n\n            skin.register_controlbar_events_audio(onMediaSuccess, controlbarid);\n\n        }, // end of register audio events\n\n        /* fetch the video events */\n        register_events_video: function (controlbarid) {\n\n            var self = this;\n            var ip = this.fetch_instanceprops(controlbarid);\n            var skin = this.skins[controlbarid];\n\n            var onMediaSuccess = function (stream) {\n\n                //restream preview video_player\n                self.restream_preview_video_player(controlbarid, stream);\n\n                //set encoder\n                var encoder = 'auto';\n                if (ip.config.hasOwnProperty('encoder')) {\n                    encoder = ip.config.encoder;\n                }\n\n                //choose and turn on the recorder\n                ip.mediaRecorder = poodll_msr;\n                ip.mediaRecorder.init(stream, ip.audioctx, ip.audioanalyser, ip.config.mediatype, encoder);\n\n\n                // set recorder type\n                if (ip.videorecordertype === 'mediarec') {\n                    ip.mediaRecorder.recorderType = MediaRecorderWrapper;\n                }\n\n                // set capture size\n                ip.mediaRecorder.videoWidth = ip.videocapturewidth;\n                ip.mediaRecorder.videoHeight = ip.videocaptureheight;\n\n                // start recording\n                ip.mediaRecorder.start(ip.timeinterval);\n                ip.mediaRecorder.ondataavailable = function (blob) {\n                    ip.blobs.push(blob);\n                    // log.debug('We got a blobby');\n                    // log.debug(URL.createObjectURL(blob));\n                };\n\n                //We want to publish a \"started\" recording event.\n                //----------------------------------\n                //but non-iframe (Classic) and in-iframe (Cloud) events work a bit different\n                //this is for non-iframe (Classic)\n                if (!ip.config.iframeembed) {\n                    if (ip.config.callbackjs && ip.config.callbackjs != '') {\n\n                        //publish recording started event to non-iframe\n                        //For callbackjs and for postmessage we need an array of stuff\n                        var callbackObject = new Array();\n                        callbackObject[0] = ip.config.widgetid;\n                        callbackObject[1] = \"started\";\n                        callbackObject[2] = ip.config.filename;\n                        callbackObject[3] = ip.config.updatecontrol;\n                        callbackObject[4] = ip.config.s3filename;\n\n                        if (typeof(ip.config.callbackjs) === 'function') {\n                            ip.config.callbackjs(callbackObject);\n                        } else {\n                            uploader.executeFunctionByName(ip.config.callbackjs, window, callbackObject);\n                        }\n                    }\n                }\n\n                //this is for in-iframe (Cloud)\n                var messageObject = {};\n                messageObject.type = \"recording\";\n                messageObject.action = 'started';\n                ip.config.hermes.postMessage(messageObject);\n\n                //start speech to text\n                if (ip.config.speechevents) {\n                    ip.speechrec.start(stream);\n                }\n\n                //defer to the skins code\n                skin.onMediaSuccess_video(controlbarid);\n\n            };\n\n            skin.register_controlbar_events_video(onMediaSuccess, controlbarid);\n        }, // end of register video events\n\n        //clear up the old stream\n        tidy_old_stream: function (controlbarid) {\n\n            //stop any playing tracks of the current stream\n            if (this.laststream[controlbarid]) {\n                this.laststream[controlbarid].getTracks().forEach(\n                    function (track) {\n                        track.stop();\n                    });\n            }\n        },\n\n        restream_preview_video_player: function (controlbarid, stream) {\n\n            //store new stream\n            this.laststream[controlbarid] = stream;\n            //play in preview\n            this.init_video_preview(controlbarid);\n\n            //do we need to do this? ..\n            //lets just do it for android and see how it works out it causes a flicker and few second delays\n            if (utils.is_android()) {\n                navigator.mediaDevices.enumerateDevices();\n            }\n\n        },\n\n        //play the stream in the preview\n        init_video_preview: function (controlbarid) {\n            var ip = this.fetch_instanceprops(controlbarid);\n            var preview = ip.controlbar.preview[0];\n\n            preview.srcObject = this.laststream[controlbarid];\n            preview.controls = false;\n            preview.volume = 0;\n            var ppromise = preview.play();\n            if (ppromise !== undefined) {\n                ppromise.then(function () {\n                    // playback started we do not need to do anything\n                }).catch(function (error) {\n                    log.debug('location: init_video_preview');\n                    log.debug(error);\n                });\n            }\n        },\n\n\n        update_status: function (controlbarid) {\n            var ip = this.fetch_instanceprops(controlbarid);\n            ip.controlbar.status.html(ip.timer.fetch_display_time());\n        },\n\n\n        fetch_controlbar_audio: function (element, controlbarid, preview, resource) {\n            var ip = this.fetch_instanceprops(controlbarid);\n            var skin = this.fetch_skin(controlbarid);\n            var controlbar = skin.insert_controlbar_audio(element, controlbarid, preview, resource);\n            return controlbar;\n        },\n\n        fetch_controlbar_video: function (element, controlbarid, preview, resource) {\n            var ip = this.fetch_instanceprops(controlbarid);\n            var skin = this.fetch_skin(controlbarid);\n            var controlbar = skin.insert_controlbar_video(element, controlbarid, preview, resource);\n            return controlbar;\n        },\n\n        fetch_strings: function () {\n            var ss = [];\n            var keys = ['record', 'play', 'pause', 'continue', 'stop', 'save', 'restart', 'testmic', 'upload', 'recordagain', 'readytorecord', 'downloadfile'];\n            $.each(keys, function (index, key) {\n                ss['recui_' + key] = M.util.get_string('recui_' + key, 'filter_poodll');\n                //log.debug(key + ':' + ss['recui_' + key]);\n                if (ss['recui_' + key].indexOf(',filter_poodll]]') > 1 || ss['recui_' + key] == '') {\n                    ss['recui_' + key] = key;\n                }\n            });\n            return ss;\n        }\n\n    };// end of returned object\n});// total end\n"],"file":"poodll_mediarecorder.min.js"}