define(["jquery","core/log","filter_poodll/utils_amd","filter_poodll/uploader","filter_poodll/drawingboard"],(function($,log,utils,uploader,DrawingBoard){return log.debug("Filter PoodLL: drawingboard.js initialising"),{instanceprops:[],loaddrawingboard:function(opts){var theid="#amdopts_"+opts.recorderid,optscontrol=$(theid).get(0);if(optscontrol){if((opts=JSON.parse(optscontrol.value)).bgimage)var erasercolor="transparent";else{erasercolor="background";opts.bgimage="#FFF"}this.config=opts,$(theid).remove()}var element="#"+opts.recorderid+"drawing-board-id",db=new DrawingBoard.Board(opts.recorderid+"_drawing-board-id",{recorderid:opts.recorderid,size:3,background:opts.bgimage,controls:["Color",{Size:{type:"auto"}},{DrawingMode:{filler:!1,eraser:!0,pencil:!0}},"Navigation"],droppable:!0,webStorage:!1,enlargeYourContainer:!0,eraserColor:erasercolor});opts.db=db;var vectordata=opts.vectordata;vectordata&&0!=vectordata.indexOf('{"shapes"')&&0!=vectordata.indexOf('{"colors"')&&(db.history=Y.JSON.parse(vectordata),db.setImg(db.history.values[db.history.position-1])),opts.uploader=uploader.clone(),opts.uploader.init(element,opts),this.instanceprops[opts.recorderid]=opts,this.registerEvents(opts.recorderid)},registerEvents:function(recid){var opts=this.instanceprops[recid];if(opts.autosave){var doStopDrawing=function(){if(document.getElementById(recid+"_messages")){var th=utils.timeouthandles[recid];th&&clearTimeout(th),utils.timeouthandles[recid]=setTimeout((function(){utils.WhiteboardUploadHandler(recid,opts.db,opts,opts.uploader)}),opts.autosave)}};opts.db.ev.bind("board:startDrawing",(function(){var m=document.getElementById(recid+"_messages");if(m){m.innerHTML="File has not been saved.",document.getElementById(recid+"_btn_upload_whiteboard").disabled=!1;var th=utils.timeouthandles[recid];th&&clearTimeout(th),utils.timeouthandles[recid]=setTimeout((function(){utils.WhiteboardUploadHandler(recid,opts.db,opts,opts.uploader)}),opts.autosave)}})),opts.db.ev.bind("board:stopDrawing",doStopDrawing),opts.db.ev.bind("board:reset",doStopDrawing),opts.db.ev.bind("historyNavigation",doStopDrawing)}else{doStopDrawing=function(){var m=document.getElementById(recid+"_messages");m&&(m.innerHTML="File has not been saved.")};opts.db.ev.bind("board:stopDrawing",doStopDrawing)}var uploadbutton=$("#"+recid+"_btn_upload_whiteboard");uploadbutton&&(opts.autosave?uploadbutton.click((function(){utils.WhiteboardUploadHandler(recid,opts.db,opts,opts.uploader)})):uploadbutton.click((function(){var cvs=utils.getCvs(recid,opts.db,opts);utils.pokeVectorData(recid,opts.db,opts),opts.uploader.uploadFile(cvs.toDataURL(),"image/png")})))}}}));

//# sourceMappingURL=drawingboard_amd.min.js.map