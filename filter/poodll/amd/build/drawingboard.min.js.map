{"version":3,"sources":["../src/drawingboard.js"],"names":["define","DrawingBoard","Board","id","opts","$","extend","defaultOpts","ev","Utils","MicroEvent","$el","document","getElementById","length","tpl","controlsPosition","indexOf","addClass","append","dom","$canvasWrapper","find","$canvas","$cursor","$controls","each","proxy","n","val","attr","canvas","get","ctx","getContext","color","errorMessage","html","storage","_getStorage","initHistory","reset","webStorage","history","background","initControls","resize","restoreWebStorage","initDropEvents","initDrawEvents","controls","size","eraserColor","droppable","enlargeYourContainer","prototype","setMode","resetBackground","setColor","lineWidth","lineCap","lineJoin","saveWebStorage","saveHistory","blankCanvas","getImg","trigger","historize","bgIsColor","isColor","prevMode","getMode","clearRect","width","fillStyle","fillRect","height","setImg","toggleClass","canvasWidth","canvasHeight","widths","boxBorderWidth","heights","boxBorderHeight","that","sum","values","multiplier","res","i","sub","css","Control","c","window","controlName","addControl","control","optsOrPos","pos","children","eq","before","push","removeClass","position","shift","slice","_goThroughHistory","goForth","goBackInHistory","goForthInHistory","src","img","Image","oldGCO","globalCompositeOperation","onload","drawImage","toDataURL","downloadImg","replace","location","href","setItem","charAt","toUpperCase","getItem","clearWebStorage","removeItem","on","e","stopPropagation","preventDefault","_onCanvasDrop","originalEvent","files","dataTransfer","type","FileReader","fr","readAsDataURL","target","result","newMode","silent","unbind","fill","strokeStyle","mode","bind","setStrokeStyle","getImageData","INDEX","X","Y","COLOR","stroke","r","parseInt","substr","g","b","start","pixelAt","coords","x","y","RGBToInt","queue","pixel","maxX","maxY","pop","data","putImageData","isDrawing","isMouseHovering","old","current","oldMid","_onInputStart","_getInputCoords","_onInputMove","_onInputStop","_onMouseOver","_onMouseOut","requestAnimationFrame","draw","transform","currentMid","_getMidInputCoords","beginPath","moveTo","quadraticCurveTo","touches","pageX","pageY","offset","left","top","drawingBoard","board","defaults","createElement","name","onBoardReset","initialize","apply","arguments","addToBoard","protoProps","staticProps","parent","child","hasOwnProperty","constructor","Surrogate","__super__","Color","initTemplate","$target","$relatedButton","hasClass","closest","$myButton","$popup","oneColorTpl","rainbows","key","additionalColor","_rgba","toString","_hsl2Rgba","_hsl","a","h","s","l","_hex2Rgba","hex","num","substring","hsl","hue2rgb","p","q","t","Math","floor","DrawingMode","pencil","eraser","filler","k","value","currentTarget","toggleButtons","item","$item","Navigation","back","forward","el","$back","removeAttr","$forward","Size","dropdownValues","types","_iHasRangeInput","inArray","updateView","_rangeTemplate","_dropdownTemplate","borderRadius","marginLeft","marginTop","abs","inputElem","docElement","documentElement","available","setAttribute","style","cssText","test","WebkitAppearance","appendChild","defaultView","getComputedStyle","offsetHeight","removeChild","Download","undef","template","tag","token","path","split","len","lookup","event","fct","_events","splice","Array","call","_boxBorderSize","withPadding","withMargin","direction","props","string","image","vendors","cancelAnimationFrame","global","self"],"mappings":"mSAAAA,OAAM,8BAAC,EAAD,CAAK,UAAW,CAMtB,GAAIC,CAAAA,CAAY,CAAG,EAAnB,CAgBAA,CAAY,CAACC,KAAb,CAAqB,SAAUC,CAAV,CAAcC,CAAd,CAAoB,CACrC,KAAKA,IAAL,CAAYC,CAAC,CAACC,MAAF,CAAS,EAAT,CAAaL,CAAY,CAACC,KAAb,CAAmBK,WAAhC,CAA6CH,CAA7C,CAAZ,CAEA,KAAKI,EAAL,CAAU,GAAIP,CAAAA,CAAY,CAACQ,KAAb,CAAmBC,UAAjC,CAEA,KAAKP,EAAL,CAAUA,CAAV,CACA,KAAKQ,GAAL,CAAWN,CAAC,CAACO,QAAQ,CAACC,cAAT,CAAwBV,CAAxB,CAAD,CAAZ,CACA,GAAI,CAAC,KAAKQ,GAAL,CAASG,MAAd,CACI,SAEJ,GAAIC,CAAAA,CAAG,CAAG,kLAAV,CACA,GAAmD,CAAC,CAAhD,MAAKX,IAAL,CAAUY,gBAAV,CAA2BC,OAA3B,CAAmC,QAAnC,CAAJ,CAAuDF,CAAG,EAAI,8CAAP,CAAvD,IACKA,CAAAA,CAAG,CAAG,+CAA+CA,CAArD,CAEL,KAAKJ,GAAL,CAASO,QAAT,CAAkB,eAAlB,EAAmCC,MAAnC,CAA0CJ,CAA1C,EACA,KAAKK,GAAL,CAAW,CACPC,cAAc,CAAE,KAAKV,GAAL,CAASW,IAAT,CAAc,+BAAd,CADT,CAEPC,OAAO,CAAE,KAAKZ,GAAL,CAASW,IAAT,CAAc,uBAAd,CAFF,CAGPE,OAAO,CAAE,KAAKb,GAAL,CAASW,IAAT,CAAc,uBAAd,CAHF,CAIPG,SAAS,CAAE,KAAKd,GAAL,CAASW,IAAT,CAAc,yBAAd,CAJJ,CAAX,CAOAjB,CAAC,CAACqB,IAAF,CAAO,CAAC,MAAD,CAAS,OAAT,CAAkB,QAAlB,CAAP,CAAoCrB,CAAC,CAACsB,KAAF,CAAQ,SAAUC,CAAV,CAAaC,CAAb,CAAkB,CAC1D,GAA8C,CAAC,CAA3C,MAAKzB,IAAL,CAAUY,gBAAV,CAA2BC,OAA3B,CAAmCY,CAAnC,CAAJ,CAAkD,CAC9C,KAAKT,GAAL,CAASK,SAAT,CAAmBK,IAAnB,CAAwB,YAAxB,CAAsCD,CAAtC,EACA,QACH,CACJ,CALmC,CAKjC,IALiC,CAApC,EAOA,KAAKE,MAAL,CAAc,KAAKX,GAAL,CAASG,OAAT,CAAiBS,GAAjB,CAAqB,CAArB,CAAd,CACA,KAAKC,GAAL,CAAW,KAAKF,MAAL,EAAe,KAAKA,MAAL,CAAYG,UAA3B,EAAyC,KAAKH,MAAL,CAAYG,UAAZ,CAAuB,IAAvB,CAAzC,CAAwE,KAAKH,MAAL,CAAYG,UAAZ,CAAuB,IAAvB,CAAxE,CAAuG,IAAlH,CACA,KAAKC,KAAL,CAAa,KAAK/B,IAAL,CAAU+B,KAAvB,CAEA,GAAI,CAAC,KAAKF,GAAV,CAAe,CACX,GAAI,KAAK7B,IAAL,CAAUgC,YAAd,CACI,KAAKzB,GAAL,CAAS0B,IAAT,CAAc,KAAKjC,IAAL,CAAUgC,YAAxB,EACJ,QACH,CAED,KAAKE,OAAL,CAAe,KAAKC,WAAL,EAAf,CAEA,KAAKC,WAAL,GAEA,KAAKC,KAAL,CAAW,CAACC,UAAU,GAAX,CAAoBC,OAAO,GAA3B,CAAoCC,UAAU,GAA9C,CAAX,EAEA,KAAKC,YAAL,GAEA,KAAKC,MAAL,GAEA,KAAKL,KAAL,CAAW,CAACC,UAAU,GAAX,CAAoBC,OAAO,GAA3B,CAAmCC,UAAU,GAA7C,CAAX,EACA,KAAKG,iBAAL,GACA,KAAKC,cAAL,GACA,KAAKC,cAAL,EACH,CArDD,CAwDAhD,CAAY,CAACC,KAAb,CAAmBK,WAAnB,CAAiC,CAC7B2C,QAAQ,CAAE,CAAC,OAAD,CAAU,aAAV,CAAyB,MAAzB,CAAiC,YAAjC,CADmB,CAE7BlC,gBAAgB,CAAE,UAFW,CAG7BmB,KAAK,CAAE,SAHsB,CAI7BgB,IAAI,CAAE,CAJuB,CAK7BP,UAAU,CAAE,MALiB,CAM7BQ,WAAW,CAAE,YANgB,CAO7BV,UAAU,CAAE,SAPiB,CAQ7BW,SAAS,GARoB,CAS7BC,oBAAoB,GATS,CAU7BlB,YAAY,CAAE,oIAVe,CAAjC,CAcAnC,CAAY,CAACC,KAAb,CAAmBqD,SAAnB,CAA+B,CAW3Bd,KAAK,CAAE,eAAUrC,CAAV,CAAgB,CACnBA,CAAI,CAAGC,CAAC,CAACC,MAAF,CAAS,CACZ6B,KAAK,CAAE,KAAK/B,IAAL,CAAU+B,KADL,CAEZgB,IAAI,CAAE,KAAK/C,IAAL,CAAU+C,IAFJ,CAGZT,UAAU,GAHE,CAIZC,OAAO,GAJK,CAKZC,UAAU,GALE,CAAT,CAMJxC,CANI,CAAP,CAQA,KAAKoD,OAAL,CAAa,QAAb,EAEA,GAAIpD,CAAI,CAACwC,UAAT,CAAqB,KAAKa,eAAL,CAAqB,KAAKrD,IAAL,CAAUwC,UAA/B,KAErB,GAAIxC,CAAI,CAAC+B,KAAT,CAAgB,KAAKuB,QAAL,CAActD,CAAI,CAAC+B,KAAnB,EAChB,GAAI/B,CAAI,CAAC+C,IAAT,CAAe,KAAKlB,GAAL,CAAS0B,SAAT,CAAqBvD,CAAI,CAAC+C,IAA1B,CAEf,KAAKlB,GAAL,CAAS2B,OAAT,CAAmB,OAAnB,CACA,KAAK3B,GAAL,CAAS4B,QAAT,CAAoB,OAApB,CAGA,GAAIzD,CAAI,CAACsC,UAAT,CAAqB,KAAKoB,cAAL,GAErB,GAAI1D,CAAI,CAACuC,OAAT,CAAkB,KAAKoB,WAAL,GAElB,KAAKC,WAAL,CAAmB,KAAKC,MAAL,EAAnB,CAEA,KAAKzD,EAAL,CAAQ0D,OAAR,CAAgB,aAAhB,CAA+B9D,CAA/B,CACH,CAtC0B,CAwC3BqD,eAAe,CAAE,yBAAUb,CAAV,CAAsBuB,CAAtB,CAAiC,CAC9CvB,CAAU,CAAGA,CAAU,EAAI,KAAKxC,IAAL,CAAUwC,UAArC,CACAuB,CAAS,CAAwB,WAArB,QAAOA,CAAAA,CAAP,CAAmCA,CAAnC,GAAZ,CAF8C,GAG1CC,CAAAA,CAAS,CAAGnE,CAAY,CAACQ,KAAb,CAAmB4D,OAAnB,CAA2BzB,CAA3B,CAH8B,CAI1C0B,CAAQ,CAAG,KAAKC,OAAL,EAJ+B,CAK9C,KAAKf,OAAL,CAAa,QAAb,EACA,KAAKvB,GAAL,CAASuC,SAAT,CAAmB,CAAnB,CAAsB,CAAtB,CAAyB,KAAKvC,GAAL,CAASF,MAAT,CAAgB0C,KAAzC,CAAgD,KAAKxC,GAAL,CAASF,MAAT,CAAgB0C,KAAhE,EACA,GAAIL,CAAJ,CAAe,CACX,KAAKnC,GAAL,CAASyC,SAAT,CAAqB9B,CAArB,CACA,KAAKX,GAAL,CAAS0C,QAAT,CAAkB,CAAlB,CAAqB,CAArB,CAAwB,KAAK1C,GAAL,CAASF,MAAT,CAAgB0C,KAAxC,CAA+C,KAAKxC,GAAL,CAASF,MAAT,CAAgB6C,MAA/D,CACH,CAHD,IAGO,IAAIhC,CAAJ,CACH,KAAKiC,MAAL,CAAYjC,CAAZ,EACJ,KAAKY,OAAL,CAAac,CAAb,EACA,GAAIH,CAAJ,CAAe,KAAKJ,WAAL,EAClB,CAtD0B,CAwD3BjB,MAAM,CAAE,iBAAY,CAChB,KAAK1B,GAAL,CAASK,SAAT,CAAmBqD,WAAnB,CAA+B,+BAA/B,CAAiE,CAAC,KAAK5B,QAAN,EAAkB,CAAC,KAAKA,QAAL,CAAcpC,MAAlG,EADgB,GAGZiE,CAAAA,CAHY,CAGCC,CAHD,CAIZC,CAAM,CAAG,CACT,KAAKtE,GAAL,CAAS8D,KAAT,EADS,CAETxE,CAAY,CAACQ,KAAb,CAAmByE,cAAnB,CAAkC,KAAKvE,GAAvC,CAFS,CAGTV,CAAY,CAACQ,KAAb,CAAmByE,cAAnB,CAAkC,KAAK9D,GAAL,CAASC,cAA3C,OAHS,CAJG,CASZ8D,CAAO,CAAG,CACV,KAAKxE,GAAL,CAASiE,MAAT,EADU,CAEV3E,CAAY,CAACQ,KAAb,CAAmB2E,eAAnB,CAAmC,KAAKzE,GAAxC,CAFU,CAGV,KAAKS,GAAL,CAASK,SAAT,CAAmBmD,MAAnB,EAHU,CAIV3E,CAAY,CAACQ,KAAb,CAAmB2E,eAAnB,CAAmC,KAAKhE,GAAL,CAASK,SAA5C,OAJU,CAKVxB,CAAY,CAACQ,KAAb,CAAmB2E,eAAnB,CAAmC,KAAKhE,GAAL,CAASC,cAA5C,OALU,CATE,CAgBZgE,CAAI,CAAG,IAhBK,CAiBZC,CAAG,CAAG,SAAUC,CAAV,CAAkBC,CAAlB,CAA8B,CACpCA,CAAU,CAAGA,CAAU,EAAI,CAA3B,CAEA,OADIC,CAAAA,CAAG,CAAGF,CAAM,CAAC,CAAD,CAChB,CAASG,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGH,CAAM,CAACzE,MAA3B,CAAmC4E,CAAC,EAApC,CAAwC,CACpCD,CAAG,CAAGA,CAAG,CAAIF,CAAM,CAACG,CAAD,CAAN,CAAYF,CAC5B,CACD,MAAOC,CAAAA,CACV,CAxBe,CAyBZE,CAAG,CAAG,SAAUJ,CAAV,CAAkB,CACxB,MAAOD,CAAAA,CAAG,CAACC,CAAD,CAAS,CAAC,CAAV,CACb,CA3Be,CA6BhB,GAAI,KAAKnF,IAAL,CAAUkD,oBAAd,CAAoC,CAChCyB,CAAW,CAAG,KAAKpE,GAAL,CAAS8D,KAAT,EAAd,CACAO,CAAY,CAAG,KAAKrE,GAAL,CAASiE,MAAT,EAAf,CAEA,KAAKjE,GAAL,CAAS8D,KAAT,CAAea,CAAG,CAACL,CAAD,CAAlB,EACA,KAAKtE,GAAL,CAASiE,MAAT,CAAgBU,CAAG,CAACH,CAAD,CAAnB,CACH,CAND,IAMO,CACHJ,CAAW,CAAGY,CAAG,CAACV,CAAD,CAAjB,CACAD,CAAY,CAAGW,CAAG,CAACR,CAAD,CACrB,CAED,KAAK/D,GAAL,CAASC,cAAT,CAAwBuE,GAAxB,CAA4B,OAA5B,CAAqCb,CAAW,CAAG,IAAnD,EACA,KAAK3D,GAAL,CAASC,cAAT,CAAwBuE,GAAxB,CAA4B,QAA5B,CAAsCZ,CAAY,CAAG,IAArD,EAEA,KAAK5D,GAAL,CAASG,OAAT,CAAiBqE,GAAjB,CAAqB,OAArB,CAA8Bb,CAAW,CAAG,IAA5C,EACA,KAAK3D,GAAL,CAASG,OAAT,CAAiBqE,GAAjB,CAAqB,QAArB,CAA+BZ,CAAY,CAAG,IAA9C,EAEA,KAAKjD,MAAL,CAAY0C,KAAZ,CAAoBM,CAApB,CACA,KAAKhD,MAAL,CAAY6C,MAAZ,CAAqBI,CACxB,CAxG0B,CAmH3BnC,YAAY,CAAE,uBAAY,CACtB,KAAKK,QAAL,CAAgB,EAAhB,CACA,GAAI,CAAC,KAAK9C,IAAL,CAAU8C,QAAV,CAAmBpC,MAApB,EAA8B,CAACb,CAAY,CAAC4F,OAAhD,CAAyD,SACzD,IAAK,GAAIH,CAAAA,CAAC,CAAG,CAAR,CACGI,CADR,CAAgBJ,CAAC,CAAG,KAAKtF,IAAL,CAAU8C,QAAV,CAAmBpC,MAAvC,CAA+C4E,CAAC,EAAhD,CAAoD,CAC5CI,CAD4C,CACxC,IADwC,CAEhD,GAAoC,QAAhC,QAAO,MAAK1F,IAAL,CAAU8C,QAAV,CAAmBwC,CAAnB,CAAX,CACII,CAAC,CAAG,GAAIC,CAAAA,MAAM,aAAN,SAAkC,KAAK3F,IAAL,CAAU8C,QAAV,CAAmBwC,CAAnB,CAAlC,CAAJ,CAA6D,IAA7D,CAAJ,CADJ,IAEK,IAAoC,QAAhC,UAAO,KAAKtF,IAAL,CAAU8C,QAAV,CAAmBwC,CAAnB,CAAP,CAAJ,CAA8C,CAC/C,IAAK,GAAIM,CAAAA,CAAT,GAAwB,MAAK5F,IAAL,CAAU8C,QAAV,CAAmBwC,CAAnB,CAAxB,EAA+C,KAA/C,CACAI,CAAC,CAAG,GAAIC,CAAAA,MAAM,aAAN,SAAkCC,CAAlC,CAAJ,CAAmD,IAAnD,CAAyD,KAAK5F,IAAL,CAAU8C,QAAV,CAAmBwC,CAAnB,EAAsBM,CAAtB,CAAzD,CACP,CACD,GAAIF,CAAJ,CAAO,CACH,KAAKG,UAAL,CAAgBH,CAAhB,CACH,CACJ,CACJ,CAlI0B,CAuI3BG,UAAU,CAAE,oBAAUC,CAAV,CAAmBC,CAAnB,CAA8BC,CAA9B,CAAmC,CAC3C,GAAuB,QAAnB,QAAOF,CAAAA,CAAP,GAAmD,QAAnB,WAAOA,CAAP,GAA+B,CAACA,CAAD,WAAoBjG,CAAAA,CAAY,CAAC4F,OAAhG,CAAJ,CACI,SAEJ,GAAIzF,CAAAA,CAAI,CAAuB,QAApB,UAAO+F,CAAP,EAA+BA,CAA/B,CAA2C,EAAtD,CACAC,CAAG,CAAGA,CAAG,CAAS,CAAN,CAAAA,CAAH,CAAkC,QAApB,QAAOD,CAAAA,CAAP,CAA+BA,CAA/B,CAA2C,IAAlE,CAEA,GAAsB,QAAlB,QAAOD,CAAAA,CAAX,CACIA,CAAO,CAAG,GAAIH,CAAAA,MAAM,aAAN,SAAkCG,CAAlC,CAAJ,CAA+C,IAA/C,CAAqD9F,CAArD,CAAV,CAEJ,GAAIgG,CAAJ,CACI,KAAKhF,GAAL,CAASK,SAAT,CAAmB4E,QAAnB,GAA8BC,EAA9B,CAAiCF,CAAjC,EAAsCG,MAAtC,CAA6CL,CAAO,CAACvF,GAArD,EADJ,IAGI,MAAKS,GAAL,CAASK,SAAT,CAAmBN,MAAnB,CAA0B+E,CAAO,CAACvF,GAAlC,EAEJ,GAAI,CAAC,KAAKuC,QAAV,CACI,KAAKA,QAAL,CAAgB,EAAhB,CACJ,KAAKA,QAAL,CAAcsD,IAAd,CAAmBN,CAAnB,EACA,KAAK9E,GAAL,CAASK,SAAT,CAAmBgF,WAAnB,CAA+B,+BAA/B,CACH,CA1J0B,CAiK3BjE,WAAW,CAAE,sBAAY,CACrB,KAAKG,OAAL,CAAe,CACX4C,MAAM,CAAE,EADG,CAEXmB,QAAQ,CAAE,CAFC,CAIlB,CAtK0B,CAwK3B3C,WAAW,CAAE,sBAAY,CACrB,MAAoC,EAA7B,MAAKpB,OAAL,CAAa4C,MAAb,CAAoBzE,MAA3B,CAAwC,CACpC,KAAK6B,OAAL,CAAa4C,MAAb,CAAoBoB,KAApB,GACA,KAAKhE,OAAL,CAAa+D,QAAb,EACH,CACD,GAA8B,CAA1B,QAAK/D,OAAL,CAAa+D,QAAb,EAA+B,KAAK/D,OAAL,CAAa+D,QAAb,CAAwB,KAAK/D,OAAL,CAAa4C,MAAb,CAAoBzE,MAA/E,CAAuF,CACnF,KAAK6B,OAAL,CAAa4C,MAAb,CAAsB,KAAK5C,OAAL,CAAa4C,MAAb,CAAoBqB,KAApB,CAA0B,CAA1B,CAA6B,KAAKjE,OAAL,CAAa+D,QAA1C,CAAtB,CACA,KAAK/D,OAAL,CAAa+D,QAAb,EACH,CAHD,IAGO,CACH,KAAK/D,OAAL,CAAa+D,QAAb,CAAwB,KAAK/D,OAAL,CAAa4C,MAAb,CAAoBzE,MAApB,CAA6B,CACxD,CACD,KAAK6B,OAAL,CAAa4C,MAAb,CAAoBiB,IAApB,CAAyB,KAAKvC,MAAL,EAAzB,EACA,KAAKzD,EAAL,CAAQ0D,OAAR,CAAgB,mBAAhB,CAAqC,KAAKvB,OAAL,CAAa+D,QAAlD,CACH,CArL0B,CAuL3BG,iBAAiB,CAAE,2BAAUC,CAAV,CAAmB,CAClC,GAAKA,CAAO,EAAI,KAAKnE,OAAL,CAAa+D,QAAb,EAAyB,KAAK/D,OAAL,CAAa4C,MAAb,CAAoBzE,MAAzD,EACC,CAACgG,CAAD,EAAqC,CAAzB,OAAKnE,OAAL,CAAa+D,QAD9B,CAEI,OACJ,GAAIN,CAAAA,CAAG,CAAGU,CAAO,CAAG,KAAKnE,OAAL,CAAa+D,QAAb,CAAwB,CAA3B,CAA+B,KAAK/D,OAAL,CAAa+D,QAAb,CAAwB,CAAxE,CACA,GAAI,KAAK/D,OAAL,CAAa4C,MAAb,CAAoBzE,MAApB,EAA8B,KAAK6B,OAAL,CAAa4C,MAAb,CAAoBa,CAAG,CAAG,CAA1B,UAAlC,CAA8E,CAC1E,KAAKzD,OAAL,CAAa+D,QAAb,CAAwBN,CAAxB,CACA,KAAKvB,MAAL,CAAY,KAAKlC,OAAL,CAAa4C,MAAb,CAAoBa,CAAG,CAAG,CAA1B,CAAZ,CACH,CACD,KAAK5F,EAAL,CAAQ0D,OAAR,CAAgB,mBAAhB,CAAqCkC,CAArC,EACA,KAAKtC,cAAL,EACH,CAlM0B,CAoM3BiD,eAAe,CAAE,0BAAY,CACzB,KAAKF,iBAAL,IACH,CAtM0B,CAwM3BG,gBAAgB,CAAE,2BAAY,CAC1B,KAAKH,iBAAL,IACH,CA1M0B,CAiN3BhC,MAAM,CAAE,gBAAUoC,CAAV,CAAe,IACfhF,CAAAA,CAAG,CAAG,KAAKA,GADI,CAEfiF,CAAG,CAAG,GAAIC,CAAAA,KAFK,CAGfC,CAAM,CAAGnF,CAAG,CAACoF,wBAHE,CAInBH,CAAG,CAACI,MAAJ,CAAa,UAAY,CACrBrF,CAAG,CAACoF,wBAAJ,CAA+B,aAA/B,CACApF,CAAG,CAACuC,SAAJ,CAAc,CAAd,CAAiB,CAAjB,CAAoBvC,CAAG,CAACF,MAAJ,CAAW0C,KAA/B,CAAsCxC,CAAG,CAACF,MAAJ,CAAW0C,KAAjD,EACAxC,CAAG,CAACsF,SAAJ,CAAcL,CAAd,CAAmB,CAAnB,CAAsB,CAAtB,EACAjF,CAAG,CAACoF,wBAAJ,CAA+BD,CAClC,CALD,CAMAF,CAAG,CAACD,GAAJ,CAAUA,CACb,CA5N0B,CA8N3BhD,MAAM,CAAE,iBAAY,CAChB,MAAO,MAAKlC,MAAL,CAAYyF,SAAZ,CAAsB,WAAtB,CACV,CAhO0B,CAkO3BC,WAAW,CAAE,sBAAY,CACrB,GAAIP,CAAAA,CAAG,CAAG,KAAKjD,MAAL,EAAV,CACAiD,CAAG,CAAGA,CAAG,CAACQ,OAAJ,CAAY,WAAZ,CAAyB,oBAAzB,CAAN,CACA3B,MAAM,CAAC4B,QAAP,CAAgBC,IAAhB,CAAuBV,CAC1B,CAtO0B,CA6O3BpD,cAAc,CAAE,yBAAY,CACxB,GAAIiC,MAAM,CAAC,KAAKzD,OAAN,CAAV,CAA0B,CACtByD,MAAM,CAAC,KAAKzD,OAAN,CAAN,CAAqBuF,OAArB,CAA6B,iBAAmB,KAAK1H,EAArD,CAAyD,KAAK8D,MAAL,EAAzD,EACA,KAAKzD,EAAL,CAAQ0D,OAAR,CAAgB,aAAe,KAAK5B,OAAL,CAAawF,MAAb,CAAoB,CAApB,EAAuBC,WAAvB,EAAf,CAAsD,KAAKzF,OAAL,CAAasE,KAAb,CAAmB,CAAnB,CAAtE,CAA6F,KAAK3C,MAAL,EAA7F,CACH,CACJ,CAlP0B,CAoP3BlB,iBAAiB,CAAE,4BAAY,CAC3B,GAAIgD,MAAM,CAAC,KAAKzD,OAAN,CAAN,EAAqF,IAA7D,GAAAyD,MAAM,CAAC,KAAKzD,OAAN,CAAN,CAAqB0F,OAArB,CAA6B,iBAAmB,KAAK7H,EAArD,CAA5B,CAA+F,CAC3F,KAAK0E,MAAL,CAAYkB,MAAM,CAAC,KAAKzD,OAAN,CAAN,CAAqB0F,OAArB,CAA6B,iBAAmB,KAAK7H,EAArD,CAAZ,EACA,KAAKK,EAAL,CAAQ0D,OAAR,CAAgB,gBAAkB,KAAK5B,OAAL,CAAawF,MAAb,CAAoB,CAApB,EAAuBC,WAAvB,EAAlB,CAAyD,KAAKzF,OAAL,CAAasE,KAAb,CAAmB,CAAnB,CAAzE,CAAgGb,MAAM,CAAC,KAAKzD,OAAN,CAAN,CAAqB0F,OAArB,CAA6B,iBAAmB,KAAK7H,EAArD,CAAhG,CACH,CACJ,CAzP0B,CA2P3B8H,eAAe,CAAE,0BAAY,CACzB,GAAIlC,MAAM,CAAC,KAAKzD,OAAN,CAAN,EAAqF,IAA7D,GAAAyD,MAAM,CAAC,KAAKzD,OAAN,CAAN,CAAqB0F,OAArB,CAA6B,iBAAmB,KAAK7H,EAArD,CAA5B,CAA+F,CAC3F4F,MAAM,CAAC,KAAKzD,OAAN,CAAN,CAAqB4F,UAArB,CAAgC,iBAAmB,KAAK/H,EAAxD,EACA,KAAKK,EAAL,CAAQ0D,OAAR,CAAgB,cAAgB,KAAK5B,OAAL,CAAawF,MAAb,CAAoB,CAApB,EAAuBC,WAAvB,EAAhB,CAAuD,KAAKzF,OAAL,CAAasE,KAAb,CAAmB,CAAnB,CAAvE,CACH,CACJ,CAhQ0B,CAkQ3BrE,WAAW,CAAE,sBAAY,CACrB,GAAI,CAAC,KAAKnC,IAAL,CAAUsC,UAAX,EAAyB,EAA2B,SAAzB,QAAKtC,IAAL,CAAUsC,UAAV,EAA+D,OAAzB,QAAKtC,IAAL,CAAUsC,UAAlD,CAA7B,CAAwG,SACxG,MAAO,MAAKtC,IAAL,CAAUsC,UAAV,CAAuB,SACjC,CArQ0B,CA4Q3BM,cAAc,CAAE,yBAAY,CACxB,GAAI,CAAC,KAAK5C,IAAL,CAAUiD,SAAf,CACI,SAEJ,KAAKjC,GAAL,CAASG,OAAT,CAAiB4G,EAAjB,CAAoB,yBAApB,CAA+C,SAAUC,CAAV,CAAa,CACxDA,CAAC,CAACC,eAAF,GACAD,CAAC,CAACE,cAAF,EACH,CAHD,EAKA,KAAKlH,GAAL,CAASG,OAAT,CAAiB4G,EAAjB,CAAoB,MAApB,CAA4B9H,CAAC,CAACsB,KAAF,CAAQ,KAAK4G,aAAb,CAA4B,IAA5B,CAA5B,CACH,CAtR0B,CAwR3BA,aAAa,CAAE,uBAAUH,CAAV,CAAa,CACxBA,CAAC,CAAGA,CAAC,CAACI,aAAF,CAAkBJ,CAAC,CAACI,aAApB,CAAoCJ,CAAxC,CACA,GAAIK,CAAAA,CAAK,CAAGL,CAAC,CAACM,YAAF,CAAeD,KAA3B,CACA,GAAI,CAACA,CAAD,EAAU,CAACA,CAAK,CAAC3H,MAAjB,EAA6D,CAAC,CAAnC,EAAA2H,CAAK,CAAC,CAAD,CAAL,CAASE,IAAT,CAAc1H,OAAd,CAAsB,OAAtB,CAA3B,EAAmE,CAAC8E,MAAM,CAAC6C,UAA/E,CACI,SACJ,GAAIC,CAAAA,CAAE,CAAG,GAAID,CAAAA,UAAb,CACAC,CAAE,CAACC,aAAH,CAAiBL,CAAK,CAAC,CAAD,CAAtB,EACAI,CAAE,CAACvB,MAAH,CAAYjH,CAAC,CAACsB,KAAF,CAAQ,SAAUnB,CAAV,CAAc,CAC9B,KAAKqE,MAAL,CAAYrE,CAAE,CAACuI,MAAH,CAAUC,MAAtB,EACA,KAAKxI,EAAL,CAAQ0D,OAAR,CAAgB,oBAAhB,CAAsC1D,CAAE,CAACuI,MAAH,CAAUC,MAAhD,EACA,KAAKxI,EAAL,CAAQ0D,OAAR,CAAgB,kBAAhB,EACA,KAAKH,WAAL,EACH,CALW,CAKT,IALS,CAMf,CArS0B,CA8S3BP,OAAO,CAAE,iBAAUyF,CAAV,CAAmBC,CAAnB,CAA2B,CAChCA,CAAM,CAAGA,CAAM,IAAf,CACAD,CAAO,CAAGA,CAAO,EAAI,QAArB,CAEA,KAAKzI,EAAL,CAAQ2I,MAAR,CAAe,oBAAf,CAAqC9I,CAAC,CAACsB,KAAF,CAAQ,KAAKyH,IAAb,CAAmB,IAAnB,CAArC,EAEA,GAA8B,aAA1B,QAAKhJ,IAAL,CAAUgD,WAAd,CACI,KAAKnB,GAAL,CAASoF,wBAAT,CAAgD,QAAZ,GAAA4B,CAAO,CAAgB,iBAAhB,CAAoC,aAA/E,CADJ,IAEK,CACD,GAAgB,QAAZ,GAAAA,CAAJ,CAA0B,CACtB,GAA8B,YAA1B,QAAK7I,IAAL,CAAUgD,WAAV,EAA0CnD,CAAY,CAACQ,KAAb,CAAmB4D,OAAnB,CAA2B,KAAKjE,IAAL,CAAUwC,UAArC,CAA9C,CACI,KAAKX,GAAL,CAASoH,WAAT,CAAuB,KAAKjJ,IAAL,CAAUwC,UAAjC,CADJ,IAEK,IAAI3C,CAAY,CAACQ,KAAb,CAAmB4D,OAAnB,CAA2B,KAAKjE,IAAL,CAAUgD,WAArC,CAAJ,CACD,KAAKnB,GAAL,CAASoH,WAAT,CAAuB,KAAKjJ,IAAL,CAAUgD,WACxC,CALD,IAKO,IAAI,CAAC,KAAKkG,IAAN,EAA4B,QAAd,QAAKA,IAAvB,CAA0C,CAC7C,KAAKrH,GAAL,CAASoH,WAAT,CAAuB,KAAKlH,KAC/B,CAED,GAAgB,QAAZ,GAAA8G,CAAJ,CACI,KAAKzI,EAAL,CAAQ+I,IAAR,CAAa,oBAAb,CAAmClJ,CAAC,CAACsB,KAAF,CAAQ,KAAKyH,IAAb,CAAmB,IAAnB,CAAnC,CACP,CACD,KAAKE,IAAL,CAAYL,CAAZ,CACA,GAAI,CAACC,CAAL,CACI,KAAK1I,EAAL,CAAQ0D,OAAR,CAAgB,YAAhB,CAA8B,KAAKoF,IAAnC,CACP,CAtU0B,CAwU3B/E,OAAO,CAAE,kBAAY,CACjB,MAAO,MAAK+E,IAAL,EAAa,QACvB,CA1U0B,CA4U3B5F,QAAQ,CAAE,kBAAUvB,CAAV,CAAiB,CACvB,GAAIkD,CAAAA,CAAI,CAAG,IAAX,CACAlD,CAAK,CAAGA,CAAK,EAAI,KAAKA,KAAtB,CACA,GAAI,CAAClC,CAAY,CAACQ,KAAb,CAAmB4D,OAAnB,CAA2BlC,CAA3B,CAAL,CACI,SACJ,KAAKA,KAAL,CAAaA,CAAb,CACA,GAA8B,aAA1B,QAAK/B,IAAL,CAAUgD,WAAV,EAAyD,QAAd,QAAKkG,IAApD,CAAuE,CACnE,GAAIE,CAAAA,CAAc,CAAG,SAAUF,CAAV,CAAgB,CACjC,GAAa,QAAT,GAAAA,CAAJ,CACIjE,CAAI,CAACgE,WAAL,CAAmBhE,CAAI,CAAClD,KAAxB,CACJkD,CAAI,CAAC7E,EAAL,CAAQ2I,MAAR,CAAe,YAAf,CAA6BK,CAA7B,CACH,CAJD,CAKA,KAAKhJ,EAAL,CAAQ+I,IAAR,CAAa,YAAb,CAA2BC,CAA3B,CACH,CAPD,IAQI,MAAKvH,GAAL,CAASoH,WAAT,CAAuB,KAAKlH,KACnC,CA3V0B,CAgW3BiH,IAAI,CAAE,cAAUhB,CAAV,CAAa,CACf,GAAI,KAAKnE,MAAL,KAAkB,KAAKD,WAA3B,CAAwC,CACpC,KAAK/B,GAAL,CAASuC,SAAT,CAAmB,CAAnB,CAAsB,CAAtB,CAAyB,KAAKvC,GAAL,CAASF,MAAT,CAAgB0C,KAAzC,CAAgD,KAAKxC,GAAL,CAASF,MAAT,CAAgB0C,KAAhE,EACA,KAAKxC,GAAL,CAASyC,SAAT,CAAqB,KAAKvC,KAA1B,CACA,KAAKF,GAAL,CAAS0C,QAAT,CAAkB,CAAlB,CAAqB,CAArB,CAAwB,KAAK1C,GAAL,CAASF,MAAT,CAAgB0C,KAAxC,CAA+C,KAAKxC,GAAL,CAASF,MAAT,CAAgB6C,MAA/D,EACA,MACH,CANc,GAQXsC,CAAAA,CAAG,CAAG,KAAKjF,GAAL,CAASwH,YAAT,CAAsB,CAAtB,CAAyB,CAAzB,CAA4B,KAAK1H,MAAL,CAAY0C,KAAxC,CAA+C,KAAK1C,MAAL,CAAY6C,MAA3D,CARK,CAWX8E,CAAK,CAAG,CAXG,CAWAC,CAAC,CAAG,CAXJ,CAWOC,CAAC,CAAG,CAXX,CAWcC,CAAK,CAAG,CAXtB,CAcXC,CAAM,CAAG,KAAK7H,GAAL,CAASoH,WAdP,CAeXU,CAAC,CAAGC,QAAQ,CAACF,CAAM,CAACG,MAAP,CAAc,CAAd,CAAiB,CAAjB,CAAD,CAAsB,EAAtB,CAfD,CAgBXC,CAAC,CAAGF,QAAQ,CAACF,CAAM,CAACG,MAAP,CAAc,CAAd,CAAiB,CAAjB,CAAD,CAAsB,EAAtB,CAhBD,CAiBXE,CAAC,CAAGH,QAAQ,CAACF,CAAM,CAACG,MAAP,CAAc,CAAd,CAAiB,CAAjB,CAAD,CAAsB,EAAtB,CAjBD,CAoBXG,CAAK,CAAGnK,CAAY,CAACQ,KAAb,CAAmB4J,OAAnB,CAA2BnD,CAA3B,CAAgC8C,QAAQ,CAAC5B,CAAC,CAACkC,MAAF,CAASC,CAAV,CAAa,EAAb,CAAxC,CAA0DP,QAAQ,CAAC5B,CAAC,CAACkC,MAAF,CAASE,CAAV,CAAa,EAAb,CAAlE,CApBG,CAuBf,GAAIJ,CAAK,CAACP,CAAD,CAAL,GAAiB5J,CAAY,CAACQ,KAAb,CAAmBgK,QAAnB,CAA4BV,CAA5B,CAA+BG,CAA/B,CAAkCC,CAAlC,CAArB,CACI,OAxBW,GA2BXO,CAAAA,CAAK,CAAG,CAACN,CAAD,CA3BG,CA8BXO,CA9BW,CA+BXC,CAAI,CAAG1D,CAAG,CAACzC,KAAJ,CAAY,CA/BR,CAgCXoG,CAAI,CAAG3D,CAAG,CAACtC,MAAJ,CAAa,CAhCT,CAkCf,MAAQ+F,CAAK,CAAGD,CAAK,CAACI,GAAN,EAAhB,CAA8B,CAC1B,GAAIH,CAAK,CAACd,CAAD,CAAL,GAAiBO,CAAK,CAACP,CAAD,CAA1B,CAAmC,CAC/B3C,CAAG,CAAC6D,IAAJ,CAASJ,CAAK,CAACjB,CAAD,CAAd,EAAyBK,CAAzB,CACA7C,CAAG,CAAC6D,IAAJ,CAASJ,CAAK,CAACjB,CAAD,CAAL,CAAe,CAAxB,EAA6BQ,CAA7B,CACAhD,CAAG,CAAC6D,IAAJ,CAASJ,CAAK,CAACjB,CAAD,CAAL,CAAe,CAAxB,EAA6BS,CAA7B,CACA,GAAe,CAAX,CAAAQ,CAAK,CAAChB,CAAD,CAAT,CACIe,CAAK,CAAClE,IAAN,CAAWvG,CAAY,CAACQ,KAAb,CAAmB4J,OAAnB,CAA2BnD,CAA3B,CAAgCyD,CAAK,CAAChB,CAAD,CAAL,CAAW,CAA3C,CAA8CgB,CAAK,CAACf,CAAD,CAAnD,CAAX,EACJ,GAAIe,CAAK,CAAChB,CAAD,CAAL,CAAWiB,CAAf,CACIF,CAAK,CAAClE,IAAN,CAAWvG,CAAY,CAACQ,KAAb,CAAmB4J,OAAnB,CAA2BnD,CAA3B,CAAgCyD,CAAK,CAAChB,CAAD,CAAL,CAAW,CAA3C,CAA8CgB,CAAK,CAACf,CAAD,CAAnD,CAAX,EACJ,GAAe,CAAX,CAAAe,CAAK,CAACf,CAAD,CAAT,CACIc,CAAK,CAAClE,IAAN,CAAWvG,CAAY,CAACQ,KAAb,CAAmB4J,OAAnB,CAA2BnD,CAA3B,CAAgCyD,CAAK,CAAChB,CAAD,CAArC,CAA0CgB,CAAK,CAACf,CAAD,CAAL,CAAW,CAArD,CAAX,EACJ,GAAIe,CAAK,CAACf,CAAD,CAAL,CAAWiB,CAAf,CACIH,CAAK,CAAClE,IAAN,CAAWvG,CAAY,CAACQ,KAAb,CAAmB4J,OAAnB,CAA2BnD,CAA3B,CAAgCyD,CAAK,CAAChB,CAAD,CAArC,CAA0CgB,CAAK,CAACf,CAAD,CAAL,CAAW,CAArD,CAAX,CACP,CACJ,CAED,KAAK3H,GAAL,CAAS+I,YAAT,CAAsB9D,CAAtB,CAA2B,CAA3B,CAA8B,CAA9B,CACH,CAnZ0B,CA0Z3BjE,cAAc,CAAE,yBAAY,CACxB,KAAKgI,SAAL,IACA,KAAKC,eAAL,IACA,KAAKZ,MAAL,CAAc,EAAd,CACA,KAAKA,MAAL,CAAYa,GAAZ,CAAkB,KAAKb,MAAL,CAAYc,OAAZ,CAAsB,KAAKd,MAAL,CAAYe,MAAZ,CAAqB,CAACd,CAAC,CAAE,CAAJ,CAAOC,CAAC,CAAE,CAAV,CAA7D,CAEA,KAAKpJ,GAAL,CAASG,OAAT,CAAiB4G,EAAjB,CAAoB,sBAApB,CAA4C9H,CAAC,CAACsB,KAAF,CAAQ,SAAUyG,CAAV,CAAa,CAC7D,KAAKkD,aAAL,CAAmBlD,CAAnB,CAAsB,KAAKmD,eAAL,CAAqBnD,CAArB,CAAtB,CACH,CAF2C,CAEzC,IAFyC,CAA5C,EAIA,KAAKhH,GAAL,CAASG,OAAT,CAAiB4G,EAAjB,CAAoB,qBAApB,CAA2C9H,CAAC,CAACsB,KAAF,CAAQ,SAAUyG,CAAV,CAAa,CAC5D,KAAKoD,YAAL,CAAkBpD,CAAlB,CAAqB,KAAKmD,eAAL,CAAqBnD,CAArB,CAArB,CACH,CAF0C,CAExC,IAFwC,CAA3C,EAIA,KAAKhH,GAAL,CAASG,OAAT,CAAiB4G,EAAjB,CAAoB,WAApB,CAAiC9H,CAAC,CAACsB,KAAF,CAAQ,UAAa,CAErD,CAFgC,CAE9B,IAF8B,CAAjC,EAIA,KAAKP,GAAL,CAASG,OAAT,CAAiB4G,EAAjB,CAAoB,kBAApB,CAAwC9H,CAAC,CAACsB,KAAF,CAAQ,SAAUyG,CAAV,CAAa,CACzD,KAAKqD,YAAL,CAAkBrD,CAAlB,CAAqB,KAAKmD,eAAL,CAAqBnD,CAArB,CAArB,CACH,CAFuC,CAErC,IAFqC,CAAxC,EAIA,KAAKhH,GAAL,CAASG,OAAT,CAAiB4G,EAAjB,CAAoB,WAApB,CAAiC9H,CAAC,CAACsB,KAAF,CAAQ,SAAUyG,CAAV,CAAa,CAClD,KAAKsD,YAAL,CAAkBtD,CAAlB,CAAqB,KAAKmD,eAAL,CAAqBnD,CAArB,CAArB,CACH,CAFgC,CAE9B,IAF8B,CAAjC,EAIA,KAAKhH,GAAL,CAASG,OAAT,CAAiB4G,EAAjB,CAAoB,UAApB,CAAgC9H,CAAC,CAACsB,KAAF,CAAQ,SAAUyG,CAAV,CAAa,CACjD,KAAKuD,WAAL,CAAiBvD,CAAjB,CAAoB,KAAKmD,eAAL,CAAqBnD,CAArB,CAApB,CAEH,CAH+B,CAG7B,IAH6B,CAAhC,EAKA/H,CAAC,CAAC,MAAD,CAAD,CAAU8H,EAAV,CAAa,kBAAb,CAAiC9H,CAAC,CAACsB,KAAF,CAAQ,UAAa,CAClD,KAAKsJ,SAAL,GACH,CAFgC,CAE9B,IAF8B,CAAjC,EAIA,GAAIlF,MAAM,CAAC6F,qBAAX,CAAkCA,qBAAqB,CAACvL,CAAC,CAACsB,KAAF,CAAQ,KAAKkK,IAAb,CAAmB,IAAnB,CAAD,CAC1D,CA9b0B,CAgc3BA,IAAI,CAAE,eAAY,CAId,GAAI9F,MAAM,CAAC6F,qBAAP,EAAqD,EAArB,MAAK3J,GAAL,CAAS0B,SAAzC,EAA2D,KAAKuH,eAApE,CAAqF,CACjF,KAAK9J,GAAL,CAASI,OAAT,CAAiBoE,GAAjB,CAAqB,CAACnB,KAAK,CAAE,KAAKxC,GAAL,CAAS0B,SAAT,CAAqB,IAA7B,CAAmCiB,MAAM,CAAE,KAAK3C,GAAL,CAAS0B,SAAT,CAAqB,IAAhE,CAArB,EACA,GAAImI,CAAAA,CAAS,CAAG7L,CAAY,CAACQ,KAAb,CAAmBM,GAAnB,CAAuB,yCAAvB,CAAkE,CAC9EwJ,CAAC,CAAE,KAAKD,MAAL,CAAYc,OAAZ,CAAoBb,CAApB,CAAyB,KAAKtI,GAAL,CAAS0B,SAAT,CAAqB,CAD6B,CAE9E6G,CAAC,CAAE,KAAKF,MAAL,CAAYc,OAAZ,CAAoBZ,CAApB,CAAyB,KAAKvI,GAAL,CAAS0B,SAAT,CAAqB,CAF6B,CAAlE,CAAhB,CAIA,KAAKvC,GAAL,CAASI,OAAT,CAAiBoE,GAAjB,CAAqB,CAAC,UAAakG,CAAd,CAAyB,oBAAqBA,CAA9C,CAAyD,gBAAiBA,CAA1E,CAArB,EACA,KAAK1K,GAAL,CAASI,OAAT,CAAiBiF,WAAjB,CAA6B,4BAA7B,CACH,CARD,IAQO,CACH,KAAKrF,GAAL,CAASI,OAAT,CAAiBN,QAAjB,CAA0B,4BAA1B,CACH,CAED,GAAI,KAAK+J,SAAT,CAAoB,CAChB,GAAIc,CAAAA,CAAU,CAAG,KAAKC,kBAAL,CAAwB,KAAK1B,MAAL,CAAYc,OAApC,CAAjB,CACA,KAAKnJ,GAAL,CAASgK,SAAT,GACA,KAAKhK,GAAL,CAASiK,MAAT,CAAgBH,CAAU,CAACxB,CAA3B,CAA8BwB,CAAU,CAACvB,CAAzC,EACA,KAAKvI,GAAL,CAASkK,gBAAT,CAA0B,KAAK7B,MAAL,CAAYa,GAAZ,CAAgBZ,CAA1C,CAA6C,KAAKD,MAAL,CAAYa,GAAZ,CAAgBX,CAA7D,CAAgE,KAAKF,MAAL,CAAYe,MAAZ,CAAmBd,CAAnF,CAAsF,KAAKD,MAAL,CAAYe,MAAZ,CAAmBb,CAAzG,EACA,KAAKvI,GAAL,CAAS6H,MAAT,GAEA,KAAKQ,MAAL,CAAYa,GAAZ,CAAkB,KAAKb,MAAL,CAAYc,OAA9B,CACA,KAAKd,MAAL,CAAYe,MAAZ,CAAqBU,CACxB,CAED,GAAIhG,MAAM,CAAC6F,qBAAX,CAAkCA,qBAAqB,CAACvL,CAAC,CAACsB,KAAF,CAAQ,UAAY,CACxE,KAAKkK,IAAL,EACH,CAFuD,CAErD,IAFqD,CAAD,CAG1D,CA9d0B,CAge3BP,aAAa,CAAE,uBAAUlD,CAAV,CAAakC,CAAb,CAAqB,CAChC,KAAKA,MAAL,CAAYc,OAAZ,CAAsB,KAAKd,MAAL,CAAYa,GAAZ,CAAkBb,CAAxC,CACA,KAAKA,MAAL,CAAYe,MAAZ,CAAqB,KAAKW,kBAAL,CAAwB1B,CAAxB,CAArB,CACA,KAAKW,SAAL,IAEA,GAAI,CAAClF,MAAM,CAAC6F,qBAAZ,CAAmC,KAAKC,IAAL,GAEnC,KAAKrL,EAAL,CAAQ0D,OAAR,CAAgB,oBAAhB,CAAsC,CAACkE,CAAC,CAAEA,CAAJ,CAAOkC,MAAM,CAAEA,CAAf,CAAtC,EACAlC,CAAC,CAACE,cAAF,EACH,CAze0B,CA2e3BkD,YAAY,CAAE,sBAAUpD,CAAV,CAAakC,CAAb,CAAqB,CAC/B,KAAKA,MAAL,CAAYc,OAAZ,CAAsBd,CAAtB,CACA,KAAK9J,EAAL,CAAQ0D,OAAR,CAAgB,eAAhB,CAAiC,CAACkE,CAAC,CAAEA,CAAJ,CAAOkC,MAAM,CAAEA,CAAf,CAAjC,EAEA,GAAI,CAACvE,MAAM,CAAC6F,qBAAZ,CAAmC,KAAKC,IAAL,GAEnCzD,CAAC,CAACE,cAAF,EACH,CAlf0B,CAof3BmD,YAAY,CAAE,sBAAUrD,CAAV,CAAakC,CAAb,CAAqB,CAC/B,GAAI,KAAKW,SAAL,GAAmB,CAAC7C,CAAC,CAACgE,OAAH,EAAmC,CAArB,GAAAhE,CAAC,CAACgE,OAAF,CAAUtL,MAA3C,CAAJ,CAA8D,CAC1D,KAAKmK,SAAL,IAEA,KAAKnH,cAAL,GACA,KAAKC,WAAL,GAEA,KAAKvD,EAAL,CAAQ0D,OAAR,CAAgB,mBAAhB,CAAqC,CAACkE,CAAC,CAAEA,CAAJ,CAAOkC,MAAM,CAAEA,CAAf,CAArC,EACA,KAAK9J,EAAL,CAAQ0D,OAAR,CAAgB,kBAAhB,EACAkE,CAAC,CAACE,cAAF,EACH,CACJ,CA/f0B,CAigB3BoD,YAAY,CAAE,sBAAUtD,CAAV,CAAakC,CAAb,CAAqB,CAC/B,KAAKY,eAAL,IACA,KAAKZ,MAAL,CAAYa,GAAZ,CAAkB,KAAKI,eAAL,CAAqBnD,CAArB,CAAlB,CACA,KAAKkC,MAAL,CAAYe,MAAZ,CAAqB,KAAKW,kBAAL,CAAwB,KAAK1B,MAAL,CAAYa,GAApC,CAArB,CAEA,KAAK3K,EAAL,CAAQ0D,OAAR,CAAgB,iBAAhB,CAAmC,CAACkE,CAAC,CAAEA,CAAJ,CAAOkC,MAAM,CAAEA,CAAf,CAAnC,CACH,CAvgB0B,CAygB3BqB,WAAW,CAAE,qBAAUvD,CAAV,CAAakC,CAAb,CAAqB,CAC9B,KAAKY,eAAL,IAEA,KAAK1K,EAAL,CAAQ0D,OAAR,CAAgB,gBAAhB,CAAkC,CAACkE,CAAC,CAAEA,CAAJ,CAAOkC,MAAM,CAAEA,CAAf,CAAlC,CACH,CA7gB0B,CA+gB3BiB,eAAe,CAAE,yBAAUnD,CAAV,CAAa,CAC1BA,CAAC,CAAGA,CAAC,CAACI,aAAF,CAAkBJ,CAAC,CAACI,aAApB,CAAoCJ,CAAxC,CACA,GAAImC,CAAAA,CAAJ,CAAOC,CAAP,CACA,GAAIpC,CAAC,CAACgE,OAAF,EAAiC,CAApB,EAAAhE,CAAC,CAACgE,OAAF,CAAUtL,MAA3B,CAAwC,CACpCyJ,CAAC,CAAGnC,CAAC,CAACgE,OAAF,CAAU,CAAV,EAAaC,KAAjB,CACA7B,CAAC,CAAGpC,CAAC,CAACgE,OAAF,CAAU,CAAV,EAAaE,KACpB,CAHD,IAGO,CACH/B,CAAC,CAAGnC,CAAC,CAACiE,KAAN,CACA7B,CAAC,CAAGpC,CAAC,CAACkE,KACT,CACD,MAAO,CACH/B,CAAC,CAAEA,CAAC,CAAG,KAAKnJ,GAAL,CAASG,OAAT,CAAiBgL,MAAjB,GAA0BC,IAD9B,CAEHhC,CAAC,CAAEA,CAAC,CAAG,KAAKpJ,GAAL,CAASG,OAAT,CAAiBgL,MAAjB,GAA0BE,GAF9B,CAIV,CA7hB0B,CA+hB3BT,kBAAkB,CAAE,4BAAU1B,CAAV,CAAkB,CAClC,MAAO,CACHC,CAAC,CAAE,KAAKD,MAAL,CAAYa,GAAZ,CAAgBZ,CAAhB,CAAoBD,CAAM,CAACC,CAA3B,EAAgC,CADhC,CAEHC,CAAC,CAAE,KAAKF,MAAL,CAAYa,GAAZ,CAAgBX,CAAhB,CAAoBF,CAAM,CAACE,CAA3B,EAAgC,CAFhC,CAIV,CApiB0B,CAA/B,CAuiBAvK,CAAY,CAAC4F,OAAb,CAAuB,SAAU6G,CAAV,CAAwBtM,CAAxB,CAA8B,CACjD,KAAKuM,KAAL,CAAaD,CAAb,CACA,KAAKtM,IAAL,CAAYC,CAAC,CAACC,MAAF,CAAS,EAAT,CAAa,KAAKsM,QAAlB,CAA4BxM,CAA5B,CAAZ,CAEA,KAAKO,GAAL,CAAWN,CAAC,CAACO,QAAQ,CAACiM,aAAT,CAAuB,KAAvB,CAAD,CAAD,CAAiC3L,QAAjC,CAA0C,uBAA1C,CAAX,CACA,GAAI,KAAK4L,IAAT,CACI,KAAKnM,GAAL,CAASO,QAAT,CAAkB,yBAA2B,KAAK4L,IAAlD,EAEJ,KAAKH,KAAL,CAAWnM,EAAX,CAAc+I,IAAd,CAAmB,aAAnB,CAAkClJ,CAAC,CAACsB,KAAF,CAAQ,KAAKoL,YAAb,CAA2B,IAA3B,CAAlC,EAEA,KAAKC,UAAL,CAAgBC,KAAhB,CAAsB,IAAtB,CAA4BC,SAA5B,EACA,MAAO,KACV,CAZD,CAcAjN,CAAY,CAAC4F,OAAb,CAAqBtC,SAArB,CAAiC,CAE7BuJ,IAAI,CAAE,EAFuB,CAI7BF,QAAQ,CAAE,EAJmB,CAM7BI,UAAU,CAAE,qBAAY,CAEvB,CAR4B,CAU7BG,UAAU,CAAE,qBAAY,CACpB,KAAKR,KAAL,CAAW1G,UAAX,CAAsB,IAAtB,CACH,CAZ4B,CAc7B8G,YAAY,CAAE,uBAAgB,CAE7B,CAhB4B,CAAjC,CAqBA9M,CAAY,CAAC4F,OAAb,CAAqBvF,MAArB,CAA8B,SAAU8M,CAAV,CAAsBC,CAAtB,CAAmC,IACzDC,CAAAA,CAAM,CAAG,IADgD,CAEzDC,CAFyD,CAG7D,GAAIH,CAAU,EAAIA,CAAU,CAACI,cAAX,CAA0B,aAA1B,CAAlB,CAA4D,CACxDD,CAAK,CAAGH,CAAU,CAACK,WACtB,CAFD,IAEO,CACHF,CAAK,CAAG,UAAY,CAChB,MAAOD,CAAAA,CAAM,CAACL,KAAP,CAAa,IAAb,CAAmBC,SAAnB,CACV,CACJ,CACD7M,CAAC,CAACC,MAAF,CAASiN,CAAT,CAAgBD,CAAhB,CAAwBD,CAAxB,EACA,GAAIK,CAAAA,CAAS,CAAG,UAAY,CACxB,KAAKD,WAAL,CAAmBF,CACtB,CAFD,CAGAG,CAAS,CAACnK,SAAV,CAAsB+J,CAAM,CAAC/J,SAA7B,CACAgK,CAAK,CAAChK,SAAN,CAAkB,GAAImK,CAAAA,CAAtB,CACA,GAAIN,CAAJ,CAAgB/M,CAAC,CAACC,MAAF,CAASiN,CAAK,CAAChK,SAAf,CAA0B6J,CAA1B,EAChBG,CAAK,CAACI,SAAN,CAAkBL,CAAM,CAAC/J,SAAzB,CACA,MAAOgK,CAAAA,CACV,CAnBD,CAoBAtN,CAAY,CAAC4F,OAAb,CAAqB+H,KAArB,CAA6B3N,CAAY,CAAC4F,OAAb,CAAqBvF,MAArB,CAA4B,CACrDwM,IAAI,CAAE,QAD+C,CAGrDE,UAAU,CAAE,qBAAY,CACpB,KAAKa,YAAL,GAEA,GAAIxI,CAAAA,CAAI,CAAG,IAAX,CACA,KAAK1E,GAAL,CAASwH,EAAT,CAAY,OAAZ,CAAqB,sCAArB,CAA6D,SAAUC,CAAV,CAAa,CACtE,GAAIjG,CAAAA,CAAK,CAAG9B,CAAC,CAAC,IAAD,CAAD,CAAQyB,IAAR,CAAa,YAAb,CAAZ,CACAuD,CAAI,CAACsH,KAAL,CAAWjJ,QAAX,CAAoBvB,CAApB,EACAkD,CAAI,CAAC1E,GAAL,CAASW,IAAT,CAAc,uCAAd,EACKsE,GADL,CACS,kBADT,CAC6BzD,CAD7B,EAEKL,IAFL,CAEU,YAFV,CAEwBK,CAFxB,EAIAkD,CAAI,CAACsH,KAAL,CAAWnM,EAAX,CAAc0D,OAAd,CAAsB,eAAtB,CAAuC/B,CAAvC,EACAkD,CAAI,CAAC1E,GAAL,CAASW,IAAT,CAAc,wCAAd,EAAwDJ,QAAxD,CAAiE,4BAAjE,EAEAkH,CAAC,CAACE,cAAF,EACH,CAXD,EAaA,KAAK3H,GAAL,CAASwH,EAAT,CAAY,OAAZ,CAAqB,uCAArB,CAA8D,SAAUC,CAAV,CAAa,CACvE/C,CAAI,CAAC1E,GAAL,CAASW,IAAT,CAAc,wCAAd,EAAwDwD,WAAxD,CAAoE,4BAApE,EACAsD,CAAC,CAACE,cAAF,EACH,CAHD,EAKAjI,CAAC,CAAC,MAAD,CAAD,CAAU8H,EAAV,CAAa,OAAb,CAAsB,SAAUC,CAAV,CAAa,IAC3B0F,CAAAA,CAAO,CAAGzN,CAAC,CAAC+H,CAAC,CAACW,MAAH,CADgB,CAE3BgF,CAAc,CAAGD,CAAO,CAACE,QAAR,CAAiB,sCAAjB,EAA2DF,CAA3D,CAAqEA,CAAO,CAACG,OAAR,CAAgB,uCAAhB,CAF3D,CAG3BC,CAAS,CAAG7I,CAAI,CAAC1E,GAAL,CAASW,IAAT,CAAc,uCAAd,CAHe,CAI3B6M,CAAM,CAAG9I,CAAI,CAAC1E,GAAL,CAASW,IAAT,CAAc,wCAAd,CAJkB,CAK/B,GAAI,CAAC,CAACyM,CAAc,CAACjN,MAAhB,EAA0BiN,CAAc,CAAC/L,GAAf,CAAmB,CAAnB,IAA0BkM,CAAS,CAAClM,GAAV,CAAc,CAAd,CAArD,GAA0E,CAACmM,CAAM,CAACH,QAAP,CAAgB,4BAAhB,CAA/E,CACIG,CAAM,CAACjN,QAAP,CAAgB,4BAAhB,CACP,CAPD,CAQH,CAjCoD,CAmCrD2M,YAAY,CAAE,uBAAY,IAKlBO,CAAAA,CAAW,CAAG,0HALI,CAMlBC,CAAQ,CAAG,EANO,CAOtBhO,CAAC,CAACqB,IAAF,CAAO,CAAC,GAAD,CAAO,EAAP,CAAY,GAAZ,CAAP,CAA0BrB,CAAC,CAACsB,KAAF,CAAQ,SAAU2M,CAAV,CAAezM,CAAf,CAAoB,IAC9C6D,CAAAA,CAAC,CAAG,CAD0C,CAE9C6I,CAAe,CAAG,IAF4B,CAGlDF,CAAQ,EAAI,sDAAZ,CACA,GAAW,GAAP,EAAAxM,CAAJ,CAAiB0M,CAAe,CAAG,KAAKC,KAAL,CAAW,CAAX,CAAc,CAAd,CAAiB,CAAjB,CAAoB,CAApB,CAAlB,CACjB,GAAW,EAAP,EAAA3M,CAAJ,CAAgB0M,CAAe,CAAG,KAAKC,KAAL,CAAW,GAAX,CAAgB,GAAhB,CAAqB,GAArB,CAA0B,CAA1B,CAAlB,CAChB,GAAW,GAAP,EAAA3M,CAAJ,CAAiB0M,CAAe,CAAG,KAAKC,KAAL,CAAW,GAAX,CAAgB,GAAhB,CAAqB,GAArB,CAA0B,CAA1B,CAAlB,CACjBH,CAAQ,EAAIpO,CAAY,CAACQ,KAAb,CAAmBM,GAAnB,CAAuBqN,CAAvB,CAAoC,CAACjM,KAAK,CAAEoM,CAAe,CAACE,QAAhB,EAAR,CAApC,CAAZ,CACA,MAAY,GAAL,EAAA/I,CAAP,CAAiB,CACb2I,CAAQ,EAAIpO,CAAY,CAACQ,KAAb,CAAmBM,GAAnB,CAAuBqN,CAAvB,CAAoC,CAACjM,KAAK,CAAE,KAAKuM,SAAL,CAAe,KAAKC,IAAL,CAAUjJ,CAAC,CAAG,EAAd,CAAkB,CAAlB,CAAqB7D,CAArB,CAAf,EAA0C4M,QAA1C,EAAR,CAApC,CAAZ,CACA/I,CAAC,EAAI,EACR,CACD2I,CAAQ,EAAI,QACf,CAbyB,CAavB,IAbuB,CAA1B,EAeA,KAAK1N,GAAL,CAASQ,MAAT,CAAgBd,CAAC,CAACJ,CAAY,CAACQ,KAAb,CAAmBM,GAAnB,qPAA4B,CAACoB,KAAK,CAAE,KAAKwK,KAAL,CAAWxK,KAAnB,CAA0BkM,QAAQ,CAAEA,CAApC,CAA5B,CAAD,CAAjB,EACA,KAAK1N,GAAL,CAASW,IAAT,CAAc,wCAAd,EAAwDJ,QAAxD,CAAiE,4BAAjE,CACH,CA3DoD,CA6DrD6L,YAAY,CAAE,uBAAgB,CAC1B,KAAKJ,KAAL,CAAWjJ,QAAX,CAAoB,KAAK/C,GAAL,CAASW,IAAT,CAAc,uCAAd,EAAuDQ,IAAvD,CAA4D,YAA5D,CAApB,CACH,CA/DoD,CAiErD0M,KAAK,CAAE,eAAUzE,CAAV,CAAaG,CAAb,CAAgBC,CAAhB,CAAmByE,CAAnB,CAAsB,CACzB,MAAO,CACH7E,CAAC,CAAEA,CADA,CACGG,CAAC,CAAEA,CADN,CACSC,CAAC,CAAEA,CADZ,CACeyE,CAAC,CAAEA,CADlB,CACqBH,QAAQ,CAAE,mBAAY,CAC1C,MAAO,QAAU1E,CAAV,CAAc,IAAd,CAAqBG,CAArB,CAAyB,IAAzB,CAAgCC,CAAhC,CAAoC,IAApC,CAA2CyE,CAA3C,CAA+C,GACzD,CAHE,CAKV,CAvEoD,CAyErDD,IAAI,CAAE,cAAUE,CAAV,CAAaC,CAAb,CAAgBC,CAAhB,CAAmB,CACrB,MAAO,CACHF,CAAC,CAAEA,CADA,CACGC,CAAC,CAAEA,CADN,CACSC,CAAC,CAAEA,CADZ,CACeN,QAAQ,CAAE,mBAAY,CACpC,MAAO,OAASI,CAAT,CAAa,IAAb,CAAwB,GAAJ,CAAAC,CAApB,CAA8B,KAA9B,CAA0C,GAAJ,CAAAC,CAAtC,CAAgD,IAC1D,CAHE,CAKV,CA/EoD,CAiFrDC,SAAS,CAAE,mBAAUC,CAAV,CAAe,CACtB,GAAIC,CAAAA,CAAG,CAAGlF,QAAQ,CAACiF,CAAG,CAACE,SAAJ,CAAc,CAAd,CAAD,CAAmB,EAAnB,CAAlB,CACA,MAAO,MAAKX,KAAL,CAAWU,CAAG,EAAI,EAAlB,CAAiC,GAAX,CAAAA,CAAG,EAAI,CAA7B,CAA4C,GAAN,CAAAA,CAAtC,CAAiD,CAAjD,CACV,CApFoD,CAuFrDR,SAAS,CAAE,mBAAUU,CAAV,CAAe,CACtB,GAAIP,CAAAA,CAAC,CAAGO,CAAG,CAACP,CAAJ,CAAQ,GAAhB,CAAqBC,CAAC,CAAGM,CAAG,CAACN,CAA7B,CAAgCC,CAAC,CAAGK,CAAG,CAACL,CAAxC,CAA2ChF,CAA3C,CAA8CG,CAA9C,CAAiDC,CAAjD,CAEA,QAASkF,CAAAA,CAAT,CAAiBC,CAAjB,CAAoBC,CAApB,CAAuBC,CAAvB,CAA0B,CACtB,GAAQ,CAAJ,CAAAA,CAAJ,CAAWA,CAAC,EAAI,CAAL,CACX,GAAQ,CAAJ,CAAAA,CAAJ,CAAWA,CAAC,EAAI,CAAL,CACX,GAAIA,CAAC,CAAG,EAAI,CAAZ,CAAe,MAAOF,CAAAA,CAAC,CAAa,CAAV,EAACC,CAAC,CAAGD,CAAL,EAAcE,CAAzB,CACf,GAAIA,CAAC,CAAG,EAAI,CAAZ,CAAe,MAAOD,CAAAA,CAAP,CACf,GAAIC,CAAC,CAAG,EAAI,CAAZ,CAAe,MAAOF,CAAAA,CAAC,CAA2B,CAAxB,GAACC,CAAC,CAAGD,CAAL,GAAW,EAAI,CAAJ,CAAQE,CAAnB,EAAX,CACf,MAAOF,CAAAA,CACV,CAED,GAAU,CAAN,GAAAR,CAAJ,CAAa,CACT/E,CAAC,CAAGG,CAAC,CAAGC,CAAC,CAAG4E,CACf,CAFD,IAEO,IACCQ,CAAAA,CAAC,CAAO,EAAJ,CAAAR,CAAC,CAASA,CAAC,EAAI,EAAID,CAAR,CAAV,CAAuBC,CAAC,CAAGD,CAAJ,CAAQC,CAAC,CAAGD,CADzC,CAECQ,CAAC,CAAG,EAAIP,CAAJ,CAAQQ,CAFb,CAGHxF,CAAC,CAAG0F,IAAI,CAACC,KAAL,CAAwC,GAA7B,CAACL,CAAO,CAACC,CAAD,CAAIC,CAAJ,CAAOV,CAAC,CAAG,EAAI,CAAf,CAAnB,CAAJ,CACA3E,CAAC,CAAGuF,IAAI,CAACC,KAAL,CAAgC,GAArB,CAACL,CAAO,CAACC,CAAD,CAAIC,CAAJ,CAAOV,CAAP,CAAnB,CAAJ,CACA1E,CAAC,CAAGsF,IAAI,CAACC,KAAL,CAAwC,GAA7B,CAACL,CAAO,CAACC,CAAD,CAAIC,CAAJ,CAAOV,CAAC,CAAG,EAAI,CAAf,CAAnB,CACP,CACD,MAAO,MAAKL,KAAL,CAAWzE,CAAX,CAAcG,CAAd,CAAiBC,CAAjB,CAAoB,CAApB,CACV,CA7GoD,CAA5B,CAA7B,CA+GAlK,CAAY,CAAC4F,OAAb,CAAqB8J,WAArB,CAAmC1P,CAAY,CAAC4F,OAAb,CAAqBvF,MAArB,CAA4B,CAE3DwM,IAAI,CAAE,aAFqD,CAI3DF,QAAQ,CAAE,CACNgD,MAAM,GADA,CAENC,MAAM,GAFA,CAGNC,MAAM,GAHA,CAJiD,CAU3D9C,UAAU,CAAE,qBAAY,CAEpB,KAAK1I,QAAL,CAAgB,KAAKqI,KAAL,CAAWpI,OAAX,EAAhB,CAEAlE,CAAC,CAACqB,IAAF,CAAO,CAAC,QAAD,CAAW,QAAX,CAAqB,QAArB,CAAP,CAAuCrB,CAAC,CAACsB,KAAF,CAAQ,SAAUoO,CAAV,CAAaC,CAAb,CAAoB,CAC/D,GAAI,KAAK5P,IAAL,CAAU4P,CAAV,CAAJ,CAAsB,CAClB,KAAKrP,GAAL,CAASQ,MAAT,CAAgB,qDAAsD6O,CAAtD,CAA8D,wBAA9D,CAAuFA,CAAvF,CAA+F,cAA/G,CACH,CACJ,CAJsC,CAIpC,IAJoC,CAAvC,EAMA,KAAKrP,GAAL,CAASwH,EAAT,CAAY,OAAZ,CAAqB,mBAArB,CAA0C9H,CAAC,CAACsB,KAAF,CAAQ,SAAUyG,CAAV,CAAa,IACvD4H,CAAAA,CAAK,CAAG3P,CAAC,CAAC+H,CAAC,CAAC6H,aAAH,CAAD,CAAmBnO,IAAnB,CAAwB,WAAxB,CAD+C,CAEvDwH,CAAI,CAAG,KAAKqD,KAAL,CAAWpI,OAAX,EAFgD,CAG3D,GAAI+E,CAAI,GAAK0G,CAAb,CAAoB,KAAK1L,QAAL,CAAgBgF,CAAhB,CACpB,GAAIL,CAAAA,CAAO,CAAGK,CAAI,GAAK0G,CAAT,CAAiB,KAAK1L,QAAtB,CAAiC0L,CAA/C,CACA,KAAKrD,KAAL,CAAWnJ,OAAX,CAAmByF,CAAnB,EACAb,CAAC,CAACE,cAAF,EACH,CAPyC,CAOvC,IAPuC,CAA1C,EASA,KAAKqE,KAAL,CAAWnM,EAAX,CAAc+I,IAAd,CAAmB,YAAnB,CAAiClJ,CAAC,CAACsB,KAAF,CAAQ,SAAU2H,CAAV,CAAgB,CACrD,KAAK4G,aAAL,CAAmB5G,CAAnB,CACH,CAFgC,CAE9B,IAF8B,CAAjC,EAIA,KAAK4G,aAAL,CAAmB,KAAKvD,KAAL,CAAWpI,OAAX,EAAnB,CACH,CAlC0D,CAoC3D2L,aAAa,CAAE,uBAAU5G,CAAV,CAAgB,CAC3B,KAAK3I,GAAL,CAASW,IAAT,CAAc,mBAAd,EAAmCI,IAAnC,CAAwC,SAAUqO,CAAV,CAAaI,CAAb,CAAmB,CACvD,GAAIC,CAAAA,CAAK,CAAG/P,CAAC,CAAC8P,CAAD,CAAb,CACAC,CAAK,CAACtL,WAAN,CAAkB,QAAlB,CAA4BwE,CAAI,GAAK8G,CAAK,CAACtO,IAAN,CAAW,WAAX,CAArC,CACH,CAHD,CAIH,CAzC0D,CAA5B,CAAnC,CA6CA7B,CAAY,CAAC4F,OAAb,CAAqBwK,UAArB,CAAkCpQ,CAAY,CAAC4F,OAAb,CAAqBvF,MAArB,CAA4B,CAE1DwM,IAAI,CAAE,YAFoD,CAI1DF,QAAQ,CAAE,CACN0D,IAAI,GADE,CAENC,OAAO,GAFD,CAGN9N,KAAK,GAHC,CAJgD,CAU1DuK,UAAU,CAAE,qBAAY,CACpB,GAAIwD,CAAAA,CAAE,CAAG,EAAT,CACA,GAAI,KAAKpQ,IAAL,CAAUkQ,IAAd,CAAoBE,CAAE,EAAI,yEAAN,CACpB,GAAI,KAAKpQ,IAAL,CAAUmQ,OAAd,CAAuBC,CAAE,EAAI,4EAAN,CACvB,GAAI,KAAKpQ,IAAL,CAAUqC,KAAd,CAAqB+N,CAAE,EAAI,2EAAN,CACrB,KAAK7P,GAAL,CAASQ,MAAT,CAAgBqP,CAAhB,EAEA,GAAI,KAAKpQ,IAAL,CAAUkQ,IAAd,CAAoB,CAChB,GAAIG,CAAAA,CAAK,CAAG,KAAK9P,GAAL,CAASW,IAAT,CAAc,wCAAd,CAAZ,CACA,KAAKqL,KAAL,CAAWnM,EAAX,CAAc+I,IAAd,CAAmB,mBAAnB,CAAwClJ,CAAC,CAACsB,KAAF,CAAQ,SAAUyE,CAAV,CAAe,CAC3D,GAAY,CAAR,GAAAA,CAAJ,CACIqK,CAAK,CAAC3O,IAAN,CAAW,UAAX,CAAuB,UAAvB,EADJ,IAGI2O,CAAAA,CAAK,CAACC,UAAN,CAAiB,UAAjB,CACP,CALuC,CAKrC,IALqC,CAAxC,EAMA,KAAK/P,GAAL,CAASwH,EAAT,CAAY,OAAZ,CAAqB,wCAArB,CAA+D9H,CAAC,CAACsB,KAAF,CAAQ,SAAUyG,CAAV,CAAa,CAChF,KAAKuE,KAAL,CAAW5F,eAAX,GACAqB,CAAC,CAACE,cAAF,EACH,CAH8D,CAG5D,IAH4D,CAA/D,CAIH,CAED,GAAI,KAAKlI,IAAL,CAAUmQ,OAAd,CAAuB,CACnB,GAAII,CAAAA,CAAQ,CAAG,KAAKhQ,GAAL,CAASW,IAAT,CAAc,2CAAd,CAAf,CACA,KAAKqL,KAAL,CAAWnM,EAAX,CAAc+I,IAAd,CAAmB,mBAAnB,CAAwClJ,CAAC,CAACsB,KAAF,CAAQ,SAAUyE,CAAV,CAAe,CAC3D,GAAIA,CAAG,GAAK,KAAKuG,KAAL,CAAWhK,OAAX,CAAmB4C,MAAnB,CAA0BzE,MAAtC,CACI6P,CAAQ,CAAC7O,IAAT,CAAc,UAAd,CAA0B,UAA1B,EADJ,IAGI6O,CAAAA,CAAQ,CAACD,UAAT,CAAoB,UAApB,CACP,CALuC,CAKrC,IALqC,CAAxC,EAMA,KAAK/P,GAAL,CAASwH,EAAT,CAAY,OAAZ,CAAqB,2CAArB,CAAkE9H,CAAC,CAACsB,KAAF,CAAQ,SAAUyG,CAAV,CAAa,CACnF,KAAKuE,KAAL,CAAW3F,gBAAX,GACAoB,CAAC,CAACE,cAAF,EACH,CAHiE,CAG/D,IAH+D,CAAlE,CAIH,CAED,GAAI,KAAKlI,IAAL,CAAUqC,KAAd,CAAqB,CACjB,KAAK9B,GAAL,CAASwH,EAAT,CAAY,OAAZ,CAAqB,yCAArB,CAAgE9H,CAAC,CAACsB,KAAF,CAAQ,SAAUyG,CAAV,CAAa,CACjF,KAAKuE,KAAL,CAAWlK,KAAX,CAAiB,CAACG,UAAU,GAAX,CAAjB,EACAwF,CAAC,CAACE,cAAF,EACH,CAH+D,CAG7D,IAH6D,CAAhE,CAIH,CACJ,CAnDyD,CAA5B,CAAlC,CAqDArI,CAAY,CAAC4F,OAAb,CAAqB+K,IAArB,CAA4B3Q,CAAY,CAAC4F,OAAb,CAAqBvF,MAArB,CAA4B,CAEpDwM,IAAI,CAAE,MAF8C,CAIpDF,QAAQ,CAAE,CACNjE,IAAI,CAAE,MADA,CAENkI,cAAc,CAAE,CAAC,CAAD,CAAI,CAAJ,CAAO,CAAP,CAAU,EAAV,CAAc,EAAd,CAAkB,EAAlB,CAAsB,EAAtB,CAA0B,EAA1B,CAFV,CAJ0C,CASpDC,KAAK,CAAE,CAAC,UAAD,CAAa,OAAb,CAT6C,CAWpD9D,UAAU,CAAE,qBAAY,CACpB,GAAsB,MAAlB,OAAK5M,IAAL,CAAUuI,IAAd,CACI,KAAKvI,IAAL,CAAUuI,IAAV,CAAiB,KAAKoI,eAAL,GAAyB,OAAzB,CAAmC,UAApD,CACJ,GAAIhQ,CAAAA,CAAG,CAA2C,CAAC,CAAzC,CAAAV,CAAC,CAAC2Q,OAAF,CAAU,KAAK5Q,IAAL,CAAUuI,IAApB,CAA0B,KAAKmI,KAA/B,EAA6C,KAAK,IAAM,KAAK1Q,IAAL,CAAUuI,IAAhB,CAAuB,UAA5B,GAA7C,GAAV,CACA,GAAI,CAAC5H,CAAL,CAAU,SAEV,KAAKc,GAAL,CAAW,KAAK8K,KAAL,CAAWvM,IAAX,CAAgB+C,IAA3B,CAEA,KAAKxC,GAAL,CAASQ,MAAT,CAAgBd,CAAC,CAACU,CAAD,CAAjB,EACA,KAAKJ,GAAL,CAASmB,IAAT,CAAc,yBAAd,CAAyC,KAAK1B,IAAL,CAAUuI,IAAnD,EACA,KAAKsI,UAAL,GAEA,GAAI5L,CAAAA,CAAI,CAAG,IAAX,CAEA,GAAsB,OAAlB,OAAKjF,IAAL,CAAUuI,IAAd,CAA+B,CAC3B,KAAKhI,GAAL,CAASwH,EAAT,CAAY,QAAZ,CAAsB,yCAAtB,CAAiE,SAAUC,CAAV,CAAa,CAC1E/C,CAAI,CAACxD,GAAL,CAAWxB,CAAC,CAAC,IAAD,CAAD,CAAQwB,GAAR,EAAX,CACAwD,CAAI,CAAC4L,UAAL,GAEA5L,CAAI,CAACsH,KAAL,CAAWnM,EAAX,CAAc0D,OAAd,CAAsB,cAAtB,CAAsCmB,CAAI,CAACxD,GAA3C,EAEAuG,CAAC,CAACE,cAAF,EACH,CAPD,CAQH,CAED,GAAsB,UAAlB,OAAKlI,IAAL,CAAUuI,IAAd,CAAkC,CAC9B,KAAKhI,GAAL,CAASwH,EAAT,CAAY,OAAZ,CAAqB,8CAArB,CAAqE9H,CAAC,CAACsB,KAAF,CAAQ,UAAa,CACtF,KAAKhB,GAAL,CAASW,IAAT,CAAc,sCAAd,EAAsDwD,WAAtD,CAAkE,4BAAlE,CACH,CAFoE,CAElE,IAFkE,CAArE,EAIA,KAAKnE,GAAL,CAASwH,EAAT,CAAY,OAAZ,CAAqB,aAArB,CAAoC,SAAUC,CAAV,CAAa,CAC7C/C,CAAI,CAACxD,GAAL,CAAWmI,QAAQ,CAAC3J,CAAC,CAAC,IAAD,CAAD,CAAQyB,IAAR,CAAa,WAAb,CAAD,CAA4B,CAA5B,CAAnB,CACAuD,CAAI,CAAC4L,UAAL,GAEA5L,CAAI,CAACsH,KAAL,CAAWnM,EAAX,CAAc0D,OAAd,CAAsB,cAAtB,CAAsCmB,CAAI,CAACxD,GAA3C,EAEAuG,CAAC,CAACE,cAAF,EACH,CAPD,CAQH,CACJ,CAlDmD,CAoDpD4I,cAAc,CAAE,yBAAY,CAKxB,MAAOjR,CAAAA,CAAY,CAACQ,KAAb,CAAmBM,GAAnB,kQAA4B,CAACoC,IAAI,CAAE,KAAKwJ,KAAL,CAAWvM,IAAX,CAAgB+C,IAAvB,CAA5B,CACV,CA1DmD,CA4DpDgO,iBAAiB,CAAE,4BAAY,CAC3B,GAAIpQ,CAAAA,CAAG,iMAAP,CAGAV,CAAC,CAACqB,IAAF,CAAO,KAAKtB,IAAL,CAAUyQ,cAAjB,CAAiC,SAAUnL,CAAV,CAAavC,CAAb,CAAmB,CAChDpC,CAAG,EAAId,CAAY,CAACQ,KAAb,CAAmBM,GAAnB,CACH,2HADG,CAEH,CAACoC,IAAI,CAAEA,CAAP,CAFG,CAIV,CALD,EAMApC,CAAG,EAAI,aAAP,CACA,MAAOA,CAAAA,CACV,CAxEmD,CA0EpDgM,YAAY,CAAE,uBAAgB,CAC1B,KAAKkE,UAAL,EACH,CA5EmD,CA8EpDA,UAAU,CAAE,qBAAY,CACpB,GAAIpP,CAAAA,CAAG,CAAG,KAAKA,GAAf,CACA,KAAK8K,KAAL,CAAW1K,GAAX,CAAe0B,SAAf,CAA2B9B,CAA3B,CAEA,KAAKlB,GAAL,CAASW,IAAT,CAAc,8FAAd,EAA8GsE,GAA9G,CAAkH,CAC9GnB,KAAK,CAAE5C,CAAG,CAAG,IADiG,CAE9G+C,MAAM,CAAE/C,CAAG,CAAG,IAFgG,CAG9GuP,YAAY,CAAEvP,CAAG,CAAG,IAH0F,CAI9GwP,UAAU,CAAE,CAAC,CAAD,CAAKxP,CAAL,CAAW,CAAX,CAAe,IAJmF,CAK9GyP,SAAS,CAAE,CAAC,CAAD,CAAKzP,CAAL,CAAW,CAAX,CAAe,IALoF,CAAlH,EAQA,KAAKlB,GAAL,CAASW,IAAT,CAAc,8BAAd,EAA8CQ,IAA9C,CAAmD,OAAnD,CAA4DD,CAA5D,EAEA,GAAsB,UAAlB,OAAKzB,IAAL,CAAUuI,IAAd,CAAkC,CAC9B,GAAIsF,CAAAA,CAAO,CAAG,IAAd,CACA5N,CAAC,CAACqB,IAAF,CAAO,KAAKtB,IAAL,CAAUyQ,cAAjB,CAAiC,SAAUnL,CAAV,CAAavC,CAAb,CAAmB,CAChD,GAAgB,IAAZ,GAAA8K,CAAO,EAAawB,IAAI,CAAC8B,GAAL,CAASpO,CAAI,CAAGtB,CAAhB,EAAuB4N,IAAI,CAAC8B,GAAL,CAAStD,CAAO,CAAGpM,CAAnB,CAA/C,CACIoM,CAAO,CAAG9K,CACjB,CAHD,EAIA,KAAKxC,GAAL,CAASW,IAAT,CAAc,sCAAd,EAAsDJ,QAAtD,CAA+D,4BAA/D,CACH,CACJ,CApGmD,CAsGpD6P,eAAe,CAAE,0BAAY,CACzB,GAAIS,CAAAA,CAAS,CAAG5Q,QAAQ,CAACiM,aAAT,CAAuB,OAAvB,CAAhB,CAEI4E,CAAU,CAAG7Q,QAAQ,CAAC8Q,eAF1B,CAIIC,CAJJ,CAKAH,CAAS,CAACI,YAAV,CAAuB,MAAvB,UACAD,CAAS,CAAsB,MAAnB,GAAAH,CAAS,CAAC7I,IAAtB,CACA6I,CAAS,CAACxB,KAAV,MACAwB,CAAS,CAACK,KAAV,CAAgBC,OAAhB,CAA0B,sCAA1B,CACA,GAAI,UAAUC,IAAV,WAAiCP,CAAS,CAACK,KAAV,CAAgBG,gBAAhB,SAArC,CAAqF,CACjFP,CAAU,CAACQ,WAAX,CAAuBT,CAAvB,EACAU,WAAW,CAAGtR,QAAQ,CAACsR,WAAvB,CACAP,CAAS,CAAGO,WAAW,CAACC,gBAAZ,EAC2D,WAAnE,GAAAD,WAAW,CAACC,gBAAZ,CAA6BX,CAA7B,CAAwC,IAAxC,EAA8CQ,gBADtC,EAEoB,CAA3B,GAAAR,CAAS,CAACY,YAFf,CAGAX,CAAU,CAACY,WAAX,CAAuBb,CAAvB,CACH,CACD,MAAO,CAAC,CAACG,CACZ,CAzHmD,CAA5B,CAA5B,CA2HA1R,CAAY,CAAC4F,OAAb,CAAqByM,QAArB,CAAgCrS,CAAY,CAAC4F,OAAb,CAAqBvF,MAArB,CAA4B,CAExDwM,IAAI,CAAE,UAFkD,CAIxDE,UAAU,CAAE,qBAAY,CACpB,KAAKrM,GAAL,CAASQ,MAAT,CAAgB,mEAAhB,EACA,KAAKR,GAAL,CAASwH,EAAT,CAAY,OAAZ,CAAqB,wCAArB,CAA+D9H,CAAC,CAACsB,KAAF,CAAQ,SAAUyG,CAAV,CAAa,CAChF,KAAKuE,KAAL,CAAWlF,WAAX,GACAW,CAAC,CAACE,cAAF,EACH,CAH8D,CAG5D,IAH4D,CAA/D,CAIH,CAVuD,CAA5B,CAAhC,CAaArI,CAAY,CAACQ,KAAb,CAAqB,EAArB,CASAR,CAAY,CAACQ,KAAb,CAAmBM,GAAnB,CAA0B,UAAY,CAClC,aAEA,GAIIwR,CAAAA,CAJJ,CAMA,MAAO,UAAUC,CAAV,CAAoBzH,CAApB,CAA0B,CAE7B,MAAOyH,CAAAA,CAAQ,CAAC9K,OAAT,uCAA0B,SAAU+K,CAAV,CAAeC,CAAf,CAAsB,CACnD,GAAIC,CAAAA,CAAI,CAAGD,CAAK,CAACE,KAAN,CAAY,GAAZ,CAAX,CACIC,CAAG,CAAGF,CAAI,CAAC7R,MADf,CAEIgS,CAAM,CAAG/H,CAFb,CAGIrF,CAAC,CAAG,CAHR,CAKA,KAAOA,CAAC,CAAGmN,CAAX,CAAgBnN,CAAC,EAAjB,CAAqB,CACjBoN,CAAM,CAAGA,CAAM,CAACH,CAAI,CAACjN,CAAD,CAAL,CAAf,CAGA,GAAIoN,CAAM,GAAKP,CAAf,CAAsB,CAClB,KAAM,SAAWI,CAAI,CAACjN,CAAD,CAAf,CAAqB,iBAArB,CAAyC+M,CAClD,CAGD,GAAI/M,CAAC,EAAKmN,CAAG,CAAG,CAAhB,CAAmB,CACf,MAAOC,CAAAA,CACV,CACJ,CACJ,CAnBM,CAoBV,CACJ,CAhCyB,EAA1B,CA6CA7S,CAAY,CAACQ,KAAb,CAAmBC,UAAnB,CAAgC,UAAY,CAC3C,CADD,CAGAT,CAAY,CAACQ,KAAb,CAAmBC,UAAnB,CAA8B6C,SAA9B,CAA0C,CACtCgG,IAAI,CAAE,cAAUwJ,CAAV,CAAiBC,CAAjB,CAAsB,CACxB,KAAKC,OAAL,CAAe,KAAKA,OAAL,EAAgB,EAA/B,CACA,KAAKA,OAAL,CAAaF,CAAb,EAAsB,KAAKE,OAAL,CAAaF,CAAb,GAAuB,EAA7C,CACA,KAAKE,OAAL,CAAaF,CAAb,EAAoBvM,IAApB,CAAyBwM,CAAzB,CACH,CALqC,CAMtC7J,MAAM,CAAE,gBAAU4J,CAAV,CAAiBC,CAAjB,CAAsB,CAC1B,KAAKC,OAAL,CAAe,KAAKA,OAAL,EAAgB,EAA/B,CACA,GAAI,IAAAF,CAAK,GAAI,MAAKE,OAAlB,CAAqC,OACrC,KAAKA,OAAL,CAAaF,CAAb,EAAoBG,MAApB,CAA2B,KAAKD,OAAL,CAAaF,CAAb,EAAoB9R,OAApB,CAA4B+R,CAA5B,CAA3B,CAA6D,CAA7D,CACH,CAVqC,CAWtC9O,OAAO,CAAE,iBAAU6O,CAAV,CAAiC,CACtC,KAAKE,OAAL,CAAe,KAAKA,OAAL,EAAgB,EAA/B,CACA,GAAI,IAAAF,CAAK,GAAI,MAAKE,OAAlB,CAAqC,OACrC,IAAK,GAAIvN,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAG,KAAKuN,OAAL,CAAaF,CAAb,EAAoBjS,MAAxC,CAAgD4E,CAAC,EAAjD,CAAqD,CACjD,KAAKuN,OAAL,CAAaF,CAAb,EAAoBrN,CAApB,EAAuBuH,KAAvB,CAA6B,IAA7B,CAAmCkG,KAAK,CAAC5P,SAAN,CAAgBqD,KAAhB,CAAsBwM,IAAtB,CAA2BlG,SAA3B,CAAsC,CAAtC,CAAnC,CACH,CACJ,CAjBqC,CAA1C,CAqBAjN,CAAY,CAACQ,KAAb,CAAmB4S,cAAnB,CAAoC,SAAU1S,CAAV,CAAe2S,CAAf,CAA4BC,CAA5B,CAAwCC,CAAxC,CAAmD,CACnFF,CAAW,CAAG,CAAC,CAACA,CAAF,IAAd,CACAC,CAAU,CAAG,CAAC,CAACA,CAAF,IAAb,CACA,GAAI9O,CAAAA,CAAK,CAAG,CAAZ,CACIgP,CADJ,CAEA,GAAiB,OAAb,EAAAD,CAAJ,CAA0B,CACtBC,CAAK,CAAG,CAAC,mBAAD,CAAsB,oBAAtB,CAAR,CACA,GAAIH,CAAJ,CAAiBG,CAAK,CAACjN,IAAN,CAAW,cAAX,CAA2B,eAA3B,EACjB,GAAI+M,CAAJ,CAAgBE,CAAK,CAACjN,IAAN,CAAW,aAAX,CAA0B,cAA1B,CACnB,CAJD,IAIO,CACHiN,CAAK,CAAG,CAAC,kBAAD,CAAqB,qBAArB,CAAR,CACA,GAAIH,CAAJ,CAAiBG,CAAK,CAACjN,IAAN,CAAW,aAAX,CAA0B,gBAA1B,EACjB,GAAI+M,CAAJ,CAAgBE,CAAK,CAACjN,IAAN,CAAW,YAAX,CAAyB,eAAzB,CACnB,CACD,IAAK,GAAId,CAAAA,CAAC,CAAG+N,CAAK,CAAC3S,MAAN,CAAe,CAA5B,CAAoC,CAAL,EAAA4E,CAA/B,CAAuCA,CAAC,EAAxC,EACIjB,CAAK,EAAIuF,QAAQ,CAACrJ,CAAG,CAACiF,GAAJ,CAAQ6N,CAAK,CAAC/N,CAAD,CAAb,EAAkBgC,OAAlB,CAA0B,IAA1B,CAAgC,EAAhC,CAAD,CAAsC,EAAtC,CADrB,CAEA,MAAOjD,CAAAA,CACV,CAjBD,CAmBAxE,CAAY,CAACQ,KAAb,CAAmByE,cAAnB,CAAoC,SAAUvE,CAAV,CAAe2S,CAAf,CAA4BC,CAA5B,CAAwC,CACxE,MAAOtT,CAAAA,CAAY,CAACQ,KAAb,CAAmB4S,cAAnB,CAAkC1S,CAAlC,CAAuC2S,CAAvC,CAAoDC,CAApD,CAAgE,OAAhE,CACV,CAFD,CAIAtT,CAAY,CAACQ,KAAb,CAAmB2E,eAAnB,CAAqC,SAAUzE,CAAV,CAAe2S,CAAf,CAA4BC,CAA5B,CAAwC,CACzE,MAAOtT,CAAAA,CAAY,CAACQ,KAAb,CAAmB4S,cAAnB,CAAkC1S,CAAlC,CAAuC2S,CAAvC,CAAoDC,CAApD,CAAgE,QAAhE,CACV,CAFD,CAIAtT,CAAY,CAACQ,KAAb,CAAmB4D,OAAnB,CAA6B,SAAUqP,CAAV,CAAkB,CAC3C,GAAI,CAACA,CAAD,EAAW,CAACA,CAAM,CAAC5S,MAAvB,CAA+B,SAC/B,MAAQ,qCAAD,CAAuCiR,IAAvC,CAA4C2B,CAA5C,GAA6G,CAAC,CAAvD,GAAArT,CAAC,CAAC2Q,OAAF,CAAU0C,CAAM,CAACvE,SAAP,CAAiB,CAAjB,CAAoB,CAApB,CAAV,CAAkC,CAAC,KAAD,CAAQ,KAAR,CAAlC,CACjE,CAHD,CAQAlP,CAAY,CAACQ,KAAb,CAAmBgK,QAAnB,CAA8B,SAAUV,CAAV,CAAaG,CAAb,CAAgBC,CAAhB,CAAmB,CAC7C,GAAIrE,CAAAA,CAAC,CAAG,CAAR,CACAA,CAAC,EAAI,CAAK,GAAJ,CAAAiE,CAAD,GAAa,EAAlB,CACAjE,CAAC,EAAI,CAAK,GAAJ,CAAAoE,CAAD,GAAa,CAAlB,CACApE,CAAC,EAAS,GAAJ,CAAAqE,CAAN,CACA,MAAOrE,CAAAA,CACV,CAND,CAWA7F,CAAY,CAACQ,KAAb,CAAmB4J,OAAnB,CAA6B,SAAUsJ,CAAV,CAAiBpJ,CAAjB,CAAoBC,CAApB,CAAuB,IAC5C9E,CAAAA,CAAC,CAA2B,CAAxB,EAAC8E,CAAC,CAAGmJ,CAAK,CAAClP,KAAV,CAAkB8F,CAAnB,CADwC,CAE5CzE,CAAC,CAAG7F,CAAY,CAACQ,KAAb,CAAmBgK,QAAnB,CACJkJ,CAAK,CAAC5I,IAAN,CAAWrF,CAAX,CADI,CAEJiO,CAAK,CAAC5I,IAAN,CAAWrF,CAAC,CAAG,CAAf,CAFI,CAGJiO,CAAK,CAAC5I,IAAN,CAAWrF,CAAC,CAAG,CAAf,CAHI,CAFwC,CAQhD,MAAO,CACHA,CADG,CAEH6E,CAFG,CAGHC,CAHG,CAIH1E,CAJG,CAMV,CAdD,CAgBC,WAAY,CAGT,OADI8N,CAAAA,CAAO,CAAG,CAAC,IAAD,CAAO,KAAP,CAAc,QAAd,CAAwB,GAAxB,CACd,CAASrJ,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGqJ,CAAO,CAAC9S,MAAZ,EAAsB,CAACiF,MAAM,CAAC6F,qBAA9C,CAAqE,EAAErB,CAAvE,CAA0E,CACtExE,MAAM,CAAC6F,qBAAP,CAA+B7F,MAAM,CAAC6N,CAAO,CAACrJ,CAAD,CAAP,CAAa,uBAAd,CAArC,CACAxE,MAAM,CAAC8N,oBAAP,CAA8B9N,MAAM,CAAC6N,CAAO,CAACrJ,CAAD,CAAP,CAAa,sBAAd,CAAN,EAA+CxE,MAAM,CAAC6N,CAAO,CAACrJ,CAAD,CAAP,CAAa,6BAAd,CACtF,CACJ,CAPA,GAAD,CASI,GAAIL,CAAAA,CAAJ,CACA,GAAsB,WAAlB,QAAOnE,CAAAA,MAAX,CAAmC,CAC/BmE,CAAC,CAAGnE,MACP,CAFD,IAEO,IAAsB,WAAlB,QAAO+N,CAAAA,MAAX,CAAmC,CACtC5J,CAAC,CAAG4J,MACP,CAFM,IAEA,IAAoB,WAAhB,QAAOC,CAAAA,IAAX,CAAiC,CACpC7J,CAAC,CAAG6J,IACP,CAFM,IAEA,CACH7J,CAAC,CAAG,IACP,CACDA,CAAC,CAACjK,YAAF,CAAiBA,CAAjB,CAGF,MAAOA,CAAAA,CAER,CAvrCK,CAAN","sourcesContent":["define([], function() {\n\n// -- Original code starts here\n/* drawingboard.js v0.4.2 - https://github.com/Leimi/drawingboard.js\n* Copyright (c) 2013 Emmanuel Pelletier\n* Licensed MIT */\nvar DrawingBoard = {};\n/**\n * pass the id of the html element to put the drawing board into\n * and some options : {\n *\tcontrols: array of controls to initialize with the drawingboard. 'Colors', 'Size', and 'Navigation' by default\n *\t\tinstead of simple strings, you can pass an object to define a control opts\n *\t\tie ['Color', { Navigation: { reset: false }}]\n *\tcontrolsPosition: \"top left\" by default. Define where to put the controls: at the \"top\" or \"bottom\" of the canvas, aligned to \"left\"/\"right\"/\"center\"\n *\tbackground: background of the drawing board. Give a hex color or an image url \"#ffffff\" (white) by default\n *\tcolor: pencil color (\"#000000\" by default)\n *\tsize: pencil size (3 by default)\n *\twebStorage: 'session', 'local' or false ('session' by default). store the current drawing in session or local storage and restore it when you come back\n *\tdroppable: true or false (false by default). If true, dropping an image on the canvas will include it and allow you to draw on it,\n *\terrorMessage: html string to put in the board's element on browsers that don't support canvas.\n * }\n */\nDrawingBoard.Board = function (id, opts) {\n    this.opts = $.extend({}, DrawingBoard.Board.defaultOpts, opts);\n\n    this.ev = new DrawingBoard.Utils.MicroEvent();\n\n    this.id = id;\n    this.$el = $(document.getElementById(id));\n    if (!this.$el.length)\n        return false;\n\n    var tpl = '<div class=\"drawing-board-canvas-wrapper\"></canvas><canvas class=\"drawing-board-canvas\"></canvas><div class=\"drawing-board-cursor drawing-board-utils-hidden\"></div></div>';\n    if (this.opts.controlsPosition.indexOf(\"bottom\") > -1) tpl += '<div class=\"drawing-board-controls\"></div>';\n    else tpl = '<div class=\"drawing-board-controls\"></div>' + tpl;\n\n    this.$el.addClass('drawing-board').append(tpl);\n    this.dom = {\n        $canvasWrapper: this.$el.find('.drawing-board-canvas-wrapper'),\n        $canvas: this.$el.find('.drawing-board-canvas'),\n        $cursor: this.$el.find('.drawing-board-cursor'),\n        $controls: this.$el.find('.drawing-board-controls')\n    };\n\n    $.each(['left', 'right', 'center'], $.proxy(function (n, val) {\n        if (this.opts.controlsPosition.indexOf(val) > -1) {\n            this.dom.$controls.attr('data-align', val);\n            return false;\n        }\n    }, this));\n\n    this.canvas = this.dom.$canvas.get(0);\n    this.ctx = this.canvas && this.canvas.getContext && this.canvas.getContext('2d') ? this.canvas.getContext('2d') : null;\n    this.color = this.opts.color;\n\n    if (!this.ctx) {\n        if (this.opts.errorMessage)\n            this.$el.html(this.opts.errorMessage);\n        return false;\n    }\n\n    this.storage = this._getStorage();\n\n    this.initHistory();\n    //init default board values before controls are added (mostly pencil color and size)\n    this.reset({webStorage: false, history: false, background: false});\n    //init controls (they will need the default board values to work like pencil color and size)\n    this.initControls();\n    //set board's size after the controls div is added\n    this.resize();\n    //reset the board to take all resized space\n    this.reset({webStorage: false, history: true, background: true});\n    this.restoreWebStorage();\n    this.initDropEvents();\n    this.initDrawEvents();\n};\n\n\nDrawingBoard.Board.defaultOpts = {\n    controls: ['Color', 'DrawingMode', 'Size', 'Navigation'],\n    controlsPosition: \"top left\",\n    color: \"#000000\",\n    size: 1,\n    background: \"#fff\",\n    eraserColor: \"background\",\n    webStorage: 'session',\n    droppable: false,\n    enlargeYourContainer: false,\n    errorMessage: \"<p>It seems you use an obsolete browser. <a href=\\\"http://browsehappy.com/\\\" target=\\\"_blank\\\">Update it</a> to start drawing.</p>\"\n};\n\n\nDrawingBoard.Board.prototype = {\n\n    /**\n     * Canvas reset/resize methods: put back the canvas to its default values\n     *\n     * depending on options, can set color, size, background back to default values\n     * and store the reseted canvas in webstorage and history queue\n     *\n     * resize values depend on the `enlargeYourContainer` option\n     */\n\n    reset: function (opts) {\n        opts = $.extend({\n            color: this.opts.color,\n            size: this.opts.size,\n            webStorage: true,\n            history: true,\n            background: false\n        }, opts);\n\n        this.setMode('pencil');\n\n        if (opts.background) this.resetBackground(this.opts.background, false);\n\n        if (opts.color) this.setColor(opts.color);\n        if (opts.size) this.ctx.lineWidth = opts.size;\n\n        this.ctx.lineCap = \"round\";\n        this.ctx.lineJoin = \"round\";\n        // this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.width);\n\n        if (opts.webStorage) this.saveWebStorage();\n\n        if (opts.history) this.saveHistory();\n\n        this.blankCanvas = this.getImg();\n\n        this.ev.trigger('board:reset', opts);\n    },\n\n    resetBackground: function (background, historize) {\n        background = background || this.opts.background;\n        historize = typeof historize !== \"undefined\" ? historize : true;\n        var bgIsColor = DrawingBoard.Utils.isColor(background);\n        var prevMode = this.getMode();\n        this.setMode('pencil');\n        this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.width);\n        if (bgIsColor) {\n            this.ctx.fillStyle = background;\n            this.ctx.fillRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\n        } else if (background)\n            this.setImg(background);\n        this.setMode(prevMode);\n        if (historize) this.saveHistory();\n    },\n\n    resize: function () {\n        this.dom.$controls.toggleClass('drawing-board-controls-hidden', (!this.controls || !this.controls.length));\n\n        var canvasWidth, canvasHeight;\n        var widths = [\n            this.$el.width(),\n            DrawingBoard.Utils.boxBorderWidth(this.$el),\n            DrawingBoard.Utils.boxBorderWidth(this.dom.$canvasWrapper, true, true)\n        ];\n        var heights = [\n            this.$el.height(),\n            DrawingBoard.Utils.boxBorderHeight(this.$el),\n            this.dom.$controls.height(),\n            DrawingBoard.Utils.boxBorderHeight(this.dom.$controls, false, true),\n            DrawingBoard.Utils.boxBorderHeight(this.dom.$canvasWrapper, true, true)\n        ];\n        var that = this;\n        var sum = function (values, multiplier) { //make the sum of all array values\n            multiplier = multiplier || 1;\n            var res = values[0];\n            for (var i = 1; i < values.length; i++) {\n                res = res + (values[i] * multiplier);\n            }\n            return res;\n        };\n        var sub = function (values) {\n            return sum(values, -1);\n        }; //substract all array values from the first one\n\n        if (this.opts.enlargeYourContainer) {\n            canvasWidth = this.$el.width();\n            canvasHeight = this.$el.height();\n\n            this.$el.width(sum(widths));\n            this.$el.height(sum(heights));\n        } else {\n            canvasWidth = sub(widths);\n            canvasHeight = sub(heights);\n        }\n\n        this.dom.$canvasWrapper.css('width', canvasWidth + 'px');\n        this.dom.$canvasWrapper.css('height', canvasHeight + 'px');\n\n        this.dom.$canvas.css('width', canvasWidth + 'px');\n        this.dom.$canvas.css('height', canvasHeight + 'px');\n\n        this.canvas.width = canvasWidth;\n        this.canvas.height = canvasHeight;\n    },\n\n\n    /**\n     * Controls:\n     * the drawing board can has various UI elements to control it.\n     * one control is represented by a class in the namespace DrawingBoard.Control\n     * it must have a $el property (jQuery object), representing the html element to append on the drawing board at initialization.\n     *\n     */\n\n    initControls: function () {\n        this.controls = [];\n        if (!this.opts.controls.length || !DrawingBoard.Control) return false;\n        for (var i = 0; i < this.opts.controls.length; i++) {\n            var c = null;\n            if (typeof this.opts.controls[i] == \"string\")\n                c = new window['DrawingBoard']['Control'][this.opts.controls[i]](this);\n            else if (typeof this.opts.controls[i] == \"object\") {\n                for (var controlName in this.opts.controls[i]) break;\n                c = new window['DrawingBoard']['Control'][controlName](this, this.opts.controls[i][controlName]);\n            }\n            if (c) {\n                this.addControl(c);\n            }\n        }\n    },\n\n    //add a new control or an existing one at the position you want in the UI\n    //to add a totally new control, you can pass a string with the js class as 1st parameter and control options as 2nd ie \"addControl('Navigation', { reset: false }\"\n    //the last parameter (2nd or 3rd depending on the situation) is always the position you want to place the control at\n    addControl: function (control, optsOrPos, pos) {\n        if (typeof control !== \"string\" && (typeof control !== \"object\" || !control instanceof DrawingBoard.Control))\n            return false;\n\n        var opts = typeof optsOrPos == \"object\" ? optsOrPos : {};\n        pos = pos ? pos * 1 : (typeof optsOrPos == \"number\" ? optsOrPos : null);\n\n        if (typeof control == \"string\")\n            control = new window['DrawingBoard']['Control'][control](this, opts);\n\n        if (pos)\n            this.dom.$controls.children().eq(pos).before(control.$el);\n        else\n            this.dom.$controls.append(control.$el);\n\n        if (!this.controls)\n            this.controls = [];\n        this.controls.push(control);\n        this.dom.$controls.removeClass('drawing-board-controls-hidden');\n    },\n\n\n    /**\n     * History methods: undo and redo drawed lines\n     */\n\n    initHistory: function () {\n        this.history = {\n            values: [],\n            position: 0\n        };\n    },\n\n    saveHistory: function () {\n        while (this.history.values.length > 30) {\n            this.history.values.shift();\n            this.history.position--;\n        }\n        if (this.history.position !== 0 && this.history.position < this.history.values.length) {\n            this.history.values = this.history.values.slice(0, this.history.position);\n            this.history.position++;\n        } else {\n            this.history.position = this.history.values.length + 1;\n        }\n        this.history.values.push(this.getImg());\n        this.ev.trigger('historyNavigation', this.history.position);\n    },\n\n    _goThroughHistory: function (goForth) {\n        if ((goForth && this.history.position == this.history.values.length) ||\n            (!goForth && this.history.position == 1))\n            return;\n        var pos = goForth ? this.history.position + 1 : this.history.position - 1;\n        if (this.history.values.length && this.history.values[pos - 1] !== undefined) {\n            this.history.position = pos;\n            this.setImg(this.history.values[pos - 1]);\n        }\n        this.ev.trigger('historyNavigation', pos);\n        this.saveWebStorage();\n    },\n\n    goBackInHistory: function () {\n        this._goThroughHistory(false);\n    },\n\n    goForthInHistory: function () {\n        this._goThroughHistory(true);\n    },\n\n\n    /**\n     * Image methods: you can directly put an image on the canvas, get it in base64 data url or start a download\n     */\n\n    setImg: function (src) {\n        var ctx = this.ctx;\n        var img = new Image();\n        var oldGCO = ctx.globalCompositeOperation;\n        img.onload = function () {\n            ctx.globalCompositeOperation = \"source-over\";\n            ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.width);\n            ctx.drawImage(img, 0, 0);\n            ctx.globalCompositeOperation = oldGCO;\n        };\n        img.src = src;\n    },\n\n    getImg: function () {\n        return this.canvas.toDataURL(\"image/png\");\n    },\n\n    downloadImg: function () {\n        var img = this.getImg();\n        img = img.replace(\"image/png\", \"image/octet-stream\");\n        window.location.href = img;\n    },\n\n\n    /**\n     * WebStorage handling : save and restore to local or session storage\n     */\n\n    saveWebStorage: function () {\n        if (window[this.storage]) {\n            window[this.storage].setItem('drawing-board-' + this.id, this.getImg());\n            this.ev.trigger('board:save' + this.storage.charAt(0).toUpperCase() + this.storage.slice(1), this.getImg());\n        }\n    },\n\n    restoreWebStorage: function () {\n        if (window[this.storage] && window[this.storage].getItem('drawing-board-' + this.id) !== null) {\n            this.setImg(window[this.storage].getItem('drawing-board-' + this.id));\n            this.ev.trigger('board:restore' + this.storage.charAt(0).toUpperCase() + this.storage.slice(1), window[this.storage].getItem('drawing-board-' + this.id));\n        }\n    },\n\n    clearWebStorage: function () {\n        if (window[this.storage] && window[this.storage].getItem('drawing-board-' + this.id) !== null) {\n            window[this.storage].removeItem('drawing-board-' + this.id);\n            this.ev.trigger('board:clear' + this.storage.charAt(0).toUpperCase() + this.storage.slice(1));\n        }\n    },\n\n    _getStorage: function () {\n        if (!this.opts.webStorage || !(this.opts.webStorage === 'session' || this.opts.webStorage === 'local')) return false;\n        return this.opts.webStorage + 'Storage';\n    },\n\n\n    /**\n     * Drop an image on the canvas to draw on it\n     */\n\n    initDropEvents: function () {\n        if (!this.opts.droppable)\n            return false;\n\n        this.dom.$canvas.on('dragover dragenter drop', function (e) {\n            e.stopPropagation();\n            e.preventDefault();\n        });\n\n        this.dom.$canvas.on('drop', $.proxy(this._onCanvasDrop, this));\n    },\n\n    _onCanvasDrop: function (e) {\n        e = e.originalEvent ? e.originalEvent : e;\n        var files = e.dataTransfer.files;\n        if (!files || !files.length || files[0].type.indexOf('image') == -1 || !window.FileReader)\n            return false;\n        var fr = new FileReader();\n        fr.readAsDataURL(files[0]);\n        fr.onload = $.proxy(function (ev) {\n            this.setImg(ev.target.result);\n            this.ev.trigger('board:imageDropped', ev.target.result);\n            this.ev.trigger('board:userAction');\n            this.saveHistory();\n        }, this);\n    },\n\n\n    /**\n     * set and get current drawing mode\n     *\n     * possible modes are \"pencil\" (draw normally), \"eraser\" (draw transparent, like, erase, you know), \"filler\" (paint can)\n     */\n\n    setMode: function (newMode, silent) {\n        silent = silent || false;\n        newMode = newMode || 'pencil';\n\n        this.ev.unbind('board:startDrawing', $.proxy(this.fill, this));\n\n        if (this.opts.eraserColor === \"transparent\")\n            this.ctx.globalCompositeOperation = newMode === \"eraser\" ? \"destination-out\" : \"source-over\";\n        else {\n            if (newMode === \"eraser\") {\n                if (this.opts.eraserColor === \"background\" && DrawingBoard.Utils.isColor(this.opts.background))\n                    this.ctx.strokeStyle = this.opts.background;\n                else if (DrawingBoard.Utils.isColor(this.opts.eraserColor))\n                    this.ctx.strokeStyle = this.opts.eraserColor;\n            } else if (!this.mode || this.mode === \"eraser\") {\n                this.ctx.strokeStyle = this.color;\n            }\n\n            if (newMode === \"filler\")\n                this.ev.bind('board:startDrawing', $.proxy(this.fill, this));\n        }\n        this.mode = newMode;\n        if (!silent)\n            this.ev.trigger('board:mode', this.mode);\n    },\n\n    getMode: function () {\n        return this.mode || \"pencil\";\n    },\n\n    setColor: function (color) {\n        var that = this;\n        color = color || this.color;\n        if (!DrawingBoard.Utils.isColor(color))\n            return false;\n        this.color = color;\n        if (this.opts.eraserColor !== \"transparent\" && this.mode === \"eraser\") {\n            var setStrokeStyle = function (mode) {\n                if (mode !== \"eraser\")\n                    that.strokeStyle = that.color;\n                that.ev.unbind('board:mode', setStrokeStyle);\n            };\n            this.ev.bind('board:mode', setStrokeStyle);\n        } else\n            this.ctx.strokeStyle = this.color;\n    },\n\n    /**\n     * Fills an area with the current stroke color.\n     */\n    fill: function (e) {\n        if (this.getImg() === this.blankCanvas) {\n            this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.width);\n            this.ctx.fillStyle = this.color;\n            this.ctx.fillRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\n            return;\n        }\n\n        var img = this.ctx.getImageData(0, 0, this.canvas.width, this.canvas.height);\n\n        // constants identifying pixels components\n        var INDEX = 0, X = 1, Y = 2, COLOR = 3;\n\n        // target color components\n        var stroke = this.ctx.strokeStyle;\n        var r = parseInt(stroke.substr(1, 2), 16);\n        var g = parseInt(stroke.substr(3, 2), 16);\n        var b = parseInt(stroke.substr(5, 2), 16);\n\n        // starting point\n        var start = DrawingBoard.Utils.pixelAt(img, parseInt(e.coords.x, 10), parseInt(e.coords.y, 10));\n\n        // no need to continue if starting and target colors are the same\n        if (start[COLOR] === DrawingBoard.Utils.RGBToInt(r, g, b))\n            return;\n\n        // pixels to evaluate\n        var queue = [start];\n\n        // loop vars\n        var pixel, x, y;\n        var maxX = img.width - 1;\n        var maxY = img.height - 1;\n\n        while ((pixel = queue.pop())) {\n            if (pixel[COLOR] === start[COLOR]) {\n                img.data[pixel[INDEX]] = r;\n                img.data[pixel[INDEX] + 1] = g;\n                img.data[pixel[INDEX] + 2] = b;\n                if (pixel[X] > 0) // west\n                    queue.push(DrawingBoard.Utils.pixelAt(img, pixel[X] - 1, pixel[Y]));\n                if (pixel[X] < maxX) // east\n                    queue.push(DrawingBoard.Utils.pixelAt(img, pixel[X] + 1, pixel[Y]));\n                if (pixel[Y] > 0) // north\n                    queue.push(DrawingBoard.Utils.pixelAt(img, pixel[X], pixel[Y] - 1));\n                if (pixel[Y] < maxY) // south\n                    queue.push(DrawingBoard.Utils.pixelAt(img, pixel[X], pixel[Y] + 1));\n            }\n        }\n\n        this.ctx.putImageData(img, 0, 0);\n    },\n\n\n    /**\n     * Drawing handling, with mouse or touch\n     */\n\n    initDrawEvents: function () {\n        this.isDrawing = false;\n        this.isMouseHovering = false;\n        this.coords = {};\n        this.coords.old = this.coords.current = this.coords.oldMid = {x: 0, y: 0};\n\n        this.dom.$canvas.on('mousedown touchstart', $.proxy(function (e) {\n            this._onInputStart(e, this._getInputCoords(e));\n        }, this));\n\n        this.dom.$canvas.on('mousemove touchmove', $.proxy(function (e) {\n            this._onInputMove(e, this._getInputCoords(e));\n        }, this));\n\n        this.dom.$canvas.on('mousemove', $.proxy(function (e) {\n\n        }, this));\n\n        this.dom.$canvas.on('mouseup touchend', $.proxy(function (e) {\n            this._onInputStop(e, this._getInputCoords(e));\n        }, this));\n\n        this.dom.$canvas.on('mouseover', $.proxy(function (e) {\n            this._onMouseOver(e, this._getInputCoords(e));\n        }, this));\n\n        this.dom.$canvas.on('mouseout', $.proxy(function (e) {\n            this._onMouseOut(e, this._getInputCoords(e));\n\n        }, this));\n\n        $('body').on('mouseup touchend', $.proxy(function (e) {\n            this.isDrawing = false;\n        }, this));\n\n        if (window.requestAnimationFrame) requestAnimationFrame($.proxy(this.draw, this));\n    },\n\n    draw: function () {\n        //if the pencil size is big (>10), the small crosshair makes a friend: a circle of the size of the pencil\n        //todo: have the circle works on every browser - it currently should be added only when CSS pointer-events are supported\n        //we assume that if requestAnimationFrame is supported, pointer-events is too, but this is terribad.\n        if (window.requestAnimationFrame && this.ctx.lineWidth > 10 && this.isMouseHovering) {\n            this.dom.$cursor.css({width: this.ctx.lineWidth + 'px', height: this.ctx.lineWidth + 'px'});\n            var transform = DrawingBoard.Utils.tpl(\"translateX({{x}}px) translateY({{y}}px)\", {\n                x: this.coords.current.x - (this.ctx.lineWidth / 2),\n                y: this.coords.current.y - (this.ctx.lineWidth / 2)\n            });\n            this.dom.$cursor.css({'transform': transform, '-webkit-transform': transform, '-ms-transform': transform});\n            this.dom.$cursor.removeClass('drawing-board-utils-hidden');\n        } else {\n            this.dom.$cursor.addClass('drawing-board-utils-hidden');\n        }\n\n        if (this.isDrawing) {\n            var currentMid = this._getMidInputCoords(this.coords.current);\n            this.ctx.beginPath();\n            this.ctx.moveTo(currentMid.x, currentMid.y);\n            this.ctx.quadraticCurveTo(this.coords.old.x, this.coords.old.y, this.coords.oldMid.x, this.coords.oldMid.y);\n            this.ctx.stroke();\n\n            this.coords.old = this.coords.current;\n            this.coords.oldMid = currentMid;\n        }\n\n        if (window.requestAnimationFrame) requestAnimationFrame($.proxy(function () {\n            this.draw();\n        }, this));\n    },\n\n    _onInputStart: function (e, coords) {\n        this.coords.current = this.coords.old = coords;\n        this.coords.oldMid = this._getMidInputCoords(coords);\n        this.isDrawing = true;\n\n        if (!window.requestAnimationFrame) this.draw();\n\n        this.ev.trigger('board:startDrawing', {e: e, coords: coords});\n        e.preventDefault();\n    },\n\n    _onInputMove: function (e, coords) {\n        this.coords.current = coords;\n        this.ev.trigger('board:drawing', {e: e, coords: coords});\n\n        if (!window.requestAnimationFrame) this.draw();\n\n        e.preventDefault();\n    },\n\n    _onInputStop: function (e, coords) {\n        if (this.isDrawing && (!e.touches || e.touches.length === 0)) {\n            this.isDrawing = false;\n\n            this.saveWebStorage();\n            this.saveHistory();\n\n            this.ev.trigger('board:stopDrawing', {e: e, coords: coords});\n            this.ev.trigger('board:userAction');\n            e.preventDefault();\n        }\n    },\n\n    _onMouseOver: function (e, coords) {\n        this.isMouseHovering = true;\n        this.coords.old = this._getInputCoords(e);\n        this.coords.oldMid = this._getMidInputCoords(this.coords.old);\n\n        this.ev.trigger('board:mouseOver', {e: e, coords: coords});\n    },\n\n    _onMouseOut: function (e, coords) {\n        this.isMouseHovering = false;\n\n        this.ev.trigger('board:mouseOut', {e: e, coords: coords});\n    },\n\n    _getInputCoords: function (e) {\n        e = e.originalEvent ? e.originalEvent : e;\n        var x, y;\n        if (e.touches && e.touches.length == 1) {\n            x = e.touches[0].pageX;\n            y = e.touches[0].pageY;\n        } else {\n            x = e.pageX;\n            y = e.pageY;\n        }\n        return {\n            x: x - this.dom.$canvas.offset().left,\n            y: y - this.dom.$canvas.offset().top\n        };\n    },\n\n    _getMidInputCoords: function (coords) {\n        return {\n            x: this.coords.old.x + coords.x >> 1,\n            y: this.coords.old.y + coords.y >> 1\n        };\n    }\n};\n\nDrawingBoard.Control = function (drawingBoard, opts) {\n    this.board = drawingBoard;\n    this.opts = $.extend({}, this.defaults, opts);\n\n    this.$el = $(document.createElement('div')).addClass('drawing-board-control');\n    if (this.name)\n        this.$el.addClass('drawing-board-control-' + this.name);\n\n    this.board.ev.bind('board:reset', $.proxy(this.onBoardReset, this));\n\n    this.initialize.apply(this, arguments);\n    return this;\n};\n\nDrawingBoard.Control.prototype = {\n\n    name: '',\n\n    defaults: {},\n\n    initialize: function () {\n\n    },\n\n    addToBoard: function () {\n        this.board.addControl(this);\n    },\n\n    onBoardReset: function (opts) {\n\n    }\n\n};\n\n//extend directly taken from backbone.js\nDrawingBoard.Control.extend = function (protoProps, staticProps) {\n    var parent = this;\n    var child;\n    if (protoProps && protoProps.hasOwnProperty('constructor')) {\n        child = protoProps.constructor;\n    } else {\n        child = function () {\n            return parent.apply(this, arguments);\n        };\n    }\n    $.extend(child, parent, staticProps);\n    var Surrogate = function () {\n        this.constructor = child;\n    };\n    Surrogate.prototype = parent.prototype;\n    child.prototype = new Surrogate();\n    if (protoProps) $.extend(child.prototype, protoProps);\n    child.__super__ = parent.prototype;\n    return child;\n};\nDrawingBoard.Control.Color = DrawingBoard.Control.extend({\n    name: 'colors',\n\n    initialize: function () {\n        this.initTemplate();\n\n        var that = this;\n        this.$el.on('click', '.drawing-board-control-colors-picker', function (e) {\n            var color = $(this).attr('data-color');\n            that.board.setColor(color);\n            that.$el.find('.drawing-board-control-colors-current')\n                .css('background-color', color)\n                .attr('data-color', color);\n\n            that.board.ev.trigger('color:changed', color);\n            that.$el.find('.drawing-board-control-colors-rainbows').addClass('drawing-board-utils-hidden');\n\n            e.preventDefault();\n        });\n\n        this.$el.on('click', '.drawing-board-control-colors-current', function (e) {\n            that.$el.find('.drawing-board-control-colors-rainbows').toggleClass('drawing-board-utils-hidden');\n            e.preventDefault();\n        });\n\n        $('body').on('click', function (e) {\n            var $target = $(e.target);\n            var $relatedButton = $target.hasClass('drawing-board-control-colors-current') ? $target : $target.closest('.drawing-board-control-colors-current');\n            var $myButton = that.$el.find('.drawing-board-control-colors-current');\n            var $popup = that.$el.find('.drawing-board-control-colors-rainbows');\n            if ((!$relatedButton.length || $relatedButton.get(0) !== $myButton.get(0)) && !$popup.hasClass('drawing-board-utils-hidden'))\n                $popup.addClass('drawing-board-utils-hidden');\n        });\n    },\n\n    initTemplate: function () {\n        var tpl = '<div class=\"drawing-board-control-inner\">' +\n            '<div class=\"drawing-board-control-colors-current\" style=\"background-color: {{color}}\" data-color=\"{{color}}\"></div>' +\n            '<div class=\"drawing-board-control-colors-rainbows\">{{rainbows}}</div>' +\n            '</div>';\n        var oneColorTpl = '<div class=\"drawing-board-control-colors-picker\" data-color=\"{{color}}\" style=\"background-color: {{color}}\"></div>';\n        var rainbows = '';\n        $.each([0.75, 0.5, 0.25], $.proxy(function (key, val) {\n            var i = 0;\n            var additionalColor = null;\n            rainbows += '<div class=\"drawing-board-control-colors-rainbow\">';\n            if (val == 0.25) additionalColor = this._rgba(0, 0, 0, 1);\n            if (val == 0.5) additionalColor = this._rgba(150, 150, 150, 1);\n            if (val == 0.75) additionalColor = this._rgba(255, 255, 255, 1);\n            rainbows += DrawingBoard.Utils.tpl(oneColorTpl, {color: additionalColor.toString()});\n            while (i <= 330) {\n                rainbows += DrawingBoard.Utils.tpl(oneColorTpl, {color: this._hsl2Rgba(this._hsl(i - 60, 1, val)).toString()});\n                i += 30;\n            }\n            rainbows += '</div>';\n        }, this));\n\n        this.$el.append($(DrawingBoard.Utils.tpl(tpl, {color: this.board.color, rainbows: rainbows})));\n        this.$el.find('.drawing-board-control-colors-rainbows').addClass('drawing-board-utils-hidden');\n    },\n\n    onBoardReset: function (opts) {\n        this.board.setColor(this.$el.find('.drawing-board-control-colors-current').attr('data-color'));\n    },\n\n    _rgba: function (r, g, b, a) {\n        return {\n            r: r, g: g, b: b, a: a, toString: function () {\n                return \"rgba(\" + r + \", \" + g + \", \" + b + \", \" + a + \")\";\n            }\n        };\n    },\n\n    _hsl: function (h, s, l) {\n        return {\n            h: h, s: s, l: l, toString: function () {\n                return \"hsl(\" + h + \", \" + s * 100 + \"%, \" + l * 100 + \"%)\";\n            }\n        };\n    },\n\n    _hex2Rgba: function (hex) {\n        var num = parseInt(hex.substring(1), 16);\n        return this._rgba(num >> 16, num >> 8 & 255, num & 255, 1);\n    },\n\n    //conversion function (modified a bit) taken from http://mjijackson.com/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript\n    _hsl2Rgba: function (hsl) {\n        var h = hsl.h / 360, s = hsl.s, l = hsl.l, r, g, b;\n\n        function hue2rgb(p, q, t) {\n            if (t < 0) t += 1;\n            if (t > 1) t -= 1;\n            if (t < 1 / 6) return p + (q - p) * 6 * t;\n            if (t < 1 / 2) return q;\n            if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;\n            return p;\n        }\n\n        if (s === 0) {\n            r = g = b = l; // achromatic\n        } else {\n            var q = l < 0.5 ? l * (1 + s) : l + s - l * s;\n            var p = 2 * l - q;\n            r = Math.floor((hue2rgb(p, q, h + 1 / 3)) * 255);\n            g = Math.floor((hue2rgb(p, q, h)) * 255);\n            b = Math.floor((hue2rgb(p, q, h - 1 / 3)) * 255);\n        }\n        return this._rgba(r, g, b, 1);\n    }\n});\nDrawingBoard.Control.DrawingMode = DrawingBoard.Control.extend({\n\n    name: 'drawingmode',\n\n    defaults: {\n        pencil: true,\n        eraser: true,\n        filler: true\n    },\n\n    initialize: function () {\n\n        this.prevMode = this.board.getMode();\n\n        $.each([\"pencil\", \"eraser\", \"filler\"], $.proxy(function (k, value) {\n            if (this.opts[value]) {\n                this.$el.append('<button class=\"drawing-board-control-drawingmode-' + value + '-button\" data-mode=\"' + value + '\"></button>');\n            }\n        }, this));\n\n        this.$el.on('click', 'button[data-mode]', $.proxy(function (e) {\n            var value = $(e.currentTarget).attr('data-mode');\n            var mode = this.board.getMode();\n            if (mode !== value) this.prevMode = mode;\n            var newMode = mode === value ? this.prevMode : value;\n            this.board.setMode(newMode);\n            e.preventDefault();\n        }, this));\n\n        this.board.ev.bind('board:mode', $.proxy(function (mode) {\n            this.toggleButtons(mode);\n        }, this));\n\n        this.toggleButtons(this.board.getMode());\n    },\n\n    toggleButtons: function (mode) {\n        this.$el.find('button[data-mode]').each(function (k, item) {\n            var $item = $(item);\n            $item.toggleClass('active', mode === $item.attr('data-mode'));\n        });\n    }\n\n});\n\nDrawingBoard.Control.Navigation = DrawingBoard.Control.extend({\n\n    name: 'navigation',\n\n    defaults: {\n        back: true,\n        forward: true,\n        reset: true\n    },\n\n    initialize: function () {\n        var el = '';\n        if (this.opts.back) el += '<button class=\"drawing-board-control-navigation-back\">&larr;</button>';\n        if (this.opts.forward) el += '<button class=\"drawing-board-control-navigation-forward\">&rarr;</button>';\n        if (this.opts.reset) el += '<button class=\"drawing-board-control-navigation-reset\">&times;</button>';\n        this.$el.append(el);\n\n        if (this.opts.back) {\n            var $back = this.$el.find('.drawing-board-control-navigation-back');\n            this.board.ev.bind('historyNavigation', $.proxy(function (pos) {\n                if (pos === 1)\n                    $back.attr('disabled', 'disabled');\n                else\n                    $back.removeAttr('disabled');\n            }, this));\n            this.$el.on('click', '.drawing-board-control-navigation-back', $.proxy(function (e) {\n                this.board.goBackInHistory();\n                e.preventDefault();\n            }, this));\n        }\n\n        if (this.opts.forward) {\n            var $forward = this.$el.find('.drawing-board-control-navigation-forward');\n            this.board.ev.bind('historyNavigation', $.proxy(function (pos) {\n                if (pos === this.board.history.values.length)\n                    $forward.attr('disabled', 'disabled');\n                else\n                    $forward.removeAttr('disabled');\n            }, this));\n            this.$el.on('click', '.drawing-board-control-navigation-forward', $.proxy(function (e) {\n                this.board.goForthInHistory();\n                e.preventDefault();\n            }, this));\n        }\n\n        if (this.opts.reset) {\n            this.$el.on('click', '.drawing-board-control-navigation-reset', $.proxy(function (e) {\n                this.board.reset({background: true});\n                e.preventDefault();\n            }, this));\n        }\n    }\n});\nDrawingBoard.Control.Size = DrawingBoard.Control.extend({\n\n    name: 'size',\n\n    defaults: {\n        type: \"auto\",\n        dropdownValues: [1, 3, 6, 10, 20, 30, 40, 50]\n    },\n\n    types: ['dropdown', 'range'],\n\n    initialize: function () {\n        if (this.opts.type == \"auto\")\n            this.opts.type = this._iHasRangeInput() ? 'range' : 'dropdown';\n        var tpl = $.inArray(this.opts.type, this.types) > -1 ? this['_' + this.opts.type + 'Template']() : false;\n        if (!tpl) return false;\n\n        this.val = this.board.opts.size;\n\n        this.$el.append($(tpl));\n        this.$el.attr('data-drawing-board-type', this.opts.type);\n        this.updateView();\n\n        var that = this;\n\n        if (this.opts.type == \"range\") {\n            this.$el.on('change', '.drawing-board-control-size-range-input', function (e) {\n                that.val = $(this).val();\n                that.updateView();\n\n                that.board.ev.trigger('size:changed', that.val);\n\n                e.preventDefault();\n            });\n        }\n\n        if (this.opts.type == \"dropdown\") {\n            this.$el.on('click', '.drawing-board-control-size-dropdown-current', $.proxy(function (e) {\n                this.$el.find('.drawing-board-control-size-dropdown').toggleClass('drawing-board-utils-hidden');\n            }, this));\n\n            this.$el.on('click', '[data-size]', function (e) {\n                that.val = parseInt($(this).attr('data-size'), 0);\n                that.updateView();\n\n                that.board.ev.trigger('size:changed', that.val);\n\n                e.preventDefault();\n            });\n        }\n    },\n\n    _rangeTemplate: function () {\n        var tpl = '<div class=\"drawing-board-control-inner\" title=\"{{size}}\">' +\n            '<input type=\"range\" min=\"1\" max=\"50\" value=\"{{size}}\" step=\"1\" class=\"drawing-board-control-size-range-input\">' +\n            '<span class=\"drawing-board-control-size-range-current\"></span>' +\n            '</div>';\n        return DrawingBoard.Utils.tpl(tpl, {size: this.board.opts.size});\n    },\n\n    _dropdownTemplate: function () {\n        var tpl = '<div class=\"drawing-board-control-inner\" title=\"{{size}}\">' +\n            '<div class=\"drawing-board-control-size-dropdown-current\"><span></span></div>' +\n            '<ul class=\"drawing-board-control-size-dropdown\">';\n        $.each(this.opts.dropdownValues, function (i, size) {\n            tpl += DrawingBoard.Utils.tpl(\n                '<li data-size=\"{{size}}\"><span style=\"width: {{size}}px; height: {{size}}px; border-radius: {{size}}px;\"></span></li>',\n                {size: size}\n            );\n        });\n        tpl += '</ul></div>';\n        return tpl;\n    },\n\n    onBoardReset: function (opts) {\n        this.updateView();\n    },\n\n    updateView: function () {\n        var val = this.val;\n        this.board.ctx.lineWidth = val;\n\n        this.$el.find('.drawing-board-control-size-range-current, .drawing-board-control-size-dropdown-current span').css({\n            width: val + 'px',\n            height: val + 'px',\n            borderRadius: val + 'px',\n            marginLeft: -1 * val / 2 + 'px',\n            marginTop: -1 * val / 2 + 'px'\n        });\n\n        this.$el.find('.drawing-board-control-inner').attr('title', val);\n\n        if (this.opts.type == 'dropdown') {\n            var closest = null;\n            $.each(this.opts.dropdownValues, function (i, size) {\n                if (closest === null || Math.abs(size - val) < Math.abs(closest - val))\n                    closest = size;\n            });\n            this.$el.find('.drawing-board-control-size-dropdown').addClass('drawing-board-utils-hidden');\n        }\n    },\n\n    _iHasRangeInput: function () {\n        var inputElem = document.createElement('input'),\n            smile = ':)',\n            docElement = document.documentElement,\n            inputElemType = 'range',\n            available;\n        inputElem.setAttribute('type', inputElemType);\n        available = inputElem.type !== 'text';\n        inputElem.value = smile;\n        inputElem.style.cssText = 'position:absolute;visibility:hidden;';\n        if (/^range$/.test(inputElemType) && inputElem.style.WebkitAppearance !== undefined) {\n            docElement.appendChild(inputElem);\n            defaultView = document.defaultView;\n            available = defaultView.getComputedStyle &&\n                defaultView.getComputedStyle(inputElem, null).WebkitAppearance !== 'textfield' &&\n                (inputElem.offsetHeight !== 0);\n            docElement.removeChild(inputElem);\n        }\n        return !!available;\n    }\n});\nDrawingBoard.Control.Download = DrawingBoard.Control.extend({\n\n    name: 'download',\n\n    initialize: function () {\n        this.$el.append('<button class=\"drawing-board-control-download-button\"></button>');\n        this.$el.on('click', '.drawing-board-control-download-button', $.proxy(function (e) {\n            this.board.downloadImg();\n            e.preventDefault();\n        }, this));\n    }\n\n});\nDrawingBoard.Utils = {};\n\n/*!\n* Tim (lite)\n*   github.com/premasagar/tim\n*/\n/*\n\tA tiny, secure JavaScript micro-templating script.\n*/\nDrawingBoard.Utils.tpl = (function () {\n    \"use strict\";\n\n    var start = \"{{\",\n        end = \"}}\",\n        path = \"[a-z0-9_][\\\\.a-z0-9_]*\", // e.g. config.person.name\n        pattern = new RegExp(start + \"\\\\s*(\" + path + \")\\\\s*\" + end, \"gi\"),\n        undef;\n\n    return function (template, data) {\n        // Merge data into the template string\n        return template.replace(pattern, function (tag, token) {\n            var path = token.split(\".\"),\n                len = path.length,\n                lookup = data,\n                i = 0;\n\n            for (; i < len; i++) {\n                lookup = lookup[path[i]];\n\n                // Property not found\n                if (lookup === undef) {\n                    throw \"tim: '\" + path[i] + \"' not found in \" + tag;\n                }\n\n                // Return the required value\n                if (i === len - 1) {\n                    return lookup;\n                }\n            }\n        });\n    };\n}());\n\n/**\n * https://github.com/jeromeetienne/microevent.js\n * MicroEvent - to make any js object an event emitter (server or browser)\n *\n * - pure javascript - server compatible, browser compatible\n * - dont rely on the browser doms\n * - super simple - you get it immediatly, no mistery, no magic involved\n *\n * - create a MicroEventDebug with goodies to debug\n *   - make it safer to use\n */\nDrawingBoard.Utils.MicroEvent = function () {\n};\n\nDrawingBoard.Utils.MicroEvent.prototype = {\n    bind: function (event, fct) {\n        this._events = this._events || {};\n        this._events[event] = this._events[event] || [];\n        this._events[event].push(fct);\n    },\n    unbind: function (event, fct) {\n        this._events = this._events || {};\n        if (event in this._events === false) return;\n        this._events[event].splice(this._events[event].indexOf(fct), 1);\n    },\n    trigger: function (event /* , args... */) {\n        this._events = this._events || {};\n        if (event in this._events === false) return;\n        for (var i = 0; i < this._events[event].length; i++) {\n            this._events[event][i].apply(this, Array.prototype.slice.call(arguments, 1));\n        }\n    }\n};\n\n//I know.\nDrawingBoard.Utils._boxBorderSize = function ($el, withPadding, withMargin, direction) {\n    withPadding = !!withPadding || true;\n    withMargin = !!withMargin || false;\n    var width = 0,\n        props;\n    if (direction == \"width\") {\n        props = ['border-left-width', 'border-right-width'];\n        if (withPadding) props.push('padding-left', 'padding-right');\n        if (withMargin) props.push('margin-left', 'margin-right');\n    } else {\n        props = ['border-top-width', 'border-bottom-width'];\n        if (withPadding) props.push('padding-top', 'padding-bottom');\n        if (withMargin) props.push('margin-top', 'margin-bottom');\n    }\n    for (var i = props.length - 1; i >= 0; i--)\n        width += parseInt($el.css(props[i]).replace('px', ''), 10);\n    return width;\n};\n\nDrawingBoard.Utils.boxBorderWidth = function ($el, withPadding, withMargin) {\n    return DrawingBoard.Utils._boxBorderSize($el, withPadding, withMargin, 'width');\n};\n\nDrawingBoard.Utils.boxBorderHeight = function ($el, withPadding, withMargin) {\n    return DrawingBoard.Utils._boxBorderSize($el, withPadding, withMargin, 'height');\n};\n\nDrawingBoard.Utils.isColor = function (string) {\n    if (!string || !string.length) return false;\n    return (/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i).test(string) || $.inArray(string.substring(0, 3), ['rgb', 'hsl']) !== -1;\n};\n\n/**\n * Packs an RGB color into a single integer.\n */\nDrawingBoard.Utils.RGBToInt = function (r, g, b) {\n    var c = 0;\n    c |= (r & 255) << 16;\n    c |= (g & 255) << 8;\n    c |= (b & 255);\n    return c;\n};\n\n/**\n * Returns informations on the pixel located at (x,y).\n */\nDrawingBoard.Utils.pixelAt = function (image, x, y) {\n    var i = (y * image.width + x) * 4;\n    var c = DrawingBoard.Utils.RGBToInt(\n        image.data[i],\n        image.data[i + 1],\n        image.data[i + 2]\n    );\n\n    return [\n        i, // INDEX\n        x, // X\n        y, // Y\n        c  // COLOR\n    ];\n};\n\n(function () {\n    var lastTime = 0;\n    var vendors = ['ms', 'moz', 'webkit', 'o'];\n    for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\n        window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];\n        window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] || window[vendors[x] + 'CancelRequestAnimationFrame'];\n    }\n}());\n//original code stops here\n    var g;\n    if (typeof window !== \"undefined\") {\n        g = window\n    } else if (typeof global !== \"undefined\") {\n        g = global\n    } else if (typeof self !== \"undefined\") {\n        g = self\n    } else {\n        g = this\n    }\n    g.DrawingBoard = DrawingBoard;\n\n  // This is our factory method. Return our module object here...\n  return DrawingBoard;\n\n});\n"],"file":"drawingboard.min.js"}