define(["jquery","core/log","filter_poodll/dlg_poodll"],(function($,log,dialog){return log.debug("Device settings dialog: initialising"),{dlg:null,pmr:null,instanceprops:null,dlgbox:null,mediatype:null,init:function(pmr,instanceprops){this.dlg=dialog.clone(),this.dlg.setHeader("settings"),this.pmr=pmr,this.instanceprops=instanceprops,this.mediatype=instanceprops.config.mediatype},clone:function(){return $.extend(!0,{},this)},fetch_dialogue_box:function(){return this.dlg.fetch_dialogue_box("settings")},set_dialogue_box:function(dlgbox){this.dlgbox=dlgbox,this.dlg.set_dialogue_box(dlgbox)},set_media_type:function(mediatype){this.mediatype=mediatype},open:function(){var self=this;this.instanceprops;navigator.mediaDevices.enumerateDevices().then((function(devices){var audiodevices=[],videodevices=[];devices.forEach((function(device){switch(device.kind){case"audioinput":audiodevices.push(device);break;case"videoinput":videodevices.push(device)}}));var audioselect='<div class="devicesettings_select"><span class="devicesettings_select_label">Audio: </span>'+self.makeSelect(audiodevices,"audio")+"</div>",videoselect='<div class="devicesettings_select"><span class="devicesettings_select_label">Video: </span>'+self.makeSelect(videodevices,"video")+"</div>",content='<div class="filter_poodll_mediadevices">';"video"==self.mediatype?content+=audioselect+"<br>"+videoselect:content+=audioselect,content+="</div>",self.dlg.setContent(content),self.registerEvents(),"video"==self.mediatype&&(self.dlg.onclose=function(){self.resetVideoUserInterface()}),self.dlg.open()})).catch((function(e){log.debug(e)}))},registerEvents:function(){var self=this,ip=this.instanceprops,preview=ip.controlbar.preview[0];preview&&preview.pause(),ip.mediaRecorder&&ip.mediaRecorder.stop(),this.dlgbox.find(".select_settings_audio").change((function(){self.instanceprops.useraudiodeviceid=this.value})),this.dlgbox.find(".select_settings_video").change((function(){self.instanceprops.uservideodeviceid=this.value}))},resetVideoUserInterface:function(){var ip=this.instanceprops,pmr=(ip.controlbar.preview[0],this.pmr),constraints=pmr.fetch_video_constraints(ip);pmr.tidy_old_stream(ip.controlbarid),navigator.mediaDevices.getUserMedia(constraints).then((function(stream){pmr.restream_preview_video_player(ip.controlbarid,stream)})).catch((function(err){log.debug("location 4567"),log.debug(err)}))},makeSelect:function(devices,devicetype){if(1==devices.length&&""==devices[0].label)return"<div>No devices available yet.</div>";switch(devicetype){case"audio":var userdeviceid=this.instanceprops.useraudiodeviceid;break;case"video":userdeviceid=this.instanceprops.uservideodeviceid}var dlg_dropdown='<select class="select_settings_'+devicetype+'">';return devices.forEach((function(device){var selected="";userdeviceid==device.deviceId&&(selected="selected"),dlg_dropdown+='<option value="'+device.deviceId+'"  '+selected+">"+device.label+"</option>"})),dlg_dropdown+="</select>"}}}));

//# sourceMappingURL=dlg_devicesettings.min.js.map