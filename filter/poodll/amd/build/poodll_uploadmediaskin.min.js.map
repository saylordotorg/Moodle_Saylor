{"version":3,"sources":["../src/poodll_uploadmediaskin.js"],"names":["define","$","log","utils","upskin_radial","dd","debug","instanceprops","pmr","clone","extend","init","ip","fetch_status_bar","fetch_preview_audio","fetch_preview_video","fetch_resource_audio","fetch_resource_video","fetch_uploader_skin","controlbarid","element","fetch_instance_props","upskin","config","controlbar","uploadcanvas","uploadmessages","setDrawParam","handle_timer_update","onUploadSuccess","hide","show","onUploadFailure","onMediaSuccess_video","onMediaSuccess_audio","insert_controlbar_video","preview","resource","prepare_controlbar","insert_controlbar_audio","register_controlbar_events_video","onMediaSuccess","register_events","register_controlbar_events_audio","mediatype","acceptmedia","iOS","test","navigator","userAgent","window","MSStream","is_ios","is_android","ss_chooselabel","M","util","get_string","skin_style","media_skin_style","recorder_class","controls","errordialog","fetch_dialogue_box","canvaswidth","canvasheight","prepend","errorsdialog","filebutton","startbutton","set_dialogue_box","self","hermes","enable","on","e","files","target","dataTransfer","FileSelectHandler","uploader","turnoff_dragdrop","off","attr","i","file","type","uploadBlob"],"mappings":"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","sourcesContent":["/* jshint ignore:start */\ndefine(['jquery', 'core/log', 'filter_poodll/utils_amd', 'filter_poodll/upskin_radial', 'filter_poodll/util_dragdrop'],\n    function ($,  log, utils, upskin_radial, dd) {\n\n        \"use strict\"; // jshint ;_;\n\n        log.debug('PoodLL Upload Media skin: initialising');\n\n        return {\n\n\n            instanceprops: null,\n            pmr: null,\n\n            //for making multiple instances\n            clone: function () {\n                return $.extend(true, {}, this);\n            },\n\n            init: function (ip, pmr) {\n                this.instanceprops = ip;\n                this.pmr = pmr;\n            },\n\n\n            fetch_status_bar: function (skinname) {\n                var status = '';\n                return status;\n            },\n\n            fetch_preview_audio: function (skinname) {\n                var preview = '';\n                return preview;\n            },\n            fetch_preview_video: function (skinname) {\n                var preview = '';\n                return preview;\n            },\n            fetch_resource_audio: function (skinname) {\n                var resourceplayer = '';\n                return resourceplayer;\n            },\n            fetch_resource_video: function (skinname) {\n                var resourceplayer = '';\n                return resourceplayer;\n            },\n\n            fetch_uploader_skin: function (controlbarid, element) {\n                var ip = this.fetch_instance_props();\n                var upskin = upskin_radial.clone();\n                upskin.init(ip.config, element, ip.controlbar.uploadcanvas, ip.controlbar.uploadmessages);\n                upskin.setDrawParam('lineWidth', 2);\n                upskin.setDrawParam('font', '14px Arial');\n                return upskin;\n            },\n            handle_timer_update: function (controlbarid) {\n                //do nothing\n            },\n            onUploadSuccess: function (controlbarid) {\n                $('#' + controlbarid + ' > .poodll_save-recording').hide();\n                $('#' + controlbarid + ' > .poodll_savedsuccessfully').show();\n            },\n\n            onUploadFailure: function (controlbarid) {\n                return;\n            },\n            onMediaSuccess_video: function (controlbarid) {\n                //this should never be called\n            },\n\n            onMediaSuccess_audio: function (controlbarid) {\n                //this should never be called\n            },\n\n            //insert the control bar and return it to be reused\n            insert_controlbar_video: function (element, controlbarid, preview, resource) {\n                var controlbar = this.prepare_controlbar(element, controlbarid, preview, resource, 'video');\n                return controlbar;\n            },\n            //insert the control bar and return it to be reused\n            insert_controlbar_audio: function (element, controlbarid, preview, resource) {\n                var controlbar = this.prepare_controlbar(element, controlbarid, preview, resource, 'audio');\n                return controlbar;\n            },\n            register_controlbar_events_video: function (onMediaSuccess, controlbarid) {\n                return this.register_events(controlbarid);\n            },\n\n            register_controlbar_events_audio: function (onMediaSuccess, controlbarid) {\n                return this.register_events(controlbarid);\n            },\n\n            fetch_instance_props: function () {\n                return this.instanceprops;\n            },\n\n            prepare_controlbar: function (element, controlbarid, preview, resource, mediatype) {\n                var ip = this.fetch_instance_props();\n\n                //what media are we accepting and how to display that\n                var acceptmedia = '';\n                switch (mediatype) {\n                    case 'video':\n                        acceptmedia = 'video/webm,video/ogg,video/mp4,video/x-m4v,video/*';\n                        break;\n                    case 'snapshot':\n                    case 'image':\n                        acceptmedia = 'image/*';\n                    case 'audio':\n                        var iOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;\n                        if (iOS) {\n                            acceptmedia = 'video/*';\n                        } else {\n                            acceptmedia = 'audio/*';\n                        }\n                    default:\n                        acceptmedia = '';\n                }\n\n                //strings for UI\n                if (utils.is_ios() || utils.is_android()) {\n                    var ss_chooselabel = M.util.get_string('recui_recordorchoose', 'filter_poodll');\n                } else {\n                    var ss_chooselabel = M.util.get_string('recui_choosefile', 'filter_poodll');\n                }\n\n                //styles and classes\n                var skin_style = ip.config.media_skin_style;\n                var recorder_class = mediatype == 'video' ? 'poodll_mediarecorder_video' : 'poodll_mediarecorder_audio';\n                var size_class = 'poodll_mediarecorder_size_auto';\n\n                //the controls (all the html)\n                var controls = '<div class=\"poodll_mediarecorderholder_upload '\n                    + recorder_class + '\" id=\"holder_' + controlbarid + '\">';\n\n                controls += '<div class=\"poodll_mediarecorderbox_upload\" id=\"' + controlbarid + '\">';\n                controls += ip.errordialog.fetch_dialogue_box();\n                controls += '<div class=\"style-holder ' + skin_style + '\">';\n\n                if (mediatype == 'audio') {\n                    var canvaswidth = 250;\n                    var canvasheight = 50;\n                } else {\n                    var canvaswidth = 130;\n                    var canvasheight = 210;\n                }\n                //we keep the canvas same height as video, but narrowe so the radial stays under the timer (we center it with CSS)\n                controls += '<div class=\"poodll_mediarecorder_uploadcanvas_cont_upload\"><canvas id=\"' + controlbarid + '_uploadcanvas\" width=\"' + canvaswidth + '\" height=\"'\n                    + canvasheight + '\" class=\"poodll_mediarecorder_uploadcanvas_upload\"></canvas></div>';\n                //upload button/s proper\n                controls += '<div class=\"p_btn_wrapper\">';\n                controls += '<input type=\"file\" id=\"' + controlbarid + '_poodllfileselect\" name=\"poodllfileselect[]\" accept=\"' + acceptmedia + '\"/>';\n                controls += '<button type=\"button\" id=\"' + controlbarid + '_p_btn\" class=\"p_btn\">' + ss_chooselabel + '</button>';\n                controls += '</div>';\n\n                controls += '<div class=\"poodll_uploadmessages_once\"></div>';\n\n                controls += '</div></div></div>';\n\n                //put the html on the page\n                $(element).prepend(controls);\n\n\n                //get a handle on the controls and return the collection\n                var controlbar = {\n                    errorsdialog: $('#' + controlbarid + ' .poodll_dialogue_box_errors'),\n                    filebutton: $('#' + controlbarid + '_poodllfileselect'),\n                    startbutton: $('#' + controlbarid + '_p_btn'),\n                    uploadcanvas: $('#' + controlbarid + '_uploadcanvas'),\n                    uploadmessages: $('#' + controlbarid + ' .poodll_uploadmessages_once'),\n                };\n\n                //settings and error dialogs\n                //They use the same dialog and just fill it with diofferent stuff\n                //settings is on 'this' because it is shown from skkn events, but errors are from pmr stuff\n                ip.errordialog.set_dialogue_box(controlbar.errorsdialog);\n                return controlbar;\n            },\n\n\n            // handle audio/video/image file uploads for Mobile\n            register_events: function (controlbarid) {\n                var self = this;\n                var pmr = this.pmr;\n                var ip = this.fetch_instance_props();\n\n                // so we enable messages to API client and timer\n                ip.config.hermes.enable();\n\n\n                ip.controlbar.filebutton.on('change', function (e) {\n                    // fetch Files and pass to upload\n                    var files = e.target.files || e.dataTransfer.files;\n                    self.FileSelectHandler(files, ip.uploader);\n\n                    //remove drag and drop and button events\n                    dd.turnoff_dragdrop();\n\n                    //turn off the button\n                    ip.controlbar.filebutton.off('change');\n                    ip.controlbar.filebutton.attr('disabled', true);\n                });\n\n                dd.init(ip.controlbar.uploadcanvas, this.FileSelectHandler, ip);\n            },\n\n            // file selection\n            FileSelectHandler: function (files, uploader) {\n\n                // process all File objects\n                for (var i = 0, file; file = files[i]; i++) {\n                    log.debug('filetype:' + file.type);\n                    uploader.uploadBlob(file, file.type);\n                }\n\n            }\n        }//end of returned object\n\n\n    });//total end"],"file":"poodll_uploadmediaskin.min.js"}