define ("filter_poodll/poodll_flashrecorder",["jquery","core/log","filter_poodll/utils_amd","filter_poodll/uploader","filter_poodll/lzloader"],function(a,b,c,d,e){"use strict";b.debug("PoodLL Flash Recorder: initialising");return{instanceprops:[],fetch_instance_props:function fetch_instance_props(a){return this.instanceprops[a]},init_instance_props:function init_instance_props(a){this.instanceprops[a]={savebutton:null,audiodatacontrol:null,config:null,uploader:null}},supports_current_browser:function supports_current_browser(a){var d=c.is_ios(),e=c.is_android();if(d||!a.flashonandroid&&e){return!1}else{if("audio"!=a.mediatype){return!1}b.debug("PoodLL Flash Recorder: supports this browser");return!0}},embed:function embed(b,f){if(1==f.flashmp3_cloudbypass){f.posturl=f.cloudbypassurl;f.filename=!1;f.s3filename=!1;f.using_s3=!1}this.init_instance_props(f.widgetid);var g=this.fetch_instance_props(f.widgetid);g.ie=c.is_ie();if(g.ie){f.flashmp3audio_widgetjson=f.flashmp3audio_widgetjson.replace("sendmethod=post","sendmethod=ajax")}g.config=f;var h=a.parseJSON(f.flashmp3audio_widgetjson);e.embed.swf(h);var i="";if(g.ie){i=" style=\"display: none\" "}var j=f.widgetid+"_savebutton",k="<button id=\""+j+"\" type=\"button\" class=\"poodll_save-recording\""+i+">"+M.util.get_string("recui_save","filter_poodll")+"</button>";a(b).append(k);var l=f.widgetid+"_adc";a(b).prepend("<input type=\"hidden\" name=\"audiodatacontrol\" id=\""+l+"\" value=\"\" />");g.uploader=d.clone();g.uploader.init(b,f);e.embed[f.widgetid].setCanvasAttribute("audiodatacontrol",l);g.savebutton=a("#"+j);g.audiodatacontrol=a("#"+l);this.registerevents(f.widgetid)},registerevents:function registerevents(a){var b=this.fetch_instance_props(a);b.audioblob=!1;b.savebutton.click(function(){var a=atob(b.audiodatacontrol.val()),c=a&&0<a.length;if(!c&&!b.audioblob){b.uploader.Output(M.util.get_string("recui_nothingtosaveerror","filter_poodll"));return!1}if(!b.audioblob&&c){for(var d=[],f=0;f<a.length;f++){d.push(a.charCodeAt(f))}b.audioblob=new Blob([new Uint8Array(d)],{type:"audio/mpeg3"})}b.uploader.uploadBlob(b.audioblob,"audio/mpeg3");e.embed[b.config.widgetid].callMethod("poodllapi.mp3_disable()");b.audiodatacontrol.val("");return!1})}}});
//# sourceMappingURL=poodll_flashrecorder.min.js.map
