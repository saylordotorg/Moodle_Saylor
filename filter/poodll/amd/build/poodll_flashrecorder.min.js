define(["jquery","core/log","filter_poodll/utils_amd","filter_poodll/uploader","filter_poodll/lzloader"],(function($,log,utils,uploader,lz){return log.debug("PoodLL Flash Recorder: initialising"),{instanceprops:[],fetch_instance_props:function(widgetid){return this.instanceprops[widgetid]},init_instance_props:function(widgetid){var props={savebutton:null,audiodatacontrol:null,config:null,uploader:null};this.instanceprops[widgetid]=props},supports_current_browser:function(config){var iOS=utils.is_ios(),isAndroid=utils.is_android();return!(iOS||!config.flashonandroid&&isAndroid)&&("audio"==config.mediatype&&(log.debug("PoodLL Flash Recorder: supports this browser"),!0))},embed:function(element,config){1==config.flashmp3_cloudbypass&&(config.posturl=config.cloudbypassurl,config.filename=!1,config.s3filename=!1,config.using_s3=!1),this.init_instance_props(config.widgetid);var ip=this.fetch_instance_props(config.widgetid);ip.ie=utils.is_ie(),ip.ie&&(config.flashmp3audio_widgetjson=config.flashmp3audio_widgetjson.replace("sendmethod=post","sendmethod=ajax")),ip.config=config;var swfopts=$.parseJSON(config.flashmp3audio_widgetjson);lz.embed.swf(swfopts);var savebuttonstyle="";ip.ie&&(savebuttonstyle=' style="display: none" ');var savebuttonid=config.widgetid+"_savebutton",savecontrol='<button id="'+savebuttonid+'" type="button" class="poodll_save-recording"'+savebuttonstyle+">"+M.util.get_string("recui_save","filter_poodll")+"</button>";$(element).append(savecontrol);var audiodatacontrolid=config.widgetid+"_adc",audiocontrol='<input type="hidden" name="audiodatacontrol" id="'+audiodatacontrolid+'" value="" />';$(element).prepend(audiocontrol),ip.uploader=uploader.clone(),ip.uploader.init(element,config),lz.embed[config.widgetid].setCanvasAttribute("audiodatacontrol",audiodatacontrolid),ip.savebutton=$("#"+savebuttonid),ip.audiodatacontrol=$("#"+audiodatacontrolid),this.registerevents(config.widgetid)},registerevents:function(widgetid){var ip=this.fetch_instance_props(widgetid);ip.audioblob=!1,ip.savebutton.click((function(){var audiodata=atob(ip.audiodatacontrol.val()),haveaudiodata=audiodata&&audiodata.length>0;if(!haveaudiodata&&!ip.audioblob)return ip.uploader.Output(M.util.get_string("recui_nothingtosaveerror","filter_poodll")),!1;if(!ip.audioblob&&haveaudiodata){for(var audioblobdata=[],i=0;i<audiodata.length;i++)audioblobdata.push(audiodata.charCodeAt(i));ip.audioblob=new Blob([new Uint8Array(audioblobdata)],{type:"audio/mpeg3"})}ip.uploader.uploadBlob(ip.audioblob,"audio/mpeg3");return lz.embed[ip.config.widgetid].callMethod("poodllapi.mp3_disable()"),ip.audiodatacontrol.val(""),!1}))}}}));

//# sourceMappingURL=poodll_flashrecorder.min.js.map