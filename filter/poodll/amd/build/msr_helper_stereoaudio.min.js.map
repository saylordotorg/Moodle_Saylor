{"version":3,"sources":["../src/msr_helper_stereoaudio.js"],"names":["define","$","log","debug","scriptprocessornode","requestDataInvoked","recordingLength","isPaused","deviceSampleRate","leftchannel","rightchannel","recording","volume","audioInput","context","sampleRate","mimeType","isPCM","numChannels","msr","audioctx","mediaStream","volumeGainNode","clone","extend","init","indexOf","audioChannels","misc","that","createGain","createMediaStreamSource","connect","bufferSize","createJavaScriptNode","createScriptProcessor","onaudioprocess","e","left","inputBuffer","getChannelData","push","Float32Array","right","audioanalyser","core","destination","record","length","encodeWAV","samples","buffer","ArrayBuffer","view","DataView","writeString","setUint32","setUint16","floatTo16BitPCM","output","offset","input","i","s","Math","max","min","setInt16","string","setUint8","charCodeAt","requestData","internalLeftChannel","slice","internalRightChannel","internalRecordingLength","leftBuffer","mergeBuffers","interleaved","rightBuffer","interleave","dataview","audioBlob","Blob","type","ondataavailable","xrequestData","blob","convertoFloat32ToInt16","writeUTFBytes","lng","index","stop","disconnect","leftChannel","rightChannel","result","inputIndex","channelBuffer","set","l","buf","Int16Array","pause","resume"],"mappings":"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","sourcesContent":["/* jshint ignore:start */\ndefine(['jquery',\n        'core/log'],\n    function ($, log) {\n\n        \"use strict\"; // jshint ;_;\n\n        log.debug('PoodLL Stereo Audio Recorder Helper: initialising');\n\n        return {\n\n            //globals??\n            scriptprocessornode: null,\n            requestDataInvoked: false,\n            recordingLength: 0,\n            isPaused: false,\n\n            // variables\n            deviceSampleRate: 48000,//44100, // range: 22050 to 96000\n            leftchannel: [],\n            rightchannel: [],\n            recording: false,\n            volume: null,\n            audioInput: null,\n            context: null,\n            sampleRate: 0,\n            mimeType: 0,\n            isPCM: false,\n            numChannels: 1,\n            msr: null,\n            audioctx: null,\n            mediaStream: null,\n            volumeGainNode: null,\n\n            //for making multiple instances\n            clone: function () {\n                return $.extend(true, {}, this);\n            },\n\n\n            init: function (msr, mediaStream, audioctx) {\n\n                this.msr = msr;\n                this.audioctx = audioctx;\n                this.mediaStream = mediaStream;\n                this.deviceSampleRate = audioctx.sampleRate;\n                //this.sampleRate = msr.sampleRate || this.deviceSampleRate;\n                this.sampleRate =  this.deviceSampleRate;\n                this.mimeType = msr.mimeType || 'audio/wav';\n                this.isPCM = this.mimeType.indexOf('audio/pcm') > -1;\n                this.numChannels = msr.audioChannels || 1;\n                log.debug('stereohelper mimetype: ' + this.mimeType);\n                //and then further init'ing\n                this.misc();\n\n            },\n\n            misc: function () {\n                var that = this;\n                // creates the audio context\n                var context = this.audioctx;\n\n                // creates a gain node\n                this.volumeGainNode = context.createGain();\n\n                var volume = this.volumeGainNode;\n\n                // creates an audio node from the microphone incoming stream\n                //the node chain is audioinput -> volume -> analyser -> scriptprocessingnode\n                this.audioInput = context.createMediaStreamSource(this.mediaStream);\n\n                // creates an audio node from the microphone incoming stream\n                var audioInput = this.audioInput;\n\n                // connect the stream to the gain node\n                audioInput.connect(volume);\n\n                /* From the spec: This value controls how frequently the audioprocess event is\n                 dispatched and how many sample-frames need to be processed each call.\n                 Lower values for buffer size will result in a lower (better) latency.\n                 Higher values will be necessary to avoid audio breakup and glitches\n                 Legal values are 256, 512, 1024, 2048, 4096, 8192, and 16384.*/\n                var bufferSize = this.msr.bufferSize || 2048;\n                if (this.msr.bufferSize === 0) {\n                    bufferSize = 0;\n                }\n\n                var scriptprocessornode = null;\n                if (context.createJavaScriptNode) {\n                    scriptprocessornode = context.createJavaScriptNode(bufferSize, this.numChannels, this.numChannels);\n                } else if (context.createScriptProcessor) {\n                    scriptprocessornode = context.createScriptProcessor(bufferSize, this.numChannels, this.numChannels);\n                } else {\n                    throw 'WebAudio API has no support on this browser.';\n                }\n\n                this.bufferSize = scriptprocessornode.bufferSize;\n                this.requestDataInvoked = false;\n\n                // sometimes \"scriptprocessornode\" disconnects from he destination-node\n                // and there is no exception thrown in this case.\n                // and obviously no further \"ondataavailable\" events will be emitted.\n                // below global-scope variable is added to debug such unexpected but \"rare\" cases.\n                this.scriptprocessornode = scriptprocessornode;\n\n                if (this.numChannels === 1) {\n                    log.debug('All right-channels are skipped.');\n                }\n\n                this.isPaused = false;\n\n                //http://webaudio.github.io/web-audio-api/#the-scriptprocessornode-interface\n                scriptprocessornode.onaudioprocess = function (e) {\n                    if (!that.recording || that.requestDataInvoked || that.isPaused) {\n                        return;\n                    }\n\n                    var left = e.inputBuffer.getChannelData(0);\n                    that.leftchannel.push(new Float32Array(left));\n\n                    if (that.numChannels === 2) {\n                        var right = e.inputBuffer.getChannelData(1);\n                        that.rightchannel.push(new Float32Array(right));\n                    }\n                    that.recordingLength += that.bufferSize;\n                };\n\n                volume.connect(this.msr.audioanalyser.core);\n                // volume.connect(this.scriptprocessornode);\n                this.msr.audioanalyser.core.connect(scriptprocessornode);\n                scriptprocessornode.connect(context.destination);\n\n            },\n\n            record: function () {\n                this.recording = true;\n                // reset the buffers for the new recording\n                this.leftchannel.length = this.rightchannel.length = 0;\n                this.recordingLength = 0;\n            },\n\n            encodeWAV: function(samples) {\n                let buffer = new ArrayBuffer(44 + samples.length * 2);\n                let view = new DataView(buffer);\n\n                /* RIFF identifier */\n                this.writeString(view, 0, 'RIFF');\n                /* RIFF chunk length */\n                view.setUint32(4, 36 + samples.length * 2, true);\n                /* RIFF type */\n                this.writeString(view, 8, 'WAVE');\n                /* format chunk identifier */\n                this.writeString(view, 12, 'fmt ');\n                /* format chunk length */\n                view.setUint32(16, 16, true);\n                /* sample format (raw) */\n                view.setUint16(20, 1, true);\n                /* channel count */\n                view.setUint16(22, this.numChannels, true);\n                /* sample rate */\n                view.setUint32(24, this.sampleRate, true);\n                /* byte rate (sample rate * block align) */\n                view.setUint32(28, this.sampleRate * 4, true);\n                /* block align (channel count * bytes per sample) */\n                view.setUint16(32, this.numChannels * 2, true);\n                /* bits per sample */\n                view.setUint16(34, 16, true);\n                /* data chunk identifier */\n                this.writeString(view, 36, 'data');\n                /* data chunk length */\n                view.setUint32(40, samples.length * 2, true);\n\n                this.floatTo16BitPCM(view, 44, samples);\n                log.debug(samples.length * 2);\n\n                return view;\n            },\n\n            floatTo16BitPCM: function(output, offset, input) {\n                for (let i = 0; i < input.length; i++, offset += 2) {\n                    let s = Math.max(-1, Math.min(1, input[i]));\n                    output.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7FFF, true);\n                }\n            },\n\n            writeString: function(view, offset, string) {\n                for (let i = 0; i < string.length; i++) {\n                    view.setUint8(offset + i, string.charCodeAt(i));\n                }\n            },\n\n            requestData: function () {\n                if (this.isPaused) {\n                    return;\n                }\n\n                if (this.recordingLength === 0) {\n                    this.requestDataInvoked = false;\n                    return;\n                }\n\n                this.requestDataInvoked = true;\n                // clone stuff\n                var internalLeftChannel = this.leftchannel.slice(0);\n                var internalRightChannel = this.rightchannel.slice(0);\n                var internalRecordingLength = this.recordingLength;\n\n                // reset the buffers for the new recording\n                this.leftchannel.length = this.rightchannel.length = [];\n                this.recordingLength = 0;\n                this.requestDataInvoked = false;\n\n                var leftBuffer = this.mergeBuffers(internalLeftChannel, internalRecordingLength);\n                var interleaved = leftBuffer;\n\n                // we interleave both channels together\n                if (this.numChannels === 2) {\n                    var rightBuffer = this.mergeBuffers(internalRightChannel, internalRecordingLength); // bug fixed via #70,#71\n                    interleaved = this.interleave(leftBuffer, rightBuffer);\n                }\n                var dataview = this.encodeWAV(interleaved);\n                var audioBlob = new Blob([dataview], {type: 'audio/wav'});\n                this.msr.ondataavailable(audioBlob);\n            },\n\n            xrequestData: function () {\n\n                if (this.isPaused) {\n                    return;\n                }\n\n                if (this.recordingLength === 0) {\n                    this.requestDataInvoked = false;\n                    return;\n                }\n\n                this.requestDataInvoked = true;\n                // clone stuff\n                var internalLeftChannel = this.leftchannel.slice(0);\n                var internalRightChannel = this.rightchannel.slice(0);\n                var internalRecordingLength = this.recordingLength;\n\n                // reset the buffers for the new recording\n                this.leftchannel.length = this.rightchannel.length = [];\n                this.recordingLength = 0;\n                this.requestDataInvoked = false;\n\n                // we flat the left and right channels down\n                var leftBuffer = this.mergeBuffers(internalLeftChannel, internalRecordingLength);\n\n                var interleaved = leftBuffer;\n\n                // we interleave both channels together\n                if (this.numChannels === 2) {\n                    var rightBuffer = this.mergeBuffers(internalRightChannel, internalRecordingLength); // bug fixed via #70,#71\n                    this.interleaved = this.interleave(leftBuffer, rightBuffer);\n                }\n\n                if (this.isPCM) {\n                    // our final binary blob\n                    var blob = new Blob([this.convertoFloat32ToInt16(interleaved)], {\n                        type: 'audio/pcm'\n                    });\n\n                    this.msr.ondataavailable(blob);\n                    return;\n                }\n\n                // we create our wav file\n                var buffer = new ArrayBuffer(44 + interleaved.length * 2);\n                var view = new DataView(buffer);\n\n                // RIFF chunk descriptor\n                this.writeUTFBytes(view, 0, 'RIFF');\n\n                // -8 (via #97)\n                view.setUint32(4, 44 + interleaved.length * 2 - 8, true);\n\n                this.writeUTFBytes(view, 8, 'WAVE');\n                // FMT sub-chunk\n                this.writeUTFBytes(view, 12, 'fmt ');\n                view.setUint32(16, 16, true);\n                view.setUint16(20, 1, true);\n                // stereo (2 channels)\n                view.setUint16(22, this.numChannels, true);\n                view.setUint32(24, this.sampleRate, true);\n                view.setUint32(28, this.sampleRate * this.numChannels * 2, true); // numChannels * 2 (via #71)\n                view.setUint16(32, this.numChannels * 2, true);\n                view.setUint16(34, 16, true);\n                // data sub-chunk\n                this.writeUTFBytes(view, 36, 'data');\n                view.setUint32(40, interleaved.length * 2, true);\n\n                // write the PCM samples\n                var lng = interleaved.length;\n                var index = 44;\n                var volume = 1;\n                for (var i = 0; i < lng; i++) {\n                    view.setInt16(index, interleaved[i] * (0x7FFF * volume), true);\n                    index += 2;\n                }\n\n                // our final binary blob\n                var blob = new Blob([view], {\n                    type: 'audio/wav'\n                });\n                this.msr.ondataavailable(blob);\n            },\n\n            stop: function () {\n                // we stop recording\n                this.recording = false;\n                this.requestData();\n                this.audioInput.disconnect();\n            },\n\n            interleave: function (leftChannel, rightChannel) {\n                var length = leftChannel.length + rightChannel.length;\n                var result = new Float32Array(length);\n\n                var inputIndex = 0;\n\n                for (var index = 0; index < length;) {\n                    result[index++] = leftChannel[inputIndex];\n                    result[index++] = rightChannel[inputIndex];\n                    inputIndex++;\n                }\n                return result;\n            },\n\n            mergeBuffers: function (channelBuffer, recordingLength) {\n                var result = new Float32Array(recordingLength);\n                var offset = 0;\n                var lng = channelBuffer.length;\n                for (var i = 0; i < lng; i++) {\n                    var buffer = channelBuffer[i];\n                    result.set(buffer, offset);\n                    offset += buffer.length;\n                }\n                return result;\n            },\n\n            writeUTFBytes: function (view, offset, string) {\n                var lng = string.length;\n                for (var i = 0; i < lng; i++) {\n                    view.setUint8(offset + i, string.charCodeAt(i));\n                }\n            },\n\n            convertoFloat32ToInt16: function (buffer) {\n                var l = buffer.length;\n                var buf = new Int16Array(l)\n\n                while (l--) {\n                    buf[l] = buffer[l] * 0xFFFF; //convert to 16 bit\n                }\n                return buf.buffer\n            },\n\n\n            pause: function () {\n                this.isPaused = true;\n            },\n\n            resume: function () {\n                this.isPaused = false;\n            }\n\n        };// end of returned object\n    });// total end\n"],"file":"msr_helper_stereoaudio.min.js"}