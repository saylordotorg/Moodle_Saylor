{"version":3,"sources":["../src/template_presets_amd.js"],"names":["define","$","log","debug","presetdata","dataitems","fetchcontrols","templateindex","controls","name","document","getElementById","key","version","instructions","showatto","showplayers","requirecss","requirejs","shim","defaults","amd","body","bodyend","script","style","dataset","datasetvars","alternate","alternateend","fetchjsonbundle","bundle","each","index","item","value","jsonbundle","JSON","stringify","exportbundle","pom","createElement","setAttribute","encodeURIComponent","createEvent","event","initEvent","dispatchEvent","click","populateform","presetindex","hasOwnProperty","usevalue","dopopulate","templatedata","Array","init","opts","controlid","presetcontrol","get","parse","remove","amdpresets","change","val","ddsquareid","on","preventDefault","stopPropagation","addClass","removeClass","files","originalEvent","dataTransfer","length","f","r","FileReader","onload","e","contents","target","result","readAsText","alert"],"mappings":"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","sourcesContent":["/* jshint ignore:start */\ndefine(['jquery', 'core/log'], function ($, log) {\n\n    \"use strict\"; // jshint ;_;\n\n    log.debug('Filter Poodll Presets initialising');\n\n    return {\n\n        presetdata: false,\n\n        dataitems: ['name', 'key', 'version', 'instructions', 'showatto', 'showplayers', 'requirecss', 'requirejs', 'shim', 'defaults',\n            'amd', 'body', 'bodyend', 'script', 'style', 'dataset', 'datasetvars', 'alternate', 'alternateend'],\n\n        fetchcontrols: function (templateindex) {\n            var controls = {};\n            controls.name = document.getElementById('id_s_filter_poodll_templatename_' + templateindex);\n            controls.key = document.getElementById('id_s_filter_poodll_templatekey_' + templateindex);\n            controls.version = document.getElementById('id_s_filter_poodll_templateversion_' + templateindex);\n            controls.instructions = document.getElementById('id_s_filter_poodll_templateinstructions_' + templateindex);\n            controls.showatto = document.getElementById('id_s_filter_poodll_template_showatto_' + templateindex);\n            controls.showplayers = document.getElementById('id_s_filter_poodll_template_showplayers_' + templateindex);\n            controls.requirecss = document.getElementById('id_s_filter_poodll_templaterequire_css_' + templateindex);\n            controls.requirejs = document.getElementById('id_s_filter_poodll_templaterequire_js_' + templateindex);\n            controls.shim = document.getElementById('id_s_filter_poodll_templaterequire_js_shim_' + templateindex);\n            controls.defaults = document.getElementById('id_s_filter_poodll_templatedefaults_' + templateindex);\n            controls.amd = document.getElementById('id_s_filter_poodll_template_amd_' + templateindex);\n            controls.body = document.getElementById('id_s_filter_poodll_template_' + templateindex);\n            controls.bodyend = document.getElementById('id_s_filter_poodll_templateend_' + templateindex);\n            controls.script = document.getElementById('id_s_filter_poodll_templatescript_' + templateindex);\n            controls.style = document.getElementById('id_s_filter_poodll_templatestyle_' + templateindex);\n            controls.dataset = document.getElementById('id_s_filter_poodll_dataset_' + templateindex);\n            controls.datasetvars = document.getElementById('id_s_filter_poodll_datasetvars_' + templateindex);\n            controls.alternate = document.getElementById('id_s_filter_poodll_templatealternate_' + templateindex);\n            controls.alternateend = document.getElementById('id_s_filter_poodll_templatealternate_end_' + templateindex);\n            controls.presetdata = document.getElementById('id_s_filter_poodll_presetdata_' + templateindex);\n            return controls;\n        },\n\n        fetchjsonbundle: function (templateindex, controls) {\n            var bundle = {};\n            $.each(this.dataitems,\n                function (index, item) {\n                    bundle[item] = controls[item].value;\n                }\n            );\n            var jsonbundle = JSON.stringify(bundle);\n            return jsonbundle;\n            window.open(\"data:text/json;charset=utf-8,\" + encodeURIComponent(jsonbundle));\n        },\n\n        exportbundle: function (templateindex) {\n            var controls = this.fetchcontrols(templateindex);\n            if (controls.key.value == '') {\n                return;\n            }\n            var jsonbundle = this.fetchjsonbundle(templateindex, controls);\n\n            var pom = document.createElement('a');\n            pom.setAttribute('href', \"data:text/json;charset=utf-8,\" + encodeURIComponent(jsonbundle));\n            pom.setAttribute('download', controls['key'].value + '.txt');\n\n            if (document.createEvent) {\n                var event = document.createEvent('MouseEvents');\n                event.initEvent('click', true, true);\n                pom.dispatchEvent(event);\n            }\n            else {\n                pom.click();\n            }\n        },\n\n        populateform: function (templateindex, presetindex, presetdata) {\n            //get all our html controls\n            var controls = this.fetchcontrols(templateindex);\n\n            //what a rip off there was no selection!!!\n            if (!presetindex && !presetdata) {\n                return;\n            }\n            if (presetindex == 0 && presetdata) {\n                //this is good, we have something from dopopulate\n                //from a drag drop\n            } else {\n                //this is a normal selection from the presets control\n                presetdata = this.presetdata;\n            }\n\n            $.each(this.dataitems,\n                function (index, item) {\n                    // log.debug(item + ':' + presetindex + ':' + presetdata[presetindex][item]);\n                    //first check we have a data item for this control(old bundles don7 have instructions etc)\n                    //then set the data\n                    if (presetdata[presetindex].hasOwnProperty(item)) {\n                        if (presetdata[presetindex]['key'] == 'cleartemplate' && (item == 'key' || item == 'name')) {\n                            var usevalue = '';\n                        } else {\n                            var usevalue = presetdata[presetindex][item];\n                        }\n                        controls[item].value = usevalue;\n                    } else {\n                        switch (item) {\n                            case 'amd':\n                            case 'showplayers':\n                            case 'showatto':\n                                controls[item].value = 0;\n                                break;\n                            default:\n                                controls[item].value = '';\n                        }\n                    }\n                }\n            );\n\n        },\n\n        dopopulate: function (templateindex, templatedata) {\n            this.populateform(templateindex, 0, new Array(templatedata));\n        },\n\n        // load all poodll stuff and stash all our variables\n        init: function (opts) {\n            if (!this.presetdata) {\n                var controlid = '#id_s_filter_poodll_presetdata_' + opts['templateindex'];\n                var presetcontrol = $(controlid).get(0);\n                this.presetdata = JSON.parse(presetcontrol.value);\n                $(controlid).remove();\n            }\n\n            var amdpresets = this;\n            //handle the select box change event\n            $(\"select[name='filter_poodll/presets']\").change(function () {\n                debugger;\n                amdpresets.populateform(opts['templateindex'], $(this).val());\n            });\n\n            //drag drop square events\n            var ddsquareid = '#id_s_filter_poodll_dragdropsquare_' + opts['templateindex'];\n\n            //export the current bundle\n            $(ddsquareid).on(\"click\", function () {\n                amdpresets.exportbundle(opts['templateindex']);\n            });\n\n\n            //handle the drop event. First cancel dragevents which prevent drop firing\n            $(ddsquareid).on(\"dragover\", function (event) {\n                event.preventDefault();\n                event.stopPropagation();\n                $(this).addClass('filter_poodll_dragging');\n            });\n\n            $(ddsquareid).on(\"dragleave\", function (event) {\n                event.preventDefault();\n                event.stopPropagation();\n                $(this).removeClass('filter_poodll_dragging');\n            });\n\n            $(ddsquareid).on('drop', function (event) {\n\n                //stop the browser from opening the file\n                event.preventDefault();\n                //Now we need to get the files that were dropped\n                //The normal method would be to use event.dataTransfer.files\n                //but as jquery creates its own event object you ave to access\n                //the browser even through originalEvent.  which looks like this\n                var files = event.originalEvent.dataTransfer.files;\n\n                //if we have files, read and process them\n                if (files.length) {\n                    var f = files[0];\n                    if (f) {\n                        var r = new FileReader();\n                        r.onload = function (e) {\n                            var contents = e.target.result;\n                            var templatedata = JSON.parse(contents);\n                            if (templatedata.key) {\n                                amdpresets.dopopulate(opts['templateindex'], templatedata);\n                            }\n                        };\n                        r.readAsText(f);\n                    } else {\n                        alert(\"Failed to load file\");\n                    }//end of if f\n                }//end of if files\n                $(this).removeClass('filter_poodll_dragging');\n            });\n        }//end of function\n    };\n});\n/* jshint ignore:end */"],"file":"template_presets_amd.min.js"}