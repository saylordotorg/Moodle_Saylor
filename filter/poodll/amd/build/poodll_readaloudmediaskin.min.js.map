{"version":3,"sources":["../src/poodll_readaloudmediaskin.js"],"names":["define","$","jqui","log","utils","upskin_radial","hwave_mic","settings","debug","instanceprops","pmr","devsettings","therecanim","clone","extend","init","ip","fetch_instanceprops","onUploadSuccess","controlbarid","hide","show","onUploadFailure","fetch_status_bar","skin","fetch_preview_audio","fetch_preview_video","fetch_resource_audio","fetch_resource_video","onMediaError","e","console","error","onMediaSuccess_video","set_visual_mode","onMediaSuccess_audio","controlbar","preview","attr","uploader","Output","start","timer","reset","update_status","handle_timer_update","status","html","fetch_display_time","seconds","initseconds","stopbutton","click","fetch_uploader_skin","element","upskin","config","playcanvas","mode","self","disable_button","startbutton","enable_button","testbutton","clear","allowearlyexit","enabled","insert_controlbar_video","resource","prepare_controlbar_audio","insert_controlbar_audio","prepare_controlbar","skin_style","media_skin_style","ss","fetch_strings","ss_startlabel","M","util","get_string","ss_testlabel","ss_stoplabel","controls","fetch_dialogue_box","downloaddialog","errordialog","prepend","settingsdialog","errorsdialog","settingsicon","set_dialogue_box","register_controlbar_events_video","onMediaSuccess","register_controlbar_events_audio","recanim","audioanalyser","get","hermes","disable","do_start_audio","setTimeout","testover","do_stop_audio","sounddetected","uploaded","open","enable","stop","doDeferredUpload","blobs","length","do_save_audio","window","onbeforeunload","button","removeClass","addClass"],"mappings":"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","sourcesContent":["/* jshint ignore:start */\ndefine(['jquery', 'jqueryui', 'core/log', 'filter_poodll/utils_amd', 'filter_poodll/upskin_radial',\n        'filter_poodll/anim_hwave_mic', 'filter_poodll/dlg_devicesettings'],\n    function ($, jqui, log, utils, upskin_radial, hwave_mic, settings) {\n\n        \"use strict\"; // jshint ;_;\n\n        log.debug('PoodLL Read Aloud Skin: initialising');\n\n        return {\n\n            instanceprops: null,\n            pmr: null,\n            devsettings: null,\n            therecanim: null,\n\n            //for making multiple instances\n            clone: function () {\n                return $.extend(true, {}, this);\n            },\n\n            init: function (ip, pmr) {\n                this.instanceprops = ip;\n                this.pmr = pmr;\n                this.devsettings = settings.clone();\n                this.devsettings.init(pmr, ip);\n            },\n\n\n            fetch_instanceprops: function () {\n                return this.instanceprops;\n            },\n\n\n            onUploadSuccess: function (controlbarid) {\n                $('#' + controlbarid + ' > .poodll_save-recording').hide();\n                // $('#' + controlbarid  + '_messages').hide();\n                $('#' + controlbarid + ' > .poodll_savedsuccessfully').show();\n            },\n\n            onUploadFailure: function (controlbarid) {\n                return;\n            },\n\n            fetch_status_bar: function (skin) {\n                var status = '<div class=\"poodll_status_' + skin + '\" width=\"320\" height=\"50\">00:00:00</div>';\n                return status;\n            },\n\n            fetch_preview_audio: function (skin) {\n                var preview = '<audio class=\"poodll_preview_' + skin + ' hide\" playsInline muted></audio>';\n                return preview;\n            },\n            fetch_preview_video: function (skin) {\n                return this.fetch_preview_audio(skin);\n            },\n            fetch_resource_audio: function (skin) {\n                var resourceplayer = '<audio class=\"poodll_resourceplayer_' + skin + ' hide\" ></audio>';\n                return resourceplayer;\n            },\n            fetch_resource_video: function (skin) {\n                return this.fetch_resource_audio(skin);\n            },\n\n            onMediaError: function (e) {\n                console.error('media error', e);\n            },\n\n            onMediaSuccess_video: function (controlbarid) {\n                var ip = this.fetch_instanceprops(controlbarid);\n                this.set_visual_mode('recordingmode', controlbarid);\n            },\n\n            onMediaSuccess_audio: function (controlbarid) {\n                var ip = this.fetch_instanceprops(controlbarid);\n                ip.controlbar.preview.attr('src', null);\n\n                //clear messages\n                ip.uploader.Output('');\n\n                //wave animation\n                this.therecanim.start();\n\n                //timer and status bar\n                ip.timer.reset();\n                ip.timer.start();\n                this.update_status(controlbarid);\n\n                //visuals\n                this.set_visual_mode('recordingmode', controlbarid);\n            },\n\n            handle_timer_update: function (controlbarid) {\n                var ip = this.fetch_instanceprops(controlbarid);\n                ip.controlbar.status.html(ip.timer.fetch_display_time());\n                if (ip.timer.seconds == 0 && ip.timer.initseconds > 0) {\n                    ip.controlbar.stopbutton.click();\n                }\n            },\n\n            update_status: function (controlbarid) {\n                var ip = this.fetch_instanceprops(controlbarid);\n                ip.controlbar.status.html(ip.timer.fetch_display_time());\n            },\n\n            fetch_uploader_skin: function (controlbarid, element) {\n                var ip = this.fetch_instanceprops(controlbarid);\n                var upskin = upskin_radial.clone();\n                upskin.init(ip.config, element, ip.controlbar.playcanvas, ip.controlbar.status);\n                return upskin;\n            },\n\n            //set visuals for different states (ie recording or playing)\n            set_visual_mode: function (mode, controlbarid) {\n                var self = this;\n                var ip = this.fetch_instanceprops(controlbarid);\n\n                switch (mode) {\n\n                    case 'startmode':\n\n                        ip.controlbar.status.hide();\n                        self.disable_button(ip.controlbar.startbutton);\n                        self.enable_button(ip.controlbar.testbutton);\n                        self.disable_button(ip.controlbar.stopbutton);\n                        self.therecanim.clear();\n                        break;\n\n                    case 'readymode':\n\n                        ip.controlbar.status.hide();\n                        self.enable_button(ip.controlbar.startbutton);\n                        self.disable_button(ip.controlbar.testbutton);\n                        self.disable_button(ip.controlbar.stopbutton);\n                        self.therecanim.clear();\n                        break;\n\n                    case 'recordingmode':\n                        //when testing(timer off) we do not want the stop button. Just really recording and allowearlyexit\n                        if (ip.config.allowearlyexit == \"1\" && ip.timer.enabled) {\n                            self.enable_button(ip.controlbar.stopbutton);\n                        }\n                        self.disable_button(ip.controlbar.startbutton);\n                        ip.controlbar.status.hide();\n                        break;\n\n                    case 'aftermode':\n                        self.disable_button(ip.controlbar.startbutton);\n                        self.disable_button(ip.controlbar.stopbutton);\n                        ip.controlbar.status.show();\n\n                        break;\n\n                }\n\n            },\n\n            //insert the control bar and return it to be reused\n            insert_controlbar_video: function (element, controlbarid, preview, resource) {\n                return this.prepare_controlbar_audio(element, controlbarid, preview, resource);\n            },\n            //insert the control bar and return it to be reused\n            insert_controlbar_audio: function (element, controlbarid, preview, resource) {\n                var controlbar = this.prepare_controlbar(element, controlbarid, preview, resource, 'audio');\n                return controlbar;\n            },\n\n            //insert the control bar and return it to be reused\n            prepare_controlbar: function (element, controlbarid, preview, resource, mediatype) {\n                var ip = this.fetch_instanceprops(controlbarid);\n                var skin_style = ip.config.media_skin_style;\n\n                var recorder_class = 'poodll_mediarecorder_audio';\n                var size_class = 'poodll_mediarecorder_size_auto';\n\n                var ss = this.pmr.fetch_strings();\n                var ss_startlabel = M.util.get_string('recui_startactivity', 'filter_poodll');\n                var ss_testlabel = M.util.get_string('recui_testmic', 'filter_poodll');\n                var ss_stoplabel = M.util.get_string('recui_stop', 'filter_poodll');\n\n                var status = this.fetch_status_bar('readaloud');\n                var controls = '<div class=\"poodll_mediarecorderholder_readaloud '\n                    + recorder_class + '\" id=\"holder_' + controlbarid + '\">';\n\n                controls += '<div class=\"poodll_mediarecorderbox_readaloud\" id=\"' + controlbarid + '\">';\n                controls += this.devsettings.fetch_dialogue_box();\n                controls += ip.downloaddialog.fetch_dialogue_box();\n                controls += ip.errordialog.fetch_dialogue_box();\n                controls += '<div class=\"style-holder ' + skin_style + '\">';\n                controls += preview,\n                    controls += '<div class=\"settingsicon\" id=\"settingsicon_' + controlbarid + '\"><button type=\"button\" class=\"btn btn-info btn-lg\" data-toggle=\"modal\" data-target=\"#myModal\"><i class=\"fa fa-cogs\" aria-hidden=\"true\"></i></button></div>';\n                controls += '<canvas id=\"' + controlbarid + '_playcanvas\" width=\"250\" height=\"120\"></canvas>';\n                controls += '<button type=\"button\" class=\"poodll_mediarecorder_button_readaloud poodll_start-recording_readaloud\">' + ss_startlabel + '</button>';\n                controls += '<button type=\"button\" class=\"poodll_mediarecorder_button_readaloud poodll_test-recording_readaloud\">' + ss_testlabel + '</button>';\n                controls += '<button type=\"button\" class=\"poodll_mediarecorder_button_readaloud poodll_stop-recording_readaloud\">' + ss_stoplabel + '</button>';\n                controls += status,\n                    controls += '</div></div></div>';\n                $(element).prepend(controls);\n                //<i class=\"fa fa-stop\" aria-hidden=\"true\"></i>\n                var controlbar = {\n                    settingsdialog: $('#' + controlbarid + ' .poodll_dialogue_box_settings'),\n                    downloaddialog: $('#' + controlbarid + ' .poodll_dialogue_box_download'),\n                    errorsdialog: $('#' + controlbarid + ' .poodll_dialogue_box_errors'),\n                    settingsicon: $('#' + controlbarid + ' .settingsicon'),\n                    status: $('#' + controlbarid + ' .poodll_status_readaloud'),\n                    preview: $('#' + controlbarid + ' .poodll_preview_readaloud'),\n                    startbutton: $('#' + controlbarid + ' .poodll_start-recording_readaloud'),\n                    testbutton: $('#' + controlbarid + ' .poodll_test-recording_readaloud'),\n                    stopbutton: $('#' + controlbarid + ' .poodll_stop-recording_readaloud'),\n                    playcanvas: $('#' + controlbarid + '_playcanvas')\n                };\n                //settings and error and download dialogs\n                //settings is on 'this' because it is shown from skkn events, but errors are from pmr stuff\n                ip.downloaddialog.set_dialogue_box(controlbar.downloaddialog);\n                ip.errordialog.set_dialogue_box(controlbar.errorsdialog);\n                this.devsettings.set_dialogue_box(controlbar.settingsdialog);\n\n                return controlbar;\n            }, //end of fetch_control_bar_readaloud\n\n\n            register_controlbar_events_video: function (onMediaSuccess, controlbarid) {\n                return this.register_controlbar_events_audio(onMediaSuccess, controlbarid);\n            },\n\n            register_controlbar_events_audio: function (onMediaSuccess, controlbarid) {\n\n                var self = this;\n                var pmr = this.pmr;\n                var ip = this.fetch_instanceprops(controlbarid);\n\n                //init recording anim\n                ip.config.recanim = 'hwave_mic';\n                var recanim = hwave_mic.clone();\n                self.therecanim = recanim;\n                recanim.init(ip.audioanalyser, ip.controlbar.playcanvas.get(0));\n\n                //set visual mode\n                this.set_visual_mode('startmode', controlbarid);\n\n\n                //Test button click\n                ip.controlbar.testbutton.click(function () {\n                    //we will start recording here.\n                    //but its just a throwaway so we disable messages to API client and timer\n                    ip.config.hermes.disable();\n                    ip.timer.disable();\n\n                    var testover = function () {\n                        //stop recording\n                        pmr.do_stop_audio(ip);\n                        //wave animation\n                        recanim.clear();\n                        if (recanim.sounddetected) {\n                            self.set_visual_mode('readymode', controlbarid);\n                        }\n                    }\n                    pmr.do_start_audio(ip, onMediaSuccess);\n                    setTimeout(testover, 4000);\n                });\n\n\n                ip.controlbar.settingsicon.click(function () {\n                    if (!self.uploaded) {\n                        self.devsettings.open();\n                    } else {\n                        ip.downloaddialog.open();\n                    }\n                });\n\n                //Start button click\n                ip.controlbar.startbutton.click(function () {\n                    //we start real recording here.\n                    // so we enable messages to API client and timer\n                    ip.config.hermes.enable();\n                    ip.timer.enable();\n\n                    pmr.do_start_audio(ip, onMediaSuccess);\n                });\n\n\n                //Stop button click\n                ip.controlbar.stopbutton.click(function () {\n\n                    //stop recording\n                    pmr.do_stop_audio(ip);\n\n                    //wave animation\n                    recanim.clear();\n\n\n                    //timer and status bar\n                    ip.timer.stop()\n                    self.update_status(controlbarid);\n\n                    //call upload right away\n                    //but we have to do it this lame deferred way because some mediastreamrecorders return a single\n                    //blob shortly after we stop. We init like that too, to make sure we do not truncate a users recording\n                    //if the mini blobs did not arrive\n                    var doDeferredUpload = function () {\n                        if (ip.blobs && ip.blobs.length > 0) {\n                            pmr.do_save_audio(ip);\n                            ip.uploaded = true;\n                            self.disable_button(ip.controlbar.startbutton);\n                        } else {\n                            setTimeout(doDeferredUpload, 200);\n                        }\n                    }\n                    setTimeout(doDeferredUpload, 200);\n\n                    //set visuals\n                    self.set_visual_mode('aftermode', controlbarid);\n\n                });\n\n\n                window.onbeforeunload = function () {\n                    //no need to do anything here\n                    // self.enable_button(ip.controlbar.startbutton);\n\n                };\n            }, //end of register_control_bar_events_readaloud\n\n\n            enable_button: function (button) {\n                $(button).attr('disabled', false);\n                $(button).removeClass('pmr_disabled');\n            },\n            disable_button: function (button) {\n                $(button).attr('disabled', true);\n                $(button).addClass('pmr_disabled');\n            },\n\n        };//end of returned object\n    });//total end\n"],"file":"poodll_readaloudmediaskin.min.js"}