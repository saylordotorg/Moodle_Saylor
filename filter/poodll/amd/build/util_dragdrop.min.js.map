{"version":3,"sources":["../src/util_dragdrop.js"],"names":["define","$","jqui","log","debug","theelement","uploadfunction","uploader","started","filebutton","init","element","ip","controlbar","supports_dragdrop","register_dragdrop","do_visuals","clone","extend","addClass","turnoff_dragdrop","removeClass","off","on","e","preventDefault","stopPropagation","that","files","originalEvent","dataTransfer","attr"],"mappings":"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","sourcesContent":["define(['jquery', 'jqueryui', 'core/log'], function ($, jqui, log) {\r\n    \"use strict\"; // jshint ;_;\r\n\r\n    log.debug('Poodll util drag drop: initialising');\r\n\r\n    return {\r\n\r\n        theelement: false,\r\n        uploadfunction: false,\r\n        uploader: false,\r\n        started: false,\r\n        filebutton: false,\r\n\r\n        init: function (element, uploadfunction, ip) {\r\n            this.theelement = element;\r\n            this.uploadfunction = uploadfunction;\r\n            this.uploader = ip.uploader;\r\n            this.filebutton = ip.controlbar.filebutton;\r\n\r\n            if (this.supports_dragdrop(element)) {\r\n                log.debug('registering drag drop');\r\n                this.register_dragdrop();\r\n                this.do_visuals();\r\n            } else {\r\n                log.debug('drag drop not supported');\r\n            }\r\n        },\r\n        //for making multiple instances\r\n        clone: function () {\r\n            return $.extend(true, {}, this);\r\n        },\r\n        supports_dragdrop: function (element) {\r\n            return ('draggable' in element) || ('ondragstart' in element && 'ondrop' in element)\r\n        },\r\n\r\n        do_visuals: function () {\r\n            this.theelement.addClass(\"poodll-can-do-drag-drop\");\r\n        },\r\n\r\n        turnoff_dragdrop: function () {\r\n            if (!this.theelement) {\r\n                return;\r\n            }\r\n            this.theelement.removeClass(\"poodll-can-do-drag-drop\");\r\n            this.theelement.removeClass('is-poodll-drag-over');\r\n            //replace events with a simple DD canceller (otherwise if we just remove them, and they DD they will leave the page)\r\n            this.theelement.off('drag dragstart dragend dragover dragenter dragleave drop');\r\n            this.theelement.on('drag dragstart dragend dragover dragenter dragleave drop', function (e) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n            });\r\n        },\r\n\r\n        register_dragdrop: function () {\r\n\r\n            var that = this;\r\n\r\n            this.theelement.on('drag dragstart dragend dragover dragenter dragleave drop', function (e) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                if (that.started) {\r\n                    return;\r\n                }\r\n            }).on('dragover dragenter', function () {\r\n                that.theelement.addClass('is-poodll-drag-over');\r\n            }).on('dragleave dragend drop', function () {\r\n                that.theelement.removeClass('is-poodll-drag-over');\r\n            }).on('drop', function (e) {\r\n                if (that.started) {\r\n                    return;\r\n                }\r\n\r\n                var files = e.originalEvent.dataTransfer.files;\r\n                that.uploadfunction(files, that.uploader);\r\n\r\n                //remove events\r\n                that.turnoff_dragdrop();\r\n                that.filebutton.off('change');\r\n                that.filebutton.attr('disabled', true);\r\n                that.started = true;\r\n\r\n            });\r\n        },\r\n\r\n    }\r\n});"],"file":"util_dragdrop.min.js"}