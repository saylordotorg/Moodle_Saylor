define(["jquery","core/log","filter_poodll/speech_poodll"],(function($,log,speechrecognition){return log.debug("anim_words: initialising"),{analyser:null,cvs:null,cvsctx:null,speechrec:null,enabled:!1,drawparams:{textColor:"#0",wavColor:"#0",font:"14px Comic Sans MS",textAlign:"center"},clone:function(){return $.extend(!0,{},this)},init:function(analyser,cvs){this.cvs=cvs,this.cvsctx=cvs.getContext("2d"),this.analyser=analyser,this.speechrec=speechrecognition.clone(),this.speechrec.init("en-US")},setDrawParam:function(paramkey,paramvalue){this.drawparams[paramkey]=paramvalue},clear:function(){this.cvsctx.clearRect(0,0,this.cvs.width,this.cvs.height),this.enabled=!1,this.speechrec.stop()},start:function(){this.enabled=!0;var that=this;this.analyser.core.fftSize=2048;var bufferLength=this.analyser.core.fftSize,dataArray=new Uint8Array(bufferLength),cwidth=this.cvs.width,cheight=this.cvs.height;this.cvsctx.clearRect(0,0,cwidth,this.ceight);var words=["..","..","..","..","..","..","..",".."];this.speechrec.oninterimspeechcapture=function(speechtext){var newwords=speechtext.split(" ");words=words.concat(newwords)},this.speechrec.start();!function draw(){if(that.enabled){(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame)(draw);that.analyser.core.getByteTimeDomainData(dataArray),that.cvsctx.clearRect(0,0,cwidth,cheight),that.cvsctx.lineWidth=2,that.cvsctx.strokeStyle=that.drawparams.wavColor,that.cvsctx.beginPath();for(var sliceWidth=1*cwidth/bufferLength,x=0,i=0;i<bufferLength;i++){var y=dataArray[i]/128*cheight/2;0===i?that.cvsctx.moveTo(x,y):that.cvsctx.lineTo(x,y),x+=sliceWidth}that.cvsctx.lineTo(cwidth,cheight/2),that.cvsctx.stroke(),that.cvsctx.font=that.drawparams.font,that.cvsctx.fillStyle=that.drawparams.textColor,that.cvsctx.textAlign=that.drawparams.textAlign;var cellvcenter=cheight/4,cellwidth=cwidth/4,cellhcenter=cwidth/8;for(i=1;i<9;i++)that.cvsctx.fillText(words[words.length-i],cellwidth*(i%4)+cellhcenter,i<5?cellvcenter:3*cellvcenter)}}()}}}));

//# sourceMappingURL=anim_words.min.js.map