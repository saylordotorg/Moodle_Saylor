define(["jquery","core/log","filter_poodll/speech_poodll"],function(a,b,c){"use strict";return b.debug("anim_words: initialising"),{analyser:null,cvs:null,cvsctx:null,speechrec:null,enabled:!1,drawparams:{textColor:"#0",wavColor:"#0",font:"14px Comic Sans MS",textAlign:"center"},clone:function(){return a.extend(!0,{},this)},init:function(a,b){this.cvs=b,this.cvsctx=b.getContext("2d"),this.analyser=a,this.speechrec=c.clone(),this.speechrec.init("en-US")},setDrawParam:function(a,b){this.drawparams[a]=b},clear:function(){this.cvsctx.clearRect(0,0,this.cvs.width,this.cvs.height),this.enabled=!1,this.speechrec.stop()},start:function(){this.enabled=!0;var a=this;this.analyser.core.fftSize=2048;var b=this.analyser.core.fftSize,c=new Uint8Array(b),d=this.cvs.width,e=this.cvs.height;this.cvsctx.clearRect(0,0,d,this.ceight);var f=["..","..","..","..","..","..","..",".."];this.speechrec.oninterimspeechcapture=function(a){var b=a.split(" ");f=f.concat(b)},this.speechrec.start();var g=function(){if(a.enabled){var h=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;h(g);a.analyser.core.getByteTimeDomainData(c),a.cvsctx.clearRect(0,0,d,e),a.cvsctx.lineWidth=2,a.cvsctx.strokeStyle=a.drawparams.wavColor,a.cvsctx.beginPath();for(var i=1*d/b,j=0,k=0;k<b;k++){var l=c[k]/128,m=l*e/2;0===k?a.cvsctx.moveTo(j,m):a.cvsctx.lineTo(j,m),j+=i}a.cvsctx.lineTo(d,e/2),a.cvsctx.stroke(),a.cvsctx.font=a.drawparams.font,a.cvsctx.fillStyle=a.drawparams.textColor,a.cvsctx.textAlign=a.drawparams.textAlign;var n=e/4,o=d/4,p=d/8;for(k=1;k<9;k++)a.cvsctx.fillText(f[f.length-k],o*(k%4)+p,k<5?n:3*n)}};g()}}});