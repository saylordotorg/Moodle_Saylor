define ("filter_poodll/poodll_readseedmediaskin",["jquery","jqueryui","core/log","filter_poodll/utils_amd","filter_poodll/upskin_radial","filter_poodll/upskin_bar","filter_poodll/anim_hwave_mic","filter_poodll/dlg_devicesettings"],function(a,b,c,d,e,f,g,h){"use strict";c.debug("PoodLL Read Seed Skin: initialising");return{instanceprops:null,pmr:null,devsettings:null,therecanim:null,buttonmode:null,clone:function clone(){return a.extend(!0,{},this)},init:function init(a,b){this.instanceprops=a;this.pmr=b;this.devsettings=h.clone();this.devsettings.init(b,a)},fetch_instanceprops:function fetch_instanceprops(){return this.instanceprops},onUploadSuccess:function onUploadSuccess(a){this.set_visual_mode("allfinished",a)},onUploadFailure:function onUploadFailure(){},fetch_status_bar:function fetch_status_bar(a){return"<div class=\"poodll_status_"+a+"\" width=\"320\" height=\"50\">00:00:00</div>"},fetch_preview_audio:function fetch_preview_audio(a){return"<audio class=\"poodll_preview_"+a+" hide\" playsInline muted></audio>"},fetch_preview_video:function fetch_preview_video(a){return this.fetch_preview_audio(a)},fetch_resource_audio:function fetch_resource_audio(a){return"<audio class=\"poodll_resourceplayer_"+a+" hide\" ></audio>"},fetch_resource_video:function fetch_resource_video(a){return this.fetch_resource_audio(a)},onMediaError:function onMediaError(a){console.error("media error",a)},onMediaSuccess_video:function onMediaSuccess_video(a){this.fetch_instanceprops(a);this.set_visual_mode("startbuttonrecording",a)},onMediaSuccess_audio:function onMediaSuccess_audio(a){var b=this.fetch_instanceprops(a);b.controlbar.preview.attr("src",null);b.uploader.Output("");this.therecanim.start();b.timer.reset();b.timer.start();this.update_status(a);if("testbuttonrecording"!=this.buttonmode){this.set_visual_mode("startbuttonrecording",a)}},handle_timer_update:function handle_timer_update(a){var b=this.fetch_instanceprops(a);b.controlbar.status.html(b.timer.fetch_display_time());if(0==b.timer.seconds&&0<b.timer.initseconds){this.process_recording_stop(a)}},update_status:function update_status(a){var b=this.fetch_instanceprops(a);b.controlbar.status.html(b.timer.fetch_display_time())},fetch_uploader_skin:function fetch_uploader_skin(a,b){var c=this.fetch_instanceprops(a),d=f.clone();d.init(c.config,b,c.controlbar.playcanvas,c.controlbar.status);return d},set_button_style:function set_button_style(b){a.each(["testbuttonready","testbuttonrecording","startbuttonready","startbuttoncountdown","startbuttonrecording","uploading","allfinished"],function(b,c){a(".poodll_mediarecorderbox_readseed").removeClass("poodll_mediarecorder_readseed_"+c);a(".poodll_mediarecorderbox_readseed").removeClass("readseed_canclick")});a(".poodll_mediarecorderbox_readseed").addClass("poodll_mediarecorder_readseed_"+b);if("testbuttonready"==b||"startbuttonready"==b){a(".poodll_mediarecorderbox_readseed").addClass("readseed_canclick")}},set_visual_mode:function set_visual_mode(a,b){var c=this,d=this.fetch_instanceprops(b);this.buttonmode=a;d.config.hermes.postMessage({type:"recorderstatus",status:a});switch(a){case"testbuttonready":d.controlbar.status.hide();d.controlbar.thecaption.text("SPEAK");d.controlbar.thecaption.show();d.controlbar.playcanvas.hide();c.set_button_style(a);break;case"testbuttonrecording":d.controlbar.thecaption.hide();d.controlbar.playcanvas.show();c.set_button_style(a);break;case"startbuttonready":d.controlbar.thecaption.text("START");d.controlbar.thecaption.show();d.controlbar.playcanvas.hide();c.set_button_style(a);break;case"startbuttoncountdown":d.controlbar.thecaption.text("----------");d.controlbar.thecaption.show();d.controlbar.playcanvas.hide();c.set_button_style(a);break;case"startbuttonrecording":d.controlbar.playcanvas.show();if("1"==d.config.allowearlyexit&&d.timer.enabled){var e=M.util.get_string("recui_clicktofinish","filter_poodll");d.controlbar.thecaption.text(e);d.controlbar.thecaption.show()}else{d.controlbar.thecaption.hide()}c.set_button_style(a);break;case"uploading":d.controlbar.thecaption.html("<i class=\"fa fa-spinner fa-spin fa-3x fa-fw\"></i>");d.controlbar.thecaption.show();d.controlbar.playcanvas.hide();c.set_button_style(a);d.controlbar.status.show();break;case"allfinished":d.controlbar.thecaption.text("Finished");d.controlbar.thecaption.show();d.controlbar.playcanvas.hide();d.controlbar.status.hide();c.set_button_style(a);break;}},insert_controlbar_video:function insert_controlbar_video(a,b,c,d){return this.prepare_controlbar_audio(a,b,c,d)},insert_controlbar_audio:function insert_controlbar_audio(a,b,c,d){var e=this.prepare_controlbar(a,b,c,d,"audio");return e},prepare_controlbar:function prepare_controlbar(b,c,d){var e=this.fetch_instanceprops(c),f=e.config.media_skin_style,g=this.pmr.fetch_strings(),h=M.util.get_string("recui_startactivity","filter_poodll"),i=M.util.get_string("recui_testmic","filter_poodll"),j=M.util.get_string("recui_stop","filter_poodll"),k=this.fetch_status_bar("readseed"),l="<div class=\"poodll_mediarecorderholder_readseed "+"poodll_mediarecorder_audio"+"\" id=\"holder_"+c+"\">";l+="<div class=\"poodll_mediarecorderbox_readseed\" id=\""+c+"\">";l+=this.devsettings.fetch_dialogue_box();l+=e.downloaddialog.fetch_dialogue_box();l+=e.errordialog.fetch_dialogue_box();l+="<div class=\"style-holder "+f+"\">";l+=d,l+="<div class=\"settingsicon\" id=\"settingsicon_"+c+"\"><button type=\"button\" class=\"btn btn-info btn-lg\" data-toggle=\"modal\" data-target=\"#myModal\"><i class=\"fa fa-cogs\" aria-hidden=\"true\"></i></button></div>";l+="<canvas id=\""+c+"_playcanvas\" class=\"poodll_mediarecorder_playcanvas_readseed\" width=\"180\" height=\"50\"></canvas>";l+="<span id=\""+c+"_caption\" class=\"poodll_mediarecorder_caption_readseed\"></span>";l+="<span id=\""+c+"_bogusstartbutton\" class=\"poodll_mediarecorder_bogusstartbutton_readseed\"></span>";l+="<span id=\""+c+"_bogusstopbutton\" class=\"poodll_mediarecorder_bogusstopbutton_readseed\"></span>";l+=k;l+="</div></div></div>";a(b).prepend(l);var m={settingsdialog:a("#"+c+" .poodll_dialogue_box_settings"),downloaddialog:a("#"+c+" .poodll_dialogue_box_download"),errorsdialog:a("#"+c+" .poodll_dialogue_box_errors"),settingsicon:a("#"+c+" .settingsicon"),status:a("#"+c+" .poodll_status_readseed"),preview:a("#"+c+" .poodll_preview_readseed"),bigbutton:a("#"+c+".poodll_mediarecorderbox_readseed"),playcanvas:a("#"+c+"_playcanvas"),thecaption:a("#"+c+"_caption"),stopbutton:a("#"+c+" .poodll_mediarecorder_bogusstopbutton_readseed"),startbutton:a("#"+c+" .poodll_mediarecorder_bogusstartbutton_readseed")};e.downloaddialog.set_dialogue_box(m.downloaddialog);e.errordialog.set_dialogue_box(m.errorsdialog);this.devsettings.set_dialogue_box(m.settingsdialog);return m},register_controlbar_events_video:function register_controlbar_events_video(a,b){return this.register_controlbar_events_audio(a,b)},register_controlbar_events_audio:function register_controlbar_events_audio(b,d){var f=this,h=this.pmr,i=this.fetch_instanceprops(d);i.config.recanim="hwave_mic";var e=g.clone();f.therecanim=e;e.init(i.audioanalyser,i.controlbar.playcanvas.get(0));this.set_visual_mode("testbuttonready",d);i.controlbar.bigbutton.click(function(c){if(c.target!==this&&!a(c.target).hasClass("poodll_mediarecorder_caption_readseed")&&!a(c.target).hasClass("poodll_mediarecorder_playcanvas_readseed")){return}switch(f.buttonmode){case"testbuttonready":var g={};g.type="recorderstatus";g.status="testbuttonrecording";i.config.hermes.postMessage(g);i.config.hermes.disable();i.timer.disable();var j=function(){if(i.mediaRecorder){h.do_stop_audio(i)}e.clear();i.config.hermes.enable();if(e.sounddetected){f.set_visual_mode("startbuttonready",d)}else{i.config.hermes.postMessage({type:"recorderstatus",status:"testrecordingfailed"});f.set_visual_mode("testbuttonready",d)}};h.do_start_audio(i,b);setTimeout(j,4e3);f.set_visual_mode("testbuttonrecording",d);break;case"startbuttonready":var k=function(){var a=new Date().getTime(),c=a-l;if(c>m){i.timer.enable();h.do_start_audio(i,b)}else{var d=!1;if(0>n&&0<c){d=m/1e3}else if(1e3>n&&1e3<c){d=m/1e3-1}else if(2e3>n&&2e3<c){d=m/1e3-2}if(d){var e={type:"countdownstatus",status:d};i.config.hermes.postMessage(e)}n=c;setTimeout(k,100)}};i.config.hermes.enable();f.set_visual_mode("startbuttoncountdown",d);var l=new Date().getTime(),m=3e3,n=-1;setTimeout(k,100);break;case"startbuttonrecording":if("1"==i.config.allowearlyexit&&i.timer.enabled){f.process_recording_stop(d)}break;case"stopbutton":f.process_recording_stop();}});i.controlbar.settingsicon.click(function(a){c.debug("we no proapagato");a.stopPropagation();if(!f.uploaded){f.devsettings.open()}else{i.downloaddialog.open()}});window.onbeforeunload=function(){}},process_recording_stop:function process_recording_stop(a){var b=this,c=this.pmr,d=this.fetch_instanceprops(a),e=b.therecanim;c.do_stop_audio(d);e.clear();d.timer.stop();b.update_status(a);var f=function(){if(d.blobs&&0<d.blobs.length){c.do_save_audio(d);d.uploaded=!0}else{setTimeout(f,200)}};setTimeout(f,200);b.set_visual_mode("uploading",a)},enable_button:function enable_button(b){a(b).attr("disabled",!1);a(b).removeClass("pmr_disabled")},disable_button:function disable_button(b){a(b).attr("disabled",!0);a(b).addClass("pmr_disabled")}}});
//# sourceMappingURL=poodll_readseedmediaskin.min.js.map
