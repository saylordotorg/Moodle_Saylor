{"version":3,"sources":["../src/poodll_scenariomediaskin.js"],"names":["define","$","log","utils","upskin_bar","debug","instanceprops","pmr","uploaded","recorded","played","mustResetResourcePlayer","clone","extend","init","ip","fetch_instanceprops","onUploadSuccess","controlbarid","hide","show","onUploadFailure","fetch_status_bar","skin","fetch_preview_audio","fetch_preview_video","fetch_resource_audio","fetch_resource_video","fetch_uploader_skin","element","upskin","config","controlbar","split_progresscanvas","status","onMediaError","e","console","error","onMediaSuccess_video","stopbutton","attr","savebutton","onMediaSuccess_audio","checkplayer","handle_timer_update","recordingstring","M","util","get_string","update_status","timer","fetch_display_time","seconds","initseconds","click","text","html","set_visual_mode","mode","self","disable_button","resourceplaybutton","empty","addClass","enable_button","removeClass","insert_controlbar_video","resourceplayer","prepare_controlbar","insert_controlbar_audio","mediatype","skin_style","media_skin_style","recorder_class","replace","resource","ss","fetch_strings","controls","statushtml","append","prepend","scenario_progresscanvas","marker","resourcestopbutton","startbutton","playbackbutton","stopplaybackbutton","register_controlbar_events_video","onMediaSuccess","register_controlbar_events_audio","do_callback","args","filenamecontrol","document","getElementById","parent","value","callbackjs","do_start_audio","reset","start","do_stop_resource","do_stop_audio","setTimeout","stop","navigator","mediaDevices","getUserMedia","then","trigger","do_play_resource","catch","err","alert","blobs","length","do_save_audio","uploader","Output","set_completion","completed","completioncheck","get","pause","currentTime","src","load","play","button"],"mappings":"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","sourcesContent":["/* jshint ignore:start */\r\ndefine(['jquery', 'core/log', 'filter_poodll/utils_amd', 'filter_poodll/upskin_bar'], function ($, log, utils, upskin_bar) {\r\n\r\n    \"use strict\"; // jshint ;_;\r\n\r\n    log.debug('PoodLL Scenario Skin: initialising');\r\n\r\n    return {\r\n\r\n        instanceprops: null,\r\n        pmr: null,\r\n        uploaded: false,\r\n        recorded: false,\r\n        played: false,\r\n        mustResetResourcePlayer: false,\r\n\r\n        //for making multiple instances\r\n        clone: function () {\r\n            return $.extend(true, {}, this);\r\n        },\r\n\r\n        init: function (ip, pmr) {\r\n            this.instanceprops = ip;\r\n            this.pmr = pmr;\r\n        },\r\n\r\n\r\n        fetch_instanceprops: function () {\r\n            return this.instanceprops;\r\n        },\r\n\r\n\r\n        onUploadSuccess: function (controlbarid) {\r\n            $('#' + controlbarid + ' > .poodll_save-recording').hide();\r\n            // $('#' + controlbarid  + '_messages').hide();\r\n            $('#' + controlbarid + ' > .poodll_savedsuccessfully').show();\r\n        },\r\n\r\n        onUploadFailure: function (controlbarid) {\r\n            return;\r\n        },\r\n\r\n        fetch_status_bar: function (skin) {\r\n            var status = '<div class=\"poodll_status_' + skin + '\"></div>';\r\n            return status;\r\n        },\r\n\r\n        fetch_preview_audio: function (skin) {\r\n            var checkplayer = '<audio class=\"poodll_checkplayer_' + skin + ' hide\" controls playsinline=\"playsinline\"></audio>';\r\n            return checkplayer;\r\n        },\r\n        fetch_preview_video: function (skin) {\r\n            var checkplayer = '<video class=\"poodll_checkplayer_' + skin + '\" width=\"320\" height=\"240\" playsinline=\"playsinline\"></video>';\r\n            return checkplayer;\r\n        },\r\n        fetch_resource_audio: function (skin) {\r\n            var resourceplayer = '<audio class=\"poodll_resourceplayer_' + skin + ' hide\" src=\"@@RESOURCEURL@@\" playsinline controls></audio>';\r\n            return resourceplayer;\r\n        },\r\n        fetch_resource_video: function (skin) {\r\n            var resourceplayer = '<video class=\"poodll_resourceplayer_' + skin + ' hide\" src=\"@@RESOURCEURL@@\" playsinline=\"playsinline\"></video>';\r\n            return resourceplayer;\r\n        },\r\n        fetch_uploader_skin: function (controlbarid, element) {\r\n            var ip = this.fetch_instanceprops(controlbarid);\r\n            var upskin = upskin_bar.clone();\r\n            upskin.init(ip.config, element, ip.controlbar.split_progresscanvas, ip.controlbar.status);\r\n            return upskin;\r\n        },\r\n        onMediaError: function (e) {\r\n            console.error('media error', e);\r\n        },\r\n\r\n        onMediaSuccess_video: function (controlbarid) {\r\n            var ip = this.fetch_instanceprops(controlbarid);\r\n            ip.controlbar.stopbutton.attr('disabled', false);\r\n            ip.controlbar.savebutton.attr('disabled', false);\r\n        },\r\n\r\n        onMediaSuccess_audio: function (controlbarid) {\r\n            var ip = this.fetch_instanceprops(controlbarid);\r\n            ip.controlbar.checkplayer.attr('src', null);\r\n            ip.controlbar.stopbutton.attr('disabled', false);\r\n            ;\r\n            ip.controlbar.savebutton.attr('disabled', false);\r\n        },\r\n\r\n        handle_timer_update: function (controlbarid) {\r\n            if (!this.played && !this.recorded) {\r\n                return;\r\n            }\r\n            var ip = this.fetch_instanceprops(controlbarid);\r\n            var recordingstring = M.util.get_string('recui_recording', 'filter_poodll');\r\n            this.update_status(controlbarid, recordingstring + ip.timer.fetch_display_time());\r\n            if (ip.timer.seconds == 0 && ip.timer.initseconds > 0) {\r\n                ip.controlbar.stopbutton.click();\r\n            }\r\n        },\r\n\r\n        update_status: function (controlbarid, text) {\r\n            var ip = this.fetch_instanceprops(controlbarid);\r\n            ip.controlbar.status.html(text);\r\n        },\r\n\r\n        //set visuals for different states (ie recording or playing)\r\n        set_visual_mode: function (mode, ip) {\r\n            var self = this;\r\n\r\n            switch (mode) {\r\n\r\n                case 'recordingmode':\r\n                    self.disable_button(ip.controlbar.resourceplaybutton);\r\n                    ip.controlbar.resourceplaybutton.empty();\r\n                    ip.controlbar.resourceplaybutton.html('<span class=\"fa fa-microphone fa-3x\"></span>');\r\n                    ip.controlbar.resourceplaybutton.addClass('poodll_mediarecorderholder_scenario_recordcolor');\r\n                    ip.controlbar.status.addClass('poodll_mediarecorderholder_scenario_recordcolor');\r\n                    self.handle_timer_update(ip.controlbarid);\r\n                    self.enable_button(ip.controlbar.stopbutton);\r\n                    break;\r\n\r\n                case 'resourceplayingmode':\r\n                    self.disable_button(ip.controlbar.resourceplaybutton);\r\n                    self.disable_button(ip.controlbar.stopbutton);\r\n                    break;\r\n\r\n\r\n                case 'neverrecordedmode':\r\n                    ip.controlbar.resourceplaybutton.empty();\r\n                    ip.controlbar.resourceplaybutton.html('<p style=\"margin-bottom: 0px; font-size: 24px;\">Start</p>');\r\n\r\n                    self.enable_button(ip.controlbar.resourceplaybutton);\r\n                    self.disable_button(ip.controlbar.stopbutton);\r\n\r\n                    this.update_status(ip.controlbarid, M.util.get_string('recui_ready', 'filter_poodll'));\r\n                    break;\r\n\r\n                case 'allstoppedmode':\r\n                    self.disable_button(ip.controlbar.resourceplaybutton);\r\n                    self.disable_button(ip.controlbar.stopbutton);\r\n                    ip.controlbar.resourceplaybutton.empty();\r\n                    ip.controlbar.resourceplaybutton.html('<span class=\"fa fa-check fa-3x\"></span>');\r\n                    ip.controlbar.resourceplaybutton.removeClass('poodll_mediarecorderholder_scenario_recordcolor');\r\n                    ip.controlbar.status.removeClass('poodll_mediarecorderholder_scenario_recordcolor');\r\n                    this.update_status(ip.controlbarid, M.util.get_string('recui_finished', 'filter_poodll'));\r\n                    break;\r\n            }\r\n\r\n        },\r\n\r\n        //insert the control bar and return it to be reused\r\n        insert_controlbar_video: function (element, controlbarid, checkplayer, resourceplayer) {\r\n            var controlbar = this.prepare_controlbar(element, controlbarid, checkplayer, resourceplayer, 'video');\r\n            return controlbar;\r\n        },\r\n        //insert the control bar and return it to be reused\r\n        insert_controlbar_audio: function (element, controlbarid, checkplayer, resourceplayer) {\r\n            var controlbar = this.prepare_controlbar(element, controlbarid, checkplayer, resourceplayer, 'audio');\r\n            return controlbar;\r\n        },\r\n\r\n        //insert the control bar and return it to be reused\r\n        prepare_controlbar: function (element, controlbarid, checkplayer, resourceplayer, mediatype) {\r\n            var ip = this.fetch_instanceprops(controlbarid);\r\n            var skin_style = ip.config.media_skin_style;\r\n\r\n            var recorder_class = mediatype == 'video' ? 'poodll_mediarecorder_video' : 'poodll_mediarecorder_audio';\r\n\r\n            //load resource player with the src of the resource audio (or video ...never)\r\n            resourceplayer = resourceplayer.replace('@@RESOURCEURL@@', ip.config.resource);\r\n\r\n\r\n            var ss = this.pmr.fetch_strings();\r\n            var controls = '<div class=\"poodll_mediarecorderholder_scenario '\r\n                + recorder_class + '\" id=\"holder_' + controlbarid + '\">';\r\n\r\n            controls += '<div class=\"poodll_mediarecorderbox_scenario\" id=\"' + controlbarid + '\">';\r\n            controls += '<div class=\"style-holder ' + skin_style + '\">';\r\n\r\n            controls += checkplayer,\r\n                controls += resourceplayer,\r\n\r\n\r\n                //this is never displayed\r\n                controls += '<button type=\"button\" class=\"poodll_mediarecorder_button_scenario poodll_start-recording_scenario hide\">'\r\n                    + '<span class=\"fa fa-microphone fa-3x\"></span>'\r\n                    + '</button>';\r\n\r\n            //this is never displayed\r\n            controls += ' <button type=\"button\" class=\"poodll_mediarecorder_button_scenario poodll_playback-recording_scenario hide\">'\r\n                + '<span class=\"fa fa-play-circle fa-3x\"></span>'\r\n                + '</button>';\r\n\r\n            //this is never displayed\r\n            controls += ' <button type=\"button\" class=\"poodll_mediarecorder_button_scenario poodll_stopplayback-recording_scenario hide\">'\r\n                + '<span class=\"fa fa-stop-circle fa-3x\"></span>'\r\n                + '</button>';\r\n\r\n            //this is never displayed\r\n            controls += '<button type=\"button\" class=\"poodll_save-recording_scenario pmr_disabled hide\">' + ss['recui_save'] + '</button></div>';\r\n\r\n            //this IS displayed\r\n            controls += '<div class=\"poodll_mediarecorderholder_scenario\"><button type=\"button\" class=\"poodll_mediarecorder_button_scenario poodll_stop-recording_scenario pmr_disabled\" disabled>'\r\n                + '<p style=\"margin-bottom: 0px;font-size: 24px;\">Submit</p>'\r\n                + '</button></div>';\r\n\r\n            controls += '<div class=\"poodll_statusholder_scenario\" >';\r\n            controls += '<canvas class=\"scenario_range\"></canvas>';\r\n            var statushtml = this.fetch_status_bar('scenario');\r\n            controls += statushtml;\r\n            controls += '</div>';\r\n\r\n\r\n            //end if div\r\n            controls += '</div></div></div>';\r\n\r\n            // add to the page\r\n            $(element).append(controls);\r\n\r\n\r\n            //play button\r\n            var playbuttonhtml = '<button type=\"button\" class=\"poodll_mediarecorder_button_scenario poodll_play-resource_scenario\">'\r\n                + '<p style=\"margin-bottom: 0px; font-size: 24px;\">Start</p></button>';\r\n            var topscenario = '<div class=\"poodll_mediarecorderholder_scenario poodll_mediarecorder_scenario_topscenario\">' + playbuttonhtml + '</div>';\r\n\r\n            //divider\r\n            var divider = \"<hr />\";\r\n\r\n            //prepend the top scenario\r\n            $('.qtext').prepend(divider);\r\n            $('.qtext').prepend(topscenario);\r\n\r\n\r\n            var controlbar = {\r\n                scenario_progresscanvas: $('#' + controlbarid + ' .scenario_range'),\r\n                marker: $('#' + controlbarid + '  .marker'),\r\n                resourceplayer: $('#' + controlbarid + '  .poodll_resourceplayer_scenario'),\r\n                checkplayer: $('#' + controlbarid + '  .poodll_checkplayer_scenario'),\r\n                stopbutton: $('#' + controlbarid + '  .poodll_stop-recording_scenario'),\r\n                resourcestopbutton: $('#' + controlbarid + '  .poodll_stop-resource_scenario'),\r\n                startbutton: $('#' + controlbarid + '  .poodll_start-recording_scenario'),\r\n                playbackbutton: $('#' + controlbarid + '  .poodll_playback-recording_scenario'),\r\n                stopplaybackbutton: $('#' + controlbarid + '  .poodll_stopplayback-recording_scenario'),\r\n                savebutton: $('#' + controlbarid + '  .poodll_save-recording_scenario'),\r\n\r\n\r\n                //these are actually outside the control bar above the question text\r\n                resourceplaybutton: $('.poodll_mediarecorder_button_scenario.poodll_play-resource_scenario'),\r\n                status: $('.poodll_status_scenario'),\r\n            };\r\n            return controlbar;\r\n        }, //end of fetch_control_bar_scenario\r\n\r\n\r\n        register_controlbar_events_video: function (onMediaSuccess, controlbarid) {\r\n            return this.register_controlbar_events_audio(onMediaSuccess, controlbarid);\r\n        },\r\n\r\n        do_callback: function (args) {\r\n            //log.debug(args);\r\n            //args will look like this\r\n            /*\r\n            0:\"recorderbase5a367e03c2f9319\"\r\n            1:\"filesubmitted\"\r\n            2:\"poodllfile5a367e03c2f9318.mp3\"\r\n            3:\"q101:1_answer_id\"\r\n            */\r\n            switch (args[1]) {\r\n\r\n                case 'filesubmitted':\r\n                    //record the url on the html page,\r\n                    var filenamecontrol = document.getElementById(args[3]);\r\n                    if (filenamecontrol == null) {\r\n                        filenamecontrol = parent.document.getElementById(args[3]);\r\n                    }\r\n                    if (filenamecontrol) {\r\n                        filenamecontrol.value = args[2];\r\n                    }\r\n\r\n                    //enable the next button\r\n                    $('#responseform input[name=next]').attr('disabled', false);\r\n                //we used to click it. But client doesn't want that\r\n                // $('#responseform input[name=next]').click();\r\n            }\r\n        },\r\n\r\n\r\n        register_controlbar_events_audio: function (onMediaSuccess, controlbarid) {\r\n\r\n            var self = this;\r\n            var pmr = this.pmr;\r\n            var ip = this.fetch_instanceprops(controlbarid);\r\n\r\n            this.set_visual_mode('neverrecordedmode', ip);\r\n            ip.config.callbackjs = self.do_callback;\r\n\r\n            //disable the forms next button.\r\n            //its not a recorder button so we do not use our disable_button method here\r\n            $('#responseform input[name=next]').attr('disabled', true);\r\n\r\n\r\n            function poodll_resource_play(count_down) {\r\n                var cd;\r\n                var playingstring = M.util.get_string('recui_playing', 'filter_poodll');\r\n                self.update_status(controlbarid, playingstring + ip.timer.fetch_display_time(count_down));\r\n                cd = setInterval(function () {\r\n                    count_down--;\r\n                    if (count_down < 0) {\r\n                        clearInterval(cd);\r\n                    } else {\r\n                        self.update_status(controlbarid, playingstring + ip.timer.fetch_display_time(count_down));\r\n                    }\r\n                }, 1000);\r\n            }\r\n\r\n            /*\r\n            //this code was for the case when the recording should start AFTER the playback ends\r\n            ip.controlbar.resourceplayer.on('ended', function() {\r\n                ip.controlbar.startbutton.trigger( \"click\" );\r\n            });\r\n            */\r\n\r\n\r\n            ip.controlbar.startbutton.click(function () {\r\n\r\n                pmr.do_start_audio(ip, onMediaSuccess);\r\n                self.recorded = true;\r\n\r\n                //recording timer setup\r\n                ip.timer.reset();\r\n                ip.timer.start();\r\n\r\n                self.set_visual_mode('recordingmode', ip);\r\n\r\n\r\n            });\r\n\r\n            ip.controlbar.stopbutton.click(function () {\r\n                //stop playing\r\n                self.do_stop_resource(ip);\r\n                //stop recording\r\n                pmr.do_stop_audio(ip);\r\n                self.disable_button(this);\r\n\r\n                //click the 'save' button\r\n                //this timeout is ugly but we just need a few ms for the blobs to arrive\r\n                setTimeout(function () {\r\n                    ip.controlbar.savebutton.click();\r\n                }, 100);\r\n\r\n\r\n                //recording timer\r\n                ip.timer.stop();\r\n                self.set_visual_mode('allstoppedmode', ip);\r\n\r\n\r\n            });\r\n\r\n\r\n            ip.controlbar.resourceplaybutton.click(function () {\r\n\r\n                //we do not want to start the timer or get going if recording is off limits\r\n                //so we first call getUserMedia, and force a permissions check\r\n                navigator.mediaDevices.getUserMedia({\"audio\": true}).then(function (stream) {\r\n                    ip.controlbar.startbutton.trigger(\"click\");\r\n\r\n                    //flag played\r\n                    self.played = true;\r\n\r\n\r\n                    if (ip.config.resource != '') {\r\n                        self.do_play_resource(ip);\r\n                    }\r\n\r\n\r\n                }).catch(function (err) {\r\n                    alert(err);\r\n                });\r\n\r\n\r\n            });\r\n\r\n            ip.controlbar.resourcestopbutton.click(function () {\r\n                self.do_stop_resource(ip);\r\n\r\n                //do visuals\r\n                if (self.recorded) {\r\n                    self.set_visual_mode('allstoppedmode', ip);\r\n                } else {\r\n                    self.set_visual_mode('neverrecordedmode', ip);\r\n                }\r\n\r\n            });\r\n\r\n            ip.controlbar.savebutton.click(function () {\r\n                self.disable_button(this);\r\n                if (ip.blobs && ip.blobs.length > 0) {\r\n                    pmr.do_save_audio(ip);\r\n                    self.uploaded = true;\r\n                    self.disable_button(ip.controlbar.startbutton);\r\n                } else {\r\n                    ip.uploader.Output(M.util.get_string('recui_nothingtosaveerror', 'filter_poodll'));\r\n                }//end of if self.blobs\t\t\r\n                //probably not necessary  ... but getting odd ajax errors occasionally\r\n                return false;\r\n            });//end of save recording\r\n        }, //end of register_control_bar_events_scenario\r\n\r\n        set_completion: function (completed, ip) {\r\n            /*On hold for now Justin 20171007 */\r\n            return;\r\n\r\n            var completioncheck = ip.controlbar.completioncheck;\r\n            if (completed) {\r\n                completioncheck.removeClass('fa-circle');\r\n                completioncheck.addClass('fa-check-circle');\r\n            } else {\r\n                completioncheck.removeClass('fa-check-circle');\r\n                completioncheck.addClass('fa-circle');\r\n            }\r\n        },\r\n\r\n        //DO stop playing the resource\r\n        do_stop_resource: function (ip) {\r\n            console.log('stopped the resource');\r\n            var resourceplayer = ip.controlbar.resourceplayer.get(0);\r\n            resourceplayer.pause();\r\n            resourceplayer.currentTime = 0;\r\n\r\n            if (ip.mustResetResourcePlayer) {\r\n                ip.mustResetResourcePlayer = false;\r\n                resourceplayer.src = ip.config.resource;\r\n                var ppromise = resourceplayer.load();\r\n                /* \r\n\t\t\t\t// playPromise wonâ€™t be defined.\r\n\t\t\t\tif (ppromise !== undefined) {\r\n\t\t\t\t\tppromise.then(function() {resourceplayer.pause();});\r\n\t\t\t\t}else{\r\n\t\t\t\t\tresourceplayer.oncanplay(resourceplayer.pause());\r\n\t\t\t\t}\r\n\t\t\t\t*/\r\n            }\r\n        },\r\n\r\n\r\n        //do the play of resource\r\n        do_play_resource: function (ip) {\r\n            //if was used to play recording, we need to reset it\r\n            var resourceplayer = ip.controlbar.resourceplayer.get(0);\r\n            resourceplayer.play();\r\n            resourceplayer.currentTime = 0;\r\n        },\r\n\r\n        enable_button: function (button) {\r\n            $(button).attr('disabled', false);\r\n            $(button).removeClass('pmr_disabled');\r\n        },\r\n        disable_button: function (button) {\r\n            $(button).attr('disabled', true);\r\n            $(button).addClass('pmr_disabled');\r\n        },\r\n\r\n    };//end of returned object\r\n\r\n\r\n});//total end\r\n"],"file":"poodll_scenariomediaskin.min.js"}