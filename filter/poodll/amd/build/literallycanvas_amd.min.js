define(["jquery","core/log","filter_poodll/utils_amd","filter_poodll/uploader","filter_poodll/react_amd","filter_poodll/literallycanvas"],function(a,b,c,d,e,f){"use strict";return b.debug("Filter PoodLL: literallycanvas.js initialising"),{instanceprops:[],loadliterallycanvas:function(b){var c="#amdopts_"+b.recorderid,e=a(c).get(0);e&&(b=JSON.parse(e.value),this.config=b,a(c).remove());var g="#"+b.recorderid+"_literally",h=a(g)[0],i=4,j=.2;if(b.whiteboardnozoom>0&&(i=1,j=1),b.backgroundimage){var k=a("#"+b.recorderid+"_separate-background-image")[0],l=new Image;l.src=k.src,l.crossOrigin="Anonymous";var m=f.createShape("Image",{x:0,y:0,image:l,scale:1}),n=f.init(h,{imageURLPrefix:b.imageurlprefix,backgroundColor:b.backgroundcolor,backgroundShapes:[m],recorderid:b.recorderid,zoomMax:i,zoomMin:j})}else var n=f.init(h,{imageURLPrefix:b.imageurlprefix,backgroundColor:b.backgroundcolor,recorderid:b.recorderid,zoomMax:i,zoomMin:j});b.lc=n;var o=b.vectordata;o&&(0!=o.indexOf('{"shapes"')&&0!=o.indexOf('{"colors"')||n.loadSnapshot(JSON.parse(o))),b.uploader=d.clone(),b.uploader.init(g,b),this.instanceprops[b.recorderid]=b,this.registerEvents(b.recorderid)},registerEvents:function(b){var d=this.instanceprops[b];d.autosave?d.lc.on("drawingChange",function(){var e=a("#"+b+"_messages")[0],f=a("#"+b+"_btn_upload_whiteboard")[0];if(e){f&&(f.disabled=!1),e.innerHTML="";var g=c.timeouthandles[b];g&&clearTimeout(g),c.timeouthandles[b]=setTimeout(function(){c.WhiteboardUploadHandler(b,d.lc,d,d.uploader)},d.autosave)}}):d.lc.on("drawingChange",function(){var c=a("#"+b+"_messages");c&&(c.innerHTML="File has not been saved.")});var e="#"+b+"_btn_upload_whiteboard",f=a(e);f&&(d.autosave?f.click(function(){c.WhiteboardUploadHandler(b,d.lc,d,d.uploader)}):f.click(function(){var a=c.getCvs(b,d.lc,d);c.pokeVectorData(b,d.lc,d),d.uploader.uploadFile(a.toDataURL(),"image/png")}))}}});