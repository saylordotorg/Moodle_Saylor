define ("tool_certificate/template-edit",["jquery","jqueryui","tool_certificate/modal_form","core/notification","core/str","core/ajax","core/sortable_list"],function(a,b,c,d,f,g,h){var i=function(b){b.preventDefault();var d=a(b.currentTarget),e=d.attr("data-id"),g=d.attr("data-name"),h=new c({formClass:"tool_certificate\\form\\details",args:{id:e},modalConfig:{title:f.get_string("editcertificate","tool_certificate",g)},saveButtonText:f.get_string("save"),triggerElement:d});h.onSubmitSuccess=function(){window.location.reload()}},j=function(b){b.preventDefault();f.get_strings([{key:"confirm",component:"moodle"},{key:"deleteelementconfirm",component:"tool_certificate",param:a(b.currentTarget).attr("data-name")},{key:"delete",component:"moodle"},{key:"cancel",component:"moodle"}]).done(function(c){d.confirm(c[0],c[1],c[2],c[3],function(){var c=g.call([{methodname:"tool_certificate_delete_element",args:{id:a(b.currentTarget).attr("data-id")}}]);c[0].done(function(){window.location.reload()}).fail(d.exception)})}).fail(d.exception)},k=function(b){b.preventDefault();if(a(b.currentTarget).hasClass("isdragged")){return}var d=new c({formClass:"tool_certificate\\edit_element_form",args:{id:a(b.currentTarget).attr("data-id")},modalConfig:{title:f.get_string("editelement","tool_certificate",a(b.currentTarget).attr("data-name"))},saveButtonText:f.get_string("save"),triggerElement:a(b.currentTarget)});d.onSubmitSuccess=function(){window.location.reload()}},l=function(b){b.preventDefault();var d=a(b.currentTarget).attr("data-pageid"),e=a(b.currentTarget).attr("data-element"),g=new c({formClass:"tool_certificate\\edit_element_form",args:{pageid:d,element:e},modalConfig:{title:f.get_string("addelementwithname","tool_certificate",a(b.currentTarget).text())},saveButtonText:f.get_string("save"),triggerElement:a(b.currentTarget)});g.onSubmitSuccess=function(){window.location.reload()}},m=function(b){b.preventDefault();f.get_strings([{key:"confirm",component:"moodle"},{key:"deletepageconfirm",component:"tool_certificate"},{key:"delete",component:"moodle"},{key:"cancel",component:"moodle"}]).done(function(c){d.confirm(c[0],c[1],c[2],c[3],function(){window.location.href=a(b.currentTarget).attr("href")})}).fail(d.exception)},n=function(b){b.preventDefault();var d=new c({formClass:"tool_certificate\\form\\page",args:{templateid:a("[data-region=\"template\"][data-id]").attr("data-id")},modalConfig:{title:f.get_string("addcertpage","tool_certificate")},saveButtonText:f.get_string("save"),triggerElement:a(b.currentTarget)});d.onSubmitSuccess=function(){window.location.reload()}},o=function(b){b.preventDefault();var d=new c({formClass:"tool_certificate\\form\\page",args:{id:a(b.currentTarget).attr("data-id")},modalConfig:{title:f.get_string("editpage","tool_certificate",a(b.currentTarget).attr("data-pagenumber"))},saveButtonText:f.get_string("save"),triggerElement:a(b.currentTarget)});d.onSubmitSuccess=function(){window.location.reload()}},p=function(){a("[data-region=\"page\"]").each(function(){var b=new h(a(this).find("[data-region=\"elementlist\"]"));b.getElementName=function(b){return a.Deferred().resolve(b.find("a.quickeditlink").text())};a(this).on(h.EVENTS.DROP,"[data-region=\"elementlist\"] > *",function(a,b){if(b.positionChanged){var c={methodname:"tool_certificate_update_element",args:{id:b.element.data("id"),sequence:b.element.index()+1}};g.call([c])[0].fail(d.exception)}})})},q=function(a){return 2*parseFloat(a)},r=function(a){return Math.round(parseFloat(a)/2)},s=function(a){return .352778*q(a)},t=function(){var b=a(this);b.css("width",q(b.data("pagewidth"))+"px");b.css("height",q(b.data("pageheight"))+"px");b.find("[data-width]").each(function(){a(this).css("width",q(a(this).data("width"))+"px")});b.find("[data-height]").each(function(){a(this).css("height",q(a(this).data("height"))+"px")});b.find("[data-fontsize]").each(function(){a(this).css("font-size",s(a(this).data("fontsize"))+"px")});b.find("[data-posy]").each(function(){a(this).css("top",q(a(this).data("posy"))+"px")});b.find("[data-posx]").each(function(){var b=q(a(this).data("posx")),c=a(this).data("refpoint")?parseInt(a(this).data("refpoint")):0,d=c?parseInt(a(this).width())*c/2:0;a(this).css("left",b-d+"px")});b.addClass("recalculated");b.find("[data-drag-type=\"move\"]").draggable()},u=function(){a("body").on("mousedown","[data-region=\"pdf\"] [data-drag-type=\"move\"]",function(b){var c=a(b.currentTarget),d=c.closest("[data-region=\"pdf\"]");d.find("[data-region=\"pagecenter\"]").css("left",q(d.data("pagecentre"))-c.width()/2+"px").css("width",c.width()+"px");c.draggable({snap:b.shiftKey?!1:".snapdraggable",snapMode:"inner",snapTolerance:10,containment:[d.offset().left-c.width(),d.offset().top-c.height(),d.offset().left+q(d.data("pagewidth")),d.offset().top+q(d.data("pageheight"))]})}).on("dragstart","[data-region=\"pdf\"] [data-drag-type=\"move\"]",function(b){a(b.currentTarget).addClass("isdragged")}).on("dragstop","[data-region=\"pdf\"] [data-drag-type=\"move\"]",function(b){var c=a(b.currentTarget),e=c.closest("[data-region=\"pdf\"]"),f=parseInt(a(this).data("refpoint")),h=f?parseInt(a(this).width())*f/2:0,i=r(c.offset().left-e.offset().left+h),j=r(c.offset().top-e.offset().top);setTimeout(function(){c.removeClass("isdragged")},100);var k={methodname:"tool_certificate_update_element",args:{id:c.data("id"),posx:i,posy:j}};g.call([k])[0].fail(d.exception)})};return{init:function init(){a("[data-action=\"editdetails\"]").on("click",i);a("[data-action=\"deleteelement\"]").on("click",j);a("[data-action=\"editelement\"]").on("click",k);a("[data-action=\"addelement\"]").on("click",l);a("[data-action=\"deletepage\"]").on("click",m);a("[data-element=\"addbutton\"]").on("click",n);a("[data-action=\"editpage\"]").on("click",o);p();u();a("[data-region=\"pdf\"]").each(t)}}});
//# sourceMappingURL=template-edit.min.js.map
