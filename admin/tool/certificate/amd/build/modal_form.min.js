define ("tool_certificate/modal_form",["jquery","core/modal_factory","core/modal_events","core/ajax","core/notification","core/yui","core/event","core/str"],function(a,b,c,d,e,f,g,h){var i=function(a){this.config=a;this.config.modalConfig=this.config.modalConfig||{};this.config.modalConfig.type=this.config.modalConfig.type||b.types.SAVE_CANCEL;this.config.args=this.config.args||{};this.init()};i.prototype.config={};i.prototype.modal=null;i.prototype.init=function(){M.util.js_pending("tool_certificate_modal_form_init");h.get_strings([{key:"collapseall",component:"moodle"},{key:"expandall",component:"moodle"}]).then(function(){return b.create(this.config.modalConfig)}.bind(this)).then(function(b){this.modal=b;this.modal.setBody(this.getBody(a.param(this.config.args)));this.modal.setLarge();this.modal.getRoot().on(c.hidden,function(){g.notifyFormSubmitAjax(this.modal.getRoot().find("form")[0],!0);this.modal.destroy();this.resetDirtyFormState();if(null!==this.config.triggerElement){this.config.triggerElement.focus()}}.bind(this));this.modal.getModal().addClass("tool-wp-modal-form-dialogue");this.modal.getRoot().on("click","form input[type=submit][data-no-submit]",this.noSubmitButtonPressed.bind(this));this.modal.getRoot().on("submit","form",this.submitFormAjax.bind(this));if("undefined"!=typeof this.config.saveButtonText&&"undefined"!=typeof this.modal.setSaveButtonText){this.modal.setSaveButtonText(this.config.saveButtonText)}this.onInit();this.modal.show();M.util.js_complete("tool_certificate_modal_form_init");return this.modal}.bind(this)).fail(e.exception)};i.prototype.onInit=function(){this.modal.getRoot().on(c.save,this.submitForm.bind(this))};i.prototype.getBody=function(b){var c=a.Deferred(),e={formdata:b,form:this.config.formClass};M.util.js_pending("tool_certificate_modal_form_body");d.call([{methodname:"tool_certificate_modal_form",args:e}])[0].then(function(a){c.resolve(a.html,j(a.javascript));M.util.js_complete("tool_certificate_modal_form_body");return null}).fail(function(a){c.reject(a)});return c.promise()};i.prototype.onSubmitSuccess=function(a){return a};i.prototype.onValidationError=function(){};i.prototype.onSubmitError=function(a){e.exception(a)};i.prototype.resetDirtyFormState=function(){f.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()})};i.prototype.noSubmitButtonPressed=function(b){b.preventDefault();g.notifyFormSubmitAjax(this.modal.getRoot().find("form")[0],!0);var c=this.modal.getRoot().find("form").serialize(),d=a(b.currentTarget);c=c+"&"+encodeURIComponent(d.attr("name"))+"="+encodeURIComponent(d.attr("value"));this.modal.setBody(this.getBody(c))};i.prototype.validateElements=function(){g.notifyFormSubmitAjax(this.modal.getRoot().find("form")[0]);var b=a.merge(this.modal.getRoot().find("[aria-invalid=\"true\"]"),this.modal.getRoot().find(".error"));if(b.length){b.first().focus();return!1}return!0};i.prototype.disableButtons=function(){this.modal.getFooter().find("[data-action]").attr("disabled",!0)};i.prototype.enableButtons=function(){this.modal.getFooter().find("[data-action]").removeAttr("disabled")};i.prototype.submitFormAjax=function(b){b.preventDefault();if(!this.validateElements()){return}this.disableButtons();var c=this.modal.getRoot().find("form").serialize();d.call([{methodname:"tool_certificate_modal_form",args:{formdata:c,form:this.config.formClass}}])[0].then(function(b){if(!b.submitted){var c=a.Deferred();c.resolve(b.html,j(b.javascript));this.modal.setBody(c.promise());this.enableButtons();this.onValidationError()}else{var d=JSON.parse(b.data);this.modal.hide();this.onSubmitSuccess(d)}return null}.bind(this)).fail(this.onSubmitError.bind(this))};i.prototype.submitForm=function(a){a.preventDefault();this.modal.getRoot().find("form").submit()};var j=function(b){var c=a(b),d="";c.each(function(b,c){c=a(c);var e=c.prop("tagName");if(e&&"script"===e.toLowerCase()){if(c.attr("src")){var f=!1;a("script").each(function(b,d){if(a(d).attr("src")===c.attr("src")){f=!0}return!f});if(!f){d+=" { ";d+=" node = document.createElement(\"script\"); ";d+=" node.type = \"text/javascript\"; ";d+=" node.src = decodeURI(\""+encodeURI(c.attr("src"))+"\"); ";d+=" document.getElementsByTagName(\"head\")[0].appendChild(node); ";d+=" } "}}else{d+=" "+c.text()}}});return d};return i});
//# sourceMappingURL=modal_form.min.js.map
