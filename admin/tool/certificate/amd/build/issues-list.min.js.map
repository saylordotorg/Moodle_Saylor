{"version":3,"file":"issues-list.min.js","sources":["../src/issues-list.js"],"sourcesContent":["// This file is part of the tool_certificate plugin for Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD module used when viewing the list of issued certificates\n *\n * @module     tool_certificate/issues-list\n * @copyright  2019 Marina Glancy\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery',\n        'tool_certificate/modal_form',\n        'core/notification',\n        'core/str',\n        'core/ajax',\n        'core/toast'],\nfunction($,\n         ModalForm,\n         Notification,\n         Str,\n         Ajax,\n         Toast) {\n\n    const SELECTORS = {\n        ADDISSUE: \"[data-element='addbutton']\",\n        REGENERATEFILE: \"[data-action='regenerate']\",\n        REVOKEISSUE: \"[data-action='revoke']\"\n    };\n\n    /**\n     * Add issue dialogue\n     * @param {Event} e\n     */\n    var addIssue = function(e) {\n        e.preventDefault();\n        var modal = new ModalForm({\n            formClass: 'tool_certificate\\\\form\\\\certificate_issues',\n            args: {tid: $(e.currentTarget).attr('data-tid')},\n            modalConfig: {title: Str.get_string('issuecertificates', 'tool_certificate'), scrollable: false},\n            saveButtonText: Str.get_string('save'),\n            triggerElement: $(e.currentTarget),\n        });\n        modal.onSubmitSuccess = function(data) {\n            data = parseInt(data, 10);\n            if (data) {\n                Str.get_strings([\n                    {key: 'oneissuewascreated', component: 'tool_certificate'},\n                    {key: 'aissueswerecreated', component: 'tool_certificate', param: data}\n                ]).done(function(s) {\n                    var str = data > 1 ? s[1] : s[0];\n                    Toast.add(str);\n                });\n                window.location.reload();\n            } else {\n                Str.get_string('noissueswerecreated', 'tool_certificate')\n                    .done(function(s) {\n                        Toast.add(s);\n                    });\n            }\n        };\n    };\n\n    /**\n     * Revoke issue\n     * @param {Event} e\n     */\n    var revokeIssue = function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        Str.get_strings([\n            {key: 'confirm', component: 'moodle'},\n            {key: 'revokecertificateconfirm', component: 'tool_certificate'},\n            {key: 'revoke', component: 'tool_certificate'},\n            {key: 'cancel', component: 'moodle'}\n        ]).done(function(s) {\n            Notification.confirm(s[0], s[1], s[2], s[3], function() {\n                var promises = Ajax.call([\n                    {methodname: 'tool_certificate_revoke_issue',\n                        args: {id: $(e.currentTarget).attr('data-id')}}\n                ]);\n                promises[0].done(function() {\n                    window.location.reload();\n                }).fail(Notification.exception);\n            });\n        }).fail(Notification.exception);\n    };\n\n    /**\n     * Revoke issue\n     * @param {Event} e\n     */\n    var regenerateIssueFile = function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        Str.get_strings([\n            {key: 'confirm', component: 'moodle'},\n            {key: 'regeneratefileconfirm', component: 'tool_certificate'},\n            {key: 'regenerate', component: 'tool_certificate'},\n            {key: 'cancel', component: 'moodle'}\n        ]).done(function(s) {\n            Notification.confirm(s[0], s[1], s[2], s[3], function() {\n                var promises = Ajax.call([\n                    {methodname: 'tool_certificate_regenerate_issue_file',\n                        args: {id: $(e.currentTarget).attr('data-id')}}\n                ]);\n                promises[0].done(function() {\n                    window.location.reload();\n                }).fail(Notification.exception);\n            });\n        }).fail(Notification.exception);\n    };\n\n    return {\n        /**\n         * Init page\n         */\n        init: function() {\n            // Add button is not inside a tab, so we can't use Tab.addButtonOnClick .\n            $('body')\n                .on('click', SELECTORS.ADDISSUE, addIssue)\n                .on('click', SELECTORS.REVOKEISSUE, revokeIssue)\n                .on('click', SELECTORS.REGENERATEFILE, regenerateIssueFile);\n        }\n    };\n});\n"],"names":["define","$","ModalForm","Notification","Str","Ajax","Toast","SELECTORS","addIssue","e","preventDefault","formClass","args","tid","currentTarget","attr","modalConfig","title","get_string","scrollable","saveButtonText","triggerElement","onSubmitSuccess","data","parseInt","get_strings","key","component","param","done","s","str","add","window","location","reload","revokeIssue","stopPropagation","confirm","call","methodname","id","fail","exception","regenerateIssueFile","init","on"],"mappings":";;;;;;;AAsBAA,sCAAO,CAAC,SACA,8BACA,oBACA,WACA,YACA,eACR,SAASC,EACAC,UACAC,aACAC,IACAC,KACAC,WAECC,mBACQ,6BADRA,yBAEc,6BAFdA,sBAGW,yBAObC,SAAW,SAASC,GACpBA,EAAEC,iBACU,IAAIR,UAAU,CACtBS,UAAW,6CACXC,KAAM,CAACC,IAAKZ,EAAEQ,EAAEK,eAAeC,KAAK,aACpCC,YAAa,CAACC,MAAOb,IAAIc,WAAW,oBAAqB,oBAAqBC,YAAY,GAC1FC,eAAgBhB,IAAIc,WAAW,QAC/BG,eAAgBpB,EAAEQ,EAAEK,iBAElBQ,gBAAkB,SAASC,OAC7BA,KAAOC,SAASD,KAAM,MAElBnB,IAAIqB,YAAY,CACZ,CAACC,IAAK,qBAAsBC,UAAW,oBACvC,CAACD,IAAK,qBAAsBC,UAAW,mBAAoBC,MAAOL,QACnEM,MAAK,SAASC,OACTC,IAAMR,KAAO,EAAIO,EAAE,GAAKA,EAAE,GAC9BxB,MAAM0B,IAAID,QAEdE,OAAOC,SAASC,UAEhB/B,IAAIc,WAAW,sBAAuB,oBACjCW,MAAK,SAASC,GACXxB,MAAM0B,IAAIF,QAU1BM,YAAc,SAAS3B,GACvBA,EAAEC,iBACFD,EAAE4B,kBACFjC,IAAIqB,YAAY,CACZ,CAACC,IAAK,UAAWC,UAAW,UAC5B,CAACD,IAAK,2BAA4BC,UAAW,oBAC7C,CAACD,IAAK,SAAUC,UAAW,oBAC3B,CAACD,IAAK,SAAUC,UAAW,YAC5BE,MAAK,SAASC,GACb3B,aAAamC,QAAQR,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,IAAI,WAC1BzB,KAAKkC,KAAK,CACrB,CAACC,WAAY,gCACT5B,KAAM,CAAC6B,GAAIxC,EAAEQ,EAAEK,eAAeC,KAAK,eAElC,GAAGc,MAAK,WACbI,OAAOC,SAASC,YACjBO,KAAKvC,aAAawC,iBAE1BD,KAAKvC,aAAawC,YAOrBC,oBAAsB,SAASnC,GAC/BA,EAAEC,iBACFD,EAAE4B,kBACFjC,IAAIqB,YAAY,CACZ,CAACC,IAAK,UAAWC,UAAW,UAC5B,CAACD,IAAK,wBAAyBC,UAAW,oBAC1C,CAACD,IAAK,aAAcC,UAAW,oBAC/B,CAACD,IAAK,SAAUC,UAAW,YAC5BE,MAAK,SAASC,GACb3B,aAAamC,QAAQR,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,IAAI,WAC1BzB,KAAKkC,KAAK,CACrB,CAACC,WAAY,yCACT5B,KAAM,CAAC6B,GAAIxC,EAAEQ,EAAEK,eAAeC,KAAK,eAElC,GAAGc,MAAK,WACbI,OAAOC,SAASC,YACjBO,KAAKvC,aAAawC,iBAE1BD,KAAKvC,aAAawC,kBAGlB,CAIHE,KAAM,WAEF5C,EAAE,QACG6C,GAAG,QAASvC,mBAAoBC,UAChCsC,GAAG,QAASvC,sBAAuB6B,aACnCU,GAAG,QAASvC,yBAA0BqC"}