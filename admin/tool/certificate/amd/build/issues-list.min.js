/**
 * AMD module used when viewing the list of issued certificates
 *
 * @module     tool_certificate/issues-list
 * @copyright  2019 Marina Glancy
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_certificate/issues-list",["jquery","tool_certificate/modal_form","core/notification","core/str","core/ajax","core/toast"],(function($,ModalForm,Notification,Str,Ajax,Toast){var SELECTORS_ADDISSUE="[data-element='addbutton']",SELECTORS_REGENERATEFILE="[data-action='regenerate']",SELECTORS_REVOKEISSUE="[data-action='revoke']",addIssue=function(e){e.preventDefault(),new ModalForm({formClass:"tool_certificate\\form\\certificate_issues",args:{tid:$(e.currentTarget).attr("data-tid")},modalConfig:{title:Str.get_string("issuecertificates","tool_certificate"),scrollable:!1},saveButtonText:Str.get_string("save"),triggerElement:$(e.currentTarget)}).onSubmitSuccess=function(data){(data=parseInt(data,10))?(Str.get_strings([{key:"oneissuewascreated",component:"tool_certificate"},{key:"aissueswerecreated",component:"tool_certificate",param:data}]).done((function(s){var str=data>1?s[1]:s[0];Toast.add(str)})),window.location.reload()):Str.get_string("noissueswerecreated","tool_certificate").done((function(s){Toast.add(s)}))}},revokeIssue=function(e){e.preventDefault(),e.stopPropagation(),Str.get_strings([{key:"confirm",component:"moodle"},{key:"revokecertificateconfirm",component:"tool_certificate"},{key:"revoke",component:"tool_certificate"},{key:"cancel",component:"moodle"}]).done((function(s){Notification.confirm(s[0],s[1],s[2],s[3],(function(){Ajax.call([{methodname:"tool_certificate_revoke_issue",args:{id:$(e.currentTarget).attr("data-id")}}])[0].done((function(){window.location.reload()})).fail(Notification.exception)}))})).fail(Notification.exception)},regenerateIssueFile=function(e){e.preventDefault(),e.stopPropagation(),Str.get_strings([{key:"confirm",component:"moodle"},{key:"regeneratefileconfirm",component:"tool_certificate"},{key:"regenerate",component:"tool_certificate"},{key:"cancel",component:"moodle"}]).done((function(s){Notification.confirm(s[0],s[1],s[2],s[3],(function(){Ajax.call([{methodname:"tool_certificate_regenerate_issue_file",args:{id:$(e.currentTarget).attr("data-id")}}])[0].done((function(){window.location.reload()})).fail(Notification.exception)}))})).fail(Notification.exception)};return{init:function(){$("body").on("click",SELECTORS_ADDISSUE,addIssue).on("click",SELECTORS_REVOKEISSUE,revokeIssue).on("click",SELECTORS_REGENERATEFILE,regenerateIssueFile)}}}));

//# sourceMappingURL=issues-list.min.js.map