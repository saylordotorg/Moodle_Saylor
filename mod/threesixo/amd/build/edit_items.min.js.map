{"version":3,"sources":["../src/edit_items.js"],"names":["define","$","Templates","Notification","Ajax","Str","Bank","ACTIONS","DELETE","MOVE_UP","MOVE_DOWN","threesixtyId","editItems","threesixtyid","registerEvents","refreshItemList","promises","call","methodname","args","when","then","response","context","items","itemCount","length","each","key","value","item","deletebutton","moveupbutton","movedownbutton","type","typetext","position","push","allitems","render","done","compiledSource","js","replaceWith","runTemplateJS","fail","exception","callItemAction","action","itemId","itemid","result","warnings","join","Error","prototype","click","e","preventDefault","init","data"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD code for the frequently used comments chooser for the marking guide grading form.\n *\n * @module     mod_threesixo/edit_items\n * @class      edit_items\n * @copyright  2016 Jun Pataleta <jun@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'core/templates',\n    'core/notification',\n    'core/ajax',\n    'core/str',\n    'mod_threesixo/question_bank',\n    'core/yui'\n], function($, Templates, Notification, Ajax, Str, Bank) {\n\n    /**\n     * List of action selectors.\n     *\n     * @type {{DELETE: string, MOVE_UP: string, MOVE_DOWN: string}}\n     */\n    var ACTIONS = {\n        DELETE: '[data-action=\"delete-item\"]',\n        MOVE_UP: '[data-action=\"move-item-up\"]',\n        MOVE_DOWN: '[data-action=\"move-item-down\"]'\n    };\n\n    var threesixtyId;\n    var editItems = function(threesixtyid) {\n        threesixtyId = threesixtyid;\n        this.registerEvents();\n    };\n\n    editItems.refreshItemList = function() {\n        var promises = Ajax.call([\n            {\n                methodname: 'mod_threesixo_get_items',\n                args: {\n                    threesixtyid: threesixtyId\n                }\n            }\n        ]);\n        $.when(promises[0]).then(function(response) {\n            var context = {\n                threesixtyid: threesixtyId\n            };\n\n            var items = [];\n            var itemCount = response.items.length;\n            $.each(response.items, function(key, value) {\n                var item = value;\n                item.deletebutton = true;\n                item.moveupbutton = false;\n                item.movedownbutton = false;\n                item.type = value.typetext;\n                if (itemCount > 1) {\n                    if (value.position === 1) {\n                        item.movedownbutton = true;\n                    } else if (value.position === itemCount) {\n                        item.moveupbutton = true;\n                    } else if (value.position > 1 && value.position < itemCount) {\n                        item.moveupbutton = true;\n                        item.movedownbutton = true;\n                    }\n                }\n                items.push(item);\n            });\n            context.allitems = items;\n\n            return Templates.render('mod_threesixo/list_360_items', context);\n\n        }).done(function(compiledSource, js) {\n            $('[data-region=\"itemlist\"]').replaceWith(compiledSource);\n            Templates.runTemplateJS(js);\n\n        }).fail(Notification.exception);\n    };\n\n    editItems.callItemAction = function(action, itemId) {\n        var promises = Ajax.call([\n            {\n                methodname: action,\n                args: {\n                    itemid: itemId\n                }\n            }\n        ]);\n        promises[0].done(function(response) {\n            if (response.result) {\n                editItems.refreshItemList();\n                return true;\n            }\n            var warnings = response.warnings.join($('<br/>'));\n            throw new Error(warnings);\n        }).fail(Notification.exception);\n    };\n\n    editItems.prototype.registerEvents = function() {\n        // Bind click event for the comments chooser button.\n        $(\"#btn-question-bank\").click(function(e) {\n            e.preventDefault();\n            Bank.init(threesixtyId);\n        });\n\n        $(ACTIONS.DELETE).click(function(e) {\n            e.preventDefault();\n\n            var itemId = $(this).data('itemid');\n            editItems.callItemAction('mod_threesixo_delete_item', itemId);\n        });\n\n        $(ACTIONS.MOVE_UP).click(function(e) {\n            e.preventDefault();\n\n            var itemId = $(this).data('itemid');\n            editItems.callItemAction('mod_threesixo_move_item_up', itemId);\n        });\n\n        $(ACTIONS.MOVE_DOWN).click(function(e) {\n            e.preventDefault();\n\n            var itemId = $(this).data('itemid');\n            editItems.callItemAction('mod_threesixo_move_item_down', itemId);\n        });\n    };\n\n    return editItems;\n});\n"],"file":"edit_items.min.js"}