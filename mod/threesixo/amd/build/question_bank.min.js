define ("mod_threesixo/question_bank",["jquery","core/templates","core/notification","core/ajax","core/str","core/modal_factory","core/modal_events"],function(a,b,c,d,e,f,g){var o,p,q=[],r,s,t,u;function h(a){var b=[];for(var c in s){if(!s.hasOwnProperty(c)){continue}var d={typeVal:c,typeName:s[c]};if("undefined"!=typeof a&&c==a){d.selected=!0}b.push(d)}return b}function i(a){for(var b in a){var c=a[b];if(-1!==p.indexOf(a[b].id)){c.checked=!0}}return a}function j(b,h){if(u){u.setBody(h);u.show()}else{f.create({type:f.types.SAVE_CANCEL,title:b,body:h,large:!0}).done(function(b){u=b;u.show();b.getRoot().on(g.shown,function(){a("#question-input").focus()});b.getRoot().on(g.hidden,function(){b.setBody("")});b.getRoot().on(g.save,function(){var b=a("#question-input").val().trim();if(!b){e.get_string("requiredelement","form").done(function(b){var c=a("<div/>").append(b).attr("class","alert alert-error").attr("role","alert");a(".error-container").html(c)}).fail(c.exception);return}var f=a("#question-type-select").val(),g=a("#threesixtyid").val(),h={question:b,type:f,threesixtyid:g},i="mod_threesixo_add_question",j=a("#question-id").val();if(j){i="mod_threesixo_update_question";h.id=j}var k=d.call([{methodname:i,args:h}]);k[0].done(function(){l()}).fail(c.exception)})})}}var v=function(a,d){e.get_string("addanewquestion","mod_threesixo").done(function(c){var e={threesixtyid:a};if("undefined"!=typeof d){e.questionid=d;for(var f in q){var g=q[f];if(g.id===d){e.question=g.question;e.type=g.type;break}}}e.questionTypes=h(e.type);var i=b.render("mod_threesixo/item_edit",e);j(c,i)}).fail(c.exception)};function k(b,e){if(t){t.setBody(e);t.show()}else{f.create({type:f.types.SAVE_CANCEL,title:b,body:e,large:!0}).done(function(b){var e=b.getRoot();e.on(g.hidden,function(){b.setBody("")});e.on(g.save,function(){var b=!1;a.each(o,function(a,c){if(-1===p.indexOf(c)){b=!0}});if(!b){a.each(p,function(a,c){if(-1===o.indexOf(c)){b=!0}})}if(b){var e={threesixtyid:r,questionids:p},f=d.call([{methodname:"mod_threesixo_set_items",args:e}]);f[0].done(function(){require(["mod_threesixo/edit_items"],function(a){a.refreshItemList()})}).fail(c.exception)}});t=b;t.show()})}}function l(){var e=d.call([{methodname:"mod_threesixo_get_questions",args:{}}]);e[0].done(function(d){q=d.questions;var e={pickerMode:r,questions:i(q)};b.render("mod_threesixo/question_list",e).done(function(b){a("#questionListWrapper").html(b);w()}).fail(c.exception)}).fail(c.exception)}function m(a,b){e.get_string("deletequestion","mod_threesixo").done(function(h){f.create({title:h,body:e.get_string("confirmquestiondeletion","mod_threesixo"),type:f.types.SAVE_CANCEL}).done(function(e){e.getRoot().on(g.save,function(){var e=d.call([{methodname:"mod_threesixo_delete_question",args:{id:a,threesixtyid:b}}]);e[0].done(function(){l()}).fail(c.exception)});e.show()})})}var w=function(){a(".question-checkbox").click(function(){var b=parseInt(this.getAttribute("data-questionid"));if(a(this).is(":checked")){p.push(b)}else{var c=p.indexOf(b);if(-1<c){p.splice(c,1)}}});a(".edit-question-button").click(function(){var b=a(this).data("threesixtyid"),c=a(this).data("questionid");v(b,c)});a(".delete-question-button").click(function(){var b=a(this),c=b.data("threesixtyid"),d=b.data("questionid");m(d,c)})};function n(){var a={pickerMode:r},f=d.call([{methodname:"mod_threesixo_get_questions",args:{}}]);f[0].done(function(d){q=d.questions;a.questions=i(q);var f=b.render("mod_threesixo/question_bank",a);e.get_string("labelpickfromquestionbank","mod_threesixo").done(function(a){k(a,f)}).fail(c.exception)}).fail(c.exception)}var x=function(a){r=a;var b=[{methodname:"mod_threesixo_get_question_types",args:{}}];if(r){b.push({methodname:"mod_threesixo_get_items",args:{threesixtyid:r}})}var e=d.call(b);e[0].done(function(a){s=a.questiontypes;if(r){p=[];o=[];e[1].done(function(a){var b=a.items;for(var c in b){if(!b.hasOwnProperty(c)){continue}p.push(b[c].questionid);o.push(b[c].questionid)}n()}).fail(c.exception)}else{n()}}).fail(c.exception)};return{init:x,displayInputDialogue:v,bindItemActionEvents:w}});
//# sourceMappingURL=question_bank.min.js.map
