define ("mod_wordcards/cards",["jquery","core/ajax"],function(a,b){var d=4;function c(a){for(var b=a.length-1;0<b;b--){var c=Math.floor(Math.random()*(b+1)),d=a[b];a[b]=a[c];a[c]=d}return a}var e=function(b,c){this._container=a(b);this._terms=c;this._selected=null};e.prototype._container=null;e.prototype._dryRun=!1;e.prototype._resizeTimeout=null;e.prototype._selected=null;e.prototype._terms=null;e.prototype.init=function(){var b=[];this._terms.forEach(function(a){b.push(this._makeCard(a.id,a.term));b.push(this._makeCard(a.id,a.definition))}.bind(this));c(b);b.forEach(function(a){this._container.append(a)}.bind(this));this._arrangePlayground();b.forEach(function(a){a.show()});this._container.on("click",".wordcard",this._handlePick.bind(this));a(window).on("resize",function(){if(this._resizeTimeout){clearTimeout(this._resizeTimeout)}this._resizeTimeout=setTimeout(this._arrangePlayground.bind(this),200)}.bind(this))};e.prototype._arrangePlayground=function(){var b=this._container.width(),c=a(window).height(),e=3,f=2*this._terms.length,g=null,h=null,i=0,j=0,k,l,m,n;if(f%2<f%3){e=2}k=this._container.find(".wordcard").first().css("lineHeight");l=parseInt(k.replace(/([^0-9]+)/,""));m=k.replace(/([0-9]+)/,"");n=60;if("px"===m){n=!l?n:3*(l+1)}n=999;g=Math.floor(b/e);h=Math.min(Math.round((c-60)/Math.ceil(f/e)),n);this._container.find(".wordcard").each(function(b,c){a(c).css({top:i*h,left:j*g,width:j==e-1?g:g-d,height:h-d});j++;if(j>=e){j=0;i++}});this._container.find(".wordcard-content").css("maxHeight",h-d);this._container.css({height:i*h});this._adjustCardContent()};e.prototype._adjustCardContent=function(){this._container.find(".wordcard-content").each(function(b,c){var d=a(c),e,f,g=0;d.text(d.data("text"));while(c.scrollHeight>c.offsetHeight&&0<c.scrollHeight){f=d.text();e=Math.max(.1,c.offsetHeight/c.scrollHeight-.05);f=f.substr(0,Math.round(f.length*e)).trim();f+="\u2026";d.text(f);if(4<g++){break}}})};e.prototype._checkComplete=function(){if(this._container.find(".wordcard.found").length==2*this._terms.length){this._trigger("complete")}};e.prototype._handlePick=function(b){b.preventDefault();var c=a(b.currentTarget);if(c.hasClass("found")){return}if(!this._selected){this._selected=c;c.addClass("selected");return}if(this._selected.is(c)){return}if(c.data("id")==this._selected.data("id")){this._selected.addClass("found").animate({opacity:0});c.addClass("found").animate({opacity:0});this._reportSuccess(this._selected.data("id"));this._checkComplete()}else{var d=this._selected;d.addClass("mismatch");c.addClass("mismatch");this._reportFailure(this._selected.data("id"),c.data("id"));setTimeout(function(){d.removeClass("mismatch");c.removeClass("mismatch")},600)}this._selected.removeClass("selected");this._selected=null};e.prototype._makeCard=function(b,c){var d=a("<div class=\"wordcard\">"),e=a("<div class=\"wordcard-wrapper\">"),f=a("<div class=\"wordcard-content\">");f.text(c);f.data("text",c);e.append(f);d.append(e);d.data("id",b);return d};e.prototype.on=function(a,b){this._container.on(a,b)};e.prototype._reportFailure=function(a,c){if(this._dryRun){return}b.call([{methodname:"mod_wordcards_report_failed_association",args:{term1id:a,term2id:c}}])};e.prototype._reportSuccess=function(a){if(this._dryRun){return}b.call([{methodname:"mod_wordcards_report_successful_association",args:{termid:a}}])};e.prototype.setDryRun=function(a){this._dryRun=a};e.prototype._trigger=function(a){this._container.trigger(a)};return e});
//# sourceMappingURL=cards.min.js.map
