{"version":3,"sources":["../src/dictation.js"],"names":["define","$","Ajax","log","a4e","keyboard","polly","templates","app","dryRun","audio","ttslanguage","distractors","init","props","theid","widgetid","nexturl","modid","isFreeMode","isfreemode","configcontrol","get","definitionsdata","JSON","parse","value","remove","debug","register_events","init_audio","token","region","owner","process","aplayer","on","total_time","timer","count","url","replace","window","location","reload","click","attr","play","fetch_polly_url","tts","ttsvoice","onnewpollyurl","theurl","start","quit","json","terms","list_vocab","terms_to_distractors","results","shuffle","pointer","hide","show","text","interval","setInterval","update","pretty_print_secs","next","clear","clearInterval","end","tdata","length","calc_total_points","render","then","html","require","mywords","initFromFeedbackPage","data","activity","console","call","methodname","args","correct","progress_dots","removeClass","distractorscopy","slice","create","disable","check","trigger","selected","toLowerCase","trim","points","addClass","reportSuccess","reportFailure","result","question","id","push","setTimeout","i","term","each","split","l","indexOf","term1id","term2id","termid"],"mappings":"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","sourcesContent":["/**\r\n * Matching module.\r\n *\r\n * @package mod_wordcards\r\n * @author  Justin Hunt - poodll.com\r\n * * (based on Paul Raine's APPs 4 EFL)\r\n */\r\n\r\ndefine([\r\n  'jquery',\r\n  'core/ajax',\r\n  'core/log',\r\n  'mod_wordcards/a4e',\r\n  'mod_wordcards/keyboard',\r\n  'mod_wordcards/pollyhelper',\r\n  'core/templates'\r\n], function($, Ajax, log, a4e, keyboard, polly, templates) {\r\n\r\n  var app = {\r\n    dryRun: false,\r\n    audio: false,\r\n    ttslanguage: 'en-US',\r\n    distractors: [],\r\n    init: function(props) {\r\n\r\n      //pick up opts from html\r\n      var theid = '#' + props.widgetid;\r\n      this.dryRun = props.dryRun;\r\n      this.nexturl = props.nexturl;\r\n      this.modid = props.modid;\r\n      this.isFreeMode = props.isfreemode;\r\n      var configcontrol = $(theid).get(0);\r\n      if (configcontrol) {\r\n        var definitionsdata = JSON.parse(configcontrol.value);\r\n        $(theid).remove();\r\n      } else {\r\n        //if there is no config we might as well give up\r\n        log.debug('No config found on page. Giving up.');\r\n        return;\r\n      }\r\n\r\n      a4e.register_events();\r\n      a4e.init_audio(props.token,props.region,props.owner);\r\n\r\n      polly.init(props.token, props.region, props.owner);\r\n      app.ttslanguage = props.ttslanguage;\r\n      app.process(definitionsdata);\r\n\r\n\r\n\r\n      this.register_events();\r\n    },\r\n\r\n    register_events: function() {\r\n\r\n      // Get the audio element\r\n      var aplayer = $(\"#dictation_player\");\r\n\r\n      $('body').on('click', \"#wordcards-close-results\", function() {\r\n\r\n        var total_time = app.timer.count;\r\n        var url = app.nexturl.replace(/&amp;/g, '&') + \"&localscattertime=\" + total_time\r\n        window.location.replace(url);\r\n\r\n      });\r\n\r\n      $('body').on('click', \"#wordcards-try-again\", function() {\r\n        location.reload();\r\n      });\r\n\r\n      $(\"#listen-button\").click(function() {\r\n        if (app.audio) {\r\n          aplayer.attr('src', app.audio);\r\n          aplayer[0].play();\r\n        } else {\r\n          polly.fetch_polly_url(app.tts, 'text', app.ttsvoice);\r\n        }\r\n\r\n      });\r\n\r\n      //play what was returned in polly.fetch_polly_url\r\n      polly.onnewpollyurl = function(theurl) {\r\n        aplayer.attr('src', theurl);\r\n        aplayer[0].play();\r\n      };\r\n\r\n      $('body').on('click', '#wordcards-start-button', function() {\r\n        app.start();\r\n      });\r\n\r\n      $('body').on('click', '#wordcards-quit-button', function() {\r\n        app.quit();\r\n      });\r\n\r\n\r\n    },\r\n\r\n    process: function(json) {\r\n\r\n      app.terms = json.terms;\r\n      a4e.list_vocab(\"#vocab-list-inner\", app.terms);\r\n      app.distractors=app.terms_to_distractors(app.terms);\r\n\r\n    },\r\n    start: function() {\r\n      app.results = [];\r\n      a4e.shuffle(app.terms);\r\n      app.pointer = 0;\r\n      $(\"#wordcards-vocab-list, #wordcards-start-button\").hide();\r\n      $(\"#wordcards-gameboard, #wordcards-quit-button\").show();\r\n      $(\"#wordcards-time-counter\").text(\"00:00\");\r\n      app.timer = {\r\n        interval: setInterval(function() {\r\n          app.timer.update();\r\n        }, 1000),\r\n        count: 0,\r\n        update: function() {\r\n          app.timer.count++;\r\n          $(\"#wordcards-time-counter\").text(a4e.pretty_print_secs(app.timer.count));\r\n        }\r\n      };\r\n      app.next();\r\n    },\r\n    quit: function() {\r\n      keyboard.clear();\r\n      clearInterval(app.timer.interval);\r\n      $(\"#wordcards-gameboard, #wordcards-quit-button\").hide();\r\n      $(\"#wordcards-vocab-list, #wordcards-start-button\").show();\r\n    },\r\n\r\n    end: function() {\r\n      keyboard.clear();\r\n      clearInterval(app.timer.interval);\r\n      $(\"#wordcards-gameboard, #wordcards-quit-button, #wordcards-start-button\").hide();\r\n      $(\"#wordcards-results\").show();\r\n\r\n      //template data\r\n      var tdata = [];\r\n      tdata['nexturl'] = this.nexturl;\r\n      tdata['results'] = app.results;\r\n      tdata['total'] = app.terms.length;\r\n      tdata['totalcorrect'] = a4e.calc_total_points(app.results);\r\n      var total_time = app.timer.count;\r\n      if (total_time == 0) {\r\n        tdata['prettytime'] = '00:00';\r\n      } else {\r\n        tdata['prettytime'] = a4e.pretty_print_secs(total_time);\r\n      }\r\n      templates.render('mod_wordcards/feedback', tdata).then(\r\n        function(html, js) {\r\n          $(\"#results-inner\").html(html);\r\n          // Add listeners for the \"Add to my words\" buttons.\r\n          require([\"mod_wordcards/mywords\"], function(mywords) {\r\n            mywords.initFromFeedbackPage();\r\n          });\r\n        }\r\n      );\r\n\r\n      var data = {\r\n        results: app.results,\r\n        activity: \"dictation\"\r\n      };\r\n      console.log(data);\r\n\r\n      if (!app.isFreeMode) {\r\n        Ajax.call([{\r\n          methodname: 'mod_wordcards_report_step_grade',\r\n          args: {\r\n            modid: app.modid,\r\n            correct: tdata['totalcorrect']\r\n          }\r\n        }]);\r\n      }\r\n\r\n    },\r\n\r\n\r\n    next: function() {\r\n      \r\n      a4e.progress_dots(app.results, app.terms);\r\n\r\n      $(\"#wordcards-submitted\").html(\"\").removeClass(\"a4e-correct a4e-incorrect\");\r\n\r\n      var distractorscopy = app.distractors.slice(0);\r\n      keyboard.create(\"wordcards-input\", app.terms[app.pointer]['term'], app.pointer, distractorscopy, function(value) {\r\n        $(\"#wordcards-submitted\").html(app.terms[app.pointer]['term']);\r\n        keyboard.disable();\r\n        app.check(value);\r\n      });\r\n\r\n      app.tts = app.terms[app.pointer]['term'];\r\n      \r\n      if (app.terms[app.pointer]['ttsvoice']) {\r\n        app.ttsvoice = app.terms[app.pointer]['ttsvoice'];\r\n      } \r\n      \r\n      else {\r\n        app.ttsvoice = 'auto';\r\n      }\r\n      \r\n      if (app.terms[app.pointer]['audio']) {\r\n        app.audio = app.terms[app.pointer]['audio'];\r\n      } \r\n      \r\n      else {\r\n        app.audio = false;\r\n      }\r\n      \r\n      $(\"#listen-button\").trigger(\"click\");\r\n\r\n    },\r\n\r\n    check: function(selected) {\r\n      var correct = selected.toLowerCase().trim() == app.terms[app.pointer]['term'].toLowerCase().trim();\r\n      var points = 0;\r\n      if (correct == true) {\r\n        //createjs.Sound.play('correct');\r\n        $(\"#wordcards-submitted\").addClass(\"a4e-correct\");\r\n        points = 1;\r\n      } else {\r\n        $(\"#wordcards-submitted\").addClass(\"a4e-incorrect\");\r\n        //createjs.Sound.play('incorrect');\r\n      }\r\n\r\n      //post results to server\r\n      if (correct) {\r\n        this.reportSuccess(app.terms[app.pointer]['id']);\r\n      } else {\r\n        this.reportFailure(app.terms[app.pointer]['id'], 0);\r\n      }\r\n\r\n      var result = {\r\n        question: app.terms[app.pointer]['definition'],\r\n        selected: selected,\r\n        correct: app.terms[app.pointer]['term'],\r\n        points: points,\r\n        id: app.terms[app.pointer]['id']\r\n      };\r\n      \r\n      app.results.push(result);\r\n\r\n      if (app.pointer < app.terms.length - 1) {\r\n        app.pointer++;\r\n        setTimeout(function() {\r\n          app.next();\r\n        }, 1000)\r\n      } else {\r\n        app.end();\r\n      }\r\n\r\n\r\n    },\r\n\r\n    terms_to_distractors: function(terms){\r\n          var distractors=[];\r\n          for(var i=0;i<terms.length; i++){\r\n              var term = terms[i].term;\r\n              $.each(term.split(''),function(i,l){\r\n                  if(distractors.indexOf(l)==-1){\r\n                      distractors.push(l);\r\n                  }\r\n              });\r\n\r\n          }\r\n          return distractors;\r\n     },\r\n\r\n\r\n      reportFailure: function(term1id, term2id) {\r\n      if (this.dryRun) {\r\n        return;\r\n      }\r\n\r\n      Ajax.call([{\r\n        methodname: 'mod_wordcards_report_failed_association',\r\n        args: {\r\n          term1id: term1id,\r\n          term2id: term2id,\r\n          isfreemode: app.isFreeMode\r\n        }\r\n      }]);\r\n    },\r\n\r\n    reportSuccess: function(termid) {\r\n      if (this.dryRun) {\r\n        return;\r\n      }\r\n\r\n      Ajax.call([{\r\n        methodname: 'mod_wordcards_report_successful_association',\r\n        args: {\r\n          termid: termid,\r\n          isfreemode: app.isFreeMode\r\n        }\r\n      }]);\r\n    }\r\n  };\r\n\r\n  return app;\r\n\r\n});"],"file":"dictation.min.js"}