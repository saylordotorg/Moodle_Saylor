define("mod_wordcards/definitions",["jquery","core/ajax","core/notification","core/modal_factory","core/str","core/modal_events","mod_wordcards/a4e"],(function($,Ajax,Notification,ModalFactory,str,ModalEvents,a4e){return{strings:{},init:function(opts){var that=this;this.init_strings();var theid="#"+opts.widgetid,propscontrol=$(theid).get(0);if(propscontrol){var props=JSON.parse(propscontrol.value);this.props=props,$(theid).remove();var ef=$(".event_flashcards"),eg=$(".event_grid"),totalcards=$(".definition_flashcards_ul li").length;$(".definition_flashcards_ul li:gt(0)").hide(),$(".definition_flashcards_ul li:first").addClass("is-current"),set_progress_info(1,totalcards),ef.click((function(d){d.preventDefault(),$(".definition_flashcards").fadeIn(),$(".definition_grid").fadeOut(),ef.addClass("btn-primary").removeClass("btn-outline-primary"),eg.removeClass("btn-primary").addClass("btn-outline-primary")})),eg.click((function(d){d.preventDefault(),$(".definition_flashcards").fadeOut(),$(".definition_grid").fadeIn(),eg.addClass("btn-primary").removeClass("btn-outline-primary"),ef.removeClass("btn-primary").addClass("btn-outline-primary")})),$("#Next").click((function(){var cr_index=$(".is-current").index()+1;cr_index>totalcards-1&&(cr_index=0),$(".definition_flashcards_ul li").slideUp(300),$(".definition_flashcards_ul li").removeClass("is-current"),$(".definition_flashcards_ul li:eq("+cr_index+")").addClass("is-current"),$(".definition_flashcards_ul li:eq("+cr_index+")").slideDown(300),set_progress_info(cr_index+1,totalcards)})),$("#Prev").click((function(){var cr_index=$(".is-current").index()-1;cr_index<0&&(cr_index=totalcards-1),$(".definition_flashcards_ul li").slideUp(300),$(".definition_flashcards_ul li").removeClass("is-current"),$(".definition_flashcards_ul li:eq("+cr_index+")").addClass("is-current"),$(".definition_flashcards_ul li:eq("+cr_index+")").slideDown(300);var curr_level_card=$(".curr_level_card").html();$(".curr_level_card").html(parseInt(curr_level_card)-1),set_progress_info(cr_index+1,totalcards)}));var container=$("#definitions-page-"+opts.widgetid),btn=(props.modid,props.canmanage,props.canattempt,container.find(".definitions-next"));a4e.register_events(),a4e.init_audio(props.token,props.region,props.owner),container.on("click",".term-seen-action",(function(e){e.preventDefault();var termNode=$(this).parents(".term").first(),termId=termNode.data("termid");termNode.addClass("term-loading"),Ajax.call([{methodname:"mod_wordcards_mark_as_seen",args:{termid:termId}}])[0].then((function(result){if(!result)return $.Deferred().reject();$('.definition_flashcards [data-termid="'+termId+'"]').addClass("term-seen"),$('.definition_grid [data-termid="'+termId+'"]').addClass("term-seen")})).fail(Notification.exception).always((function(){termNode.removeClass("term-loading")}))})),btn.click((function(e){e.preventDefault();var buttonhref=$(this).data("href");"reattempt"===$(this).data("action")?ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:that.strings.reattempttitle,body:that.strings.reattemptbody}).then((function(modal){modal.setSaveButtonText(that.strings.reattempt),modal.getRoot().on(ModalEvents.save,(function(){window.location.href=buttonhref})),modal.show()})):window.location.href=buttonhref}))}else log.debug("No config found on page. Giving up.");function set_progress_info(index,total){$(".definition_flashcards .wc_cardsprogress").text(index+" / "+total)}},init_strings:function(){var that=this;str.get_strings([{key:"reattempttitle",component:"mod_wordcards"},{key:"reattemptbody",component:"mod_wordcards"},{key:"reattempt",component:"mod_wordcards"}]).done((function(s){var i=0;that.strings.reattempttitle=s[i++],that.strings.reattemptbody=s[i++],that.strings.reattempt=s[i++]}))}}}));

//# sourceMappingURL=definitions.min.js.map