define ("mod_wordcards/listenchoose",["jquery","core/ajax","core/log","mod_wordcards/a4e","mod_wordcards/pollyhelper","core/templates"],function(a,b,c,d,e,f){var g={dryRun:!1,audio:!1,ttslanguage:"en-US",init:function init(b){var f="#"+b.widgetid;this.dryRun=b.dryRun;this.nexturl=b.nexturl;this.modid=b.modid;var h=a(f).get(0);if(h){var i=JSON.parse(h.value);a(f).remove()}else{c.debug("No config found on page. Giving up.");return}g.process(i);d.register_events();d.init_audio(b.token,b.region,b.owner);e.init(b.token,b.region,b.owner);g.ttslanguage=b.ttslanguage;this.register_events()},register_events:function register_events(){var b=a("#dictation_player");a("#listen-button").click(function(){if(g.audio){b.attr("src",g.audio);b[0].play()}else{e.fetch_polly_url(g.tts,"text",g.ttsvoice)}});e.onnewpollyurl=function(a){b.attr("src",a);b[0].play()};a("body").on("click","#wordcards-close-results",function(){var a=g.timer.count,b=g.nexturl.replace(/&amp;/g,"&")+"&localscattertime="+a;window.location.replace(b)});a("body").on("click","#wordcards-try-again",function(){location.reload()});a("body").on("click",".a4e-distractor",function(){g.check(a(this).data("correct"),this)});a("body").on("click","#wordcards-start-button",function(){g.start()})},process:function process(a){g.terms=a.terms;g.has_images=a.has_images;d.list_vocab("#vocab-list-inner",g.terms)},start:function start(){g.results=[];d.shuffle(g.terms);g.pointer=0;a("#wordcards-vocab-list, #wordcards-start-button").hide();a("#wordcards-gameboard").show();a("#wordcards-time-counter").text("00:00");g.timer={interval:setInterval(function(){g.timer.update()},1e3),count:0,update:function update(){g.timer.count++;a("#wordcards-time-counter").text(d.pretty_print_secs(g.timer.count))}};g.next()},quit:function quit(){clearInterval(g.timer.interval);a("#wordcards-gameboard").hide();a("#wordcards-vocab-list, #wordcards-start-button").show()},end:function end(){clearInterval(g.timer.interval);a("#wordcards-gameboard, #wordcards-start-button").hide();a("#wordcards-results").show();var c=[];c.results=g.results;c.total=g.terms.length;c.totalcorrect=d.calc_total_points(g.results);var e=g.timer.count;if(0==e){c.prettytime="00:00"}else{c.prettytime=d.pretty_print_secs(e)}f.render("mod_wordcards/feedback",c).then(function(b){a("#results-inner").html(b)});var h={results:g.results,activity:"match_select"};console.log(h);b.call([{methodname:"mod_wordcards_report_step_grade",args:{modid:g.modid,correct:c.totalcorrect}}])},next:function next(){d.progress_dots(g.results,g.terms);g.tts=g.terms[g.pointer].term;if(g.terms[g.pointer].ttsvoice){g.ttsvoice=g.terms[g.pointer].ttsvoice}else{g.ttsvoice="auto"}if(g.terms[g.pointer].audio){g.audio=g.terms[g.pointer].audio}else{g.audio=!1}a("#listen-button").trigger("click");a("#wordcards-input").html(g.get_distractors())},check:function check(b,c){var d=0;if(!0==b){d=1}a(".a4e-distractor").css("pointer-events","none");var e={question:g.terms[g.pointer].definition,selected:a(c).text(),correct:g.terms[g.pointer].term,points:d};g.results.push(e);var f=!0==b?"a4e-correct":"a4e-incorrect";a(c).addClass(f).append("<i style='color:"+(b?"green":"red")+";margin-left:5px;' class='fa fa-"+(b?"check":"times")+"'></i>").parent().addClass("a4e-click-disabled");if(!b){a(".a4e-distractor[data-correct='true']").addClass("a4e-correct").append("<i style='color:green;margin-left:5px;' class='fa fa-check'></i>")}if(b){this.reportSuccess(g.terms[g.pointer].id)}else{this.reportFailure(g.terms[g.pointer].id,a(c).data("id"))}g.pointer++;if(!b){setTimeout(function(){if(g.pointer<g.terms.length){g.next()}else{g.end()}},1500)}else{setTimeout(function(){if(g.pointer<g.terms.length){g.next()}else{g.end()}},1e3)}},get_distractors:function get_distractors(){var b=g.terms.slice(0),c=g.terms[g.pointer].term;b.splice(g.pointer,1);d.shuffle(b);b=b.slice(0,4);b.push(g.terms[g.pointer]);d.shuffle(b);var e=[];a.each(b,function(a,b){var d=b.term==c,f=b.id;e.push("<li data-id=\""+f+"\" data-correct=\""+d.toString()+"\" class=\"list-group-item a4e-distractor a4e-noselect\">"+b.term+"</li>")});var f="<ul class=\"list-group a4e-distractors\">"+e.join("")+"</ul>";return f},reportFailure:function reportFailure(a,c){if(this.dryRun){return}b.call([{methodname:"mod_wordcards_report_failed_association",args:{term1id:a,term2id:c}}])},reportSuccess:function reportSuccess(a){if(this.dryRun){return}b.call([{methodname:"mod_wordcards_report_successful_association",args:{termid:a}}])}};return g});
//# sourceMappingURL=listenchoose.min.js.map
