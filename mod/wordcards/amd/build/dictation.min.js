define ("mod_wordcards/dictation",["jquery","core/ajax","core/log","mod_wordcards/a4e","mod_wordcards/keyboard","mod_wordcards/pollyhelper","core/templates"],function(a,b,c,d,e,f,g){var h={dryRun:!1,audio:!1,ttslanguage:"en-US",distractors:[],init:function init(b){var e="#"+b.widgetid;this.dryRun=b.dryRun;this.nexturl=b.nexturl;this.modid=b.modid;var g=a(e).get(0);if(g){var i=JSON.parse(g.value);a(e).remove()}else{c.debug("No config found on page. Giving up.");return}d.register_events();d.init_audio(b.token,b.region,b.owner);f.init(b.token,b.region,b.owner);h.ttslanguage=b.ttslanguage;h.process(i);this.register_events()},register_events:function register_events(){var b=a("#dictation_player");a("body").on("click","#wordcards-close-results",function(){var a=h.timer.count,b=h.nexturl.replace(/&amp;/g,"&")+"&localscattertime="+a;window.location.replace(b)});a("body").on("click","#wordcards-try-again",function(){location.reload()});a("#listen-button").click(function(){if(h.audio){b.attr("src",h.audio);b[0].play()}else{f.fetch_polly_url(h.tts,"text",h.ttsvoice)}});f.onnewpollyurl=function(a){b.attr("src",a);b[0].play()};a("body").on("click","#wordcards-start-button",function(){h.start()});a("body").on("click","#wordcards-quit-button",function(){h.quit()})},process:function process(a){h.terms=a.terms;h.has_images=a.has_images;d.list_vocab("#vocab-list-inner",h.terms);h.distractors=h.terms_to_distractors(h.terms)},start:function start(){h.results=[];d.shuffle(h.terms);h.pointer=0;a("#wordcards-vocab-list, #wordcards-start-button").hide();a("#wordcards-gameboard, #wordcards-quit-button").show();a("#wordcards-time-counter").text("00:00");h.timer={interval:setInterval(function(){h.timer.update()},1e3),count:0,update:function update(){h.timer.count++;a("#wordcards-time-counter").text(d.pretty_print_secs(h.timer.count))}};h.next()},quit:function quit(){e.clear();clearInterval(h.timer.interval);a("#wordcards-gameboard, #wordcards-quit-button").hide();a("#wordcards-vocab-list, #wordcards-start-button").show()},end:function end(){e.clear();clearInterval(h.timer.interval);a("#wordcards-gameboard, #wordcards-quit-button, #wordcards-start-button").hide();a("#wordcards-results").show();var c=[];c.results=h.results;c.total=h.terms.length;c.totalcorrect=d.calc_total_points(h.results);var f=h.timer.count;if(0==f){c.prettytime="00:00"}else{c.prettytime=d.pretty_print_secs(f)}g.render("mod_wordcards/feedback",c).then(function(b){a("#results-inner").html(b)});var i={results:h.results,activity:"dictation"};console.log(i);b.call([{methodname:"mod_wordcards_report_step_grade",args:{modid:h.modid,correct:c.totalcorrect}}])},next:function next(){d.progress_dots(h.results,h.terms);a("#wordcards-submitted").html("").removeClass("a4e-correct a4e-incorrect");var b=h.distractors.slice(0);e.create("wordcards-input",h.terms[h.pointer].term,h.pointer,b,function(b){a("#wordcards-submitted").html(h.terms[h.pointer].term);e.disable();h.check(b)});h.tts=h.terms[h.pointer].term;if(h.terms[h.pointer].ttsvoice){h.ttsvoice=h.terms[h.pointer].ttsvoice}else{h.ttsvoice="auto"}if(h.terms[h.pointer].audio){h.audio=h.terms[h.pointer].audio}else{h.audio=!1}a("#listen-button").trigger("click")},check:function check(b){var c=b.toLowerCase().trim()==h.terms[h.pointer].term.toLowerCase().trim(),d=0;if(!0==c){a("#wordcards-submitted").addClass("a4e-correct");d=1}else{a("#wordcards-submitted").addClass("a4e-incorrect")}if(c){this.reportSuccess(h.terms[h.pointer].id)}else{this.reportFailure(h.terms[h.pointer].id,0)}var e={question:h.terms[h.pointer].definition,selected:b,correct:h.terms[h.pointer].term,points:d};h.results.push(e);if(h.pointer<h.terms.length-1){h.pointer++;setTimeout(function(){h.next()},1e3)}else{h.end()}},terms_to_distractors:function terms_to_distractors(b){for(var c=[],d=0,e;d<b.length;d++){e=b[d].term;a.each(e.split(""),function(a,b){if(-1==c.indexOf(b)){c.push(b)}})}return c},reportFailure:function reportFailure(a,c){if(this.dryRun){return}b.call([{methodname:"mod_wordcards_report_failed_association",args:{term1id:a,term2id:c}}])},reportSuccess:function reportSuccess(a){if(this.dryRun){return}b.call([{methodname:"mod_wordcards_report_successful_association",args:{termid:a}}])}};return h});
//# sourceMappingURL=dictation.min.js.map
