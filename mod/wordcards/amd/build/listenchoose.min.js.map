{"version":3,"sources":["../src/listenchoose.js"],"names":["define","$","Ajax","log","a4e","polly","templates","app","dryRun","audio","ttslanguage","init","props","theid","widgetid","nexturl","modid","lcoptions","isFreeMode","isfreemode","configcontrol","get","matchingdata","JSON","parse","value","remove","debug","process","register_events","init_audio","token","region","owner","aplayer","click","attr","play","fetch_polly_url","tts","ttsvoice","onnewpollyurl","theurl","on","total_time","timer","count","url","replace","window","location","reload","check","data","start","json","terms","list_vocab","results","shuffle","pointer","hide","show","text","interval","setInterval","update","pretty_print_secs","next","quit","clearInterval","end","tdata","length","calc_total_points","render","then","html","require","mywords","initFromFeedbackPage","activity","console","call","methodname","args","correct","progress_dots","trigger","get_distractors","clicked","points","css","result","question","selected","id","push","background","addClass","append","parent","reportSuccess","reportFailure","setTimeout","distractors","slice","answer","splice","options","each","i","o","is_correct","term_id","label","toString","code","join","term1id","term2id","termid"],"mappings":"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","sourcesContent":["/**\r\n * Matching module.\r\n *\r\n * @package mod_wordcards\r\n * @author  Justin Hunt - poodll.com\r\n * * (based on Paul Raine's APPs 4 EFL)\r\n */\r\n\r\ndefine([\r\n  'jquery',\r\n  'core/ajax',\r\n  'core/log',\r\n  'mod_wordcards/a4e',\r\n  'mod_wordcards/pollyhelper',\r\n  'core/templates'\r\n], function($, Ajax, log, a4e, polly, templates) {\r\n\r\n  var app = {\r\n    dryRun: false,\r\n    audio: false,\r\n    ttslanguage: 'en-US',\r\n\r\n    init: function(props) {\r\n\r\n      //pick up opts from html\r\n      var theid = '#' + props.widgetid;\r\n      this.dryRun = props.dryRun;\r\n      this.nexturl = props.nexturl;\r\n      this.modid = props.modid;\r\n      this.lcoptions=props.lcoptions;\r\n      this.isFreeMode = props.isfreemode;\r\n      var configcontrol = $(theid).get(0);\r\n      if (configcontrol) {\r\n        var matchingdata = JSON.parse(configcontrol.value);\r\n        $(theid).remove();\r\n      } else {\r\n        //if there is no config we might as well give up\r\n        log.debug('No config found on page. Giving up.');\r\n        return;\r\n      }\r\n\r\n      app.process(matchingdata);\r\n\r\n      a4e.register_events();\r\n      a4e.init_audio(props.token,props.region,props.owner);\r\n      polly.init(props.token, props.region, props.owner);\r\n      app.ttslanguage = props.ttslanguage;\r\n\r\n      this.register_events();\r\n    },\r\n\r\n    register_events: function() {\r\n\r\n      // Get the audio element\r\n      var aplayer = $(\"#dictation_player\");\r\n      $(\"#listen-button\").click(function() {\r\n          if (app.audio) {\r\n              aplayer.attr('src', app.audio);\r\n              aplayer[0].play();\r\n          } else {\r\n              polly.fetch_polly_url(app.tts, 'text', app.ttsvoice);\r\n          }\r\n\r\n      });\r\n\r\n      //play what was returned in polly.fetch_polly_url\r\n      polly.onnewpollyurl = function(theurl) {\r\n          aplayer.attr('src', theurl);\r\n          aplayer[0].play();\r\n      };\r\n\r\n      $('body').on('click', \"#wordcards-close-results\", function() {\r\n\r\n        var total_time = app.timer.count;\r\n        var url = app.nexturl.replace(/&amp;/g, '&') + \"&localscattertime=\" + total_time\r\n        window.location.replace(url);\r\n\r\n      });\r\n\r\n      $('body').on('click', \"#wordcards-try-again\", function() {\r\n        location.reload();\r\n      });\r\n\r\n      $(\"body\").on('click', '.a4e-distractor', function(e) {\r\n        app.check($(this).data('correct'), this);\r\n      });\r\n\r\n      $('body').on('click', '#wordcards-start-button', function() {\r\n        app.start();\r\n      });\r\n\r\n    },\r\n\r\n    process: function(json) {\r\n      app.terms = json.terms;\r\n      a4e.list_vocab(\"#vocab-list-inner\", app.terms);\r\n    },\r\n    start: function() {\r\n      app.results = [];\r\n      a4e.shuffle(app.terms);\r\n      app.pointer = 0;\r\n      $(\"#wordcards-vocab-list, #wordcards-start-button\").hide();\r\n      $(\"#wordcards-gameboard\").show();\r\n      $(\"#wordcards-time-counter\").text(\"00:00\");\r\n      app.timer = {\r\n        interval: setInterval(function() {\r\n          app.timer.update();\r\n        }, 1000),\r\n        count: 0,\r\n        update: function() {\r\n          app.timer.count++;\r\n          $(\"#wordcards-time-counter\").text(a4e.pretty_print_secs(app.timer.count));\r\n        }\r\n      }\r\n      app.next();\r\n    },\r\n    quit: function() {\r\n      clearInterval(app.timer.interval);\r\n      $(\"#wordcards-gameboard\").hide();\r\n      $(\"#wordcards-vocab-list, #wordcards-start-button\").show();\r\n    },\r\n\r\n    end: function() {\r\n      clearInterval(app.timer.interval);\r\n      $(\"#wordcards-gameboard, #wordcards-start-button\").hide();\r\n      $(\"#wordcards-results\").show();\r\n\r\n      //template data\r\n      var tdata = [];\r\n      tdata['nexturl'] = this.nexturl;\r\n      tdata['results'] = app.results;\r\n      tdata['total'] = app.terms.length;\r\n      tdata['totalcorrect'] = a4e.calc_total_points(app.results);\r\n      var total_time = app.timer.count;\r\n      if (total_time == 0) {\r\n        tdata['prettytime'] = '00:00';\r\n      } else {\r\n        tdata['prettytime'] = a4e.pretty_print_secs(total_time);\r\n      }\r\n      templates.render('mod_wordcards/feedback', tdata).then(\r\n        function(html, js) {\r\n          $(\"#results-inner\").html(html);\r\n          // Add listeners for the \"Add to my words\" buttons.\r\n          require([\"mod_wordcards/mywords\"], function(mywords) {\r\n            mywords.initFromFeedbackPage();\r\n          });\r\n        }\r\n      );\r\n\r\n      var data = {\r\n        results: app.results,\r\n        activity: \"match_select\"\r\n      };\r\n\r\n      console.log(data);\r\n\r\n      if (!app.isFreeMode) {\r\n        Ajax.call([{\r\n          methodname: 'mod_wordcards_report_step_grade',\r\n          args: {\r\n            modid: app.modid,\r\n            correct: tdata['totalcorrect']\r\n          }\r\n        }]);\r\n      }\r\n\r\n\r\n    },\r\n    next: function() {\r\n      \r\n      a4e.progress_dots(app.results, app.terms);\r\n\r\n        app.tts = app.terms[app.pointer]['term'];\r\n\r\n        if (app.terms[app.pointer]['ttsvoice']) {\r\n            app.ttsvoice = app.terms[app.pointer]['ttsvoice'];\r\n        } else {\r\n            app.ttsvoice = 'auto';\r\n        }\r\n\r\n        if (app.terms[app.pointer]['audio']) {\r\n            app.audio = app.terms[app.pointer]['audio'];\r\n        } else {\r\n            app.audio = false;\r\n        }\r\n        $(\"#listen-button\").trigger(\"click\");\r\n\r\n      $(\"#wordcards-input\").html(app.get_distractors());\r\n\r\n    },\r\n\r\n    check: function(correct, clicked) {\r\n      var points = 0;\r\n      if (correct == true) {\r\n        //createjs.Sound.play('correct');\r\n        points = 1;\r\n      } else {\r\n        //createjs.Sound.play('incorrect');\r\n      }\r\n      $(\".a4e-distractor\").css('pointer-events', 'none');\r\n      \r\n      var result = {\r\n        question: app.terms[app.pointer]['definition'],\r\n        selected: $(clicked).text(),\r\n        correct: app.terms[app.pointer]['term'],\r\n        points: points,\r\n        id: app.terms[app.pointer]['id']\r\n      };\r\n      \r\n      app.results.push(result);\r\n\r\n      var background = correct == true ? 'a4e-correct' : 'a4e-incorrect';\r\n      $(clicked).addClass(background).append(\"<i style='color:\" + (correct ? 'green' : 'red') + \";margin-left:5px;' class='fa fa-\" + (correct ? 'check' : 'times') + \"'></i>\").parent().addClass('a4e-click-disabled');\r\n\r\n      if (!correct) {\r\n        $(\".a4e-distractor[data-correct='true']\").addClass('a4e-correct').append(\"<i style='color:green;margin-left:5px;' class='fa fa-check'></i>\");\r\n      }\r\n\r\n      //post results to server\r\n      if (correct) {\r\n        this.reportSuccess(app.terms[app.pointer]['id']);\r\n      } else {\r\n        this.reportFailure(app.terms[app.pointer]['id'], $(clicked).data('id'));\r\n      }\r\n\r\n      app.pointer++;\r\n      if (!correct) {\r\n        setTimeout(function() {\r\n          if (app.pointer < app.terms.length) {\r\n            app.next();\r\n          } else {\r\n            app.end();\r\n          }\r\n        }, 1500)\r\n      } else {\r\n        setTimeout(function() {\r\n          if (app.pointer < app.terms.length) {\r\n            app.next();\r\n          } else {\r\n            app.end();\r\n          }\r\n        }, 1000)\r\n      }\r\n    },\r\n\r\n    get_distractors: function() {\r\n      var distractors = app.terms.slice(0);\r\n      var answer = app.terms[app.pointer]['term'];\r\n      distractors.splice(app.pointer, 1);\r\n      a4e.shuffle(distractors);\r\n      distractors = distractors.slice(0, 4);\r\n      distractors.push(app.terms[app.pointer]);\r\n      a4e.shuffle(distractors);\r\n      var options = [];\r\n      $.each(distractors, function(i, o) {\r\n        var is_correct = o['term'] == answer;\r\n        var term_id = o['id'];\r\n        //depending on options  show option label as term or def\r\n        if(app.lcoptions===\"0\"){\r\n          var label= o['term'];\r\n        }else{\r\n         var label= o['definition'];\r\n        }\r\n        //\r\n        options.push('<li data-id=\"' + term_id + '\" data-correct=\"' + is_correct.toString() + '\" class=\"list-group-item a4e-distractor a4e-noselect\">' + label + '</li>');\r\n      });\r\n      var code = '<ul class=\"list-group a4e-distractors\">' + options.join('') + '</ul>';\r\n      return code;\r\n    },\r\n\r\n    reportFailure: function(term1id, term2id) {\r\n      if (this.dryRun) {\r\n        return;\r\n      }\r\n\r\n      Ajax.call([{\r\n        methodname: 'mod_wordcards_report_failed_association',\r\n        args: {\r\n          term1id: term1id,\r\n          term2id: term2id,\r\n          isfreemode: app.isFreeMode\r\n        }\r\n      }]);\r\n    },\r\n\r\n    reportSuccess: function(termid) {\r\n      if (this.dryRun) {\r\n        return;\r\n      }\r\n\r\n      Ajax.call([{\r\n        methodname: 'mod_wordcards_report_successful_association',\r\n        args: {\r\n          termid: termid,\r\n          isfreemode: app.isFreeMode\r\n        }\r\n      }]);\r\n    }\r\n  };\r\n\r\n  return app;\r\n\r\n});"],"file":"listenchoose.min.js"}