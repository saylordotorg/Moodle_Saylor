{"version":3,"sources":["../src/matchtype.js"],"names":["define","$","Ajax","log","a4e","keyboard","templates","app","dryRun","distractors","init","props","theid","widgetid","nexturl","modid","configcontrol","get","matchingdata","JSON","parse","value","remove","debug","process","register_events","init_audio","token","region","owner","on","total_time","timer","count","url","replace","window","location","reload","start","json","terms","has_images","list_vocab","terms_to_distractors","results","shuffle","pointer","hide","show","text","interval","setInterval","update","pretty_print_secs","next","quit","clear","clearInterval","end","tdata","length","calc_total_points","render","then","html","data","activity","console","call","methodname","args","correct","progress_dots","removeClass","distractorscopy","slice","create","term","disable","check","code","image","definition","selected","toLowerCase","trim","points","addClass","reportSuccess","reportFailure","result","question","push","setTimeout","i","each","split","l","indexOf","term1id","term2id","termid"],"mappings":"AAQAA,OAAM,2BAAC,CACL,QADK,CAEL,WAFK,CAGL,UAHK,CAIL,mBAJK,CAKL,wBALK,CAML,gBANK,CAAD,CAOH,SAASC,CAAT,CAAYC,CAAZ,CAAkBC,CAAlB,CAAuBC,CAAvB,CAA4BC,CAA5B,CAAsCC,CAAtC,CAAiD,CAElD,GAAIC,CAAAA,CAAG,CAAG,CACRC,MAAM,GADE,CAERC,WAAW,CAAE,EAFL,CAIRC,IAAI,CAAE,cAASC,CAAT,CAAgB,CAGpB,GAAIC,CAAAA,CAAK,CAAG,IAAMD,CAAK,CAACE,QAAxB,CACA,KAAKL,MAAL,CAAcG,CAAK,CAACH,MAApB,CACA,KAAKM,OAAL,CAAeH,CAAK,CAACG,OAArB,CACA,KAAKC,KAAL,CAAaJ,CAAK,CAACI,KAAnB,CACA,GAAIC,CAAAA,CAAa,CAAGf,CAAC,CAACW,CAAD,CAAD,CAASK,GAAT,CAAa,CAAb,CAApB,CACA,GAAID,CAAJ,CAAmB,CACjB,GAAIE,CAAAA,CAAY,CAAGC,IAAI,CAACC,KAAL,CAAWJ,CAAa,CAACK,KAAzB,CAAnB,CACApB,CAAC,CAACW,CAAD,CAAD,CAASU,MAAT,EACD,CAHD,IAGO,CAELnB,CAAG,CAACoB,KAAJ,CAAU,qCAAV,EACA,MACD,CAEDhB,CAAG,CAACiB,OAAJ,CAAYN,CAAZ,EAEAd,CAAG,CAACqB,eAAJ,GACArB,CAAG,CAACsB,UAAJ,CAAef,CAAK,CAACgB,KAArB,CAA2BhB,CAAK,CAACiB,MAAjC,CAAwCjB,CAAK,CAACkB,KAA9C,EAEA,KAAKJ,eAAL,EACD,CA3BO,CA6BRA,eAAe,CAAE,0BAAW,CAE1BxB,CAAC,CAAC,MAAD,CAAD,CAAU6B,EAAV,CAAa,OAAb,CAAsB,0BAAtB,CAAkD,UAAW,IAEvDC,CAAAA,CAAU,CAAGxB,CAAG,CAACyB,KAAJ,CAAUC,KAFgC,CAGvDC,CAAG,CAAG3B,CAAG,CAACO,OAAJ,CAAYqB,OAAZ,CAAoB,QAApB,CAA8B,GAA9B,EAAqC,oBAArC,CAA4DJ,CAHX,CAI3DK,MAAM,CAACC,QAAP,CAAgBF,OAAhB,CAAwBD,CAAxB,CAED,CAND,EAQAjC,CAAC,CAAC,MAAD,CAAD,CAAU6B,EAAV,CAAa,OAAb,CAAsB,sBAAtB,CAA8C,UAAW,CACvDO,QAAQ,CAACC,MAAT,EACD,CAFD,EAIArC,CAAC,CAAC,MAAD,CAAD,CAAU6B,EAAV,CAAa,OAAb,CAAsB,yBAAtB,CAAiD,UAAW,CAC1DvB,CAAG,CAACgC,KAAJ,EACD,CAFD,CAID,CA/CO,CAiDRf,OAAO,CAAE,iBAASgB,CAAT,CAAe,CAEtBjC,CAAG,CAACkC,KAAJ,CAAYD,CAAI,CAACC,KAAjB,CACAlC,CAAG,CAACmC,UAAJ,CAAiBF,CAAI,CAACE,UAAtB,CACAtC,CAAG,CAACuC,UAAJ,CAAe,mBAAf,CAAoCpC,CAAG,CAACkC,KAAxC,EACAlC,CAAG,CAACE,WAAJ,CAAgBF,CAAG,CAACqC,oBAAJ,CAAyBrC,CAAG,CAACkC,KAA7B,CAEjB,CAxDO,CAyDRF,KAAK,CAAE,gBAAW,CAChBhC,CAAG,CAACsC,OAAJ,CAAc,EAAd,CACAzC,CAAG,CAAC0C,OAAJ,CAAYvC,CAAG,CAACkC,KAAhB,EACAlC,CAAG,CAACwC,OAAJ,CAAc,CAAd,CACA9C,CAAC,CAAC,gDAAD,CAAD,CAAoD+C,IAApD,GACA/C,CAAC,CAAC,sBAAD,CAAD,CAA0BgD,IAA1B,GACAhD,CAAC,CAAC,yBAAD,CAAD,CAA6BiD,IAA7B,CAAkC,OAAlC,EACA3C,CAAG,CAACyB,KAAJ,CAAY,CACVmB,QAAQ,CAAEC,WAAW,CAAC,UAAW,CAC/B7C,CAAG,CAACyB,KAAJ,CAAUqB,MAAV,EACD,CAFoB,CAElB,GAFkB,CADX,CAIVpB,KAAK,CAAE,CAJG,CAKVoB,MAAM,CAAE,iBAAW,CACjB9C,CAAG,CAACyB,KAAJ,CAAUC,KAAV,GACAhC,CAAC,CAAC,yBAAD,CAAD,CAA6BiD,IAA7B,CAAkC9C,CAAG,CAACkD,iBAAJ,CAAsB/C,CAAG,CAACyB,KAAJ,CAAUC,KAAhC,CAAlC,CACD,CARS,CAAZ,CAUA1B,CAAG,CAACgD,IAAJ,EACD,CA3EO,CA4ERC,IAAI,CAAE,eAAW,CACfnD,CAAQ,CAACoD,KAAT,GACAC,aAAa,CAACnD,CAAG,CAACyB,KAAJ,CAAUmB,QAAX,CAAb,CACAlD,CAAC,CAAC,sBAAD,CAAD,CAA0B+C,IAA1B,GACA/C,CAAC,CAAC,gDAAD,CAAD,CAAoDgD,IAApD,EACD,CAjFO,CAmFRU,GAAG,CAAE,cAAW,CACdtD,CAAQ,CAACoD,KAAT,GACAC,aAAa,CAACnD,CAAG,CAACyB,KAAJ,CAAUmB,QAAX,CAAb,CACAlD,CAAC,CAAC,+CAAD,CAAD,CAAmD+C,IAAnD,GACA/C,CAAC,CAAC,oBAAD,CAAD,CAAwBgD,IAAxB,GAGA,GAAIW,CAAAA,CAAK,CAAG,EAAZ,CACAA,CAAK,QAAL,CAAmBrD,CAAG,CAACsC,OAAvB,CACAe,CAAK,MAAL,CAAiBrD,CAAG,CAACkC,KAAJ,CAAUoB,MAA3B,CACAD,CAAK,aAAL,CAAwBxD,CAAG,CAAC0D,iBAAJ,CAAsBvD,CAAG,CAACsC,OAA1B,CAAxB,CACA,GAAId,CAAAA,CAAU,CAAGxB,CAAG,CAACyB,KAAJ,CAAUC,KAA3B,CACA,GAAkB,CAAd,EAAAF,CAAJ,CAAqB,CACnB6B,CAAK,WAAL,CAAsB,OACvB,CAFD,IAEO,CACLA,CAAK,WAAL,CAAsBxD,CAAG,CAACkD,iBAAJ,CAAsBvB,CAAtB,CACvB,CACDzB,CAAS,CAACyD,MAAV,CAAiB,wBAAjB,CAA2CH,CAA3C,EAAkDI,IAAlD,CACE,SAASC,CAAT,CAAmB,CACjBhE,CAAC,CAAC,gBAAD,CAAD,CAAoBgE,IAApB,CAAyBA,CAAzB,CACD,CAHH,EAMA,GAAIC,CAAAA,CAAI,CAAG,CACTrB,OAAO,CAAEtC,CAAG,CAACsC,OADJ,CAETsB,QAAQ,CAAE,YAFD,CAAX,CAIAC,OAAO,CAACjE,GAAR,CAAY+D,CAAZ,EAEAhE,CAAI,CAACmE,IAAL,CAAU,CAAC,CACPC,UAAU,CAAE,iCADL,CAEPC,IAAI,CAAE,CACFxD,KAAK,CAAER,CAAG,CAACQ,KADT,CAEFyD,OAAO,CAAEZ,CAAK,aAFZ,CAFC,CAAD,CAAV,CAQD,CAxHO,CA0HRL,IAAI,CAAE,eAAW,CAEfnD,CAAG,CAACqE,aAAJ,CAAkBlE,CAAG,CAACsC,OAAtB,CAA+BtC,CAAG,CAACkC,KAAnC,EAEAxC,CAAC,CAAC,sBAAD,CAAD,CAA0BgE,IAA1B,CAA+B,EAA/B,EAAmCS,WAAnC,CAA+C,2BAA/C,EAEA,GAAIC,CAAAA,CAAe,CAAGpE,CAAG,CAACE,WAAJ,CAAgBmE,KAAhB,CAAsB,CAAtB,CAAtB,CACAvE,CAAQ,CAACwE,MAAT,CAAgB,iBAAhB,CAAmCtE,CAAG,CAACkC,KAAJ,CAAUlC,CAAG,CAACwC,OAAd,EAAuB+B,IAA1D,CAAgEvE,CAAG,CAACwC,OAApE,CAA6E4B,CAA7E,CAA8F,SAAStD,CAAT,CAAgB,CAC5GpB,CAAC,CAAC,sBAAD,CAAD,CAA0BgE,IAA1B,CAA+B1D,CAAG,CAACkC,KAAJ,CAAUlC,CAAG,CAACwC,OAAd,EAAuB+B,IAAtD,EACAzE,CAAQ,CAAC0E,OAAT,GACAxE,CAAG,CAACyE,KAAJ,CAAU3D,CAAV,CACD,CAJD,EAMA,GAAI4D,CAAAA,CAAI,CAAC,EAAT,CACA,GAAG1E,CAAG,CAACkC,KAAJ,CAAUlC,CAAG,CAACwC,OAAd,EAAuBmC,KAA1B,CAAgC,CAC9BD,CAAI,EAAE,oCAAsC1E,CAAG,CAACkC,KAAJ,CAAUlC,CAAG,CAACwC,OAAd,EAAuBmC,KAA7D,CAAqE,IAC5E,CACDD,CAAI,EAAE,WAAa1E,CAAG,CAACkC,KAAJ,CAAUlC,CAAG,CAACwC,OAAd,EAAuBoC,UAApC,CAAiD,WAAvD,CACAlF,CAAC,CAAC,qBAAD,CAAD,CAAyBgE,IAAzB,CAA8BgB,CAA9B,CAED,CA9IO,CAgJRD,KAAK,CAAE,eAASI,CAAT,CAAmB,IACpBZ,CAAAA,CAAO,CAAGY,CAAQ,CAACC,WAAT,GAAuBC,IAAvB,IAAiC/E,CAAG,CAACkC,KAAJ,CAAUlC,CAAG,CAACwC,OAAd,EAAuB+B,IAAvB,CAA4BO,WAA5B,GAA0CC,IAA1C,EADvB,CAEpBC,CAAM,CAAG,CAFW,CAGxB,GAAI,IAAAf,CAAJ,CAAqB,CAEnBvE,CAAC,CAAC,sBAAD,CAAD,CAA0BuF,QAA1B,CAAmC,aAAnC,EACAD,CAAM,CAAG,CACV,CAJD,IAIO,CACLtF,CAAC,CAAC,sBAAD,CAAD,CAA0BuF,QAA1B,CAAmC,eAAnC,CAED,CAGD,GAAIhB,CAAJ,CAAa,CACX,KAAKiB,aAAL,CAAmBlF,CAAG,CAACkC,KAAJ,CAAUlC,CAAG,CAACwC,OAAd,IAAnB,CACD,CAFD,IAEO,CACL,KAAK2C,aAAL,CAAmBnF,CAAG,CAACkC,KAAJ,CAAUlC,CAAG,CAACwC,OAAd,IAAnB,CAAiD,CAAjD,CACD,CAED,GAAI4C,CAAAA,CAAM,CAAG,CACXC,QAAQ,CAAErF,CAAG,CAACkC,KAAJ,CAAUlC,CAAG,CAACwC,OAAd,YADC,CAEXqC,QAAQ,CAAEA,CAFC,CAGXZ,OAAO,CAAEjE,CAAG,CAACkC,KAAJ,CAAUlC,CAAG,CAACwC,OAAd,MAHE,CAIXwC,MAAM,CAAEA,CAJG,CAAb,CAOAhF,CAAG,CAACsC,OAAJ,CAAYgD,IAAZ,CAAiBF,CAAjB,EAEA,GAAIpF,CAAG,CAACwC,OAAJ,CAAcxC,CAAG,CAACkC,KAAJ,CAAUoB,MAAV,CAAmB,CAArC,CAAwC,CACtCtD,CAAG,CAACwC,OAAJ,GAEA+C,UAAU,CAAC,UAAW,CACpBvF,CAAG,CAACgD,IAAJ,EACD,CAFS,CAEP,GAFO,CAIX,CAPD,IAOO,CACLhD,CAAG,CAACoD,GAAJ,EACD,CAIF,CAzLO,CA2LPf,oBAAoB,CAAE,8BAASH,CAAT,CAAe,CAEhC,OADIhC,CAAAA,CAAW,CAAC,EAChB,CAAQsF,CAAC,CAAC,CAAV,CACQjB,CADR,CAAYiB,CAAC,CAACtD,CAAK,CAACoB,MAApB,CAA4BkC,CAAC,EAA7B,CAAgC,CACxBjB,CADwB,CACjBrC,CAAK,CAACsD,CAAD,CAAL,CAASjB,IADQ,CAE5B7E,CAAC,CAAC+F,IAAF,CAAOlB,CAAI,CAACmB,KAAL,CAAW,EAAX,CAAP,CAAsB,SAASF,CAAT,CAAWG,CAAX,CAAa,CAC/B,GAA2B,CAAC,CAAzB,EAAAzF,CAAW,CAAC0F,OAAZ,CAAoBD,CAApB,CAAH,CAA8B,CAC1BzF,CAAW,CAACoF,IAAZ,CAAiBK,CAAjB,CACH,CACJ,CAJD,CAMH,CACD,MAAOzF,CAAAA,CACV,CAvMK,CAyMNiF,aAAa,CAAE,uBAASU,CAAT,CAAkBC,CAAlB,CAA2B,CAC1C,GAAI,KAAK7F,MAAT,CAAiB,CACf,MACD,CAEDN,CAAI,CAACmE,IAAL,CAAU,CAAC,CACTC,UAAU,CAAE,yCADH,CAETC,IAAI,CAAE,CACJ6B,OAAO,CAAEA,CADL,CAEJC,OAAO,CAAEA,CAFL,CAFG,CAAD,CAAV,CAOD,CArNO,CAuNRZ,aAAa,CAAE,uBAASa,CAAT,CAAiB,CAC9B,GAAI,KAAK9F,MAAT,CAAiB,CACf,MACD,CAEDN,CAAI,CAACmE,IAAL,CAAU,CAAC,CACTC,UAAU,CAAE,6CADH,CAETC,IAAI,CAAE,CACJ+B,MAAM,CAAEA,CADJ,CAFG,CAAD,CAAV,CAMD,CAlOO,CAAV,CAqOA,MAAO/F,CAAAA,CAER,CAhPK,CAAN","sourcesContent":["/**\r\n * Matching module.\r\n *\r\n * @package mod_wordcards\r\n * @author  Justin Hunt - poodll.com\r\n * * (based on Paul Raine's APPs 4 EFL)\r\n */\r\n\r\ndefine([\r\n  'jquery',\r\n  'core/ajax',\r\n  'core/log',\r\n  'mod_wordcards/a4e',\r\n  'mod_wordcards/keyboard',\r\n  'core/templates'\r\n], function($, Ajax, log, a4e, keyboard, templates) {\r\n\r\n  var app = {\r\n    dryRun: false,\r\n    distractors: [],\r\n\r\n    init: function(props) {\r\n\r\n      //pick up opts from html\r\n      var theid = '#' + props.widgetid;\r\n      this.dryRun = props.dryRun;\r\n      this.nexturl = props.nexturl;\r\n      this.modid = props.modid;\r\n      var configcontrol = $(theid).get(0);\r\n      if (configcontrol) {\r\n        var matchingdata = JSON.parse(configcontrol.value);\r\n        $(theid).remove();\r\n      } else {\r\n        //if there is no config we might as well give up\r\n        log.debug('No config found on page. Giving up.');\r\n        return;\r\n      }\r\n\r\n      app.process(matchingdata);\r\n\r\n      a4e.register_events();\r\n      a4e.init_audio(props.token,props.region,props.owner);\r\n\r\n      this.register_events();\r\n    },\r\n\r\n    register_events: function() {\r\n\r\n      $('body').on('click', \"#wordcards-close-results\", function() {\r\n\r\n        var total_time = app.timer.count;\r\n        var url = app.nexturl.replace(/&amp;/g, '&') + \"&localscattertime=\" + total_time\r\n        window.location.replace(url);\r\n\r\n      });\r\n\r\n      $('body').on('click', \"#wordcards-try-again\", function() {\r\n        location.reload();\r\n      });\r\n\r\n      $('body').on('click', '#wordcards-start-button', function() {\r\n        app.start();\r\n      });\r\n\r\n    },\r\n\r\n    process: function(json) {\r\n\r\n      app.terms = json.terms;\r\n      app.has_images = json.has_images;\r\n      a4e.list_vocab(\"#vocab-list-inner\", app.terms);\r\n      app.distractors=app.terms_to_distractors(app.terms);\r\n\r\n    },\r\n    start: function() {\r\n      app.results = [];\r\n      a4e.shuffle(app.terms);\r\n      app.pointer = 0;\r\n      $(\"#wordcards-vocab-list, #wordcards-start-button\").hide();\r\n      $(\"#wordcards-gameboard\").show();\r\n      $(\"#wordcards-time-counter\").text(\"00:00\");\r\n      app.timer = {\r\n        interval: setInterval(function() {\r\n          app.timer.update();\r\n        }, 1000),\r\n        count: 0,\r\n        update: function() {\r\n          app.timer.count++;\r\n          $(\"#wordcards-time-counter\").text(a4e.pretty_print_secs(app.timer.count));\r\n        }\r\n      };\r\n      app.next();\r\n    },\r\n    quit: function() {\r\n      keyboard.clear();\r\n      clearInterval(app.timer.interval);\r\n      $(\"#wordcards-gameboard\").hide();\r\n      $(\"#wordcards-vocab-list, #wordcards-start-button\").show();\r\n    },\r\n\r\n    end: function() {\r\n      keyboard.clear();\r\n      clearInterval(app.timer.interval);\r\n      $(\"#wordcards-gameboard, #wordcards-start-button\").hide();\r\n      $(\"#wordcards-results\").show();\r\n\r\n      //template data\r\n      var tdata = [];\r\n      tdata['results'] = app.results;\r\n      tdata['total'] = app.terms.length;\r\n      tdata['totalcorrect'] = a4e.calc_total_points(app.results);\r\n      var total_time = app.timer.count;\r\n      if (total_time == 0) {\r\n        tdata['prettytime'] = '00:00';\r\n      } else {\r\n        tdata['prettytime'] = a4e.pretty_print_secs(total_time);\r\n      }\r\n      templates.render('mod_wordcards/feedback', tdata).then(\r\n        function(html, js) {\r\n          $(\"#results-inner\").html(html);\r\n        }\r\n      );\r\n\r\n      var data = {\r\n        results: app.results,\r\n        activity: \"match_type\"\r\n      };\r\n      console.log(data);\r\n\r\n      Ajax.call([{\r\n          methodname: 'mod_wordcards_report_step_grade',\r\n          args: {\r\n              modid: app.modid,\r\n              correct: tdata['totalcorrect']\r\n          }\r\n      }]);\r\n\r\n    },\r\n\r\n    next: function() {\r\n\r\n      a4e.progress_dots(app.results, app.terms);\r\n      \r\n      $(\"#wordcards-submitted\").html(\"\").removeClass(\"a4e-correct a4e-incorrect\");\r\n\r\n      var distractorscopy = app.distractors.slice(0);\r\n      keyboard.create(\"wordcards-input\", app.terms[app.pointer].term, app.pointer, distractorscopy, function(value) {\r\n        $(\"#wordcards-submitted\").html(app.terms[app.pointer].term);\r\n        keyboard.disable();\r\n        app.check(value);\r\n      });\r\n\r\n      var code=\"\";\r\n      if(app.terms[app.pointer].image){\r\n        code+=\"<img class='a4e-prompt-img' src='\" + app.terms[app.pointer].image + \"'>\";\r\n      }\r\n      code+=\"<strong>\" + app.terms[app.pointer].definition + \"</strong>\"\r\n      $(\"#wordcards-question\").html(code);\r\n\r\n    },\r\n\r\n    check: function(selected) {\r\n      var correct = selected.toLowerCase().trim() == app.terms[app.pointer].term.toLowerCase().trim();\r\n      var points = 0;\r\n      if (correct == true) {\r\n        //createjs.Sound.play('correct');\r\n        $(\"#wordcards-submitted\").addClass(\"a4e-correct\");\r\n        points = 1;\r\n      } else {\r\n        $(\"#wordcards-submitted\").addClass(\"a4e-incorrect\");\r\n        //createjs.Sound.play('incorrect');\r\n      }\r\n\r\n      //post results to server\r\n      if (correct) {\r\n        this.reportSuccess(app.terms[app.pointer]['id']);\r\n      } else {\r\n        this.reportFailure(app.terms[app.pointer]['id'], 0);\r\n      }\r\n\r\n      var result = {\r\n        question: app.terms[app.pointer]['definition'],\r\n        selected: selected,\r\n        correct: app.terms[app.pointer]['term'],\r\n        points: points\r\n      };\r\n      \r\n      app.results.push(result);\r\n\r\n      if (app.pointer < app.terms.length - 1) {\r\n        app.pointer++;\r\n\r\n        setTimeout(function() {\r\n          app.next();\r\n        }, 1000)\r\n\r\n      } else {\r\n        app.end();\r\n      }\r\n\r\n\r\n\r\n    },\r\n\r\n     terms_to_distractors: function(terms){\r\n          var distractors=[];\r\n          for(var i=0;i<terms.length; i++){\r\n              var term = terms[i].term;\r\n              $.each(term.split(''),function(i,l){\r\n                  if(distractors.indexOf(l)==-1){\r\n                      distractors.push(l);\r\n                  }\r\n              });\r\n\r\n          }\r\n          return distractors;\r\n      },\r\n\r\n      reportFailure: function(term1id, term2id) {\r\n      if (this.dryRun) {\r\n        return;\r\n      }\r\n\r\n      Ajax.call([{\r\n        methodname: 'mod_wordcards_report_failed_association',\r\n        args: {\r\n          term1id: term1id,\r\n          term2id: term2id\r\n        }\r\n      }]);\r\n    },\r\n\r\n    reportSuccess: function(termid) {\r\n      if (this.dryRun) {\r\n        return;\r\n      }\r\n\r\n      Ajax.call([{\r\n        methodname: 'mod_wordcards_report_successful_association',\r\n        args: {\r\n          termid: termid\r\n        }\r\n      }]);\r\n    }\r\n  };\r\n\r\n  return app;\r\n\r\n});"],"file":"matchtype.min.js"}