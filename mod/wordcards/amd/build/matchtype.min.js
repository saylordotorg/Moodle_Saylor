define ("mod_wordcards/matchtype",["jquery","core/ajax","core/log","mod_wordcards/a4e","mod_wordcards/keyboard","core/templates"],function(a,b,c,d,e,f){var g={dryRun:!1,distractors:[],init:function init(b){var e="#"+b.widgetid;this.dryRun=b.dryRun;this.nexturl=b.nexturl;this.modid=b.modid;this.isFreeMode=b.isfreemode;var f=a(e).get(0);if(f){var h=JSON.parse(f.value);a(e).remove()}else{c.debug("No config found on page. Giving up.");return}g.process(h);d.register_events();d.init_audio(b.token,b.region,b.owner);this.register_events()},register_events:function register_events(){a("body").on("click","#wordcards-close-results",function(){var a=g.timer.count,b=g.nexturl.replace(/&amp;/g,"&")+"&localscattertime="+a;window.location.replace(b)});a("body").on("click","#wordcards-try-again",function(){location.reload()});a("body").on("click","#wordcards-start-button",function(){g.start()})},process:function process(a){g.terms=a.terms;d.list_vocab("#vocab-list-inner",g.terms);g.distractors=g.terms_to_distractors(g.terms)},start:function start(){g.results=[];d.shuffle(g.terms);g.pointer=0;a("#wordcards-vocab-list, #wordcards-start-button").hide();a("#wordcards-gameboard").show();a("#wordcards-time-counter").text("00:00");g.timer={interval:setInterval(function(){g.timer.update()},1e3),count:0,update:function update(){g.timer.count++;a("#wordcards-time-counter").text(d.pretty_print_secs(g.timer.count))}};g.next()},quit:function quit(){e.clear();clearInterval(g.timer.interval);a("#wordcards-gameboard").hide();a("#wordcards-vocab-list, #wordcards-start-button").show()},end:function end(){e.clear();clearInterval(g.timer.interval);a("#wordcards-gameboard, #wordcards-start-button").hide();a("#wordcards-results").show();var c=[];c.nexturl=this.nexturl;c.results=g.results;c.total=g.terms.length;c.totalcorrect=d.calc_total_points(g.results);var h=g.timer.count;if(0==h){c.prettytime="00:00"}else{c.prettytime=d.pretty_print_secs(h)}f.render("mod_wordcards/feedback",c).then(function(b){a("#results-inner").html(b);require(["mod_wordcards/mywords"],function(a){a.initFromFeedbackPage()})});var i={results:g.results,activity:"match_type"};console.log(i);if(!g.isFreeMode){b.call([{methodname:"mod_wordcards_report_step_grade",args:{modid:g.modid,correct:c.totalcorrect}}])}},next:function next(){d.progress_dots(g.results,g.terms);a("#wordcards-submitted").html("").removeClass("a4e-correct a4e-incorrect");var b=g.distractors.slice(0);e.create("wordcards-input",g.terms[g.pointer].term,g.pointer,b,function(b){a("#wordcards-submitted").html(g.terms[g.pointer].term);e.disable();g.check(b)});var c="";if(g.terms[g.pointer].image){c+="<img class='a4e-prompt-img' src='"+g.terms[g.pointer].image+"'>"}c+="<strong>"+g.terms[g.pointer].definition+"</strong>";a("#wordcards-question").html(c)},check:function check(b){var c=b.toLowerCase().trim()==g.terms[g.pointer].term.toLowerCase().trim(),d=0;if(!0==c){a("#wordcards-submitted").addClass("a4e-correct");d=1}else{a("#wordcards-submitted").addClass("a4e-incorrect")}if(c){this.reportSuccess(g.terms[g.pointer].id)}else{this.reportFailure(g.terms[g.pointer].id,0)}var e={question:g.terms[g.pointer].definition,selected:b,correct:g.terms[g.pointer].term,points:d,id:g.terms[g.pointer].id};g.results.push(e);if(g.pointer<g.terms.length-1){g.pointer++;setTimeout(function(){g.next()},1e3)}else{g.end()}},terms_to_distractors:function terms_to_distractors(b){for(var c=[],d=0,e;d<b.length;d++){e=b[d].term;a.each(e.split(""),function(a,b){if(-1==c.indexOf(b)){c.push(b)}})}return c},reportFailure:function reportFailure(a,c){if(this.dryRun){return}b.call([{methodname:"mod_wordcards_report_failed_association",args:{term1id:a,term2id:c,isfreemode:g.isFreeMode}}])},reportSuccess:function reportSuccess(a){if(this.dryRun){return}b.call([{methodname:"mod_wordcards_report_successful_association",args:{termid:a,isfreemode:g.isFreeMode}}])}};return g});
//# sourceMappingURL=matchtype.min.js.map
