{"version":3,"file":"a4e.min.js","sources":["../src/a4e.js"],"sourcesContent":["/**\n * Apps4EFL module.\n *\n * @package mod_wordcards\n * @author  Justin Hunt - poodll.com\n * (based on Paul Raine's APPs 4 EFL)\n */\n\ndefine([\n  'jquery',\n  'core/log',\n  'core/ajax',\n  'mod_wordcards/flip',\n  'mod_wordcards/textfit',\n  'core/templates',\n  'mod_wordcards/pollyhelper',\n], function($, log, Ajax, flip, textFit, templates, polly) {\n\n  var a4e = {\n\n    face: true,\n\n    register_events: function() {\n      console.log(\"register_events within a4e.js\");\n    },\n\n    init_audio: function(token, region, owner){\n\n        //Init Polly TTS\n        polly.init(token, region, owner);\n\n        //play what was returned in polly.fetch_polly_url (callback)\n        polly.onnewpollyurl = function(theurl) {\n            var theplayer = $(\"#poodll_vocabplayer\");\n            theplayer.attr('src', theurl);\n            theplayer[0].play();\n        };\n\n        //register button event handler to play audio\n        $(document.body).on('click','.a4e-flashcards-container .play-tts, span.model-sentence-play-tts,.definitions-container .definition-play-tts ',function() {\n            var theplayer = $(\"#poodll_vocabplayer\");\n\n            //if we have model audio use that, otherwise TTS\n            var audiourl=$(this).attr('data-modelaudio');\n            if(audiourl && (audiourl.indexOf('http:')===0 ||audiourl.indexOf('https:')===0)){\n                theplayer.attr('src', audiourl);\n                theplayer[0].play();\n            }else{\n                polly.fetch_polly_url($(this).attr('data-tts'), 'text', $(this).attr('data-ttsvoice'));\n            }\n        });\n    },\n\n    progress_dots: function(results, terms) {\n\n      var code = \"\",\n        color;\n      terms.forEach(function(o, i) {\n        var color = \"darkgray\";\n        if (results[i] !== undefined) {\n          if (results[i].points) {\n            color = \"green\";\n          } else {\n            color = \"red\";\n          }\n        }\n        code += '<i style=\"color:' + color + ';\" class=\"fa fa-circle\"></i>';\n      });\n\n      $(\"#wordcards-progress-dots\").html(code);\n\n    },\n\n    shuffle: function(a) {\n      var j, x, i;\n      for (i = a.length; i; i -= 1) {\n        j = Math.floor(Math.random() * i);\n        x = a[i - 1];\n        a[i - 1] = a[j];\n        a[j] = x;\n      }\n    },\n    pretty_print_secs: function(time) {\n      var minutes = Math.floor(time / 60);\n      var seconds = time - minutes * 60;\n      return a4e.str_pad_left(minutes, '0', 2) + ':' + a4e.str_pad_left(seconds, '0', 2);\n    },\n\n    list_vocab: function(target, terms, frontfaceflip) {\n\n      //template data\n      var tdata = [];\n      tdata['terms'] = terms;\n      templates.render('mod_wordcards/vocablist', tdata).then(\n        function(html, js) {\n          $(target).html(html);\n\n          var cards = $(\".a4e-flashcards-container .a4e-card\");\n          var faces = $(\".front,.back\");\n\n          setTimeout(function() {\n            cards.flip({axis:'x'});\n            textFit(faces, {\n              multiLine: true,\n              maxFontSize: 50,\n              alignHoriz: true,\n              alignVert: true\n            });\n          }, 100);\n\n          $('.a4e-flashcards-container .mod_wordcards_matching_frontbtn').on('click', function() {\n            $(\".a4e-flashcards-container .a4e-card\").flip(a4e.face);\n            a4e.face = !a4e.face;\n          });\n\n        }\n      );\n\n    },\n    calc_total_points: function(results) {\n      var total = 0;\n      $.each(results, function(i, o) {\n        if (o.points != undefined) {\n          total += o.points;\n        }\n      });\n      return total;\n    },\n    basic_feedback: function(results) {\n\n      var total = 0;\n      var total_time = 0;\n\n      $.each(results, function(i, o) {\n        if (o.time != null) {\n          total_time += o.time;\n        }\n        if (o.points != undefined) {\n          total += o.points;\n        }\n      });\n      var code = \"<div class='a4e-basic_feedback'><h2>\";\n      code += \"<i class='fa fa-trophy'></i> \" + total + \" points\";\n      if (total_time != 0) {\n        code += \"<hr/><i class='fa fa-clock-o'></i> \" + a4e.pretty_print_secs(total_time)\n      };\n      code += \"</h2></div>\";\n      return code;\n\n    },\n    detailed_feedback: function(results) {\n\n      var code = \"<div style='text-align:center;'>\",\n        color;\n\n      $.each(results, function(i, o) {\n\n        color = \"\";\n\n        if (o.points > 0) {\n          color = \"a4e-correct\";\n        } else {\n          color = \"a4e-incorrect\";\n        }\n\n        code += \"<div class='a4e-detailed_feedback_div \" + color + \"'>\";\n        code += \"<h3 style='margin-bottom:10px;margin-top:5px;'>\" + (i + 1) + \"</h3>\";\n        $.each(o, function(k, v) {\n          if (k == \"time\") {\n            code += \"<p><strong>\" + a4e.ucfirst(k) + \"</strong>:<br/>\" + a4e.pretty_print_secs(v) + \"</p>\";\n          } else {\n            code += \"<p><strong>\" + a4e.ucfirst(k) + \"</strong>:<br/>\" + (v == \"\" ? \"N/A\" : v) + \"</p>\";\n          }\n        });\n        code += \"</div>\";\n      });\n\n      code += \"</div>\";\n\n      return code;\n\n    },\n\n    str_pad_left: function(string, pad, length) {\n      return (new Array(length + 1).join(pad) + string).slice(-length);\n    },\n\n    ucfirst: function(str) {\n      str += ''\n      var f = str.charAt(0).toUpperCase()\n      return f + str.substr(1)\n    }\n\n  };\n\n  return a4e;\n\n});"],"names":["define","$","log","Ajax","flip","textFit","templates","polly","a4e","face","register_events","console","init_audio","token","region","owner","init","onnewpollyurl","theurl","theplayer","attr","play","document","body","on","audiourl","this","indexOf","fetch_polly_url","progress_dots","results","terms","code","forEach","o","i","color","undefined","points","html","shuffle","a","j","x","length","Math","floor","random","pretty_print_secs","time","minutes","seconds","str_pad_left","list_vocab","target","frontfaceflip","tdata","render","then","js","cards","faces","setTimeout","axis","multiLine","maxFontSize","alignHoriz","alignVert","calc_total_points","total","each","basic_feedback","total_time","detailed_feedback","k","v","ucfirst","string","pad","Array","join","slice","str","charAt","toUpperCase","substr"],"mappings":"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"}