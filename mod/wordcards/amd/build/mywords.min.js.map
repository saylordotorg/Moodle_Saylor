{"version":3,"file":"mywords.min.js","sources":["../src/mywords.js"],"sourcesContent":["/**\n * Module to watch my words buttons for clicks and report to back end.\n *\n * @package mod_wordcards\n * @author David Watson - evolutioncode.uk\n */\ndefine(['jquery', 'core/ajax', 'core/str'], function($, ajax, str) {\n    const SELECTOR = {\n        DATA_SET: '*[data-action=\"wordcards-set-my-words\"]',\n        MY_WORDS_DIV: '#my-words-ids',\n        MY_WORDS_ACTION_BTN_ID: '.wordcards-mywords-action-',\n        WORDPOOL_COUNTS: '.wordpool-count'\n    }\n\n    const CLASS = {\n        DISABLED: 'disabled',\n        BTN_NOT_IN_MY_WORDS: 'btn-outline-primary',\n        BTN_IN_MY_WORDS: 'btn-primary'\n    }\n\n    const EVENT = {\n        CLICK: 'click'\n    }\n\n    const DATA = {\n        TERM_ID: 'data-termid',\n        VALUE: 'data-value',\n        ADD: 'data-add',\n        REMOVE: 'data-remove',\n        MY_WORDS_IDS: 'data-my-words-term-ids'\n    }\n    var stringStore = {};\n\n    const initStrings = function (callback) {\n        str.get_strings([\n            {key: \"addtomywords\", component: \"mod_wordcards\"},\n            {key: \"removefrommywords\", component: \"mod_wordcards\"},\n        ]).done(function (strings) {\n            stringStore = strings;\n            if (typeof callback == 'function') {\n                callback();\n            }\n        });\n    }\n\n    const initButtonListeners = function() {\n        $(SELECTOR.DATA_SET).on(EVENT.CLICK, function(e) {\n            // There are two buttons for each term (one in grid and one in flashcards).\n            const currTar = $(e.currentTarget);\n            const buttons = $(SELECTOR.MY_WORDS_ACTION_BTN_ID + currTar.attr(DATA.TERM_ID));\n            const termId = buttons.attr(DATA.TERM_ID);\n            if (!currTar.hasClass(CLASS.DISABLED)) {\n                e.preventDefault();\n                buttons.addClass(CLASS.DISABLED)\n                // Hide wordpool counts in drop down as may become incorrect here.\n                $(SELECTOR.WORDPOOL_COUNTS).fadeOut();\n                const newStatus = buttons.hasClass(CLASS.BTN_IN_MY_WORDS) ? 0 : 1;\n                ajax.call([{\n                    methodname: 'mod_wordcards_set_my_words',\n                    args: {\n                        termid: termId,\n                        newstatus: newStatus\n                    }\n                }])[0].done(function(response) {\n                    if (response.success) {\n                        buttons.removeClass(CLASS.DISABLED);\n                        if (response.newStatus) {\n                            buttons.addClass(CLASS.BTN_IN_MY_WORDS);\n                            buttons.removeClass(CLASS.BTN_NOT_IN_MY_WORDS);\n                            buttons.attr('title', stringStore[1]);\n                        } else {\n                            buttons.removeClass(CLASS.BTN_IN_MY_WORDS);\n                            buttons.addClass(CLASS.BTN_NOT_IN_MY_WORDS);\n                            buttons.attr('title', stringStore[0]);\n                        }\n                    }\n                }).fail(function() {\n                    buttons.removeClass(CLASS.DISABLED);\n                })\n            }\n        })\n    }\n\n    /**\n     * Existing button statuses are on the main freemode template markup, so we need to grab them and render them,\n     */\n    const applyButtonStatuses = function() {\n        const myWordsDiv = $(SELECTOR.MY_WORDS_DIV);\n        if (myWordsDiv) {\n            const ids = JSON.parse(myWordsDiv.attr(DATA.MY_WORDS_IDS));\n            ids.forEach((id) => {\n                const btn = $(SELECTOR.MY_WORDS_ACTION_BTN_ID + id);\n                if (!btn.hasClass(CLASS.BTN_IN_MY_WORDS)) {\n                    btn\n                        .addClass(CLASS.BTN_IN_MY_WORDS)\n                        .removeClass(CLASS.BTN_NOT_IN_MY_WORDS)\n                        .attr('title', stringStore[1]);\n                }\n            });\n            return true;\n        }\n    }\n    return {\n        init: function () {\n            $(document).ready(function() {\n                initStrings();\n                initButtonListeners();\n            })\n        },\n        initFromFeedbackPage: function () {\n            initStrings(applyButtonStatuses);\n            initButtonListeners();\n        }\n    }\n});"],"names":["define","$","ajax","str","SELECTOR","CLASS","EVENT","DATA","stringStore","initStrings","callback","get_strings","key","component","done","strings","initButtonListeners","on","e","currTar","currentTarget","buttons","attr","termId","hasClass","preventDefault","addClass","fadeOut","newStatus","call","methodname","args","termid","newstatus","response","success","removeClass","fail","applyButtonStatuses","myWordsDiv","JSON","parse","forEach","id","btn","init","document","ready","initFromFeedbackPage"],"mappings":"AAMAA,+BAAO,CAAC,SAAU,YAAa,aAAa,SAASC,EAAGC,KAAMC,SACpDC,kBACQ,0CADRA,sBAEY,gBAFZA,gCAGsB,6BAHtBA,yBAIe,kBAGfC,eACQ,WADRA,0BAEmB,sBAFnBA,sBAGe,cAGfC,YACK,QAGLC,aACO,cADPA,kBAKY,yBAEdC,YAAc,GAEZC,YAAc,SAAUC,UAC1BP,IAAIQ,YAAY,CACZ,CAACC,IAAK,eAAgBC,UAAW,iBACjC,CAACD,IAAK,oBAAqBC,UAAW,mBACvCC,MAAK,SAAUC,SACdP,YAAcO,QACS,mBAAZL,UACPA,eAKNM,oBAAsB,WACxBf,EAAEG,mBAAmBa,GAAGX,aAAa,SAASY,OAEpCC,QAAUlB,EAAEiB,EAAEE,eACdC,QAAUpB,EAAEG,gCAAkCe,QAAQG,KAAKf,eAC3DgB,OAASF,QAAQC,KAAKf,kBACvBY,QAAQK,SAASnB,gBAAiB,CACnCa,EAAEO,iBACFJ,QAAQK,SAASrB,gBAEjBJ,EAAEG,0BAA0BuB,cACtBC,UAAYP,QAAQG,SAASnB,uBAAyB,EAAI,EAChEH,KAAK2B,KAAK,CAAC,CACPC,WAAY,6BACZC,KAAM,CACFC,OAAQT,OACRU,UAAWL,cAEf,GAAGd,MAAK,SAASoB,UACbA,SAASC,UACTd,QAAQe,YAAY/B,gBAChB6B,SAASN,WACTP,QAAQK,SAASrB,uBACjBgB,QAAQe,YAAY/B,2BACpBgB,QAAQC,KAAK,QAASd,YAAY,MAElCa,QAAQe,YAAY/B,uBACpBgB,QAAQK,SAASrB,2BACjBgB,QAAQC,KAAK,QAASd,YAAY,SAG3C6B,MAAK,WACJhB,QAAQe,YAAY/B,wBAS9BiC,oBAAsB,eAClBC,WAAatC,EAAEG,0BACjBmC,kBACYC,KAAKC,MAAMF,WAAWjB,KAAKf,oBACnCmC,SAAQ,SAACC,QACHC,IAAM3C,EAAEG,gCAAkCuC,IAC3CC,IAAIpB,SAASnB,wBACduC,IACKlB,SAASrB,uBACT+B,YAAY/B,2BACZiB,KAAK,QAASd,YAAY,QAGhC,SAGR,CACHqC,KAAM,WACF5C,EAAE6C,UAAUC,OAAM,WACdtC,cACAO,0BAGRgC,qBAAsB,WAClBvC,YAAY6B,qBACZtB"}