{"version":3,"sources":["../src/definitions.js"],"names":["define","$","Ajax","Notification","ModalFactory","str","ModalEvents","a4e","strings","init","opts","that","init_strings","theid","propscontrol","get","props","JSON","parse","value","remove","log","debug","ef","eg","totalcards","length","hide","addClass","set_progress_info","click","d","preventDefault","fadeIn","fadeOut","removeClass","cr_index","index","slideUp","slideDown","curr_level_card","html","parseInt","total","text","container","modid","canmanage","canattempt","btn","find","register_events","init_audio","token","region","owner","on","e","termNode","parents","first","termId","data","call","then","result","Deferred","reject","fail","exception","always","buttonhref","window","location","href","create","type","types","SAVE_CANCEL","title","reattempttitle","body","reattemptbody","modal","setSaveButtonText","reattempt","root","getRoot","save","show","get_strings","done","s","i"],"mappings":"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","sourcesContent":["define(['jquery', 'core/ajax', 'core/notification','core/modal_factory','core/str','core/modal_events', 'mod_wordcards/a4e'],\r\n    function($, Ajax, Notification,ModalFactory, str, ModalEvents, a4e) {\r\n  \"use strict\"; // jshint ;_;\r\n\r\n  return {\r\n\r\n    strings: {},\r\n\r\n    init: function(opts) {\r\n\r\n        var that = this;\r\n\r\n        //init strings\r\n        this.init_strings();\r\n\r\n        //pick up opts from html\r\n        var theid = '#' + opts['widgetid'];\r\n        var propscontrol = $(theid).get(0);\r\n        if (propscontrol) {\r\n            var props = JSON.parse(propscontrol.value);\r\n            this.props =props;\r\n            $(theid).remove();\r\n        } else {\r\n            //if there is no config we might as well give up\r\n            log.debug('No config found on page. Giving up.');\r\n            return;\r\n        }\r\n\r\n/* flashcards code start */\r\n\t\t\tvar ef = $(\".event_flashcards\");\r\n\t\t\tvar eg = $(\".event_grid\");\r\n\r\n\t\t\tvar totalcards = $('.definition_flashcards_ul li').length;\r\n\t\t\t$(\".definition_flashcards_ul li:gt(0)\").hide();\r\n            //set the first card as is_current\r\n            $(\".definition_flashcards_ul li:first\").addClass('is-current');\r\n\t\t\tset_progress_info(1,totalcards);\r\n\r\n\t\t\tef.click(function (d) {\r\n\t\t\t\td.preventDefault();\r\n\t\t\t\t$('.definition_flashcards').fadeIn();\r\n\t\t\t\t$('.definition_grid').fadeOut();\r\n\t\t\t\tef.addClass('btn-primary').removeClass('btn-outline-primary')\r\n\t\t\t\teg.removeClass('btn-primary').addClass('btn-outline-primary')\r\n\t\t\t});\r\n\t\t\teg.click(function (d) {\r\n\t\t\t\td.preventDefault();\r\n\t\t\t\t$('.definition_flashcards').fadeOut();\r\n\t\t\t\t$('.definition_grid').fadeIn();\r\n\t\t\t\teg.addClass('btn-primary').removeClass('btn-outline-primary')\r\n\t\t\t\tef.removeClass('btn-primary').addClass('btn-outline-primary')\r\n\t\t\t});\r\n\r\n\r\n\r\n\t\t\t$('#Next').click(function () {\r\n\t\t\t\tvar cr_index = $(\".is-current\").index() + 1;\r\n                if(cr_index > (totalcards-1)){cr_index=0;}\r\n\t\t\t\t$('.definition_flashcards_ul li').slideUp(300);\r\n                $('.definition_flashcards_ul li').removeClass(\"is-current\");\r\n                $('.definition_flashcards_ul li:eq(' + cr_index + ')').addClass(\"is-current\");\r\n\t\t\t\t$('.definition_flashcards_ul li:eq(' + cr_index + ')').slideDown(300);\r\n\r\n\t\t\t\t//var curr_level_card = $('.curr_level_card').html();\r\n\t\t\t\t//$('.curr_level_card').html(parseInt(curr_level_card) + 1);\r\n\r\n\t\t\t\tset_progress_info(cr_index + 1,totalcards);\r\n\r\n\t\t\t});\r\n\r\n\t\t\t$('#Prev').click(function () {\r\n\t\t\t\tvar cr_index = $(\".is-current\").index() - 1;\r\n                if(cr_index <0){cr_index=(totalcards-1);}\r\n\t\t\t\t$('.definition_flashcards_ul li').slideUp(300);\r\n                $('.definition_flashcards_ul li').removeClass(\"is-current\");\r\n                $('.definition_flashcards_ul li:eq(' + cr_index + ')').addClass(\"is-current\");\r\n\t\t\t\t$('.definition_flashcards_ul li:eq(' + cr_index + ')').slideDown(300);\r\n\t\t\t\tvar curr_level_card = $('.curr_level_card').html();\r\n\t\t\t\t$('.curr_level_card').html(parseInt(curr_level_card) - 1);\r\n\t\t\t\tset_progress_info(cr_index + 1 ,totalcards);\r\n\r\n\t\t\t});\r\n\r\n\t\t\tfunction set_progress_info(index,total) {\r\n\t\t\t\t$(\".definition_flashcards .wc_cardsprogress\").text(index + ' / ' + total);\r\n\t\t\t}\r\n\r\n\t\t\t/* flashcards code end */\r\n      var container = $('#definitions-page-' + opts['widgetid']),\r\n        modid = props.modid,\r\n        canmanage = props.canmanage,\r\n        canattempt = props.canattempt,\r\n        btn = container.find('.definitions-next');\r\n\r\n       //set up audio\r\n       a4e.register_events();\r\n       a4e.init_audio(props.token,props.region,props.owner);\r\n\r\n      container.on('click', '.term-seen-action', function(e) {\r\n        e.preventDefault();\r\n\r\n        var termNode = $(this).parents('.term').first();\r\n        var termId = termNode.data('termid');\r\n\r\n        //On the clicked (and visible) node add loading\r\n        termNode.addClass('term-loading');\r\n        Ajax.call([{\r\n            'methodname': 'mod_wordcards_mark_as_seen',\r\n            'args': {\r\n              'termid': termId\r\n            }\r\n          }])[0].then(function(result) {\r\n            if (!result) {\r\n              return $.Deferred().reject();\r\n            }\r\n\r\n          //since we have two nodes (grid and flashcards) for a single term,\r\n\t\t\t// and the user might toggle between the grid and flashcards view we need to update both\r\n\t\t\t//so the old termNode.addClass('term-seen') is no good. it would only update one\r\n          //  termNode.addClass('term-seen');\r\n\t\t\t$('.definition_flashcards [data-termid=\"' + termId + '\"]').addClass('term-seen')\r\n\t\t\t$('.definition_grid [data-termid=\"' + termId + '\"]').addClass('term-seen')\r\n          })\r\n          .fail(Notification.exception)\r\n          .always(function() {\r\n          \t//remove loading from  node which loading was applied to\r\n            termNode.removeClass('term-loading');\r\n\r\n          });\r\n      });\r\n\r\n      btn.click(function(e) {\r\n        e.preventDefault();\r\n        var buttonhref= $(this).data('href');\r\n\r\n        //f its not a reattempt ... proceed\r\n        if($(this).data('action')!=='reattempt') {\r\n            window.location.href = buttonhref;\r\n            return;\r\n        }\r\n\r\n        //if its a reattempt, confirm and proceed\r\n          ModalFactory.create({\r\n              type: ModalFactory.types.SAVE_CANCEL,\r\n              title: that.strings.reattempttitle,\r\n              body: that.strings.reattemptbody\r\n          })\r\n          .then(function(modal) {\r\n              modal.setSaveButtonText(that.strings.reattempt);\r\n              var root = modal.getRoot();\r\n              root.on(ModalEvents.save, function() {\r\n                  window.location.href = buttonhref;\r\n              });\r\n              modal.show();\r\n          });\r\n\r\n      });\r\n\r\n    },\r\n\r\n    init_strings: function(){\r\n        var that = this;\r\n        // set up strings\r\n        str.get_strings([\r\n            {\"key\": \"reattempttitle\",       \"component\": 'mod_wordcards'},\r\n            {\"key\": \"reattemptbody\",           \"component\": 'mod_wordcards'},\r\n            {\"key\": \"reattempt\",           \"component\": 'mod_wordcards'}\r\n\r\n        ]).done(function(s) {\r\n            var i = 0;\r\n            that.strings.reattempttitle = s[i++];\r\n            that.strings.reattemptbody = s[i++];\r\n            that.strings.reattempt = s[i++];\r\n        });\r\n    }\r\n\r\n  }\r\n\r\n});\r\n"],"file":"definitions.min.js"}