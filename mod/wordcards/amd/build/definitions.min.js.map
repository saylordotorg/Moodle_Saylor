{"version":3,"file":"definitions.min.js","sources":["../src/definitions.js"],"sourcesContent":["define(['jquery', 'core/ajax', 'core/notification','core/modal_factory','core/str','core/modal_events', 'mod_wordcards/a4e'],\r\n    function($, Ajax, Notification,ModalFactory, str, ModalEvents, a4e) {\r\n  \"use strict\"; // jshint ;_;\r\n\r\n  return {\r\n\r\n    strings: {},\r\n\r\n    init: function(opts) {\r\n\r\n        var that = this;\r\n\r\n        //init strings\r\n        this.init_strings();\r\n\r\n        //pick up opts from html\r\n        var theid = '#' + opts['widgetid'];\r\n        var propscontrol = $(theid).get(0);\r\n        if (propscontrol) {\r\n            var props = JSON.parse(propscontrol.value);\r\n            this.props =props;\r\n            $(theid).remove();\r\n        } else {\r\n            //if there is no config we might as well give up\r\n            log.debug('No config found on page. Giving up.');\r\n            return;\r\n        }\r\n\r\n/* flashcards code start */\r\n\t\t\tvar ef = $(\".event_flashcards\");\r\n\t\t\tvar eg = $(\".event_grid\");\r\n\r\n\t\t\tvar totalcards = $('.definition_flashcards_ul li').length;\r\n\t\t\t$(\".definition_flashcards_ul li:gt(0)\").hide();\r\n            //set the first card as is_current\r\n            $(\".definition_flashcards_ul li:first\").addClass('is-current');\r\n\t\t\tset_progress_info(1,totalcards);\r\n\r\n\t\t\tef.click(function (d) {\r\n\t\t\t\td.preventDefault();\r\n\t\t\t\t$('.definition_flashcards').fadeIn();\r\n\t\t\t\t$('.definition_grid').fadeOut();\r\n\t\t\t\tef.addClass('btn-primary').removeClass('btn-outline-primary')\r\n\t\t\t\teg.removeClass('btn-primary').addClass('btn-outline-primary')\r\n\t\t\t});\r\n\t\t\teg.click(function (d) {\r\n\t\t\t\td.preventDefault();\r\n\t\t\t\t$('.definition_flashcards').fadeOut();\r\n\t\t\t\t$('.definition_grid').fadeIn();\r\n\t\t\t\teg.addClass('btn-primary').removeClass('btn-outline-primary')\r\n\t\t\t\tef.removeClass('btn-primary').addClass('btn-outline-primary')\r\n\t\t\t});\r\n\r\n\r\n\r\n\t\t\t$('#Next').click(function () {\r\n\t\t\t\tvar cr_index = $(\".is-current\").index() + 1;\r\n                if(cr_index > (totalcards-1)){cr_index=0;}\r\n\t\t\t\t$('.definition_flashcards_ul li').slideUp(300);\r\n                $('.definition_flashcards_ul li').removeClass(\"is-current\");\r\n                $('.definition_flashcards_ul li:eq(' + cr_index + ')').addClass(\"is-current\");\r\n\t\t\t\t$('.definition_flashcards_ul li:eq(' + cr_index + ')').slideDown(300);\r\n\r\n\t\t\t\t//var curr_level_card = $('.curr_level_card').html();\r\n\t\t\t\t//$('.curr_level_card').html(parseInt(curr_level_card) + 1);\r\n\r\n\t\t\t\tset_progress_info(cr_index + 1,totalcards);\r\n\r\n\t\t\t});\r\n\r\n\t\t\t$('#Prev').click(function () {\r\n\t\t\t\tvar cr_index = $(\".is-current\").index() - 1;\r\n                if(cr_index <0){cr_index=(totalcards-1);}\r\n\t\t\t\t$('.definition_flashcards_ul li').slideUp(300);\r\n                $('.definition_flashcards_ul li').removeClass(\"is-current\");\r\n                $('.definition_flashcards_ul li:eq(' + cr_index + ')').addClass(\"is-current\");\r\n\t\t\t\t$('.definition_flashcards_ul li:eq(' + cr_index + ')').slideDown(300);\r\n\t\t\t\tvar curr_level_card = $('.curr_level_card').html();\r\n\t\t\t\t$('.curr_level_card').html(parseInt(curr_level_card) - 1);\r\n\t\t\t\tset_progress_info(cr_index + 1 ,totalcards);\r\n\r\n\t\t\t});\r\n\r\n\t\t\tfunction set_progress_info(index,total) {\r\n\t\t\t\t$(\".definition_flashcards .wc_cardsprogress\").text(index + ' / ' + total);\r\n\t\t\t}\r\n\r\n\t\t\t/* flashcards code end */\r\n      var container = $('#definitions-page-' + opts['widgetid']),\r\n        modid = props.modid,\r\n        canmanage = props.canmanage,\r\n        canattempt = props.canattempt,\r\n        btn = container.find('.definitions-next');\r\n\r\n       //set up audio\r\n       a4e.register_events();\r\n       a4e.init_audio(props.token,props.region,props.owner);\r\n\r\n      container.on('click', '.term-seen-action', function(e) {\r\n        e.preventDefault();\r\n\r\n        var termNode = $(this).parents('.term').first();\r\n        var termId = termNode.data('termid');\r\n\r\n        //On the clicked (and visible) node add loading\r\n        termNode.addClass('term-loading');\r\n        Ajax.call([{\r\n            'methodname': 'mod_wordcards_mark_as_seen',\r\n            'args': {\r\n              'termid': termId\r\n            }\r\n          }])[0].then(function(result) {\r\n            if (!result) {\r\n              return $.Deferred().reject();\r\n            }\r\n\r\n          //since we have two nodes (grid and flashcards) for a single term,\r\n\t\t\t// and the user might toggle between the grid and flashcards view we need to update both\r\n\t\t\t//so the old termNode.addClass('term-seen') is no good. it would only update one\r\n          //  termNode.addClass('term-seen');\r\n\t\t\t$('.definition_flashcards [data-termid=\"' + termId + '\"]').addClass('term-seen')\r\n\t\t\t$('.definition_grid [data-termid=\"' + termId + '\"]').addClass('term-seen')\r\n          })\r\n          .fail(Notification.exception)\r\n          .always(function() {\r\n          \t//remove loading from  node which loading was applied to\r\n            termNode.removeClass('term-loading');\r\n\r\n          });\r\n      });\r\n\r\n      btn.click(function(e) {\r\n        e.preventDefault();\r\n        var buttonhref= $(this).data('href');\r\n\r\n        //f its not a reattempt ... proceed\r\n        if($(this).data('action')!=='reattempt') {\r\n            window.location.href = buttonhref;\r\n            return;\r\n        }\r\n\r\n        //if its a reattempt, confirm and proceed\r\n          ModalFactory.create({\r\n              type: ModalFactory.types.SAVE_CANCEL,\r\n              title: that.strings.reattempttitle,\r\n              body: that.strings.reattemptbody\r\n          })\r\n          .then(function(modal) {\r\n              modal.setSaveButtonText(that.strings.reattempt);\r\n              var root = modal.getRoot();\r\n              root.on(ModalEvents.save, function() {\r\n                  window.location.href = buttonhref;\r\n              });\r\n              modal.show();\r\n          });\r\n\r\n      });\r\n\r\n    },\r\n\r\n    init_strings: function(){\r\n        var that = this;\r\n        // set up strings\r\n        str.get_strings([\r\n            {\"key\": \"reattempttitle\",       \"component\": 'mod_wordcards'},\r\n            {\"key\": \"reattemptbody\",           \"component\": 'mod_wordcards'},\r\n            {\"key\": \"reattempt\",           \"component\": 'mod_wordcards'}\r\n\r\n        ]).done(function(s) {\r\n            var i = 0;\r\n            that.strings.reattempttitle = s[i++];\r\n            that.strings.reattemptbody = s[i++];\r\n            that.strings.reattempt = s[i++];\r\n        });\r\n    }\r\n\r\n  }\r\n\r\n});\r\n"],"names":["define","$","Ajax","Notification","ModalFactory","str","ModalEvents","a4e","strings","init","opts","that","this","init_strings","theid","propscontrol","get","props","JSON","parse","value","remove","ef","eg","totalcards","length","hide","addClass","set_progress_info","click","d","preventDefault","fadeIn","fadeOut","removeClass","cr_index","index","slideUp","slideDown","curr_level_card","html","parseInt","container","btn","modid","canmanage","canattempt","find","register_events","init_audio","token","region","owner","on","e","termNode","parents","first","termId","data","call","then","result","Deferred","reject","fail","exception","always","buttonhref","create","type","types","SAVE_CANCEL","title","reattempttitle","body","reattemptbody","modal","setSaveButtonText","reattempt","getRoot","save","window","location","href","show","log","debug","total","text","get_strings","done","s","i"],"mappings":"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"}