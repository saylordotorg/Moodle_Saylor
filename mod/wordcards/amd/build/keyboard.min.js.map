{"version":3,"sources":["../src/keyboard.js"],"names":["define","$","templates","keyboard","string","letters","qwerty","mobile_user","test","navigator","userAgent","iphone_user","shuffle","a","j","x","i","length","Math","floor","random","flash","target","classname","addClass","setTimeout","removeClass","off","clear","remove","disable","text","create","id","langdistractors","func","Array","isArray","distractors","each","split","l","indexOf","push","splice","concat","slice","sort","letter","item","charcode","charCodeAt","tdata","render","then","html","click_and_touchstart","e","press","preventDefault","on","code","substring","key","which","trigger","button","value","String","fromCharCode","data","old","new"],"mappings":"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","sourcesContent":["/**\n * Keyboard Helper\n *\n * @package mod_wordcards\n * @author  Justin Hunt - poodll.com\n * * (based on Paul Raine's APPs 4 EFL)\n */\n\ndefine(['jquery','core/templates'], function($,templates) {\n\n    var keyboard={\n        string:\"\",\n        letters:[],\n        qwerty:[\n            ['q','w','e','r','t','y','u','i','o','p'],\n            ['a','s','d','f','g','h','j','k','l'],\n            ['z','x','c','v','b','n','m']\n        ],\n        mobile_user:function(){\n            if( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ) {\n                return true;\n            }\n            else {\n                return false;\n            }\n        },\n        iphone_user:function(){\n            if( /iPhone|iPod/i.test(navigator.userAgent) ) {\n                return true;\n            }\n            else {\n                return false;\n            }\n        },\n        shuffle:function(a) {\n            var j, x, i;\n            for (i = a.length; i; i -= 1) {\n                j = Math.floor(Math.random() * i);\n                x = a[i - 1];\n                a[i - 1] = a[j];\n                a[j] = x;\n            }\n        },\n        flash:function(target,classname){\n            $(target).addClass(classname);\n            setTimeout(function(){\n                $(target).removeClass(classname);\n            }, 100);\n        },\n        off:function(){\n            $(\"body\").off(keyboard.mobile_user()?'touchstart':'click',\".chunk-key\")\n            .off(\"click\",\"#delete-chunk-input\")\n            .off(\"click\",\"#clear-chunk-input\")\n            .off(\"click\",\"#submit-chunk-input\")\n            .off(\"keypress\")\n            .off(\"keydown\");\n        },\n        clear:function(){\n            keyboard.off();\n            $(\"#chunk-input\").remove();\n        },\n        disable:function(){\n            keyboard.off();\n            $(\"#chunk-typed-inner\").text(\"\");\n            $(\"#chunk-input\").addClass(\"chunk-input-disabled\");\n        },\n        create:function(target,string,id,langdistractors,func){\n            var qwertydistractors=['a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z'];\n            if(Array.isArray(langdistractors)&& langdistractors.length>3){\n                var distractors = langdistractors;\n            }else{\n                distractors = qwertydistractors;\n            }\n\n            keyboard.string=string;\n            keyboard.off();\n            keyboard.letters=[];\n            $.each(string.split(''),function(i,l){\n                if(keyboard.letters.indexOf(l)==-1){\n                    keyboard.letters.push(l);\n                    distractors.splice(distractors.indexOf(l),1);\n                }\n            });\n            keyboard.shuffle(distractors);\n            if(distractors.length>2) {\n                keyboard.letters = keyboard.letters.concat(distractors.slice(0, 3));\n            }\n\n            keyboard.letters.sort();\n            var letters=[];\n            $.each(keyboard.letters,function(i,letter){\n                var item ={};\n                item.charcode = letter.charCodeAt(0);\n                if(letter==' '){\n                    item.letter='&nbsp;';\n                }else{\n                    item.letter=letter;\n                }\n                letters.push(item);\n            });\n            var tdata=[];\n            tdata['letters'] = letters;\n            tdata['dataid'] = id;\n            templates.render('mod_wordcards/keyboard',tdata).then(\n                function(html,js){\n                    $(\"#\"+target).html(html);\n                }\n            );\n\n\n            var click_and_touchstart = function(e){\n                var text=$(\"#chunk-typed-inner\").text();\n                if(text.length<string.length){\n                    //createjs.Sound.play('click');\n                    keyboard.press(this,func);\n                }\n                else{\n                    keyboard.flash(\"#chunk-typed-inner\",\"a4e-incorrect\");\n                    //createjs.Sound.play('cancel');\n                }\n                e.preventDefault();\n            };\n            \n            if(keyboard.mobile_user() && !keyboard.iphone_user()){\n              $(\"body\").off('touchstart',\".chunk-key\");\n              $(\"body\").on('touchstart',\".chunk-key\",click_and_touchstart);\n            }else{\n              $(\"body\").off('click',\".chunk-key\");\n              $(\"body\").on('click',\".chunk-key\",click_and_touchstart);            \n            }\n\n\n            $(\"body\").on(\"touchmove\",\"#\"+target,function(e){\n                e.preventDefault();\n            });\n            $(\"body\").on(\"click\",\"#delete-chunk-input\",function(){\n                var text=$(\"#chunk-typed-inner\").text();\n                var code=text.slice(-1).charCodeAt(0);\n                $(\"#chunk-typed-inner\").text(text.substring(0,text.length-1));\n                //$(\".chunk-key[data-val='\"+code+\"'].a4e-key-disabled:last\").removeClass('a4e-key-disabled');\n            });\n            $(\"body\").on(\"click\",\"#submit-chunk-input\",function(){\n                var text=$(\"#chunk-typed-inner\").text();\n                func(text);\n            });\n            $(\"body\").on(\"keydown\",function(e){\n                var key=e.which;\n                if([0,8,46].indexOf(key)!=-1){\n                    $(\"#delete-chunk-input\").trigger(\"click\");\n                    e.preventDefault();\n                }\n                else if(e.which==13){\n                    $(\"#submit-chunk-input\").trigger(\"click\");\n                    e.preventDefault();\n                }\n            });\n            $(\"body\").on('keypress',function(e){\n\n                var text=$(\"#chunk-typed-inner\").text();\n                var key=e.which;\n                //var button=$(\".chunk-key[data-val='\"+key+\"']:not(.a4e-key-disabled)\").first();\n                var button=$(\".chunk-key[data-val='\"+key+\"']\");\n                if(button.length && text.length<string.length){\n                    keyboard.press(button,func);\n                }\n                else{\n                    keyboard.flash(\"#chunk-typed-inner\",\"a4e-incorrect\");\n                    //createjs.Sound.play('cancel');\n                }\n                e.preventDefault();\n\n            });\n        },\n        press:function(target,func){\n            var value=String.fromCharCode($(target).data(\"val\"));\n            keyboard.flash(target,\"a4e-key-pressed\");\n            var text={old:$(\"#chunk-typed-inner\").text()};\n            text.new=text.old+value;\n            if(text.new.length<=keyboard.string.length){\n                $(\"#chunk-typed-inner\").text(text.new);\n                //$(target).addClass('a4e-key-disabled');\n            }\n            else{\n                keyboard.flash(\"#chunk-typed-inner\",\"a4e-incorrect\");\n                //createjs.Sound.play('cancel');\n            }\n        }\n    };\n\n    return keyboard;\n\n});\n"],"file":"keyboard.min.js"}