{"version":3,"file":"keyboard.min.js","sources":["../src/keyboard.js"],"sourcesContent":["/**\n * Keyboard Helper\n *\n * @package mod_wordcards\n * @author  Justin Hunt - poodll.com\n * * (based on Paul Raine's APPs 4 EFL)\n */\n\ndefine(['jquery','core/templates'], function($,templates) {\n\n    var keyboard={\n        string:\"\",\n        letters:[],\n        qwerty:[\n            ['q','w','e','r','t','y','u','i','o','p'],\n            ['a','s','d','f','g','h','j','k','l'],\n            ['z','x','c','v','b','n','m']\n        ],\n        mobile_user:function(){\n            if( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ) {\n                return true;\n            }\n            else {\n                return false;\n            }\n        },\n        iphone_user:function(){\n            if( /iPhone|iPod/i.test(navigator.userAgent) ) {\n                return true;\n            }\n            else {\n                return false;\n            }\n        },\n        shuffle:function(a) {\n            var j, x, i;\n            for (i = a.length; i; i -= 1) {\n                j = Math.floor(Math.random() * i);\n                x = a[i - 1];\n                a[i - 1] = a[j];\n                a[j] = x;\n            }\n        },\n        flash:function(target,classname){\n            $(target).addClass(classname);\n            setTimeout(function(){\n                $(target).removeClass(classname);\n            }, 100);\n        },\n        off:function(){\n            $(\"body\").off(keyboard.mobile_user()?'touchstart':'click',\".chunk-key\")\n            .off(\"click\",\"#delete-chunk-input\")\n            .off(\"click\",\"#clear-chunk-input\")\n            .off(\"click\",\"#submit-chunk-input\")\n            .off(\"keypress\")\n            .off(\"keydown\");\n        },\n        clear:function(){\n            keyboard.off();\n            $(\"#chunk-input\").remove();\n        },\n        disable:function(){\n            keyboard.off();\n            $(\"#chunk-typed-inner\").text(\"\");\n            $(\"#chunk-input\").addClass(\"chunk-input-disabled\");\n        },\n        create:function(target,string,id,langdistractors,func){\n            var qwertydistractors=['a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z'];\n            if(Array.isArray(langdistractors)&& langdistractors.length>3){\n                var distractors = langdistractors;\n            }else{\n                distractors = qwertydistractors;\n            }\n\n            keyboard.string=string;\n            keyboard.off();\n            keyboard.letters=[];\n            $.each(string.split(''),function(i,l){\n                if(keyboard.letters.indexOf(l)==-1){\n                    keyboard.letters.push(l);\n                    distractors.splice(distractors.indexOf(l),1);\n                }\n            });\n            keyboard.shuffle(distractors);\n            if(distractors.length>2) {\n                keyboard.letters = keyboard.letters.concat(distractors.slice(0, 3));\n            }\n\n            keyboard.letters.sort();\n            var letters=[];\n            $.each(keyboard.letters,function(i,letter){\n                var item ={};\n                item.charcode = letter.charCodeAt(0);\n                if(letter==' '){\n                    item.letter='&nbsp;';\n                }else{\n                    item.letter=letter;\n                }\n                letters.push(item);\n            });\n            var tdata=[];\n            tdata['letters'] = letters;\n            tdata['dataid'] = id;\n            templates.render('mod_wordcards/keyboard',tdata).then(\n                function(html,js){\n                    $(\"#\"+target).html(html);\n                }\n            );\n\n\n            var click_and_touchstart = function(e){\n                var text=$(\"#chunk-typed-inner\").text();\n                if(text.length<string.length){\n                    //createjs.Sound.play('click');\n                    keyboard.press(this,func);\n                }\n                else{\n                    keyboard.flash(\"#chunk-typed-inner\",\"a4e-incorrect\");\n                    //createjs.Sound.play('cancel');\n                }\n                e.preventDefault();\n            };\n            \n            if(keyboard.mobile_user() && !keyboard.iphone_user()){\n              $(\"body\").off('touchstart',\".chunk-key\");\n              $(\"body\").on('touchstart',\".chunk-key\",click_and_touchstart);\n            }else{\n              $(\"body\").off('click',\".chunk-key\");\n              $(\"body\").on('click',\".chunk-key\",click_and_touchstart);            \n            }\n\n\n            $(\"body\").on(\"touchmove\",\"#\"+target,function(e){\n                e.preventDefault();\n            });\n            $(\"body\").on(\"click\",\"#delete-chunk-input\",function(){\n                var text=$(\"#chunk-typed-inner\").text();\n                var code=text.slice(-1).charCodeAt(0);\n                $(\"#chunk-typed-inner\").text(text.substring(0,text.length-1));\n                //$(\".chunk-key[data-val='\"+code+\"'].a4e-key-disabled:last\").removeClass('a4e-key-disabled');\n            });\n            $(\"body\").on(\"click\",\"#submit-chunk-input\",function(){\n                var text=$(\"#chunk-typed-inner\").text();\n                func(text);\n            });\n            $(\"body\").on(\"keydown\",function(e){\n                var key=e.which;\n                if([0,8,46].indexOf(key)!=-1){\n                    $(\"#delete-chunk-input\").trigger(\"click\");\n                    e.preventDefault();\n                }\n                else if(e.which==13){\n                    $(\"#submit-chunk-input\").trigger(\"click\");\n                    e.preventDefault();\n                }\n            });\n            $(\"body\").on('keypress',function(e){\n\n                var text=$(\"#chunk-typed-inner\").text();\n                var key=e.which;\n                //var button=$(\".chunk-key[data-val='\"+key+\"']:not(.a4e-key-disabled)\").first();\n                var button=$(\".chunk-key[data-val='\"+key+\"']\");\n                if(button.length && text.length<string.length){\n                    keyboard.press(button,func);\n                }\n                else{\n                    keyboard.flash(\"#chunk-typed-inner\",\"a4e-incorrect\");\n                    //createjs.Sound.play('cancel');\n                }\n                e.preventDefault();\n\n            });\n        },\n        press:function(target,func){\n            var value=String.fromCharCode($(target).data(\"val\"));\n            keyboard.flash(target,\"a4e-key-pressed\");\n            var text={old:$(\"#chunk-typed-inner\").text()};\n            text.new=text.old+value;\n            if(text.new.length<=keyboard.string.length){\n                $(\"#chunk-typed-inner\").text(text.new);\n                //$(target).addClass('a4e-key-disabled');\n            }\n            else{\n                keyboard.flash(\"#chunk-typed-inner\",\"a4e-incorrect\");\n                //createjs.Sound.play('cancel');\n            }\n        }\n    };\n\n    return keyboard;\n\n});\n"],"names":["define","$","templates","keyboard","string","letters","qwerty","mobile_user","test","navigator","userAgent","iphone_user","shuffle","a","j","x","i","length","Math","floor","random","flash","target","classname","addClass","setTimeout","removeClass","off","clear","remove","disable","text","create","id","langdistractors","func","Array","isArray","distractors","each","split","l","indexOf","push","splice","concat","slice","sort","letter","item","charcode","charCodeAt","tdata","render","then","html","js","click_and_touchstart","e","press","this","preventDefault","on","substring","key","which","trigger","button","value","String","fromCharCode","data","old","new"],"mappings":"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"}