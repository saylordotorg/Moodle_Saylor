define(["jquery","core/log","mod_minilesson/definitions"],(function($,log,def){return log.debug("Polly helper: initialising"),{token:"",region:"",owner:"",init:function(token,region,owner){this.token=token,this.region=region,this.owner=owner},clean_ssml_chars:function(speaktext){return speaktext=(speaktext=(speaktext=(speaktext=(speaktext=speaktext.replace(/&/g,"&amp;")).replace(/'/g,"&apos;")).replace(/"/g,"&quot;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")},can_speak_neural:function(voice,region){switch(region){case"useast1":case"tokyo":case"sydney":case"dublin":case"ottawa":case"frankfurt":case"london":case"singapore":case"capetown":break;default:return!1}return-1!==def.neural_voices.indexOf(voice)},fetch_polly_url:function(speaktext,voiceoption,voice){var that=this;return new Promise((function(resolve,reject){var xhr=new XMLHttpRequest;xhr.onreadystatechange=function(e){if(4===this.readyState)if(200==xhr.status){var payload=xhr.responseText,payloadobject=JSON.parse(payload);if(payloadobject){if(payloadobject.returnCode>0)return reject(payloadobject.returnMessage),log.debug(payloadobject.returnMessage),!1;if(0===payloadobject.returnCode){var pollyurl=payloadobject.returnMessage;resolve(pollyurl)}else reject("Polly Signed URL Request failed:"),log.debug("Polly Signed URL Request failed:"),log.debug(payloadobject)}else reject("Polly Signed URL Request something bad happened"),log.debug("Polly Signed URL Request something bad happened")}else reject("Polly Signed URL Request Not 200 response:"+xhr.status),log.debug("Polly Signed URL Request Not 200 response:"+xhr.status)};switch(parseInt(voiceoption)){case 1:speaktext='<speak><break time="1000ms"></break><prosody rate="slow">'+(speaktext=that.clean_ssml_chars(speaktext))+"</prosody></speak>";break;case 2:speaktext='<speak><break time="1000ms"></break><prosody rate="x-slow">'+(speaktext=that.clean_ssml_chars(speaktext))+"</prosody></speak>";break;case 3:speaktext="<speak>"+speaktext+"</speak>";break;default:speaktext='<speak><break time="1000ms"></break>'+(speaktext=that.clean_ssml_chars(speaktext))+"</speak>"}var engine=that.can_speak_neural(voice,that.region)?"neural":"standard",xhrparams="wstoken="+that.token+"&wsfunction=local_cpapi_fetch_polly_url&moodlewsrestformat=json&text="+encodeURIComponent(speaktext)+"&texttype=ssml&voice="+voice+"&appid="+def.component+"&owner="+that.owner+"&region="+that.region+"&engine="+engine,serverurl=def.cloudpoodllurl+"/webservice/rest/server.php";xhr.open("POST",serverurl,!0),xhr.setRequestHeader("Cache-Control","no-cache"),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.send(xhrparams)}))}}}));

//# sourceMappingURL=pollyhelper.min.js.map