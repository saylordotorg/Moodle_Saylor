define(["jquery","core/log","mod_minilesson/definitions"],function(a,b,c){"use strict";b.debug("Polly helper: initialising");return{token:"",region:"",owner:"",init:function init(a,b,c){this.token=a;this.region=b;this.owner=c},clean_ssml_chars:function clean_ssml_chars(a){a=a.replace(/&/g,"&amp;");a=a.replace(/'/g,"&apos;");a=a.replace(/"/g,"&quot;");a=a.replace(/</g,"&lt;");a=a.replace(/>/g,"&gt;");return a},can_speak_neural:function can_speak_neural(a,b){switch(b){case"useast1":case"tokyo":case"sydney":case"dublin":case"ottawa":case"frankfurt":case"london":case"singapore":case"capetown":break;default:return!1;}if(-1!==c.neural_voices.indexOf(a)){return!0}else{return!1}},fetch_polly_url:function fetch_polly_url(a,d,e){var f=this;return new Promise(function(g,h){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4===this.readyState){if(200==i.status){var a=i.responseText,c=JSON.parse(a);if(c){if(0<c.returnCode){h(c.returnMessage);b.debug(c.returnMessage);return!1}else if(0===c.returnCode){var d=c.returnMessage;g(d)}else{h("Polly Signed URL Request failed:");b.debug("Polly Signed URL Request failed:");b.debug(c)}}else{h("Polly Signed URL Request something bad happened");b.debug("Polly Signed URL Request something bad happened")}}else{h("Polly Signed URL Request Not 200 response:"+i.status);b.debug("Polly Signed URL Request Not 200 response:"+i.status)}}};switch(parseInt(d)){case 1:a=f.clean_ssml_chars(a);a="<speak><break time=\"1000ms\"></break><prosody rate=\"slow\">"+a+"</prosody></speak>";break;case 2:a=f.clean_ssml_chars(a);a="<speak><break time=\"1000ms\"></break><prosody rate=\"x-slow\">"+a+"</prosody></speak>";break;case 3:a="<speak>"+a+"</speak>";break;case 0:default:a=f.clean_ssml_chars(a);a="<speak><break time=\"1000ms\"></break>"+a+"</speak>";break;}var j=f.can_speak_neural(e,f.region)?"neural":"standard",k="wstoken="+f.token+"&wsfunction="+"local_cpapi_fetch_polly_url"+"&moodlewsrestformat=json&text="+encodeURIComponent(a)+"&texttype="+"ssml"+"&voice="+e+"&appid="+c.component+"&owner="+f.owner+"&region="+f.region+"&engine="+j,l=c.cloudpoodllurl+"/webservice/rest/server.php";i.open("POST",l,!0);i.setRequestHeader("Cache-Control","no-cache");i.setRequestHeader("Content-Type","application/x-www-form-urlencoded");i.send(k)})}}});
//# sourceMappingURL=pollyhelper.min.js.map
