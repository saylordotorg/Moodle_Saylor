define(["jquery","core/log","mod_minilesson/definitions","mod_minilesson/pollyhelper","mod_minilesson/animatecss"],(function($,log,def,polly,anim){return log.debug("MiniLesson Multichoice: initialising"),{clone:function(){return $.extend(!0,{},this)},init:function(index,itemdata,quizhelper){itemdata.hasOwnProperty("audiocontent")&&this.prepare_audio(itemdata),this.itemdata=itemdata,this.register_events(index,itemdata,quizhelper);var animopts={};animopts.useanimatecss=quizhelper.useanimatecss,anim.init(animopts)},next_question:function(percent){var stepdata={};stepdata.index=this.index,stepdata.hasgrade=!0,stepdata.totalitems=1,stepdata.correctitems=percent>0?1:0,stepdata.grade=percent,this.quizhelper.do_next(stepdata)},register_events:function(index,itemdata,quizhelper){var self=this;self.index=index,self.quizhelper=quizhelper;var chosenelement=null,theplayer=$("#"+itemdata.uniqueid+"_player"),nextbutton=$("#"+itemdata.uniqueid+"_container .minilesson_nextbutton");nextbutton.on("click",(function(e){self.next_question(0)})),1!==itemdata.confirmchoice&&"1"!==itemdata.confirmchoice||nextbutton.hide();var finalChoice=function(){if(!$("#"+itemdata.uniqueid+"_container .minilesson_mc_response").hasClass("minilesson_mc_disabled")){var checked=$(chosenelement).data("index");if($("#"+itemdata.uniqueid+"_container .minilesson_mc_response").addClass("minilesson_mc_disabled"),$("#"+itemdata.uniqueid+"_container .minilesson_mc_unanswered").hide(),$("#"+itemdata.uniqueid+"_container .minilesson_mc_wrong").show(),$("#"+itemdata.uniqueid+"_option"+itemdata.correctanswer+" .minilesson_mc_wrong").hide(),$("#"+itemdata.uniqueid+"_option"+itemdata.correctanswer+" .minilesson_mc_right").show(),itemdata.hasOwnProperty("audiocontent"))for(var i=0;i<itemdata.sentences.length;i++){$("#"+itemdata.uniqueid+"_option"+(i+1));$("#"+itemdata.uniqueid+"_option"+(i+1)+" .minilesson_sentence").text(itemdata.sentences[i].sentence)}$("#"+itemdata.uniqueid+"_option"+checked).addClass("minilesson_mc_selected");var percent=checked==itemdata.correctanswer?100:0;$(".minilesson_nextbutton").prop("disabled",!0),setTimeout((function(){$(".minilesson_nextbutton").prop("disabled",!1),self.next_question(percent)}),2e3)}};$("#"+itemdata.uniqueid+"_container .minilesson_mc_response").on("click",(function(e){if(chosenelement=this,0===itemdata.confirmchoice||"0"===itemdata.confirmchoice)finalChoice();else{var checked=$(this).data("index");$("#"+itemdata.uniqueid+"_container .minilesson_mc_response").removeClass("minilesson_mc_selected"),$("#"+itemdata.uniqueid+"_option"+checked).addClass("minilesson_mc_selected"),self.showConfirmButton(itemdata)}})),$("#"+itemdata.uniqueid+"_container .minilesson_mc_confirmchoice").on("click",(function(e){finalChoice()})),$("#"+itemdata.uniqueid+"_container .minilesson_mc_audioplayer").on("click",(function(e){if(!$("#"+itemdata.uniqueid+"_container .minilesson_mc_audioplayer").hasClass("minilesson_mc_disabled"))if(self.playing)theplayer[0].pause(),theplayer[0].currentTime=0,$("#"+itemdata.uniqueid+"_container .minilesson_mc_playstate").removeClass("fa-spin fa-spinner").addClass("fa-play"),self.playing=!1;else{var el=this;self.playing=!0,theplayer.attr("src",$(this).attr("data-src")),theplayer[0].play(),theplayer[0].onended=function(){$(el).find(".minilesson_mc_playstate").removeClass("fa-spin fa-spinner").addClass("fa-play"),self.playing=!1},$(el).find(".minilesson_mc_playstate").removeClass("fa-play").addClass("fa-spin fa-spinner")}}))},showConfirmButton:function(itemdata){var confirmbutton=$("#"+itemdata.uniqueid+"_container .minilesson_mc_confirmchoice");anim.do_animate(confirmbutton,"zoomIn animate__faster","in")},prepare_audio:function(itemdata){$.each(itemdata.sentences,(function(index,sentence){polly.fetch_polly_url(sentence.sentence,itemdata.voiceoption,itemdata.usevoice).then((function(audiourl){$("#"+itemdata.uniqueid+"_audioplayer"+(index+1)).attr("data-src",audiourl)}))}))}}}));

//# sourceMappingURL=multichoice.min.js.map