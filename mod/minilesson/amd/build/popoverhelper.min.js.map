{"version":3,"file":"popoverhelper.min.js","sources":["../src/popoverhelper.js"],"sourcesContent":["define(['jquery','core/log','mod_minilesson/definitions','mod_minilesson/dependencyloader','theme_boost/popover'], function($,log,def) {\n    \"use strict\"; // jshint ;_;\n\n/*\nThis file is to\n */\n\n    log.debug('Popover helper: initialising');\n\n    return{\n\n        lastitem: false,\n        okbuttonclass: def.okbuttonclass,\n        ngbuttonclass: def.ngbuttonclass,\n        msvclosebuttonclass: def.msvclosebuttonclass,\n        s_buttonclass: def.s_buttonclass,\n        m_buttonclass: def.m_buttonclass,\n        v_buttonclass: def.v_buttonclass,\n        correctbuttonclass: def.correctbuttonclass,\n        errorbuttonclass: def.errorbuttonclass,\n        selfcorrectbuttonclass: def.selfcorrectbuttonclass,\n        msvgradebuttonclass: def.msvgradebutton,\n        msvcontainerclass: def.msvcontainerclass,\n        msvbuttonsbox: def.msvbuttonsbox,\n        quickgradecontainer: def.quickgradecontainerclass,\n        stateerror:  def.stateerror,\n        statecorrect:  def.statecorrect,\n        stateselfcorrect:  def.stateselfcorrect,\n        quickgradetitle: M.util.get_string('quickgrade',def.component),\n        transcripttitle: M.util.get_string('transcript',def.component),\n        msvtitle: M.util.get_string('msv',def.component),\n        oklabel: M.util.get_string('ok',def.component),\n        nglabel: M.util.get_string('ng',def.component),\n        msvcloselabel: M.util.get_string('msvcloselabel',def.component),\n        s_label: M.util.get_string('s_label',def.component),\n        m_label: M.util.get_string('m_label',def.component),\n        v_label: M.util.get_string('v_label',def.component),\n        errorlabel: M.util.get_string('error',def.component),\n        correctlabel: M.util.get_string('correct',def.component),\n        selfcorrectlabel: M.util.get_string('selfcorrect',def.component),\n        dispose: false, //Bv4 = dispose  Bv3 = destroy\n\n        init: function(){\n            this.register_events();\n        },\n\n        register_events: function() {\n            var that = this;\n\n            //on close button push\n            $(document).on('click','.' + this.okbuttonclass,this.onAccept);\n            $(document).on('click','.' + this.ngbuttonclass,this.onReject);\n            $(document).on('click','.' + this.msvclosebuttonclass,this.onMSVClose);\n\n            //on msv button push\n            $(document).on('click','.' + this.msvgradebuttonclass,\n                function(){\n                //if we are not in correct mode, then toggle the s or m or v button\n                    if($('input[name=\"msvitem\"]:checked').val()===that.statecorrect){return;}\n                    if($(this).attr('data-checked')=='0'){\n                        $(this).attr('data-checked','1');\n                    }else{\n                        $(this).attr('data-checked','0');\n                    }\n            });\n\n            //on msv dialog correct/error/selfcorrect\n           // $(document).on('click','.' + that.msvcontainerclass + ' .btn-secondary',\n            $(document).on('change','.msvtoggleform',\n                function(){\n                    //turn off s and m and v buttons\n                    if($('input[name=\"msvitem\"]:checked').val() ===that.statecorrect) {\n                        $('.' + that.s_buttonclass).attr('data-checked','0');\n                        $('.' + that.m_buttonclass).attr('data-checked','0');\n                        $('.' + that.v_buttonclass).attr('data-checked','0');\n                    }\n                }\n            );\n        },\n\n        //different bootstrap/popover versions have a different word for \"dispose\" so this method bridges that.\n        //we can not be sure what version is installed\n        disposeWord: function(){\n            if(this.dispose){return this.dispose;}\n            var version ='3';\n            if($.fn.popover.Constructor.hasOwnProperty('VERSION')){\n                version = $.fn.popover.Constructor.VERSION.charAt(0);\n            }\n            switch(version){\n                case '4':\n                    this.dispose='dispose';\n                    break;\n                case '3':\n                default:\n                    this.dispose='destroy';\n                    break;\n            }\n            return this.dispose;\n        },\n\n        remove: function(item){\n          if(item) {\n              $(item).popover(this.disposeWord());\n          }else if(this.lastitem) {\n              $(this.lastitem).popover(this.disposeWord());\n              this.lastitem=false;\n          }\n        },\n\n        addQuickGrader: function(item){\n\n            //dispose of previous popover, and remember this one\n            if(this.lastitem && this.lastitem !== item) {\n                $(this.lastitem).popover(this.disposeWord());\n                this.lastitem=false;\n            }\n            this.lastitem = item;\n            var that = this;\n\n            var thefunc = function(){\n                var wordnumber = $(this).attr(\"data-wordnumber\");\n                var okbutton = \"<button type='button' class='btn \" + that.okbuttonclass + \"' data-wordnumber='\" + wordnumber + \"'><i class='fa fa-check'></i> \" + that.oklabel + \"</button>\";\n                var ngbutton = \"<button type='button' class='btn \" + that.ngbuttonclass + \"' data-wordnumber='\" + wordnumber + \"'><i class='fa fa-close'></i> \" + that.nglabel + \"</button>\";\n                var container = \"<div class='\" + that.quickgradecontainerclass +  \"'>\" + okbutton + ngbutton + \"</div>\";\n                return container;\n            };\n\n            //lets add the popover\n            $(item).popover({\n                title: this.quickgradetitle,\n                content: thefunc,\n                trigger: 'manual',\n                placement: 'top',\n                html: true\n            });\n            $(item).popover('show');\n        },\n\n        addMSVGrader: function(item,currentmsv){\n\n            //dispose of previous popover, and remember this one\n            if(this.lastitem && this.lastitem !== item) {\n                $(this.lastitem).popover(this.disposeWord());\n                this.lastitem=false;\n            }\n            this.lastitem = item;\n            var that = this;\n\n            //close button\n\n\n            var thefunc = function(){\n                var wordnumber = $(this).attr(\"data-wordnumber\");\n\n                //toggle button\n                var toggle = '<form class=\"msvtoggleform\">';\n                toggle += '<div class=\"btn-group btn-group-toggle\" data-toggle=\"buttons\">';\n\n                //correct\n                var checked = currentmsv.state===that.statecorrect ? 'checked' : '';\n                var active = currentmsv.state===that.statecorrect ? 'active' : '';\n                toggle +=    '<label for=\"'+ that.correctbuttonclass +'\" class=\"btn btn-secondary  ' + active + '\">';\n                toggle +=    '<input id=\"'+ that.correctbuttonclass +'\" name=\"msvitem\" type=\"radio\" ' + checked + ' value=\"' + that.statecorrect + '\">';\n                toggle +=    that.correctlabel + '</label>';\n\n                //error\n                checked = currentmsv.state===that.stateerror ? 'checked' : '';\n                active = currentmsv.state===that.stateerror ? 'active' : '';\n                toggle +=    '<label for=\"'+ that.errorbuttonclass +'\" class=\"btn btn-secondary ' + active + '\">';\n                toggle +=    '<input id=\"'+ that.errorbuttonclass +'\" name=\"msvitem\" type=\"radio\" ' + checked + '  value=\"' + that.stateerror  + '\">';\n                toggle +=    that.errorlabel + '</label>';\n\n                //selfcorrect\n                checked = currentmsv.state===that.stateselfcorrect ? 'checked' : '';\n                active = currentmsv.state===that.stateselfcorrect ? 'active' : '';\n                toggle +=    '<label for=\"'+ that.selfcorrectbuttonclass +'\" class=\"btn btn-secondary ' + active + '\">';\n                toggle +=    '<input id=\"'+ that.selfcorrectbuttonclass +'\" name=\"msvitem\" type=\"radio\" ' + checked + ' value=\"' + that.stateselfcorrect + '\">';\n                toggle +=     that.selfcorrectlabel + '</label>';\n\n                toggle +=    '</div>';\n                toggle +=    '</form>';\n\n                var msvbuttons = \"<button type='button' data-checked='\" + currentmsv.msv.m +\"' class='btn \" + that.m_buttonclass + ' ' + that.msvgradebuttonclass + \"'>\" + that.m_label + \"</button>\";\n                msvbuttons += \"<button type='button' data-checked='\" + currentmsv.msv.s +\"' class='btn \" + that.s_buttonclass + ' ' + that.msvgradebuttonclass + \"'>\" + that.s_label + \"</button>\";\n                msvbuttons+= \"<button type='button' data-checked='\" + currentmsv.msv.v +\"' class='btn \" + that.v_buttonclass + ' ' + that.msvgradebuttonclass + \"'>\" + that.v_label + \"</button>\";\n                var msvbuttonsdiv = \"<div class='\" + that.msvbuttonsbox + \"'>\" + msvbuttons +\"</div>\";\n\n                var closebutton = \"<button type='button' class='btn \" + that.msvclosebuttonclass + \"' data-wordnumber='\" + wordnumber + \"'>\" + that.msvcloselabel + \"</button>\";\n                var container = \"<div class='\" + that.msvcontainerclass +  \"'>\" + toggle + msvbuttonsdiv + closebutton + \"</div>\";\n                return container;\n            };\n\n            //lets add the popover\n            $(item).popover({\n                title: this.msvtitle,\n                content: thefunc,\n                trigger: 'manual',\n                placement: 'top',\n                html: true\n            });\n            $(item).popover('show');\n        },\n\n        fetchMSVResults: function(){\n            var ret={};\n            ret.msv={};\n            ret.msv.m=$('.' + this.m_buttonclass).attr('data-checked');\n            ret.msv.s=$('.' + this.s_buttonclass).attr('data-checked');\n            ret.msv.v=$('.' + this.v_buttonclass).attr('data-checked');\n            ret.state=$('input[name=\"msvitem\"]:checked').val();\n            return ret;\n        },\n\n        addTranscript: function(item,transcript){\n\n            //if we are already showing this item then dispose of it, set last item to null and go home\n            if(this.lastitem == item) {\n                $(this.lastitem).popover(this.disposeWord());\n                this.lastitem = false;\n                return;\n            }\n\n            //dispose of previous popover, and remember this one\n            if(this.lastitem) {\n                $(this.lastitem).popover(this.disposeWord());\n                this.lastitem=false;\n            }\n            this.lastitem = item;\n\n            //lets add the popover\n            $(item).popover({\n                title: this.transcripttitle,\n                content: transcript,\n                trigger: 'manual',\n                placement: 'top'\n            });\n            $(item).popover('show');\n        },\n\n        //these two functions are overridden by the calling class\n        onAccept: function(){alert($(this).attr('data-wordnumber'));},\n        onReject: function(){alert($(this).attr('data-wordnumber'));},\n        onMSVClose: function(){alert($(this).attr('data-wordnumber'));}\n\n    };//end of return value\n});"],"names":["define","$","log","def","debug","lastitem","okbuttonclass","ngbuttonclass","msvclosebuttonclass","s_buttonclass","m_buttonclass","v_buttonclass","correctbuttonclass","errorbuttonclass","selfcorrectbuttonclass","msvgradebuttonclass","msvgradebutton","msvcontainerclass","msvbuttonsbox","quickgradecontainer","quickgradecontainerclass","stateerror","statecorrect","stateselfcorrect","quickgradetitle","M","util","get_string","component","transcripttitle","msvtitle","oklabel","nglabel","msvcloselabel","s_label","m_label","v_label","errorlabel","correctlabel","selfcorrectlabel","dispose","init","register_events","that","this","document","on","onAccept","onReject","onMSVClose","val","attr","disposeWord","version","fn","popover","Constructor","hasOwnProperty","VERSION","charAt","remove","item","addQuickGrader","title","content","wordnumber","okbutton","ngbutton","trigger","placement","html","addMSVGrader","currentmsv","toggle","checked","state","active","msvbuttons","msv","m","s","v","msvbuttonsdiv","closebutton","fetchMSVResults","ret","addTranscript","transcript","alert"],"mappings":"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"}