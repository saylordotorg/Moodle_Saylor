function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var f=a.apply(b,c);function g(a){asyncGeneratorStep(f,d,e,g,h,"next",a)}function h(a){asyncGeneratorStep(f,d,e,g,h,"throw",a)}g(void 0)})}}define ("mod_minilesson/shortanswer",["jquery","core/log","mod_minilesson/definitions","mod_minilesson/pollyhelper","mod_minilesson/cloudpoodllloader","mod_minilesson/ttrecorder"],function(a,b,c,d,e,f){"use strict";b.debug("MiniLesson ShortAnswer: initialising");return{passmark:90,clone:function clone(){return a.extend(!0,{},this)},init:function init(a,b,c){this.register_events(a,b,c);this.init_components(a,b,c)},next_question:function next_question(a){var b=this,c={};c.index=b.index;c.hasgrade=!0;c.totalitems=1;c.correctitems=0<a?1:0;c.grade=a;b.quizhelper.do_next(c)},prepare_audio:function prepare_audio(b){a.each(b.sentences,function(c,e){d.fetch_polly_url(e.sentence,b.voiceoption,b.usevoice).then(function(d){a("#"+b.uniqueid+"_option"+(c+1)).attr("data-src",d)})})},register_events:function register_events(b,c,d){var e=this;e.index=b;e.quizhelper=d;a("#"+c.uniqueid+"_container .minilesson_nextbutton").on("click",function(){e.next_question(0)});a("#"+c.uniqueid+"_container ."+c.uniqueid+"_option").on("click",function(){a("."+c.uniqueid+"_option").prop("disabled",!0);a("."+c.uniqueid+"_fb").html("<i style='color:red;' class='fa fa-times'></i>");a("."+c.uniqueid+"_option"+c.correctanswer+"_fb").html("<i style='color:green;' class='fa fa-check'></i>");var b=a("input[name="+c.uniqueid+"_options]:checked").data("index"),d=b==c.correctanswer?100:0;a(".minilesson_nextbutton").prop("disabled",!0);setTimeout(function(){a(".minilesson_nextbutton").prop("disabled",!1);e.next_question(d)},2e3)})},init_components:function init_components(c,d,e){for(var g=this,h=d.sentences,j=0;j<h.length;j++){h[j].originalsentence=h[j].sentence;h[j].sentence=e.cleanText(h[j].sentence)}var k=function(){var c=_asyncToGenerator(regeneratorRuntime.mark(function c(f){var j,k,l,m,n,o,p,q,r,s,t,u;return regeneratorRuntime.wrap(function(c){while(1){switch(c.prev=c.next){case 0:c.t0=f.type;c.next="recording"===c.t0?3:"speech"===c.t0?4:71;break;case 3:return c.abrupt("break",71);case 4:b.debug("speech at shortanswer");j=f.capturedspeech;k=e.cleanText(j);l=k;b.debug("speechtext:",j);b.debug("cleanspeechtext:",l);m=!1;n=0;o=0;case 13:if(!(o<h.length)){c.next=25;break}if(!(""===h[o].sentence)){c.next=16;break}return c.abrupt("continue",22);case 16:p=e.similarity(l,h[o].sentence);b.debug("JS similarity: "+l+":"+h[o].sentence+":"+p);if(!(p>=g.passmark||g.spokenIsCorrect(e,k,h[o].sentence))){c.next=22;break}n=g.process_accepted_response(d,o);m=!0;return c.abrupt("break",25);case 22:o++;c.next=13;break;case 25:if(m){c.next=41;break}o=0;case 27:if(!(o<h.length)){c.next=41;break}c.next=30;return e.checkByPhonetic(h[o].sentence,l,h[o].phonetic,d.language);case 30:q=c.sent;if(!(!q||q<g.passmark)){c.next=34;break}c.next=38;break;case 34:m=!0;b.debug("PHP similarity: "+l+q);n=g.process_accepted_response(d,o);return c.abrupt("break",41);case 38:o++;c.next=27;break;case 41:if(m){c.next=64;break}o=0;case 43:if(!(o<h.length)){c.next=64;break}c.next=46;return e.comparePassageToTranscript(h[o].sentence,l,h[o].phonetic,d.language);case 46:r=c.sent;s=JSON.parse(r);t=!1;u=0;case 50:if(!(u<s.length)){c.next=57;break}if(!(!1===s[u].matched)){c.next=54;break}t=!0;return c.abrupt("break",57);case 54:u++;c.next=50;break;case 57:if(t){c.next=61;break}n=g.process_accepted_response(d,o);m=!0;return c.abrupt("break",64);case 61:o++;c.next=43;break;case 64:if(!(m&&!1)){c.next=70;break}a(".minilesson_nextbutton").prop("disabled",!0);setTimeout(function(){a(".minilesson_nextbutton").prop("disabled",!1);g.next_question(n)},2e3);return c.abrupt("return");case 70:a("#"+d.uniqueid+"_correctanswer").effect("shake");case 71:case"end":return c.stop();}}},c)}));return function(){return c.apply(this,arguments)}}(),l={};l.uniqueid=d.uniqueid;b.debug("sa uniqueid:"+d.uniqueid);l.callback=k;l.ds_only=e.is_ds_only();f.clone().init(l)},spokenIsCorrect:function spokenIsCorrect(a,b,c){b=a.cleanText(b);c=a.cleanText(c);if(b===c){return!0}return!1},process_accepted_response:function process_accepted_response(b,c){var d=0<=c?100:0;if(0<d){if(0===parseInt(b.show_text)){for(var e=0;e<b.sentences.length;e++){a("#"+b.uniqueid+"_option"+(e+1));a("#"+b.uniqueid+"_option"+(e+1)+" .minilesson_sentence").text(b.sentences[e].sentence)}}var f=a("#"+b.uniqueid+"_correctanswer");f.text(b.sentences[c].originalsentence);f.addClass("minilesson_success")}return d}}});
//# sourceMappingURL=shortanswer.min.js.map
