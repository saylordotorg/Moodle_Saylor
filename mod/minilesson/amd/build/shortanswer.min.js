function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var f=a.apply(b,c);function g(a){asyncGeneratorStep(f,d,e,g,h,"next",a)}function h(a){asyncGeneratorStep(f,d,e,g,h,"throw",a)}g(void 0)})}}define ("mod_minilesson/shortanswer",["jquery","core/log","mod_minilesson/definitions","mod_minilesson/pollyhelper","mod_minilesson/cloudpoodllloader","mod_minilesson/ttrecorder"],function(a,b,c,d,e,f){"use strict";b.debug("MiniLesson ShortAnswer: initialising");return{passmark:90,clone:function clone(){return a.extend(!0,{},this)},init:function init(a,b,c){this.register_events(a,b,c);this.init_components(a,b,c)},next_question:function next_question(a){var b=this,c={};c.index=b.index;c.hasgrade=!0;c.totalitems=1;c.correctitems=0<a?1:0;c.grade=a;b.quizhelper.do_next(c)},prepare_audio:function prepare_audio(b){a.each(b.sentences,function(c,e){d.fetch_polly_url(e.sentence,b.voiceoption,b.usevoice).then(function(d){a("#"+b.uniqueid+"_option"+(c+1)).attr("data-src",d)})})},register_events:function register_events(b,c,d){var e=this;e.index=b;e.quizhelper=d;a("#"+c.uniqueid+"_container .minilesson_nextbutton").on("click",function(){e.next_question(0)});a("#"+c.uniqueid+"_container ."+c.uniqueid+"_option").on("click",function(){a("."+c.uniqueid+"_option").prop("disabled",!0);a("."+c.uniqueid+"_fb").html("<i style='color:red;' class='fa fa-times'></i>");a("."+c.uniqueid+"_option"+c.correctanswer+"_fb").html("<i style='color:green;' class='fa fa-check'></i>");var b=a("input[name="+c.uniqueid+"_options]:checked").data("index"),d=b==c.correctanswer?100:0;a(".minilesson_nextbutton").prop("disabled",!0);setTimeout(function(){a(".minilesson_nextbutton").prop("disabled",!1);e.next_question(d)},2e3)})},init_components:function init_components(c,d,e){for(var g=this,h=d.sentences,j=0;j<h.length;j++){h[j].sentence=e.cleanText(h[j].sentence)}var k=function(){var c=_asyncToGenerator(regeneratorRuntime.mark(function c(f){var i,j,k,l,m,n,o;return regeneratorRuntime.wrap(function(c){while(1){switch(c.prev=c.next){case 0:c.t0=f.type;c.next="recording"===c.t0?3:"speech"===c.t0?4:33;break;case 3:return c.abrupt("break",33);case 4:b.debug("speech at shortanswer");i=f.capturedspeech;j=e.cleanText(i);k=j;b.debug("speechtext:",i);b.debug("cleanspeechtext:",k);l=0;case 11:if(!(l<h.length)){c.next=24;break}if(!(""===h[l].sentence)){c.next=14;break}return c.abrupt("continue",21);case 14:m=e.similarity(k,h[l].sentence);b.debug("JS similarity: "+k+":"+h[l].sentence+":"+m);if(!(m>=g.passmark||g.spokenIsCorrect(e,j,h[l].sentence))){c.next=21;break}n=g.process_accepted_response(d,l);a(".minilesson_nextbutton").prop("disabled",!0);setTimeout(function(){a(".minilesson_nextbutton").prop("disabled",!1);g.next_question(n)},2e3);return c.abrupt("return");case 21:l++;c.next=11;break;case 24:l=0;case 25:if(!(l<h.length)){c.next=33;break}c.next=28;return e.checkByPhonetic(h[l].sentence,k,h[l].phonetic,d.language);case 28:o=c.sent;if(!(!o||o<g.passmark)){b.debug("PHP similarity: "+k+o);n=g.process_accepted_response(d,l);a(".minilesson_nextbutton").prop("disabled",!0);setTimeout(function(){a(".minilesson_nextbutton").prop("disabled",!1);g.next_question(n)},2e3)}case 30:l++;c.next=25;break;case 33:case"end":return c.stop();}}},c)}));return function(){return c.apply(this,arguments)}}(),l={};l.uniqueid=d.uniqueid;b.debug("sa uniqueid:"+d.uniqueid);l.callback=k;l.ds_only=e.is_ds_only();f.clone().init(l)},spokenIsCorrect:function spokenIsCorrect(a,b,c){b=a.cleanText(b);c=a.cleanText(c);if(b===c){return!0}return!1},process_accepted_response:function process_accepted_response(b,c){var d=0<=c?100:0;if(0<d){if(0===parseInt(b.show_text)){for(var e=0;e<b.sentences.length;e++){a("#"+b.uniqueid+"_option"+(e+1));a("#"+b.uniqueid+"_option"+(e+1)+" .minilesson_sentence").text(b.sentences[e].sentence)}}var f=a("#"+b.uniqueid+"_correctanswer");f.text(b.sentences[c].sentence);f.show()}return d}}});
//# sourceMappingURL=shortanswer.min.js.map
