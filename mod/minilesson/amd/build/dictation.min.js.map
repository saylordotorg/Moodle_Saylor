{"version":3,"file":"dictation.min.js","sources":["../src/dictation.js"],"sourcesContent":["define(['jquery', 'core/log', 'mod_minilesson/definitions', 'mod_minilesson/pollyhelper'], function($, log, def, polly) {\n  \"use strict\"; // jshint ;_;\n\n  /*\n  This file is to manage the quiz stage\n   */\n\n  log.debug('MiniLesson dictation: initialising');\n\n  return {\n\n    playing: false,\n\n      //for making multiple instances\n      clone: function () {\n          return $.extend(true, {}, this);\n      },\n\n\n      init: function(index, itemdata, quizhelper, polly) {\n\n      this.prepare_audio(itemdata, polly);\n      this.register_events(index, itemdata, quizhelper);\n\n    },\n\n    prepare_html: function(itemdata) {\n      //do something\n    },\n\n    prepare_audio: function(itemdata) {\n      $.each(itemdata.sentences, function(index, sentence) {\n        polly.fetch_polly_url(sentence.prompt, itemdata.voiceoption, itemdata.usevoice).then(function(audiourl) {\n          $(\"#\" + itemdata.uniqueid + \"_container .dictationplayer_\" + index + \" .dictationtrigger\").attr(\"data-src\", audiourl);\n        });\n      });\n    },\n\n    register_events: function(qindex, itemdata, quizhelper) {\n\n      var self = this;\n\n      var theplayer = $(\"#\" + itemdata.uniqueid + \"_player\");\n\n      //key events in text box\n      $(\"#\" + itemdata.uniqueid + \"_container .poodlldictationinput input\").on(\"input\", function(e) {\n\n        var index = $(this).data(\"index\");\n        var correct = itemdata.sentences[index].sentence.trim().toLowerCase();\n        var typed = $(this).val().trim().toLowerCase();\n\n        //update char count\n        $(\"#\"+itemdata.uniqueid+\"_container .dictationplayer_\"+index+\"_chars\").html(typed.length);\n        //trim punctuation before comparing, if ignore punctuation is set\n        if(itemdata.ignorepunctuation){\n            correct = quizhelper.cleanText(correct);\n            typed = quizhelper.cleanText(typed);\n        }\n\n        if (correct == typed) {\n          $(\"#\"+itemdata.uniqueid+\"_container .dictate-feedback[data-index='\" + index + \"']\").removeClass(\"fa-times\").addClass(\"fa-check\").css(\"color\",\"green\").show();\n        } else {\n          $(\"#\"+itemdata.uniqueid+\"_container .dictate-feedback[data-index='\" + index + \"']\").removeClass(\"fa-check\").addClass(\"fa-times\").css(\"color\",\"red\").show();\n        }\n\n      });\n\n      //audio play requests\n      $(\"#\" + itemdata.uniqueid + \"_container .dictationtrigger\").on('click', function(e) {\n        if (!self.playing) {\n          var el = this;\n          self.playing = true;\n          theplayer.attr('src', $(this).attr('data-src'));\n          theplayer[0].play();\n          theplayer[0].onended = function() {\n            $(el).find(\".fa\").removeClass(\"fa-spin fa-spinner\").addClass(\"fa-play\");\n            self.playing = false;\n          }\n          $(el).find(\".fa\").removeClass(\"fa-play\").addClass(\"fa-spin fa-spinner\");\n        }\n      });\n\n      //When click next button , report and leave it up to parent to eal with it.\n      $(\"#\" + itemdata.uniqueid + \"_container .minilesson_nextbutton\").on('click', function(e) {\n        var stepdata = {};\n        var correct = $('#' + itemdata.uniqueid + '_container .dictate-feedback.fa-check').length;\n        var total = $('#' + itemdata.uniqueid + '_container .dictate-feedback').length;\n        var grade = Math.round(correct / total, 2) * 100;\n        stepdata.index = qindex;\n        stepdata.hasgrade = true;\n        stepdata.grade = grade;\n        stepdata.totalitems=total;\n        stepdata.correctitems=correct;\n        stepdata.grade = grade;\n        quizhelper.do_next(stepdata);\n      });\n    }\n  }; //end of return value\n});"],"names":["define","$","log","def","polly","debug","playing","clone","extend","this","init","index","itemdata","quizhelper","prepare_audio","register_events","prepare_html","each","sentences","sentence","fetch_polly_url","prompt","voiceoption","usevoice","then","audiourl","uniqueid","attr","qindex","self","theplayer","on","e","data","correct","trim","toLowerCase","typed","val","html","length","ignorepunctuation","cleanText","removeClass","addClass","css","show","el","play","onended","find","stepdata","total","grade","Math","round","hasgrade","totalitems","correctitems","do_next"],"mappings":"AAAAA,kCAAO,CAAC,SAAU,WAAY,6BAA8B,+BAA+B,SAASC,EAAGC,IAAKC,IAAKC,cAO/GF,IAAIG,MAAM,sCAEH,CAELC,SAAS,EAGPC,MAAO,kBACIN,EAAEO,QAAO,EAAM,GAAIC,OAI9BC,KAAM,SAASC,MAAOC,SAAUC,WAAYT,YAEvCU,cAAcF,SAAUR,YACxBW,gBAAgBJ,MAAOC,SAAUC,aAIxCG,aAAc,SAASJ,YAIvBE,cAAe,SAASF,UACtBX,EAAEgB,KAAKL,SAASM,WAAW,SAASP,MAAOQ,UACzCf,MAAMgB,gBAAgBD,SAASE,OAAQT,SAASU,YAAaV,SAASW,UAAUC,MAAK,SAASC,UAC5FxB,EAAE,IAAMW,SAASc,SAAW,+BAAiCf,MAAQ,sBAAsBgB,KAAK,WAAYF,iBAKlHV,gBAAiB,SAASa,OAAQhB,SAAUC,gBAEtCgB,KAAOpB,KAEPqB,UAAY7B,EAAE,IAAMW,SAASc,SAAW,WAG5CzB,EAAE,IAAMW,SAASc,SAAW,0CAA0CK,GAAG,SAAS,SAASC,OAErFrB,MAAQV,EAAEQ,MAAMwB,KAAK,SACrBC,QAAUtB,SAASM,UAAUP,OAAOQ,SAASgB,OAAOC,cACpDC,MAAQpC,EAAEQ,MAAM6B,MAAMH,OAAOC,cAGjCnC,EAAE,IAAIW,SAASc,SAAS,+BAA+Bf,MAAM,UAAU4B,KAAKF,MAAMG,QAE/E5B,SAAS6B,oBACRP,QAAUrB,WAAW6B,UAAUR,SAC/BG,MAAQxB,WAAW6B,UAAUL,QAG7BH,SAAWG,MACbpC,EAAE,IAAIW,SAASc,SAAS,4CAA8Cf,MAAQ,MAAMgC,YAAY,YAAYC,SAAS,YAAYC,IAAI,QAAQ,SAASC,OAEtJ7C,EAAE,IAAIW,SAASc,SAAS,4CAA8Cf,MAAQ,MAAMgC,YAAY,YAAYC,SAAS,YAAYC,IAAI,QAAQ,OAAOC,UAMxJ7C,EAAE,IAAMW,SAASc,SAAW,gCAAgCK,GAAG,SAAS,SAASC,OAC1EH,KAAKvB,QAAS,KACbyC,GAAKtC,KACToB,KAAKvB,SAAU,EACfwB,UAAUH,KAAK,MAAO1B,EAAEQ,MAAMkB,KAAK,aACnCG,UAAU,GAAGkB,OACblB,UAAU,GAAGmB,QAAU,WACrBhD,EAAE8C,IAAIG,KAAK,OAAOP,YAAY,sBAAsBC,SAAS,WAC7Df,KAAKvB,SAAU,GAEjBL,EAAE8C,IAAIG,KAAK,OAAOP,YAAY,WAAWC,SAAS,0BAKtD3C,EAAE,IAAMW,SAASc,SAAW,qCAAqCK,GAAG,SAAS,SAASC,OAChFmB,SAAW,GACXjB,QAAUjC,EAAE,IAAMW,SAASc,SAAW,yCAAyCc,OAC/EY,MAAQnD,EAAE,IAAMW,SAASc,SAAW,gCAAgCc,OACpEa,MAAyC,IAAjCC,KAAKC,MAAMrB,QAAUkB,MAAO,GACxCD,SAASxC,MAAQiB,OACjBuB,SAASK,UAAW,EACpBL,SAASE,MAAQA,MACjBF,SAASM,WAAWL,MACpBD,SAASO,aAAaxB,QACtBiB,SAASE,MAAQA,MACjBxC,WAAW8C,QAAQR"}