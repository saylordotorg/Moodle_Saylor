{"version":3,"sources":["../src/multichoice.js"],"names":["define","$","log","def","polly","debug","clone","extend","init","index","itemdata","quizhelper","hasOwnProperty","prepare_audio","register_events","next_question","percent","self","stepdata","hasgrade","totalitems","correctitems","grade","do_next","theplayer","uniqueid","on","hasClass","checked","data","addClass","hide","show","correctanswer","i","sentences","length","text","sentence","prop","setTimeout","playing","el","attr","play","onended","find","removeClass","pause","currentTime","each","fetch_polly_url","voiceoption","usevoice","then","audiourl"],"mappings":"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","sourcesContent":["define(['jquery', 'core/log', 'mod_minilesson/definitions', 'mod_minilesson/pollyhelper'], function($, log, def, polly) {\n  \"use strict\"; // jshint ;_;\n\n  /*\n  This file is to manage the quiz stage\n   */\n\n  log.debug('MiniLesson Multichoice: initialising');\n\n  return {\n\n    //for making multiple instances\n      clone: function () {\n          return $.extend(true, {}, this);\n     },\n\n    init: function(index, itemdata, quizhelper) {\n      if(itemdata.hasOwnProperty('audiocontent')) {\n          this.prepare_audio(itemdata);\n      }\n      this.itemdata = itemdata;\n      this.register_events(index, itemdata, quizhelper);\n    },\n    next_question: function(percent) {\n      var self = this;\n      var stepdata = {};\n      stepdata.index = self.index;\n      stepdata.hasgrade = true;\n      stepdata.totalitems = 1;\n      stepdata.correctitems = percent>0?1:0;\n      stepdata.grade = percent;\n      self.quizhelper.do_next(stepdata);\n    },\n\n    register_events: function(index, itemdata, quizhelper) {\n      \n      var self = this;\n      self.index = index;\n      self.quizhelper = quizhelper;\n      var theplayer = $(\"#\" + itemdata.uniqueid + \"_player\");\n      \n      $(\"#\" + itemdata.uniqueid + \"_container .minilesson_nextbutton\").on('click', function(e) {\n        self.next_question(0);\n      });\n      \n      $(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_response\").on('click', function(e) {\n        //if disabled =>just return (already answered)\n          if($(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_response\").hasClass('minilesson_mc_disabled')){\n            return;\n          }\n\n          //get selected item index\n          var checked = $(this).data('index');\n\n          //disable the answers, cos its answered\n          $(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_response\").addClass('minilesson_mc_disabled');\n\n        //reveal answers\n        $(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_unanswered\").hide();\n        $(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_wrong\").show();\n\n        $(\"#\" + itemdata.uniqueid + \"_option\" + itemdata.correctanswer + \" .minilesson_mc_wrong\").hide();\n        $(\"#\" + itemdata.uniqueid + \"_option\" + itemdata.correctanswer + \" .minilesson_mc_right\").show();\n\n\n        //if answers were dots for audio content, show them\n          if(itemdata.hasOwnProperty('audiocontent')) {\n              for (var i = 0; i < itemdata.sentences.length; i++) {\n                  var theline = $(\"#\" + itemdata.uniqueid + \"_option\" + (i + 1));\n                  $(\"#\" + itemdata.uniqueid + \"_option\" + (i + 1) + ' .minilesson_sentence').text(itemdata.sentences[i].sentence);\n              }\n          }\n\n        \n        //highlight selected answers\n        $(\"#\" + itemdata.uniqueid + \"_option\" + checked).addClass('minilesson_mc_selected');\n\n\n        var percent = checked == itemdata.correctanswer ? 100 : 0;\n        \n        $(\".minilesson_nextbutton\").prop(\"disabled\", true);\n        setTimeout(function() {\n          $(\".minilesson_nextbutton\").prop(\"disabled\", false);\n          self.next_question(percent);\n        }, 2000);\n        \n      });\n\n      //play audio if we are doing this as an audio player thingy\n        //this will use the multichoice audio content template\n        $(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_audioplayer\").on('click', function(e) {\n            //if disabled =>just return (already answered)\n            if($(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_audioplayer\").hasClass('minilesson_mc_disabled')){\n                return;\n            }\n\n            //audio play requests\n            if (!self.playing) {\n                var el = this;\n                self.playing = true;\n                theplayer.attr('src', $(this).attr('data-src'));\n                theplayer[0].play();\n                theplayer[0].onended = function() {\n                    $(el).find(\".minilesson_mc_playstate\").removeClass(\"fa-spin fa-spinner\").addClass(\"fa-play\");\n                    self.playing = false;\n                };\n                $(el).find(\".minilesson_mc_playstate\").removeClass(\"fa-play\").addClass(\"fa-spin fa-spinner\");\n            }else{\n                theplayer[0].pause();\n                theplayer[0].currentTime=0;\n                $(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_playstate\").removeClass(\"fa-spin fa-spinner\").addClass(\"fa-play\");\n                self.playing = false;\n            }\n        });\n      \n    },\n\n\n      prepare_audio: function(itemdata) {\n          // debugger;\n          $.each(itemdata.sentences, function(index, sentence) {\n              polly.fetch_polly_url(sentence.sentence, itemdata.voiceoption, itemdata.usevoice).then(function(audiourl) {\n                  $(\"#\" + itemdata.uniqueid + \"_audioplayer\" + (index+1)).attr(\"data-src\", audiourl);\n              });\n          });\n      }\n  };\n});"],"file":"multichoice.min.js"}