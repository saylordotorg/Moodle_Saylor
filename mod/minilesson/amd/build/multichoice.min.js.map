{"version":3,"file":"multichoice.min.js","sources":["../src/multichoice.js"],"sourcesContent":["define(['jquery', 'core/log', 'mod_minilesson/definitions', 'mod_minilesson/pollyhelper'], function($, log, def, polly) {\n  \"use strict\"; // jshint ;_;\n\n  /*\n  This file is to manage the quiz stage\n   */\n\n  log.debug('MiniLesson Multichoice: initialising');\n\n  return {\n\n    //for making multiple instances\n      clone: function () {\n          return $.extend(true, {}, this);\n     },\n\n    init: function(index, itemdata, quizhelper) {\n      if(itemdata.hasOwnProperty('audiocontent')) {\n          this.prepare_audio(itemdata);\n      }\n      this.itemdata = itemdata;\n      this.register_events(index, itemdata, quizhelper);\n    },\n    next_question: function(percent) {\n      var self = this;\n      var stepdata = {};\n      stepdata.index = self.index;\n      stepdata.hasgrade = true;\n      stepdata.totalitems = 1;\n      stepdata.correctitems = percent>0?1:0;\n      stepdata.grade = percent;\n      self.quizhelper.do_next(stepdata);\n    },\n\n    register_events: function(index, itemdata, quizhelper) {\n      \n      var self = this;\n      self.index = index;\n      self.quizhelper = quizhelper;\n      var theplayer = $(\"#\" + itemdata.uniqueid + \"_player\");\n      \n      $(\"#\" + itemdata.uniqueid + \"_container .minilesson_nextbutton\").on('click', function(e) {\n        self.next_question(0);\n      });\n      \n      $(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_response\").on('click', function(e) {\n        //if disabled =>just return (already answered)\n          if($(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_response\").hasClass('minilesson_mc_disabled')){\n            return;\n          }\n\n          //get selected item index\n          var checked = $(this).data('index');\n\n          //disable the answers, cos its answered\n          $(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_response\").addClass('minilesson_mc_disabled');\n\n        //reveal answers\n        $(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_unanswered\").hide();\n        $(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_wrong\").show();\n\n        $(\"#\" + itemdata.uniqueid + \"_option\" + itemdata.correctanswer + \" .minilesson_mc_wrong\").hide();\n        $(\"#\" + itemdata.uniqueid + \"_option\" + itemdata.correctanswer + \" .minilesson_mc_right\").show();\n\n\n        //if answers were dots for audio content, show them\n          if(itemdata.hasOwnProperty('audiocontent')) {\n              for (var i = 0; i < itemdata.sentences.length; i++) {\n                  var theline = $(\"#\" + itemdata.uniqueid + \"_option\" + (i + 1));\n                  $(\"#\" + itemdata.uniqueid + \"_option\" + (i + 1) + ' .minilesson_sentence').text(itemdata.sentences[i].sentence);\n              }\n          }\n\n        \n        //highlight selected answers\n        $(\"#\" + itemdata.uniqueid + \"_option\" + checked).addClass('minilesson_mc_selected');\n        var percent = checked == itemdata.correctanswer ? 100 : 0;\n        \n        $(\".minilesson_nextbutton\").prop(\"disabled\", true);\n        setTimeout(function() {\n          $(\".minilesson_nextbutton\").prop(\"disabled\", false);\n          self.next_question(percent);\n        }, 2000);\n        \n      });\n\n      //play audio if we are doing this as an audio player thingy\n        //this will use the multichoice audio content template\n        $(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_audioplayer\").on('click', function(e) {\n            //if disabled =>just return (already answered)\n            if($(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_audioplayer\").hasClass('minilesson_mc_disabled')){\n                return;\n            }\n\n            //audio play requests\n            if (!self.playing) {\n                var el = this;\n                self.playing = true;\n                theplayer.attr('src', $(this).attr('data-src'));\n                theplayer[0].play();\n                theplayer[0].onended = function() {\n                    $(el).find(\".minilesson_mc_playstate\").removeClass(\"fa-spin fa-spinner\").addClass(\"fa-play\");\n                    self.playing = false;\n                };\n                $(el).find(\".minilesson_mc_playstate\").removeClass(\"fa-play\").addClass(\"fa-spin fa-spinner\");\n            }else{\n                theplayer[0].pause();\n                theplayer[0].currentTime=0;\n                $(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_playstate\").removeClass(\"fa-spin fa-spinner\").addClass(\"fa-play\");\n                self.playing = false;\n            }\n        });\n      \n    },\n\n\n      prepare_audio: function(itemdata) {\n          // debugger;\n          $.each(itemdata.sentences, function(index, sentence) {\n              polly.fetch_polly_url(sentence.sentence, itemdata.voiceoption, itemdata.usevoice).then(function(audiourl) {\n                  $(\"#\" + itemdata.uniqueid + \"_audioplayer\" + (index+1)).attr(\"data-src\", audiourl);\n              });\n          });\n      }\n  };\n});"],"names":["define","$","log","def","polly","debug","clone","extend","this","init","index","itemdata","quizhelper","hasOwnProperty","prepare_audio","register_events","next_question","percent","stepdata","hasgrade","totalitems","correctitems","grade","do_next","self","theplayer","uniqueid","on","e","hasClass","checked","data","addClass","hide","show","correctanswer","i","sentences","length","text","sentence","prop","setTimeout","playing","pause","currentTime","removeClass","el","attr","play","onended","find","each","fetch_polly_url","voiceoption","usevoice","then","audiourl"],"mappings":"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"}