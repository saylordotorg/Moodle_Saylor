{"version":3,"sources":["../src/smartframe.js"],"names":["define","$","log","debug","clone","extend","init","index","itemdata","quizhelper","register_events","next_question","percent","self","stepdata","hasgrade","totalitems","correctitems","grade","do_next","uniqueid","on","window","addEventListener","event","origin","smartframehost","gradesdata","data","itemid","id","prop","setTimeout"],"mappings":"AAAAA,OAAM,6BAAC,CAAC,QAAD,CAAW,UAAX,CAAuB,4BAAvB,CAAD,CAAuD,SAASC,CAAT,CAAYC,CAAZ,CAAsB,CACjF,aAMAA,CAAG,CAACC,KAAJ,CAAU,qCAAV,EAEA,MAAO,CAGHC,KAAK,CAAE,gBAAY,CACf,MAAOH,CAAAA,CAAC,CAACI,MAAF,IAAe,EAAf,CAAmB,IAAnB,CACX,CALG,CAOLC,IAAI,CAAE,cAASC,CAAT,CAAgBC,CAAhB,CAA0BC,CAA1B,CAAsC,CAC1C,KAAKC,eAAL,CAAqBH,CAArB,CAA4BC,CAA5B,CAAsCC,CAAtC,CACD,CATI,CAULE,aAAa,CAAE,uBAASC,CAAT,CAAkB,IAC3BC,CAAAA,CAAI,CAAG,IADoB,CAE3BC,CAAQ,CAAG,EAFgB,CAG/BA,CAAQ,CAACP,KAAT,CAAiBM,CAAI,CAACN,KAAtB,CACAO,CAAQ,CAACC,QAAT,IACAD,CAAQ,CAACE,UAAT,CAAsB,EAAtB,CACAF,CAAQ,CAACG,YAAT,CAAwBL,CAAO,CAAG,EAAlC,CACAE,CAAQ,CAACI,KAAT,CAAiBN,CAAjB,CACAC,CAAI,CAACJ,UAAL,CAAgBU,OAAhB,CAAwBL,CAAxB,CACD,CAnBI,CAoBLJ,eAAe,CAAE,yBAASH,CAAT,CAAgBC,CAAhB,CAA0BC,CAA1B,CAAsC,CAErD,GAAII,CAAAA,CAAI,CAAG,IAAX,CACAA,CAAI,CAACN,KAAL,CAAaA,CAAb,CACAM,CAAI,CAACJ,UAAL,CAAkBA,CAAlB,CAEAR,CAAC,CAAC,IAAMO,CAAQ,CAACY,QAAf,CAA0B,mCAA3B,CAAD,CAAiEC,EAAjE,CAAoE,OAApE,CAA6E,UAAY,CACvFR,CAAI,CAACF,aAAL,CAAmB,CAAnB,CACD,CAFD,EAKAW,MAAM,CAACC,gBAAP,CAAwB,SAAxB,CAAmC,SAASC,CAAT,CAAgB,CACjDtB,CAAG,CAACC,KAAJ,CAAU,cAAV,CAAyBqB,CAAzB,EAGI,GAAIA,CAAK,CAACC,MAAN,GAAiBjB,CAAQ,CAACkB,cAA9B,CAA8C,CAC1C,MACH,CAED,GAAIC,CAAAA,CAAU,CAAGH,CAAK,CAACI,IAAvB,CAGA,GAAwB,WAArB,QAAOD,CAAAA,CAAP,EAAoCA,CAAU,CAACE,MAAX,EAAqBrB,CAAQ,CAACsB,EAArE,CAAyE,CACpDH,CAAU,CAACf,OADyC,CAGrEX,CAAC,CAAC,wBAAD,CAAD,CAA4B8B,IAA5B,CAAiC,UAAjC,KACAC,UAAU,CAAC,UAAY,CACnB/B,CAAC,CAAC,wBAAD,CAAD,CAA4B8B,IAA5B,CAAiC,UAAjC,KACAlB,CAAI,CAACF,aAAL,CAAmBgB,CAAU,CAACf,OAA9B,CACH,CAHS,CAGP,GAHO,CAIb,CACF,CApBL,IAuBD,CAtDI,CAwDR,CAjEK,CAAN","sourcesContent":["define(['jquery', 'core/log', 'mod_minilesson/definitions'], function($, log, def) {\n  \"use strict\"; // jshint ;_;\n\n  /*\n  This file is to manage the quiz stage\n   */\n\n  log.debug('MiniLesson SmartFrame: initialising');\n\n  return {\n\n    //for making multiple instances\n      clone: function () {\n          return $.extend(true, {}, this);\n     },\n\n    init: function(index, itemdata, quizhelper) {\n      this.register_events(index, itemdata, quizhelper);\n    },\n    next_question: function(percent) {\n      var self = this;\n      var stepdata = {};\n      stepdata.index = self.index;\n      stepdata.hasgrade = true;\n      stepdata.totalitems = 10;\n      stepdata.correctitems = percent / 10;\n      stepdata.grade = percent;\n      self.quizhelper.do_next(stepdata);\n    },\n    register_events: function(index, itemdata, quizhelper) {\n      \n      var self = this;\n      self.index = index;\n      self.quizhelper = quizhelper;\n      \n      $(\"#\" + itemdata.uniqueid + \"_container .minilesson_nextbutton\").on('click', function(e) {\n        self.next_question(0);\n      });\n\n      //listen for the grades\n      window.addEventListener(\"message\", function(event) {\n        log.debug('messageevent',event);\n\n            //if its not really our smartframe host get out of here\n            if (event.origin !== itemdata.smartframehost) {\n                return;\n            }\n            //pass back results and transition\n            var gradesdata = event.data;\n            //each instance of teacher tools itemtype will catch this event, so we need to filter the ones we handle to just this instanc\n           //thats why we pass the itemdata around\n            if(typeof gradesdata != 'undefined' && gradesdata.itemid == itemdata.id) {\n                var thepercent = gradesdata.percent;\n\n                $(\".minilesson_nextbutton\").prop(\"disabled\", true);\n                setTimeout(function () {\n                    $(\".minilesson_nextbutton\").prop(\"disabled\", false);\n                    self.next_question(gradesdata.percent);\n                }, 500);\n            }\n          }, false\n      );\n      \n    }\n  };\n});"],"file":"smartframe.min.js"}