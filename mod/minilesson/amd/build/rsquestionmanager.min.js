define ("mod_minilesson/rsquestionmanager",["jquery","jqueryui","core/log","core/templates","mod_minilesson/definitions","mod_minilesson/modalformhelper","mod_minilesson/modaldeletehelper","mod_minilesson/moveitemhelper","mod_minilesson/modalpreviewhelper","mod_minilesson/duplicateitemhelper","mod_minilesson/datatables"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";c.debug("RSQuestion manager: initialising");return{cmid:null,controls:null,rowIds:[],init:function init(a){var b=this;b.contextid=a.contextid;b.tableid=a.tableid;b.register_events();b.process_html();b.collate_rowids();b.hide_useless_arrows()},process_html:function process_html(){this.controls=[];this.controls.questionstable=k.getDataTable(this.tableid);this.controls.questionscontainer=a("#"+e.itemscontainer);this.controls.noquestionscontainer=a("#"+e.noitemscontainer);this.controls.movearrows=a("#"+e.movearrow)},collate_rowids:function collate_rowids(){var a=this;a.rowIds=[];a.controls.questionstable.rows().every(function(b){var c=a.controls.questionstable.cell({row:b,column:0}).data();a.rowIds[c]=b})},hide_useless_arrows:function hide_useless_arrows(){a(".mod_minilesson_item_move").attr("style","");var b=this.controls.questionstable.data().length;if(!b||1>b){return}var c=this.rowIds[b],d=this.controls.questionstable.row(c).node();a(d).find(".mod_minilesson_item_move[data-direction=\"down\"]").attr("style","visibility: hidden;");var e=this.rowIds[1],f=this.controls.questionstable.row(e).node();a(f).find(".mod_minilesson_item_move[data-direction=\"up\"]").attr("style","visibility: hidden;")},renumber_rows:function renumber_rows(a){for(var b=this.controls.questionstable,c=b.data().length,d=a,e;d<c;d++){e=this.rowIds[d+1];b.cell({row:e,column:0}).data(d)}},move_row:function move_row(a,b){var c=this.controls.questionstable,d="#"+e.itemrow+"_"+a,f=c.row(d),g=f.index(),h=parseInt(c.cell({row:g,column:0}).data()),i;if("up"==b){i=h-1}else if("down"==b){i=h+1}if(1>i){return}var j=c.data().length;if(i>j){return}var k=this.rowIds[i],l=c.cell({row:g,column:0}).data(),m=c.cell({row:k,column:0}).data();c.cell({row:g,column:0}).data(m);c.cell({row:k,column:0}).data(l);c.draw(!1);this.collate_rowids()},register_events:function register_events(){var b=this,k=[e.qtype_dictation,e.qtype_dictationchat,e.qtype_page,e.qtype_speechcards,e.qtype_listenrepeat,e.qtype_multichoice,e.qtype_multiaudio];f.init("."+e.component+"_addlink",b.contextid,function after_questionadd(c,e){c.id=e;c.name=decodeURIComponent(c.name);c.index=b.controls.questionstable.data().length+1;c.up={key:"t/up",component:"moodle",title:"up"};c.down={key:"t/down",component:"moodle",title:"down"};d.render("mod_minilesson/itemlistitem",c).then(function(c){b.controls.questionstable.row.add(a(c)[0]).page("last").draw(!1);b.collate_rowids();b.hide_useless_arrows()});b.controls.noquestionscontainer.hide();b.controls.questionscontainer.show()});f.init("."+e.itemrow+"_editlink",b.contextid,function after_questionedit(c,d){var f="#"+e.itemrow+"_"+d;b.controls.questionstable.cell(a(f+" .c1")).data(decodeURIComponent(c.name))});g.init("."+e.itemrow+"_deletelink",b.contextid,"deleteitem",function after_questiondelete(a){c.debug("after question delete");var d=b.controls.questionstable.row("#"+e.itemrow+"_"+a),f=parseInt(d.data()[0]);b.renumber_rows(f);d.remove().draw(!1);b.collate_rowids();b.hide_useless_arrows();var g=b.controls.questionstable.rows().count();if(!g){b.controls.noquestionscontainer.show();b.controls.questionscontainer.hide()}});h.init("."+e.movearrow,b.contextid,function after_questionmove(a,c){b.move_row(a,c);b.hide_useless_arrows()});i.init("."+e.itemrow+"_previewlink",b.contextid,function after_questionpreview(){c.debug("after preview");a("#mod_minilesson_quiz_cont").remove()});j.init("."+e.itemrow+"_duplicatelink",b.contextid,function after_questionduplicate(c){var e=JSON.parse(c),f={};f.id=e.newitemid;f.name=decodeURIComponent(e.newitemname);f.type=e.type;f.typelabel=decodeURIComponent(e.typelabel);f.index=b.controls.questionstable.data().length+1;f.up={key:"t/up",component:"moodle",title:"up"};f.down={key:"t/down",component:"moodle",title:"down"};d.render("mod_minilesson/itemlistitem",f).then(function(c){b.controls.questionstable.row.add(a(c)[0]).page("last").draw(!1);b.collate_rowids();b.hide_useless_arrows()});b.controls.noquestionscontainer.hide();b.controls.questionscontainer.show()})}}});
//# sourceMappingURL=rsquestionmanager.min.js.map
