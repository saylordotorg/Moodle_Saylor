define ("mod_vpl/vplutil",["jquery","jqueryui","core/log"],function(a,b,c){var d={doNothing:a.noop,returnFalse:function(){return!1},returnTrue:function(){return!0}},e=!1;d.log=function(a,b){if(e||b){c.debug(a)}};d.setUserPreferences=function(b){a.ajax({async:!0,type:"POST",url:"../editor/userpreferences.json.php",data:JSON.stringify(b),contentType:"application/json; charset=utf-8",dataType:"json"})};d.getUserPreferences=function(b){a.ajax({async:!0,type:"POST",url:"../editor/userpreferences.json.php",data:JSON.stringify({getPreferences:!0}),contentType:"application/json; charset=utf-8",dataType:"json"}).done(b)};d.scrollBarWidth=function(){var b,c,d;b=a("<div style=\"width:50px;height:50px;overflow:auto\"><div/></div>").appendTo("body");c=b.children();d=c.innerWidth()-c.height(99).innerWidth();b.remove();return d};d.sanitizeHTML=function(b){if("undefined"==typeof b||""==b.replace(/^\s+$/g,"")){return""}return a("<div>"+b+"</div>").html()};d.sanitizeText=function(a){if("undefined"==typeof a||""==a.replace(/^\s+$/g,"")){return""}return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")};d.setProtocol=function(a){var b;if(0==a.securePort||0==a.port){b=0==a.port}else{switch(a.wsProtocol){case"always_use_wss":b=!0;break;case"always_use_ws":b=!1;break;default:b="https:"==window.location.protocol;}}var c=(b?"wss://":"ws://")+a.server;a.secure=b;a.portToUse=b?a.securePort:a.port;c+=":"+a.portToUse+"/";a.monitorURL=c+a.monitorPath;a.executionURL=c+a.executionPath};d.ArrayBuffer2String=function(a){var b=new Uint8Array(a),c=[],d=32e3,e,f;for(e=0,f=b.length;e<f;e+=d){c.push(String.fromCharCode.apply(String,b.subarray(e,Math.min(e+d,f))))}return c.join("")};d.String2ArrayBuffer=function(a){for(var b=a.length,c=new ArrayBuffer(b),d=new Uint8Array(c),e=0;e<b;e++){d[e]=a.charCodeAt(e)}return c};(function(){var a=0;d.getUniqueId=function(){return a++}})();(function(){d.fileExtension=function(a){var b=/\.([^.]*)$/.exec(a);return null!==b?b[1]:""};d.isImage=function(a){return /^(gif|jpg|jpeg|png|ico)$/i.test(d.fileExtension(a))};d.isBinary=function(a){return d.isImage(a)||/^(zip|jar|pdf|tar|bin|7z|arj|deb|gzip|rar|rpm|dat|db|dll|rtf|doc|docx|odt|exe|com)$/i.test(d.fileExtension(a))};d.isBlockly=function(a){return /^blockly[0123]?$/.test(d.fileExtension(a))};d.validFileName=function(a){if(1>a.length){return!1}if(128<a.length){return!1}return!/[\cA-\cZ]|[:-@]|[{-~]|\\|\[|\]|[/^`Â´]|^-|^ | $|\.\./.test(a)}})();d.getCurrentTime=function(){return parseInt(new Date().valueOf()/1e3)};d.encodeBinary=function(a,b){if(!d.isBinary(a)){return btoa(unescape(encodeURIComponent(b)))}return btoa(d.ArrayBuffer2String(b))};d.decodeBinary=function(a,b){var c=atob(b);if(!d.isBinary(a)){return decodeURIComponent(escape(c))}return d.String2ArrayBuffer(c)};d.validPath=function(a){if(256<a.length){return!1}for(var b=a.split("/"),c=0;c<b.length;c++){if(!d.validFileName(b[c])){return!1}}return!0};d.getFileName=function(a){var b=a.split("/");return b[b.length-1]};d.dataFromURLData=function(a){return a.substr(a.indexOf(",")+1)};d.readZipFile=function(a,b,c,e){if(!e){e=d.doNothing}if("undefined"==typeof JUnzip){d.loadScript(["../editor/zip/inflate.js","../editor/zip/unzip.js"],function(){d.readZipFile(a,b,c,e)});return}var g=d.ArrayBuffer2String(a),h=new JUnzip(g);if(!h.isZipFile()){d.log("Not a ZIP file");e();return}h.readEntries();var j=h.entries.length;function f(a){if(a>=j||c.isClosed()){e();return}var g=h.entries[a],k=g.fileName,l;if(k.match(/\/$/)){f(a+1)}else{c.processFile(k);var m="";if(0===g.compressionMethod){m=g.data}else if(8===g.compressionMethod){m=JSInflate.inflate(g.data)}if(d.isBinary(k)){b({name:k,contents:btoa(m),encoding:1});f(a+1)}else{l=d.String2ArrayBuffer(m);var n=new Blob([l],{type:"text/plain"}),o=new FileReader;o.onload=function(c){b({name:k,contents:c.target.result,encoding:0});f(a+1)};o.onerror=function(b){d.log(b);a=j;f(a+1)};o.readAsText(n)}}}f(0)};d.readSelectedFiles=function(a,b,c){var h=new d.progressBar("import","import"),i="";if(!c){c=d.doNothing}h.processFile=function(a){h.setLabel(a)};function g(j){if(j>=a.length||h.isClosed()){c();h.close();if(""<i){d.showErrorMessage(i)}return}var k=a[j];h.processFile(k.name);var f=d.isBinary(k.name),l=new FileReader,m=d.fileExtension(k.name).toLowerCase();l.onload=function(a){if(f){if("zip"==m){try{d.readZipFile(a.target.result,b,h,function(){g(j+1)});return}catch(a){d.showErrorMessage(a+" : "+k.name)}}else{var c=d.dataFromURLData(a.target.result);b({name:k.name,contents:c,encoding:1})}}else{b({name:k.name,contents:a.target.result,encoding:0})}g(j+1)};l.onerror=function(a){i+="Error \""+a.target.error+"\" reading "+k.name+"\n";g(j+1)};if(f){if("zip"==m){l.readAsArrayBuffer(k)}else{l.readAsDataURL(k)}}else{l.readAsText(k)}}g(0)};(function(){var a={gif:"image/gif",jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",ico:"image/vnd.microsoft.icon",pdf:"application/pdf"};d.getMIME=function(b){var c=d.fileExtension(b);if(c in a){return a[c]}return"application/octet-stream"};d.getTimeLeft=function(a){var b="",c=60,d=60*c,e=24*d;if(0>a){b+="-";a=-a}var f=a,g=parseInt(f/e);f-=g*e;if(0!==g){b+=g+"T"}var h=parseInt(f/d);f-=h*d;var i=parseInt(f/c);f-=i*c;var j=parseInt(f);b+=("00"+h).substr(-2)+":";b+=("00"+i).substr(-2);if(a<d){b+=":"+("00"+j).substr(-2)}return b}})();(function(){var a={abap:"abap",abc:"abc",ada:"ada",ads:"ada",adb:"ada",as:"actionscript",as3:"actionscript",asm:"assembly_x86",bash:"sh",bat:"batchfile",c:"c_cpp",C:"c_cpp",cc:"c_cpp",cpp:"c_cpp","c++":"c_cpp",hxx:"c_cpp",h:"c_cpp",H:"c_cpp",cases:"cases",cbl:"cobol",cob:"cobol",coffee:"coffee",clj:"clojure",cs:"csharp",css:"css",d:"d",dart:"dart",e:"eiffel",erl:"erlang",hrl:"erlang",f:"fortran",f77:"fortran",f90:"fortran",for:"fortran",go:"golang",groovy:"groovy",gv:"dot",hs:"haskell",htm:"html",html:"html",hx:"haxe",java:"java",jl:"julia",js:"javascript",json:"json",jsp:"jsp",jsx:"jsx",kt:"kotlin",kts:"kotlin",m:"matlab",md:"markdown",less:"less",lisp:"lisp",lsp:"lisp",lua:"lua",pas:"pascal",p:"pascal",perl:"perl",prl:"perl",php:"php",pro:"prolog",pl:"prolog",py:"python",R:"r",r:"r",rb:"ruby",ruby:"ruby",s:"assembly_x86",sass:"sass",scala:"scala",scm:"scheme",scss:"scss",sh:"sh",swift:"swift",sql:"sql",svg:"svg",tex:"tex",tcl:"tcl",ts:"typescript",twig:"twig",vbs:"vbscript",v:"verilog",vh:"verilog",vhd:"vhdl",vhdl:"vhdl",xml:"xml",yaml:"yaml"};d.langType=function(b){if(b in a){return a[b]}return"plain_text"}})();(function(){var a={};d.str=function(b,c){if(!a[b]){return"{"+b+"}"}if("undefined"!=typeof c){return a[b].replace(/\{\\*\$a\\*}/g,c)}else{return a[b]}};d.setStr=function(b){for(var c in b){if(b.hasOwnProperty(c)){a[c]=b[c]}}d.dialogbaseOptions={minWidth:200,autoOpen:!1,width:"auto",closeText:d.str("cancel"),modal:!0,dialogClass:"vpl_ide vpl_ide_dialog"}};d.setStr(window.VPLi18n)})();(function(){var a={},b={},c=100,e=0;d.delay=function(b,c,d,f){if("undefined"!=typeof a[b]){clearTimeout(a[b]);e--}e++;a[b]=setTimeout(function(){e--;c(d,f);delete a[b]},20)};d.longDelay=function(b,d,f,g){if("undefined"!=typeof a[b]){clearTimeout(a[b]);e--}e++;a[b]=setTimeout(function(){e--;d(f,g);delete a[b]},c)};var f=function(a,d,g,h){if("undefined"!=typeof b[a]){clearTimeout(b[a])}return setTimeout(function(){if(0<e){b[a]=f(a,d,g,h)}else{d(g,h);delete b[a]}},c)};d.afterAll=function(a,c,d,e){b[a]=f(a,c,d,e)}})();d.iconModified=function(){var a="<span title=\""+d.str("modified")+"\" class=\"vpl_ide_charicon\">";a+="<i class=\"fa fa-star\"></i></span> ";return a};d.iconDelete=function(){var a=" <span title=\""+d.str("delete")+"\" class=\"vpl_ide_charicon vpl_ide_delicon\">";a+="<i class=\"fa fa-trash\"></i></span> ";return a};d.iconClose=function(){var a=" <span title=\""+d.str("closebuttontitle");a+="\" class=\"vpl_ide_charicon vpl_ide_closeicon\"><i class=\"fa fa-remove\"></i></span> ";return a};d.iconRequired=function(){var a=" <span title=\""+d.str("required")+"\" class=\"vpl_ide_charicon\">";a+="<i class=\"fa fa-shield\"></i></span> ";return a};d.iconFolder=function(){return"<i class=\"fa fa-folder-open-o\"></i>"};(function(){var a={filelist:"folder-o",filelistclose:"folder-open-o",new:"file-code-o",rename:"pencil",delete:"trash",multidelete:"trash|list",close:"remove",comments:"commenting",import:"upload",print:"print",edit:"edit",undo:"undo",redo:"repeat",select_all:"location-arrow",find:"search",find_replace:"exchange",next:"search-plus",resetfiles:"refresh",download:"download",fullscreen:"expand",regularscreen:"compress",save:"save",shortcuts:"flash",sort:"list-ol",run:"rocket",running:"rocket fa-spin",debug:"bug",evaluate:"check-square-o",console:"terminal",about:"question",info:"info-circle",alert:"warning",trash:"trash",retrieve:"download",spinner:"refresh fa-spin",keyboard:"keyboard-o",clipboard:"clipboard",timeleft:"clock-o",copy:"copy",paste:"paste",more:"plus-square",less:"minus-square",resize:"arrows-alt",graphic:"picture-o",send:"send",theme:"paint-brush",user:"user",fontsize:"text-height"};d.genIcon=function(b,c){if(!a[b]){return""}var d="fa fa-";if(!c){d+="lg"}else{d+=c}for(var e=a[b].split("|"),f="",g=0;g<e.length;g++){f+="<i class='"+d+" fa-"+e[g]+"'></i>"}return f}})();d.setTitleBar=function(b,c,e,f,g){var j=a(b).parent().find("span.ui-dialog-title");function h(a){var b="<a id='vpl_"+c+"_"+a+"' href='#' title='"+d.str(a)+"'>";b+=d.genIcon(a,"fw")+"</a>";return b}var k=d.genIcon(e);k+=" <span class='"+c+"-title-buttons'></span>";k+="<span class='"+c+"-title-text'></span>";j.html(k);var l=j.find("span."+c+"-title-buttons"),m=j.find("span."+c+"-title-text");k="";for(var n=0;n<f.length;n++){k+=h(f[n])}l.html(k);for(var o=0,p;o<g.length;o++){p=j.find("#vpl_"+c+"_"+f[o]);p.button().click(g[o]);p.css("padding","1px 3px")}l.on("focus","*",function(){a(this).blur()});return m};d.setDialogTitleIcon=function(b,c){var e=a(b).parent().find("span.ui-dialog-title");e.html(d.genIcon(c)+" "+e.html())};d.progressBar=function(b,c,e){var f="<div class=\"vpl_ide_progressbaricon\">"+d.genIcon("spinner")+"</div>",g=a("<div class=\"vpl_ide_dialog\" style=\"display:none;\">"+(" <div class=\"vpl_ide_progressbar\">"+f+"<span class=\"vpl_ide_progressbarlabel\"></span>"+"</div>")+"</div>");a("body").append(g);var h=g.find(".vpl_ide_progressbar"),i=h.find(".vpl_ide_progressbarlabel");g.dialog({title:d.str(b),resizable:!1,autoOpen:!1,width:200,height:20,minHeight:20,modal:!0,dialogClass:"vpl_ide vpl_ide_dialog",close:function close(a){if(g){if(e&&a.originalEvent){e()}e=!1}}});this.setLabel=function(a,b){if(g){i.text(a);if(b){i.html(d.genIcon(b)+" "+i.html())}}};this.close=function(){if(g){g.dialog("destroy");a(g).remove();g=!1}};this.isClosed=function(){return!1===g};var j=g.siblings().find(".ui-dialog-title");j.html(d.genIcon(b)+" "+j.html());this.setLabel(d.str(c));g.dialog("open");g.dialog("option","height","auto")};d.showMessage=function(b,c){var e=a.extend({},d.dialogbaseOptions,c),f=a("<div class=\"vpl_ide_dialog\" style=\"display:none\"></div>"),g="",h=" <span class=\"dmessage\">"+b.replace(/\n/g,"<br>")+"</span>";f.html(h);if("undefined"==typeof e.icon){g="info"}else{g=e.icon;delete e.icon}if(!e.title){e.title=d.str("warning")}a("body").append(f);var i={};if("function"==typeof c.ok){i[d.str("ok")]=function(){a(this).dialog("close");c.ok()};i[d.str("cancel")]=function(){a(this).dialog("close")};delete e.ok}else if("function"==typeof c.yes){i[d.str("yes")]=function(){a(this).dialog("close");c.yes()};i[d.str("no")]=function(){a(this).dialog("close")};delete e.yes}else{i[d.str("close")]=function(){a(this).dialog("close")}}if(e.next){i[d.str("next")]=function(){a(this).dialog("close");c.next()}}e.close=function(){a(this).remove();if(c.close){c.close()}};e.buttons=i;f.dialog(e);var j=f.siblings().find(".ui-dialog-title");j.html(d.genIcon(g)+" "+j.html());f.setMessage=function(b){a(f).find(".dmessage").html(b.replace(/\n/g,"<br>"))};f.dialog("open");return f};d.showErrorMessage=function(b,c){var e=a.extend({},d.dialogbaseOptions,{title:d.str("error"),icon:"alert"});if(c){e=a.extend(e,c)}return d.showMessage(b,e)};d.requestAction=function(b,c,f,g,h){var i=a.Deferred(),j=null,k=!1,l=!1;if(!h){if(""===c){c="connecting"}l=new d.progressBar(b,c,function(){if(4!=j.readyState){if(k&&k.abort){k.abort()}}})}j=a.ajax({beforeSend:function beforeSend(a){k=a;return!0},async:!0,type:"POST",url:g+b,data:JSON.stringify(f),contentType:"application/json; charset=utf-8",dataType:"json"}).always(function(){if(!h){l.close()}}).done(function(a){if(!a.success){i.reject(a.error)}else{i.resolve(a.response)}}).fail(function(a,b,c){var f=d.str("connection_fail")+": "+b;if(e&&c.message!=void 0){f+=": "+c.message}d.log(f);i.reject(f)});return i};d.supportWebSocket=function(){if("WebSocket"in window){return!0}return!1};d.isAndroid=function(){return-1<window.navigator.userAgent.indexOf("Android")};d.isFirefox=function(){return-1<window.navigator.userAgent.indexOf("Firefox")};d.isMac=function(){return-1<window.navigator.userAgent.indexOf("Mac")};d.clickServer=function(b){var c=450,e=screen.width/2-275,f=screen.height/2-c/2;try{var g="toolbar=no, location=no, directories=no, status=no, menubar=no";g+=", resizable=yes, scrollbars=yes, copyhistory=no, width=550";g+=", height="+c+", top="+f+", left="+e;var h=window.open(a(this).attr("href"),"_blank",g);if(!h){return!0}}catch(a){d.log(a);return!0}b.preventDefault();a(this).parent().hide();return!1};d.acceptCertificates=function(b,c){if(0<b.length){var e=d.str("acceptcertificatesnote");e+="<ol>";for(var f in b){if(b.hasOwnProperty(f)){var g=1+f;e+="<li><a href=\""+b[f]+"\" target=\"_blank\">Server ";e+=g+"</a></li>"}}e+="</ol>";var h=d.showMessage(e,{ok:function ok(){var a=c();if(a){a()}},icon:"unlocked",title:d.str("acceptcertificates")});a(h).find("a").on("click keypress",d.clickServer)}else{d.log("servers.length == 0");d.showErrorMessage(d.str("connection_fail"))}};d.monitorRunning=d.returnFalse;(function(){var a=-1;d.setProcessId=function(b){a=b};d.getProcessId=function(){return a}})();d.webSocketMonitor=function(b,c,e,f){d.setProtocol(b);d.setProcessId(b.processid);var g=null,h=null,i=a.Deferred(),j=function(a){i.reject(a)},k=!1,l={message:function message(a){var b=/^([^:]*):?([^]*)/.exec(a),c=b[1],g=b[2];if("running"==c){c=e}var i=d.str(c);if(""<g){i+=": "+g}if(null!==h&&!h.isClosed()){h.setLabel(i)}else if(f.getConsole&&f.getConsole().isOpen()){f.getConsole().setMessage(i)}else{d.log("Error: no dialogo. Message not shown: "+i)}},compilation:function compilation(a){if(f.setResult){f.setResult({compilation:a},!1)}},retrieve:function retrieve(){var a={processid:d.getProcessId()};h.close();k=!0;d.requestAction("retrieve","",a,f.ajaxurl).done(function(a){i.resolve();if(f.setResult){f.setResult(a,!0)}}).fail(j)},run:function run(a){h.close();f.run(a,b,g)},close:function close(){d.log("ws close message from jail");g.close();var a={processid:d.getProcessId()};d.requestAction("cancel","",a,f.ajaxurl,!0)}};try{if(d.supportWebSocket()){g=new WebSocket(b.monitorURL)}else{d.log("ws not available");i.reject(d.str("browserupdate"));return i}}catch(a){d.log("ws new say "+a);i.reject(a.message);return i}h=new d.progressBar(c,"connecting",function(){i.reject("Stopped by user");g.close()});g.notOpen=!0;g.onopen=function(){g.notOpen=!1;h.setLabel(d.str("connected"));if(f.open){f.open()}};g.onerror=function(a){d.log("ws error "+a);h.close();if(b.secure&&g.notOpen){d.requestAction("getjails","retrieve",{},f.ajaxurl).done(function(a){d.acceptCertificates(a.servers,function(){return f.getLastAction()})}).fail(j)}else{i.reject(d.str("connection_fail"))}if(f.close){d.delay("externalActions.close",f.close)}};g.onclose=function(){if(f.getConsole){f.getConsole().disconnect()}if(!g.notOpen){h.close();if(!k&&"rejected"!=i.state()){i.resolve()}}if(f.close){f.close()}};g.onmessage=function(a){var b=/^([^:]+):([^]*)/.exec(a.data);if(null!==b){var c=b[1],e=b[2];if(l[c]){l[c](e)}}else{h.setLabel(d.str("error")+": "+a.data)}};d.monitorRunning=function(){return null!==g&&g.readyState!=WebSocket.CLOSED};return i};d.directRun=function(b,e,f){var g=a.Deferred();a.ajax({async:!0,type:"POST",url:b+"directrun",data:JSON.stringify({command:e,files:f}),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(a){if(!a.success){g.reject(a.error)}else{var b=a.response;d.setProtocol(b);var e=new WebSocket(b.executionURL);c.debug("Conecting with:"+b.executionURL);g.resolve({processid:b.processid,homepath:b.homepath,connection:e})}}).fail(function(a,b,d){var e="Connection fail: "+b;if(d.message!=void 0){e+=": "+d.message}c.debug(e);g.reject(e)});return g};d.directRunTest=function(a,b,e){d.directRun(a,b,[{name:"a.c",contents:"int main(){return 0;}",encoding:0},{name:"b.c",contents:"int f(){return 1;}",encoding:0}]).done(function(a){var b=0;a.connection.onopen=function(){c.debug("Ws open "+a.homepath+" processid "+a.processid);if(e!=void 0){a.connection.send(e)}setTimeout(function(){a.connection.close()},600000)};a.connection.onmessage=function(d){c.debug("WS Message ("+ ++b+"): "+d.data);if(10<=b){a.connection.close()}};a.connection.onerror=function(a){c.debug("WS error: "+a)};a.connection.onclose=function(a){c.debug("WS close: "+a.code+" "+a.reason)}}).fail(function(d){c.debug("Direct run fail. URL: "+a+" command: "+b+" message: "+d)})};d.processResult=function(a,b,c,e,f){if("undefined"==typeof a||""==a.replace(/^\s+$/gm,"")){return""}function g(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/,"\\$&")}var p=/^\s*>/,q=new RegExp("\\[err\\]|error|"+g(d.str("error")),"i"),r=new RegExp("\\[warn\\]|warning|note|"+g(d.str("warning")),"i"),s="",t="",u="",v="",w=a.split(/\r\n|\n|\r/),x=[],y=!1,z=!1,A=!1;function h(a){if("undefined"==typeof c[a].getTagId){return"href=\"#\" "}else{return"href=\"#"+c[a].getTagId()+"\" "}}(function(){for(var a=0;a<b.length;a++){var c=g(b[a]);x[a]=new RegExp("(^| |/)"+c+"( on line | line |:|\\()(\\d+)(:|,)?(\\d+)?(\\))?","m")}})();function j(a,e){for(var f=!1,g=0;g<x.length;g++){var j=x[g],k;while(null!==(k=j.exec(a))){var l=c[g].getAnnotations();z=g;f=!0;var m;if(-1<a.search(q)){m="error"}else if(-1<a.search(r)){m="warning"}else if(-1<a.search(/\[info\]|information/i)){m="info"}else{m="error"}y={row:k[3]-1,column:k[5],type:m,text:e};l.push(y);var n=b[g],o=h(g),p=d.sanitizeText(n),s="data-file=\""+n+"\" data-line=\""+k[3]+"\"";a=a.replace(j,"$1<a "+o+" class=\"vpl_fl\" "+s+">"+p+"$2$3$4$5$6</a>");c[g].setAnnotations(l)}}if(!f&&y){if(""!==e){y.text+="\n"+e;c[z].setAnnotations(c[z].getAnnotations())}else{y=!1}}return a}function k(a){y=!1;a=a.substr(1);var b=/\([-]?[\d]+[.]?[\d]*\)\s*$/.exec(a);if(null!==b){a=a.substr(0,a.length-b[0].length)}var c="";if(f){c+="<a href=\"javascript:void(0)\" onclick=\"VPLUtil.showHideDiv(this)\">[+]</a>"}c+="<b class=\"ui-widget-header ui-corner-all\">"+d.sanitizeText(a)+"</b><br>";c=j(c,a);return c}function l(){y=!1;var a=u;u="";return a}function m(a){var b=d.sanitizeText(a);u+=j(b,a)+"<br>"}function n(a){var b=d.sanitizeText(a);v+=j(b,a)+"\n"}function o(){y=!1;var a=v;v="";return"<pre><i>"+a+"</i></pre>"}for(var B=0,C;B<w.length;B++){C=w[B];if(e){t+=j(d.sanitizeText(C),C)+"\n";continue}var D=p.exec(C),E=p.test(C);if(null!==D!=E){d.log("error")}if(/^-.*/.test(C)){switch(s){case"comment":t+=l();break;case"case":t+=o();break;}if(A){t+="</div>"}t+=k(C);t+=f?"<div style=\"display:none\">":"<div>";A=!0;s=""}else if(E){if("comment"==s){t+=l()}n(C.substr(D[0].length));s="case"}else{if("case"==s){t+=o()}m(C);s="comment"}}switch(s){case"comment":t+=l();break;case"case":t+=o();break;}if(A){t+="</div>"}return t};(function(){var a=[];d.loadScript=function(b,c){if(0==b.length){c();return}var e=b[0];if("undefined"==typeof a[e]){b.shift();a[e]=1;var f=document.createElement("script");f.type="text/javascript";f.src=d.options.scriptPath+e;f.onload=function(){a[e]=2;d.loadScript(b,c)};document.head.appendChild(f)}else if(2==a[e]){b.shift();d.loadScript(b,c)}else{d.log("Error loading js "+e+" "+a[e]);setTimeout(function(){d.loadScript(b,c)},50)}};d.isScriptLoading=function(b){if("undefined"==typeof a[b]){return!1}return 1==a[b]};d.isScriptLoaded=function(b){if("undefined"==typeof a[b]){return!1}return 2==a[b]}})();d.adjustBlockly=function(a,b,c){for(var d=a.getAllBlocks(),e=2e4,f=-2e4,g=2e4,h=-2e4,k=0,l;k<d.length;k++){l=d[k].getRelativeToSurfaceXY();e=Math.min(e,l.y);f=Math.max(f,l.y);g=Math.min(g,l.x);h=Math.max(h,l.x)}d=a.getTopBlocks();for(var m=0;m<d.length;m++){d[m].moveBy(b-g,c-e)}return f-e+100+c};(function(){var c=[],e=[],f=[];function b(a,b){var c=this;this.files=a;this.results=b;setTimeout(function(){c.highlight()},10)}b.prototype.highlightBlockly=function(b){d.loadScript(["../editor/blockly/blockly_compressed.js","../editor/blockly/msg/js/en.js","../editor/blockly/blocks_compressed.js"],function(){var e=a("#"+b),f=e.html();a("#"+b+"load").remove();e.html("");e.show();f=a("<div />").html(f).text().replace(/\n/g,"");var g=Blockly.Xml.textToDom(f);e.html("").height(300).width(e.parent().width());var i=Blockly.inject(b,{toolbox:"",readOnly:!0,media:"../editor/blockly/media/"});Blockly.Xml.domToWorkspace(g,i);var j=d.adjustBlockly(i,10,10);e.height(j);e.width("100%");Blockly.svgResize(i);Blockly.resizeSvgContents(i);var k=e.html();i.dispose();e.html(k)})};b.prototype.highlight=function(){for(var b=this,c=!1,e=this.files,g=0,h;g<e.length;g++){h=e[g];if(d.isBinary(h.fileName)||d.isBlockly(h.fileName)){continue}else{c=!0;break}}if(c&&"undefined"==typeof ace){d.loadScript(["../editor/ace9/ace.js"],function(){b.highlight()});return}for(var j=this.results,k=[],l=[],m=0;m<e.length;m++){var n=e[m],o="code"+n.tagId;if(d.isBlockly(n.fileName)){b.highlightBlockly(o);continue}var p=d.fileExtension(n.fileName),q=d.langType(p);a("#"+o).show();a("#"+o+"load").remove();var r=ace.edit(o);r.setTheme("ace/theme/"+n.theme);r.getSession().setMode("ace/mode/"+q);r.renderer.setShowGutter(n.showln);r.setReadOnly(!0);r.setHighlightActiveLine(!1);r.setAutoScrollEditorIntoView(!0);r.setOption("maxLines",n.nl);r.getAnnotations=function(){return this.getSession().getAnnotations()};r.setAnnotations=function(b){return this.getSession().setAnnotations(b)};r.getTagId=function(){return this.vplTagId};r.vplTagId=n.tagId;k.push(r);l.push(n.fileName);f[n.tagId]=r}for(var s=0;s<j.length;s++){var t=document.getElementById(j[s].tagId),u=t.textContent||t.innerText;t.innerHTML=d.processResult(u,l,k,j[s].noFormat,j[s].folding)}};d.addResults=function(a,b,c){e.push({tagId:a,noFormat:b,folding:c})};d.syntaxHighlightFile=function(a,b,d,e,f){c.push({tagId:a,fileName:b,theme:d,showln:e,nl:f})};d.syntaxHighlight=function(){new b(c,e);c=[];e=[]};d.flEventHandler=function(a){var b=a.target.getAttribute("href").substring(1),c=a.target.getAttribute("data-line"),d=f[b];d.gotoLine(c,0);d.scrollToLine(c,!0)};d.setflEventHandler=function(){for(var a=document.getElementsByClassName("vpl_fl"),b=0;b<a.length;b++){a[b].onclick=d.flEventHandler}};d.showHideDiv=function(b){var a=b,c=b;if(!c.nextSibling){c=c.parentNode}c=c.nextSibling;while("DIV"!=c.nodeName&&"PRE"!=c.nodeName){c=c.nextSibling;if(!c){return}}if(a){if("[+]"==a.innerHTML){if(c.savedDisplay){c.style.display=c.savedDisplay}else{c.style.display=""}a.innerHTML="[-]"}else{c.savedDisplay=c.style.display;c.style.display="none";a.innerHTML="[+]"}}}})();d.options={scriptPath:""};if("undefined"!=typeof window.VPLDebugMode){e=window.VPLDebugMode}d.init=function(b){d.options={scriptPath:""};a.extend(d.options,b);if("undefined"!=typeof window.VPLDebugMode){e=window.VPLDebugMode}d.log(d.options)};window.VPLUtil=d;return d});
//# sourceMappingURL=vplutil.min.js.map
