define ("mod_vpl/vplidebutton",["jquery","jqueryui","mod_vpl/vplutil"],function(a,b,c){var d=function(b,d){var e=this,f={};this.notAdded=function(a){return!f[a]};this.setText=function(b,d,g){if(e.notAdded(b)){return}if(!d){d=f[b].icon}if(!g){g=f[b].title}if(!g){g=c.str(d)}f[b].icon=d;f[b].title=g;if(f[b].hasOwnProperty("key")){g+=" ("+f[b].key+")"}a("#vpl_ide_"+b).attr("title",g);a("#vpl_ide_"+b+" i").replaceWith(c.genIcon(d))};this.setExtracontent=function(b,c){if(e.notAdded(b)){return}var d=a("#vpl_ide_"+b+" i");if(0==d.find(".bt_extrahtml").length){d.append(" <span class=\"bt_extrahtml\"><span>")}d.find(".bt_extrahtml").html(c)};this.add=function(a){if("string"==typeof a){var b=a;a={name:b}}if(!d(a.name)){return}if(!a.hasOwnProperty("icon")){a.icon=a.name}if(!a.hasOwnProperty("title")){a.title=c.str(a.name)}if(!a.hasOwnProperty("active")){a.active=!0}if(!a.hasOwnProperty("editorName")){a.editorName=a.name}if(!a.hasOwnProperty("originalAction")){a.originalAction=c.doNothing}if(e.notAdded(a.name)){f[a.name]=a}else{throw new Error("Button already set "+a.name)}e.setAction(a.name,a.originalAction);if(a.hasOwnProperty("bindKey")){a.command={name:a.editorName,bindKey:a.bindKey,exec:a.action};var g="win";if(navigator.platform.startsWith("Mac")){g="mac"}a.key=a.bindKey[g]}};this.getHTML=function(a){if(e.notAdded(a)){return""}else{var b=f[a].title;if(f[a].hasOwnProperty("key")){b+=" ("+f[a].key+")"}var d="<a id='vpl_ide_"+a+"' href='#' title='"+b+"'>";d+=c.genIcon(a)+"</a>";return d}};this.enable=function(b,c){if(e.notAdded(b)){return}var d=a("#vpl_ide_"+b);f[b].active=c;d.data("vpl-active",c);if(!c){d.addClass("ui-button-disabled ui-state-disabled")}else{d.removeClass("ui-button-disabled ui-state-disabled")}};this.setAction=function(a,b){if(e.notAdded(a)){return}f[a].originalAction=b;f[a].action=function(){if(f[a].active){b()}}};this.getAction=function(a){if(e.notAdded(a)){return c.doNothing}return f[a].action};this.launchAction=function(a){if(e.notAdded(a)){return}f[a].originalAction()};this.setGetkeys=function(a){if(!a){return}var b=a.commands.commands,c=a.commands.platform;for(var d in f){if(f.hasOwnProperty(d)){var g=f[d].editorName;if(b[g]&&b[g].bindKey&&!f[d].Key){f[d].key=b[g].bindKey[c];e.setText(d)}else{if(f[d].bindKey&&!f[d].hasOwnProperty("key")){f[d].key=f[d].bindKey[c];e.setText(d)}}}}};this.getShortcuts=function(a){var b="<ul>";for(var d in f){if(f[d].hasOwnProperty("key")){b+="<li>";b+=f[d].title+" ("+f[d].key+")";b+="</li>"}}b+="</ul>";if(a){b+="<h5>"+c.str("edit")+"</h5>";var e=a.commands.commands,g=a.commands.platform;b+="<ul>";for(var h in e){if(e[h].hasOwnProperty("bindKey")&&""<e[h].bindKey[g]){b+="<li>";b+=h+" ("+e[h].bindKey[g]+")";b+="</li>"}}b+="</ul>"}if("<ul></ul>"==b){return""}return b};a(b).on("click","a",function(b){if(a(this).data("vpl-active")){var c=a(this).attr("id");if("string"==typeof c&&c.startsWith("vpl_ide_")){c=c.replace("vpl_ide_","")}else{return!0}if(e.notAdded(c)){return!0}if(f[c]&&!f[c].active){return!0}var d=e.getAction(c);if("import"!=c){setTimeout(d,10)}else{d()}}b.stopImmediatePropagation();return!1});a("body").on("keydown",function(a){var b=!1,c="";if(a.shiftKey){c+="shift-"}if(a.altKey){c+="alt-";b=!0}if(a.ctrlKey){c+="ctrl-";b=!0}if(a.metaKey){c+="meta-";b=!0}if(112<=a.which&&123>=a.which){c+="f"+(a.which-111);b=!0}else{var d=String.fromCharCode(a.which).toLowerCase();if("a">d||"z"<d){b=!1}else{c+=d}}if(b){for(var e in f){if(f[e].hasOwnProperty("key")){if(c==f[e].key.toLowerCase()){a.preventDefault();a.stopImmediatePropagation();f[e].action();return!1}}}}return!0});this.multiple=function(a,b){return a-a%b};(function(){var b=0,d=0,f=!1,g=3600,h=!1,i=null,j=5,k=1e3,l=0,m=function(a){j=5;k=1e3;if(a>g){j=60;k=5e3}else if(a>24*g){j=300;k=25000}},n=function(){var a=e.multiple(c.getCurrentTime(),j);if(a===d||null===i){return}d=a;var f=l-(d-b),g="";if(0>=f){g="vpl_buttonleft_black"}else if(f<=300){h=!0;g="vpl_buttonleft_red"}else if(f<=900){g="vpl_buttonleft_orange"}else{m(f)}var k="<span class=\""+g+"\">"+c.genIcon("timeleft");if(h){k+=" "+c.getTimeLeft(f)}k+="</span>";i.html(k);i.removeClass("vpl_buttonleft_orange vpl_buttonleft_red vpl_buttonleft_black");i.addClass(g)};e.toggleTimeLeft=function(){h=!h;d=0;n()};e.setTimeLeft=function(g){i=a("#vpl_ide_timeleft");if(!1!==f){clearInterval(f);f=!1}if(g.hasOwnProperty("timeLeft")){l=g.timeLeft;m(l);var h=l%j;l=e.multiple(l,j);b=e.multiple(c.getCurrentTime(),j);d=b-j;setTimeout(function(){f=setInterval(n,k)},1e3*h);a("#vpl_ide_timeleft").show();n()}else{a("#vpl_ide_timeleft").hide()}}})()};window.VPLIDEButtons=d;return d});
//# sourceMappingURL=vplidebutton.min.js.map
