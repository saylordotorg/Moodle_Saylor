{"version":3,"file":"vplideblocklyfile.min.js","sources":["../src/vplideblocklyfile.js"],"sourcesContent":["// This file is part of VPL for Moodle - http://vpl.dis.ulpgc.es/\n//\n// VPL for Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// VPL for Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with VPL for Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Blockly file management\n *\n * @copyright 2013 Juan Carlos Rodríguez-del-Pino\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author Juan Carlos Rodríguez-del-Pino <jcrodriguez@dis.ulpgc.es>\n */\n\n/* globals Interpreter */\n/* globals Blockly */\n\ndefine(\n    [\n        'jquery',\n        'mod_vpl/vplutil',\n    ],\n    function($, VPLUtil) {\n        return function() {\n            var self = this;\n            var vplIdeInstance = this.getVPLIDE();\n            this.firstContent = true;\n            this.workspaceInstance = false;\n            var adaptBlockly = function() {\n                if (typeof Blockly.PHP.workspaceToCodeOld == 'undefined') {\n                    Blockly.PHP.workspaceToCodeOld = Blockly.PHP.workspaceToCode;\n                    Blockly.PHP.workspaceToCode = function(workspace) {\n                        return \"<?php\\n\" + Blockly.PHP.workspaceToCodeOld(workspace);\n                    };\n                }\n                if (typeof Blockly.Python.workspaceToCodeOld == 'undefined') {\n                    Blockly.Python.workspaceToCodeOld = Blockly.Python.workspaceToCode;\n                    Blockly.Python.workspaceToCode = function(workspace) {\n                        return \"# -*- coding: utf-8 -*-\\n\" + Blockly.Python.workspaceToCodeOld(workspace);\n                    };\n                }\n            };\n            var oldAdjustSize = this.adjustSize;\n            this.adjustSize = function() {\n                if (oldAdjustSize.call(this)) {\n                    var editTag = $(this.getTId());\n                    if (editTag.length === 0) {\n                        return false;\n                    }\n                    var tabs = editTag.parent();\n                    var newHeight = tabs.height();\n                    newHeight -= editTag.position().top;\n                    editTag.height(newHeight);\n                    $('#' + this.bdiv).height(newHeight);\n                    $('#' + this.bdiv).width(editTag.width());\n                    Blockly.svgResize(this.workspaceInstance);\n                    return false;\n                }\n                return false;\n            };\n            this.undo = function() {\n                if (this.isOpen()) {\n                    this.workspaceInstance.undo(false);\n                }\n            };\n            this.redo = function() {\n                if (this.isOpen()) {\n                    this.workspaceInstance.undo(true);\n                }\n            };\n            this.interpreter = false;\n            this.animateRun = false;\n            this.RUNSTATE = 1;\n            this.STEPSTATE = 2;\n            this.STOPSTATE = 3;\n            this.executionState = this.STOPSTATE;\n            this.goNext = false;\n            this.initRun = function(animate) {\n                var ter = vplIdeInstance.getTerminal();\n                if (ter.isConnected()) {\n                    ter.closeLocal();\n                }\n                this.animateRun = animate;\n                Blockly.JavaScript.STATEMENT_PREFIX = 'highlightBlock(%1);\\n';\n                Blockly.JavaScript.addReservedWords('highlightBlock');\n                var code = Blockly.JavaScript.workspaceToCode(self.workspaceInstance);\n                var initApi = function(interpreter, scope) {\n                    // Add an API function for the alert() block.\n                    var wrapperAlert = function(text) {\n                        text = typeof text != 'string' ? text.toString() + '\\r\\n' : text + '\\r\\n';\n                        return interpreter.createPrimitive(ter.writeLocal(text));\n                    };\n                    interpreter.setProperty(scope, 'alert',\n                            interpreter.createNativeFunction(wrapperAlert));\n\n                    // Add an API function for the prompt() block.\n                    var wrapperPrompt = function(text, callback) {\n                        text = typeof text != 'string' ? text.toString() : '' + text;\n                        ter.writeLocal(text);\n                        ter.setDataCallback(function(t) {\n                                               ter.writeLocal('\\n');\n                                               callback(t);\n                                            });\n                    };\n                    interpreter.setProperty(scope, 'prompt',\n                        interpreter.createAsyncFunction(wrapperPrompt));\n\n                    var wrapperHighlightBlock = function(id) {\n                        if (id == self.getBreakpoint()) {\n                            self.executionState = self.STEPSTATE;\n                            self.updateRunButtons();\n                            vplIdeInstance.getTerminal().setMessage(VPLUtil.str('breakpoint'));\n                        }\n                        if (self.animateRun || self.executionState == self.STEPSTATE) {\n                            self.workspaceInstance.highlightBlock(id);\n                        }\n                        self.goNext = false;\n                    };\n                    interpreter.setProperty(scope, 'highlightBlock',\n                            interpreter.createNativeFunction(wrapperHighlightBlock));\n                };\n                self.interpreter = new Interpreter(code, initApi);\n                ter.connectLocal(self.stop, VPLUtil.doNothing);\n            };\n            this.reservedWords = {\n                'Infinity': true, 'Array': true, 'Boolean': true,\n                'Date': true, 'Error': true, 'EvalError': true,\n                'Function': true, 'JSON': true, 'Math': true,\n                'NaN': true, 'Number': true, 'Object': true, 'RangeError': true,\n                'ReferenceError': true, 'RegExp': true, 'String': true,\n                'SyntaxError': true, 'TypeError': true, 'URIError': true,\n                'alert': true, 'arguments': true, 'constructor': true, 'eval': true,\n                'highlightBlock': true, 'isFinite': true,\n                'isNaN': true, 'parseFloat': true, 'parseInt': true, 'prompt': true,\n                'self': true, 'this': true, 'window': true,\n            };\n            (function() {\n                var breakpoint = null;\n                var lastSelection = null;\n                self.getBreakpoint = function() {\n                    return breakpoint;\n                };\n                self.setBreakpoint = function() {\n                    breakpoint = lastSelection;\n                };\n                self.removeBreakpoint = function() {\n                    breakpoint = null;\n                };\n                self.setLastSelection = function(selection) {\n                    lastSelection = selection;\n                };\n                self.isSelectingBreakpoint = function() {\n                    return breakpoint === null && lastSelection !== null;\n                };\n            })();\n            this.getVarValue = function(val) {\n                var HTML = '';\n                if (val === null) {\n                    HTML = \"<b>null</b>\";\n                } else if (val != undefined) {\n                    var type = typeof val;\n                    if (type == 'string') {\n                        HTML = '\"' + VPLUtil.sanitizeText(val) + '\"';\n                    } else if (type == 'boolean') {\n                        HTML = \"<b>\" + val + \"</b>\";\n                    } else if (type == 'object' && val.class === \"Array\") {\n                        HTML = '[';\n                        var ar = val.properties;\n                        for (var i = 0; i < ar.length; i++) {\n                            HTML += self.getVarValue(ar[i]);\n                            if (i != ar.length - 1) {\n                                HTML += ', ';\n                            }\n                        }\n                        HTML += ']';\n                    } else if (type == 'object') {\n                        HTML = \"<b>\" + val.toString() + \"</b>\";\n                    } else {\n                        HTML += '' + val;\n                    }\n                }\n                return HTML;\n            };\n            this.getVariables = function(properties) {\n                var HTML = '';\n                for (var proname in properties) {\n                    if (this.reservedWords[proname] === true) {\n                        continue;\n                    }\n                    var pro = properties[proname];\n                    if (pro != undefined && !(pro.class === \"Function\")) {\n                        var value = VPLUtil.sanitizeText(self.getVarValue(pro));\n                        HTML += '<b>' + proname + \"</b>:&nbsp;\" + value + \"<br>\\n\";\n                    }\n                }\n                return HTML;\n            };\n            this.getParameters = function(args) {\n                var HTML = '(';\n                for (var i = 0; i < args.length; i++) {\n                    HTML += '' + args[i];\n                    if (i < args.length - 1) {\n                        HTML += ', ';\n                    }\n                }\n                return HTML + ')';\n            };\n            this.showStack = function(interpreter) {\n                var sn = 0;\n                var HTML = '<table class=\"generaltable\">';\n                var stack = interpreter.stateStack;\n                var lastFunc = '<tr><td>0</td><td><b>Globals</b></td>';\n                for (var i = 0; i < stack.length; i++) {\n                    var level = stack[i];\n                    if (lastFunc > '' && (level.node.type == 'CallExpression' || i == stack.length - 1)) {\n                        HTML += lastFunc + '<td>' + self.getVariables(level.scope.properties);\n                        HTML += '</td></tr>';\n                    }\n                    if (level.node.type == 'CallExpression') {\n                        if (self.reservedWords[level.node.callee.name] !== true\n                        && level.node.callee.name != undefined) {\n                            sn++;\n                            lastFunc = '<tr><td>' + sn + '</td>';\n                            lastFunc += '<td>' + level.node.callee.name + self.getParameters(level.arguments_) + '</td>';\n                        } else {\n                            lastFunc = '';\n                        }\n                    }\n                }\n                HTML += '</table>';\n                vplIdeInstance.setResult({variables: HTML});\n            };\n            this.runLoop = function() {\n                if (!self.interpreter) {\n                    return;\n                }\n                self.goNext = true;\n                for (var i = 0; i < 30000 && self.goNext; i++) {\n                    if (self.executionState == self.STOPSTATE) {\n                        break;\n                    }\n                    if (!self.interpreter || !self.interpreter.step()) {\n                        self.executionState = self.STOPSTATE;\n                        self.updateRunButtons();\n                        break;\n                    }\n                }\n                if (self.executionState == self.STOPSTATE) {\n                    self.workspaceInstance.highlightBlock(-1);\n                    vplIdeInstance.getTerminal().closeLocal();\n                    vplIdeInstance.setResult({variables: ''});\n                    return;\n                }\n                if (self.executionState == self.RUNSTATE) {\n                    if (self.animateRun) {\n                        setTimeout(self.runLoop, 1000);\n                        self.showStack(self.interpreter);\n                    } else {\n                        setTimeout(self.runLoop, 0);\n                    }\n                } else {\n                    self.showStack(self.interpreter);\n                }\n            };\n            this.start = function() {\n                if (self.executionState != self.STOPSTATE) {\n                    return;\n                }\n                self.initRun(false);\n                self.executionState = self.RUNSTATE;\n                self.updateRunButtons();\n                vplIdeInstance.getTerminal().setMessage(VPLUtil.str('start'));\n                self.runLoop();\n            };\n            this.startAnimate = function() {\n                if (self.executionState != self.STOPSTATE) {\n                    return;\n                }\n                self.initRun(true);\n                self.executionState = self.RUNSTATE;\n                self.updateRunButtons();\n                vplIdeInstance.getTerminal().setMessage(VPLUtil.str('startanimate'));\n                self.runLoop();\n            };\n            this.stop = function() {\n                self.executionState = self.STOPSTATE;\n                self.workspaceInstance.highlightBlock(-1);\n                self.updateRunButtons();\n                vplIdeInstance.getTerminal().setMessage(VPLUtil.str('stop'));\n                vplIdeInstance.getTerminal().closeLocal();\n                self.interpreter = false;\n                vplIdeInstance.setResult({variables: ''});\n            };\n            this.pause = function() {\n                if (self.executionState != self.RUNSTATE) {\n                    return;\n                }\n                self.executionState = self.STEPSTATE;\n                vplIdeInstance.getTerminal().setMessage(VPLUtil.str('pause'));\n                self.updateRunButtons();\n            };\n            this.resume = function() {\n                if (self.executionState != self.STEPSTATE) {\n                    return;\n                }\n                self.executionState = self.RUNSTATE;\n                vplIdeInstance.getTerminal().setMessage(VPLUtil.str('resume'));\n                self.updateRunButtons();\n                self.runLoop();\n            };\n            this.step = function() {\n                if (self.executionState == self.STOPSTATE) {\n                    self.initRun(true);\n                }\n                self.executionState = self.STEPSTATE;\n                self.updateRunButtons();\n                vplIdeInstance.getTerminal().setMessage(VPLUtil.str('step'));\n                self.runLoop();\n            };\n            this.hasUndo = function() {\n                return true;\n            };\n            this.hasRedo = function() {\n                return true;\n            };\n            this.oldSetFileName = this.setFileName;\n            this.generatorMap = {\n                py: 'Python',\n                dart: 'Dart',\n                js: 'JavaScript',\n                lua: 'Lua',\n                php: 'PHP'\n            };\n            this.generator = '';\n            this.setFileName = function(newName) {\n                var oldFileName = this.getFileName();\n                var oldExt = VPLUtil.fileExtension(oldFileName);\n                if (!self.oldSetFileName(newName)) {\n                    VPLUtil.log(\"Blockly setFileName: name no acepted \" + newName);\n                    return false;\n                }\n                VPLUtil.log('Blockly set filename ' + newName);\n                var regExt2 = /\\.([^.]+)\\.blockly[123]?$/;\n                var regFn2 = /(.+)\\.blockly[123]?$/;\n                var ext2 = regExt2.exec(newName);\n                var fn2 = regFn2.exec(newName);\n                if (ext2 !== null && fn2 !== null && typeof this.generatorMap[ext2[1]] == 'string') {\n                    this.generator = this.generatorMap[ext2[1]];\n                    this.generatedFilename = fn2[1];\n                    VPLUtil.log('Blockly generator ' + this.generator + ' for filename ' + this.generatedFilename);\n                    this.updateGeneratedCode();\n                } else {\n                    this.generator = '';\n                }\n                if (oldExt != VPLUtil.fileExtension(newName)) {\n                    VPLUtil.log('Blockly extension changed');\n                    VPLUtil.afterAll('reopenBlockly', function() {\n                            VPLUtil.log('reopenBlockly');\n                            self.close();\n                            self.open();\n                        }\n                    );\n                }\n                return true;\n            };\n            this.updateGeneratedCode = function() {\n                if (self.blocklyNotLoaded) {\n                    return;\n                }\n                var fileManager = self.getFileManager();\n                if (self.generator != '') {\n                    VPLUtil.log('Blockly generate ' + self.generator);\n                    var fid = fileManager.fileNameExists(self.generatedFilename);\n                    // Try to create generated code file.\n                    if (fid == -1) {\n                        VPLUtil.log(\"try to create \" + self.generatedFilename + \" files\");\n                        fileManager.addFile({\n                            name: self.generatedFilename,\n                            contents: ''},\n                            false, VPLUtil.doNothing, VPLUtil.doNothing);\n                        fid = fileManager.fileNameExists(self.generatedFilename);\n                    }\n                    if (fid != -1) {\n                        var code = Blockly[self.generator].workspaceToCode(self.workspaceInstance);\n                        var fileGenerated = fileManager.getFile(fid);\n                        if (fileGenerated.getContent() != code) {\n                            fileGenerated.setContent(code);\n                            fileGenerated.change();\n                            fileGenerated.gotoLine(1);\n                            fileGenerated.setReadOnly(true);\n                        }\n                    }\n                }\n            };\n            this.changeCode = function(event) {\n                VPLUtil.log(event);\n                if (event.type == 'ui' && event.element == 'selected') {\n                    self.setLastSelection(event.newValue);\n                    return;\n                }\n                if (event.type == 'ui'\n                        && event.element == 'category'\n                        && event.newValue == VPLUtil.str('run')) {\n                        VPLUtil.longDelay('updateRunButtons', self.updateRunButtons);\n                    return;\n                }\n                if (self.firstContent) {\n                    if (event.type == 'finished_loading') {\n                        self.firstContent = false;\n                        self.workspaceInstance.clearUndo();\n                    } else {\n                        return;\n                    }\n                }\n                if (!event.recordUndo) {\n                    return;\n                }\n\n                VPLUtil.log('Call change due changeCode');\n                self.change();\n                if (self.generator != '') {\n                    VPLUtil.afterAll('generate' + self.getFileName(), self.updateGeneratedCode);\n                }\n            };\n            var triesUpdateRunButtons = 0;\n            var triesUpdateRunButtonsLimits = 20;\n            this.updateRunButtons = function() {\n                if ($('.blocklySelectBreakpointC').length == 0) {\n                    triesUpdateRunButtons++;\n                    if (triesUpdateRunButtons > triesUpdateRunButtonsLimits) {\n                        triesUpdateRunButtons = 0;\n                        VPLUtil.log('Giving up to tries of updateRunButtons');\n                        return;\n                    }\n                    VPLUtil.longDelay('updateRunButtons', self.updateRunButtons);\n                    return;\n                }\n                VPLUtil.log('updateRunButtons');\n                triesUpdateRunButtons = 0;\n                var dimmed = 'vpl_dimmed';\n                if (self.isSelectingBreakpoint()) {\n                    $('.blocklySelectBreakpointC').removeClass(dimmed);\n                } else {\n                    $('.blocklySelectBreakpointC').addClass(dimmed);\n                }\n                if (self.getBreakpoint() === null) {\n                    $('.blocklyRemoveBreakpointC').addClass(dimmed);\n                } else {\n                    $('.blocklyRemoveBreakpointC').removeClass(dimmed);\n                }\n                switch (self.executionState) {\n                    case self.RUNSTATE: {\n                        $('.blocklyStartC').addClass(dimmed);\n                        $('.blocklyStartAnimateC').addClass(dimmed);\n                        $('.blocklyStopC').removeClass(dimmed);\n                        $('.blocklyPauseC').removeClass(dimmed);\n                        $('.blocklyResumeC').addClass(dimmed);\n                        $('.blocklyStepC').addClass(dimmed);\n                        break;\n                    }\n                    case self.STEPSTATE: {\n                        $('.blocklyStartC').addClass(dimmed);\n                        $('.blocklyStartAnimateC').addClass(dimmed);\n                        $('.blocklyStopC').removeClass(dimmed);\n                        $('.blocklyPauseC').addClass(dimmed);\n                        $('.blocklyResumeC').removeClass(dimmed);\n                        $('.blocklyStepC').removeClass(dimmed);\n                        break;\n                    }\n                    case self.STOPSTATE: {\n                        $('.blocklyStartC').removeClass(dimmed);\n                        $('.blocklyStartAnimateC').removeClass(dimmed);\n                        $('.blocklyStopC').addClass(dimmed);\n                        $('.blocklyPauseC').addClass(dimmed);\n                        $('.blocklyResumeC').addClass(dimmed);\n                        $('.blocklyStepC').removeClass(dimmed);\n                        break;\n                    }\n                }\n            };\n            this.setToolbox = function() {\n                var ext = VPLUtil.fileExtension(this.getFileName());\n                var toolboxname = ext + 'Toolbox';\n                if (self[toolboxname] === false) {\n                    $.ajax({\n                        url: '../editor/blocklytoolboxes/' + toolboxname + '.xml',\n                        dataType: 'text',\n                        success: function(data) {\n                            self[toolboxname] = self.blocklyIn18(data);\n                            self.setToolbox();\n                        },\n                    });\n                    return;\n                }\n                var addUpdateButtons = function(func) {\n                    return function() {\n                        func();\n                        self.updateRunButtons();\n                    };\n                };\n                var callBacks = {\n                    'blocklyStartButton': this.start,\n                    'blocklyStartAnimateButton': this.startAnimate,\n                    'blocklyStopButton': this.stop,\n                    'blocklyPauseButton': this.pause,\n                    'blocklyResumeButton': this.resume,\n                    'blocklyStepButton': this.step,\n                    'blocklySelectBreakpointButton': this.setBreakpoint,\n                    'blocklyRemoveBreakpointButton': this.removeBreakpoint,\n                };\n                var wp = this.workspaceInstance;\n                wp.updateToolbox(this[toolboxname]);\n                for (var key in callBacks) {\n                    wp.registerButtonCallback(key, addUpdateButtons(callBacks[key]));\n                }\n                this.adjustSize();\n            };\n            this.open = function() {\n                this.showFileName();\n                if (self.blocklyNotLoaded) {\n                    VPLUtil.loadScript(\n                        [\n                            '../editor/blockly/blockly_compressed.js',\n                            '../editor/blockly/msg/js/en.js',\n                            '../editor/blockly/blocks_compressed.js',\n                            '../editor/blockly/python_compressed.js',\n                            '../editor/blockly/javascript_compressed.js',\n                            '../editor/blockly/php_compressed.js',\n                            '../editor/blockly/lua_compressed.js',\n                            '../editor/blockly/dart_compressed.js',\n                            '../editor/acorn/acorn.js',\n                            '../editor/acorn/interpreter.js',\n                        ],\n                        function() {\n                            VPLUtil.log('Blocklyloaded', true);\n                            adaptBlockly();\n                            self.blocklyNotLoaded = false;\n                            self.open();\n                        }\n                    );\n                    return false;\n                }\n                var code = this.getContent();\n                this.setOpen(true);\n                var fileName = this.getFileName();\n                var horizontalMenu = false;\n                if (/.*[0-9]$/.test(VPLUtil.fileExtension(fileName))) {\n                    horizontalMenu = true;\n                }\n                var tid = this.getTId();\n                // Workaround to remove jquery-ui theme background color.\n                $(tid).removeClass('ui-widget-content ui-tabs-panel');\n                $(tid).addClass('ui-corner-bottom');\n                this.bdiv = 'bkdiv' + this.getId();\n                $(tid).html('<div id=\"' + this.bdiv + '\" style=\"height: 480px; width: 600px;\"></div>');\n                var options = {\n                    toolbox: '<xml><category name=\"\" colour=\"330\"><block type=\"math_number\"></block></category></xml>',\n                    media: '../editor/blockly/media/',\n                    horizontalLayout: horizontalMenu,\n                    zoom: {\n                        controls: true,\n                        wheel: true,\n                        startScale: 1.0,\n                        maxScale: 3,\n                        minScale: 0.2,\n                        scaleSpeed: 1.05\n                    }\n                };\n                this.workspaceInstance = Blockly.inject(this.bdiv, options);\n                this.setToolbox();\n                this.firstContent = code > '';\n                self.workspaceInstance.addChangeListener(self.changeCode);\n                this.setContent(code);\n                VPLUtil.adjustBlockly(self.workspaceInstance, 10, 10);\n                self.workspaceInstance.scrollX = 0;\n                self.workspaceInstance.scrollY = 0;\n                Blockly.svgResize(self.workspaceInstance);\n                Blockly.resizeSvgContents(self.workspaceInstance);\n                self.setFileName(self.getFileName());\n                self.adjustSize();\n                // Must return false. Do not change it.\n                return false;\n            };\n            var getContentOld = this.getContent;\n            this.getContent = function() {\n                if (!this.isOpen()) {\n                    return getContentOld.call(this);\n                }\n                var xml = Blockly.Xml.workspaceToDom(this.workspaceInstance);\n                var xmlText = Blockly.Xml.domToPrettyText(xml);\n                return xmlText;\n            };\n            var setContentOld = this.setContent;\n            this.setContent = function(c) {\n                setContentOld.call(this, c);\n                if (c.length > 0 && this.isOpen()) {\n                    this.workspaceInstance.clear();\n                    var xml = Blockly.Xml.textToDom(c);\n                    Blockly.Xml.domToWorkspace(xml, this.workspaceInstance);\n                }\n            };\n            this.close = function() {\n                if (this.isOpen()) {\n                    setContentOld.call(this, this.getContent());\n                    this.workspaceInstance.dispose();\n                    this.workspaceInstance = false;\n                    this.setOpen(false);\n                }\n            };\n            this.blocklyNotLoaded = true;\n            this.blocklyToolbox = false;\n            this.blockly0Toolbox = false;\n            this.blockly1Toolbox = false;\n            this.blockly2Toolbox = false;\n            this.blockly3Toolbox = false;\n            this.blocklyStrs = [\n                'basic',\n                'intermediate',\n                'advanced',\n                'variables',\n                'operatorsvalues',\n                'control',\n                'inputoutput',\n                'functions',\n                'lists',\n                'math',\n                'text',\n                'run',\n                'start',\n                'startanimate',\n                'stop',\n                'pause',\n                'resume',\n                'step',\n                'breakpoint',\n                'selectbreakpoint',\n                'removebreakpoint'\n            ];\n            this.blocklyIn18 = function(data) {\n                var l = this.blocklyStrs.length;\n                for (var i = 0; i < l; i++) {\n                    var str = this.blocklyStrs[i];\n                    var reg = new RegExp('\\\\[\\\\[' + str + '\\\\]\\\\]', 'g');\n                    var rep = VPLUtil.str(str);\n                    data = data.replace(reg, rep);\n                }\n                return data;\n            };\n        };\n    }\n);\n"],"names":["define","$","VPLUtil","self","this","vplIdeInstance","getVPLIDE","firstContent","workspaceInstance","breakpoint","lastSelection","oldAdjustSize","adjustSize","call","editTag","getTId","length","newHeight","parent","height","position","top","bdiv","width","Blockly","svgResize","undo","isOpen","redo","interpreter","animateRun","RUNSTATE","STEPSTATE","STOPSTATE","executionState","goNext","initRun","animate","ter","getTerminal","isConnected","closeLocal","JavaScript","STATEMENT_PREFIX","addReservedWords","code","workspaceToCode","Interpreter","scope","setProperty","createNativeFunction","text","toString","createPrimitive","writeLocal","createAsyncFunction","callback","setDataCallback","t","id","getBreakpoint","updateRunButtons","setMessage","str","highlightBlock","connectLocal","stop","doNothing","reservedWords","Infinity","Array","Boolean","Date","Error","EvalError","Function","JSON","Math","NaN","Number","Object","RangeError","ReferenceError","RegExp","String","SyntaxError","TypeError","URIError","alert","arguments","constructor","eval","isFinite","isNaN","parseFloat","parseInt","prompt","window","setBreakpoint","removeBreakpoint","setLastSelection","selection","isSelectingBreakpoint","getVarValue","val","HTML","undefined","type","sanitizeText","class","ar","properties","i","getVariables","proname","pro","getParameters","args","showStack","sn","stack","stateStack","lastFunc","level","node","callee","name","arguments_","setResult","variables","runLoop","step","setTimeout","start","startAnimate","pause","resume","hasUndo","hasRedo","oldSetFileName","setFileName","generatorMap","py","dart","js","lua","php","generator","newName","oldFileName","getFileName","oldExt","fileExtension","log","ext2","exec","fn2","generatedFilename","updateGeneratedCode","afterAll","close","open","blocklyNotLoaded","fileManager","getFileManager","fid","fileNameExists","addFile","contents","fileGenerated","getFile","getContent","setContent","change","gotoLine","setReadOnly","changeCode","event","element","newValue","clearUndo","recordUndo","longDelay","triesUpdateRunButtons","dimmed","removeClass","addClass","setToolbox","toolboxname","addUpdateButtons","func","callBacks","blocklyStartButton","blocklyStartAnimateButton","blocklyStopButton","blocklyPauseButton","blocklyResumeButton","blocklyStepButton","blocklySelectBreakpointButton","blocklyRemoveBreakpointButton","wp","key","updateToolbox","registerButtonCallback","ajax","url","dataType","success","data","blocklyIn18","showFileName","loadScript","PHP","workspaceToCodeOld","workspace","Python","setOpen","fileName","horizontalMenu","test","tid","getId","html","options","toolbox","media","horizontalLayout","zoom","controls","wheel","startScale","maxScale","minScale","scaleSpeed","inject","addChangeListener","adjustBlockly","scrollX","scrollY","resizeSvgContents","getContentOld","xml","Xml","workspaceToDom","domToPrettyText","setContentOld","c","clear","textToDom","domToWorkspace","dispose","blocklyToolbox","blockly0Toolbox","blockly1Toolbox","blockly2Toolbox","blockly3Toolbox","blocklyStrs","l","reg","rep","replace"],"mappings":"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"}