{"version":3,"file":"vplidefile.min.js","sources":["../src/vplidefile.js"],"sourcesContent":["// This file is part of VPL for Moodle - http://vpl.dis.ulpgc.es/\n//\n// VPL for Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// VPL for Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with VPL for Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * File management\n *\n * @copyright 2013 Juan Carlos Rodríguez-del-Pino\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author Juan Carlos Rodríguez-del-Pino <jcrodriguez@dis.ulpgc.es>\n */\n\ndefine(\n    [\n        'jquery',\n        'jqueryui',\n        'mod_vpl/vplutil',\n        'mod_vpl/vplidecodefile',\n        'mod_vpl/vplideblocklyfile',\n        'mod_vpl/vplidebinaryfile',\n    ],\n    function($, jqui, VPLUtil, codeExtension, blocklyExtension, binaryExtension) {\n        return function(id, name, value, fileManager, vplIdeInstance) {\n            var tid = \"#vpl_file\" + id;\n            var tabnameid = \"#vpl_tab_name\" + id;\n            var fileName = name;\n            var modified = true;\n            var opened = false;\n            var self = this;\n            this.getContent = function() {\n                return value;\n            };\n            this.setContent = function(c) {\n                value = c;\n            };\n            this.getFileManager = function() {\n                return fileManager;\n            };\n            this.getFileName = function() {\n                return fileName;\n            };\n            this.getId = function() {\n                return id;\n            };\n            this.getTabNameId = function() {\n                return tabnameid;\n            };\n            this.getTId = function() {\n                return tid;\n            };\n            this.getFileName = function() {\n                return fileName;\n            };\n            this.isModified = function() {\n                return modified;\n            };\n            this.resetModified = function() {\n                modified = false;\n                this.showFileName();\n            };\n            this.setModified = function() {\n                modified = true;\n                this.showFileName();\n            };\n            this.getTabPos = function() {\n                return fileManager.getTabPos(this);\n            };\n            this.isOpen = function() {\n                return opened;\n            };\n            this.setOpen = function(openState) {\n                opened = openState;\n            };\n            this.getVPLIDE = function() {\n                return vplIdeInstance;\n            };\n            this.change = function() {\n                if (!modified) {\n                    this.setModified();\n                    fileManager.generateFileList();\n                    this.showFileName();\n                    VPLUtil.longDelay('setModified', fileManager.setModified);\n                }\n            };\n            this.setFileName = function(name) {\n                if (!VPLUtil.validPath(name)) {\n                    return false;\n                }\n                if (name != fileName) {\n                    fileName = name;\n                    self.change();\n                }\n                if (!this.isOpen()) {\n                    return true;\n                }\n                this.showFileName();\n                this.langSelection();\n                return true;\n            };\n            this.showFileName = function() {\n                var name = this.getFileName();\n                var fn = VPLUtil.getFileName(name);\n                if (fn.length > 20) {\n                    fn = fn.substring(0, 16) + '...';\n                }\n                var html = (modified ? VPLUtil.iconModified() : '') + fn;\n                if (this.getTabPos() < fileManager.minNumberOfFiles) {\n                    html = html + VPLUtil.iconRequired();\n                } else {\n                    html = html + VPLUtil.iconClose();\n                }\n                $(tabnameid + ' a').html(html);\n                if (fn != name) {\n                    $(tabnameid + ' a').attr('title', name);\n                }\n                VPLUtil.afterAll('adjustTabsTitles' + self.id, function() {\n                    fileManager.adjustTabsTitles(true);\n                    VPLUtil.delay('adjustTabsTitles' + self.id, function() {\n                        self.adjustSize();\n                    });\n                });\n            };\n\n            this.destroy = function() {\n                $(tabnameid).remove();\n                $(tid).remove();\n            };\n\n            this.adjustSize = function() {\n                if (!this.isOpen()) {\n                    return false;\n                }\n                var editTag = $(tid);\n                var tabs = editTag.parent();\n                if (editTag.length === 0) {\n                    return false;\n                }\n                var editorHeight = editTag.height();\n                var editorWidth = editTag.width();\n                var newHeight = tabs.height();\n                newHeight -= editTag.position().top;\n                var newWidth = $('#vpl_tabs_scroll').width();\n                if (newHeight != editorHeight || newWidth != editorWidth) {\n                    $(editTag).height(newHeight);\n                    $(editTag).width(newWidth);\n                    return true;\n                }\n                return false;\n            };\n            this.gotoLine = VPLUtil.doNothing;\n            this.setReadOnly = VPLUtil.doNothing;\n            this.focus = VPLUtil.doNothing;\n            this.blur = VPLUtil.doNothing;\n            this.undo = VPLUtil.doNothing;\n            this.redo = VPLUtil.doNothing;\n            this.selectAll = VPLUtil.doNothing;\n            this.open = VPLUtil.doNothing;\n            this.hasUndo = VPLUtil.returnFalse;\n            this.hasRedo = VPLUtil.returnFalse;\n            this.hasSelectAll = VPLUtil.returnFalse;\n            this.hasFind = VPLUtil.returnFalse;\n            this.hasFindReplace = VPLUtil.returnFalse;\n            this.hasNext = VPLUtil.returnFalse;\n            this.find = VPLUtil.doNothing;\n            this.replace = VPLUtil.doNothing;\n            this.next = VPLUtil.doNothing;\n            this.getAnnotations = function() {\n                return [];\n            };\n            this.setAnnotations = VPLUtil.doNothing;\n            this.setFontSize = VPLUtil.doNothing;\n            this.setTheme = VPLUtil.doNothing;\n            this.clearAnnotations = VPLUtil.doNothing;\n            this.langSelection = VPLUtil.doNothing;\n            this.isBinary = VPLUtil.returnFalse;\n            // Adds support for current extensions\n            this.extendToCodeEditor = codeExtension;\n            this.extendToBlockly = blocklyExtension;\n            this.extendToBinary = binaryExtension;\n        };\n    }\n);\n"],"names":["define","$","jqui","VPLUtil","codeExtension","blocklyExtension","binaryExtension","id","name","value","fileManager","vplIdeInstance","tid","tabnameid","fileName","modified","opened","self","this","getContent","setContent","c","getFileManager","getFileName","getId","getTabNameId","getTId","isModified","resetModified","showFileName","setModified","getTabPos","isOpen","setOpen","openState","getVPLIDE","change","generateFileList","longDelay","setFileName","validPath","langSelection","fn","length","substring","html","iconModified","minNumberOfFiles","iconRequired","iconClose","attr","afterAll","adjustTabsTitles","delay","adjustSize","destroy","remove","editTag","tabs","parent","editorHeight","height","editorWidth","width","newHeight","position","top","newWidth","gotoLine","doNothing","setReadOnly","focus","blur","undo","redo","selectAll","open","hasUndo","returnFalse","hasRedo","hasSelectAll","hasFind","hasFindReplace","hasNext","find","replace","next","getAnnotations","setAnnotations","setFontSize","setTheme","clearAnnotations","isBinary","extendToCodeEditor","extendToBlockly","extendToBinary"],"mappings":"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"}