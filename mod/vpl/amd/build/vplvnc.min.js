define ("mod_vpl/vplvnc",["jquery","jqueryui","mod_vpl/vplutil","mod_vpl/vplclipboard","core/log"],function(a,b,c,d,e){window.INCLUDE_URI="../editor/noVNC/include/";function f(){if("undefined"==typeof Util){c.delay("loadVNCScripts",f)}else{Util.load_scripts(["webutil.js","base64.js","websock.js","des.js","keysymdef.js","keyboard.js","input.js","display.js","jsunzip.js","rfb.js","keysym.js"])}}c.delay("loadVNCScripts",f);return function VPLVNCClient(b,f){var q=this,r,s="",u="",v="",x=a("#"+b),y=a("#"+b+" canvas"),z=c.doNothing,A,B=!0,C,D=window.document.createElement("input");D.style.position="absolute";D.style.left="0px";D.style.top="-10000px";D.style.width="1em";D.style.height="1ex";D.style.opacity="0";D.style.backgroundColor="transparent";D.style.borderStyle="none";D.style.outlineStyle="none";D.autocapitalize="off";D.autocomplete="off";D.autocorrect="off";D.wrap="off";D.spellcheck="false";x.append(D);function g(){if(a(D).is(":focus")){D.blur()}else{D.focus()}}function h(){if(q.isConnected()){r.clipboardPasteFrom(A.getEntry2())}}function i(a,b){A.setEntry1(b)}function j(){A.show()}function k(){if(q.isConnected()){r.get_keyboard().set_focused(!0)}}function l(){if(q.isConnected()){r.get_keyboard().set_focused(!1)}}function m(){A.setEntry1(A.getEntry1());document.execCommand("copy")}var E=c.genIcon("copy","sw")+" "+f("copy"),F=c.genIcon("paste","sw")+" "+f("paste");A=new d("vpl_dialog_vnc_clipboard",E,m,F,h,l);y.on("click",function(a){if(a.target==y[0]){k()}else{l()}});this.displayResize=function(){if(q.isConnected()){var a=x.width(),b=x.height();q.setCanvasSize(a,b);r.get_display().viewportChange(0,0,a,b)}};function n(){var b=a("html").width(),c=a(window).height();if(x.width()>b){B=!0;x.dialog("option","width",b)}if(x.parent().height()>c){B=!0;x.dialog("option","height",c-x.prev().outerHeight())}}x.dialog({closeOnEscape:!1,autoOpen:!1,modal:!0,width:"auto",height:"auto",dialogClass:"vpl_ide vpl_vnc",create:function create(){C=c.setTitleBar(x,"vnc","graphic",["clipboard","keyboard"],[j,g])},dragStop:n,focus:k,open:n,beforeClose:function beforeClose(){if(B){var a=x.width(),b=x.height();B=!1;q.setCanvasSize(a,b)}},close:function close(){q.disconnect()},resizeStop:function resizeStop(){n();B=!0}});x.css("padding","1px");x.parent().css("z-index",2e3);this.updateTitle=function(){var a=s;if(""!==u){a+=" ("+u+")"}C.text(f("console")+": "+a)};this.setTitle=function(a){s=a;this.updateTitle()};this.setMessage=function(a){u=a;this.updateTitle()};function o(a,b,c,d){v=b;switch(b){case"normal":q.setMessage("");q.setTitle(f("connected"));break;case"disconnect":case"disconnected":q.setTitle(f("connection_closed"));break;case"failed":q.setTitle(f("connection_fail"));e.log("VNC client: "+d);break;default:q.setMessage("");q.setTitle(f("connecting"));}}this.connect=function(c,d,e,f,g,h){A.setEntry1("");z=h;q.show();var j=a("#"+b+" canvas")[0];if(!r){r=new RFB({target:j,encrypt:c,repeaterID:"",true_color:!0,local_cursor:!0,shared:!1,view_only:!1,onUpdateState:o,onPasswordRequired:null,onClipboard:i});r.set_local_cursor(r.get_display().get_cursor_uri())}if(!e){e=c?443:80}r.connect(d,e,f,g)};this.isOpen=function(){return x.dialog("isOpen")};this.close=function(){x.dialog("close")};this.isConnected=function(){return r&&"disconnected"!=v};this.disconnect=function(){if(r){r.disconnect()}z();A.hide()};function p(a){if(100>a){a=100}return 2*Math.floor(a/2)}this.getCanvasSize=function(){return y.width()+"x"+y.height()};this.setCanvasSize=function(a,b){y.width(p(a));y.height(p(b))};this.show=function(){x.dialog("open");x.width("auto");x.height("auto")};q.setCanvasSize(a(window).width()-150,a(window).height()-150)}});
//# sourceMappingURL=vplvnc.min.js.map
