{"version":3,"file":"vplutil.min.js","sources":["../src/vplutil.js"],"sourcesContent":["// This file is part of VPL for Moodle - http://vpl.dis.ulpgc.es/\n//\n// VPL for Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// VPL for Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with VPL for Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Tools for the VPL IDE\n *\n * @copyright 2016 Juan Carlos Rodríguez-del-Pino\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author Juan Carlos Rodríguez-del-Pino <jcrodriguez@dis.ulpgc.es>\n */\n\n/* globals JUnzip */\n/* globals JSInflate */\n/* globals Blockly */\n/* globals ace */\n\n\ndefine(\n    [\n        'jquery',\n        'jqueryui',\n        'core/log',\n    ],\n    function($, jqui, log) {\n        var VPLUtil = {};\n        VPLUtil.doNothing = $.noop;\n        VPLUtil.returnFalse = function() {\n            return false;\n        };\n        VPLUtil.returnTrue = function() {\n            return true;\n        };\n        var debugMode = false;\n        VPLUtil.log = function(m, forced) {\n            if (debugMode || forced) {\n                log.debug(m);\n            }\n        };\n        VPLUtil.setUserPreferences = function(pref) {\n            $.ajax({\n                async: true,\n                type: \"POST\",\n                url: '../editor/userpreferences.json.php',\n                'data': JSON.stringify(pref),\n                contentType: \"application/json; charset=utf-8\",\n                dataType: \"json\"\n            });\n        };\n        VPLUtil.getUserPreferences = function(func) {\n            $.ajax({\n                async: true,\n                type: \"POST\",\n                url: '../editor/userpreferences.json.php',\n                'data': JSON.stringify({getPreferences: true}),\n                contentType: \"application/json; charset=utf-8\",\n                dataType: \"json\"\n            }).done(func);\n        };\n        // Get scrollBarWidth.\n        VPLUtil.scrollBarWidth = function() {\n            var parent, child, width;\n            parent = $('<div style=\"width:50px;height:50px;overflow:auto\"><div/></div>').appendTo('body');\n            child = parent.children();\n            width = child.innerWidth() - child.height(99).innerWidth();\n            parent.remove();\n            return width;\n        };\n        VPLUtil.sanitizeHTML = function(t) {\n            if (typeof t == 'undefined' || t.replace(/^\\s+$/g, '') == '') {\n                return '';\n            }\n            return $('<div>' + t + '</div>').html();\n        };\n        VPLUtil.sanitizeText = function(s) {\n            if (typeof s == 'undefined' || s.replace(/^\\s+$/g, '') == '') {\n                return '';\n            }\n            return s.replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\n        };\n\n        VPLUtil.setProtocol = function(coninfo) {\n            var secure;\n            if (coninfo.securePort == 0 || coninfo.port == 0) {\n                secure = coninfo.port == 0;\n            } else {\n                switch (coninfo.wsProtocol) {\n                    case 'always_use_wss':\n                        secure = true;\n                        break;\n                    case 'always_use_ws':\n                        secure = false;\n                        break;\n                    default:\n                        secure = window.location.protocol == 'https:';\n                }\n            }\n            var URLBase = (secure ? 'wss://' : 'ws://') + coninfo.server;\n            coninfo.secure = secure;\n            coninfo.portToUse = secure ? coninfo.securePort : coninfo.port;\n            URLBase += ':' + coninfo.portToUse + '/';\n            coninfo.monitorURL = URLBase + coninfo.monitorPath;\n            coninfo.executionURL = URLBase + coninfo.executionPath;\n        };\n        VPLUtil.ArrayBuffer2String = function(data) {\n            var view = new Uint8Array(data);\n            var chunks = [];\n            var chunkSize = 32000;\n            var i, len;\n            for (i = 0, len = view.length; i < len; i += chunkSize) {\n                chunks.push(String.fromCharCode.apply(String, view.subarray(i, Math.min(i + chunkSize, len))));\n            }\n            return chunks.join('');\n        };\n        VPLUtil.String2ArrayBuffer = function(data) {\n            var len = data.length;\n            var ret = new ArrayBuffer(len);\n            var u8 = new Uint8Array(ret);\n            for (var i = 0; i < len; i++) {\n                u8[i] = data.charCodeAt(i);\n            }\n            return ret;\n        };\n\n        (function() {\n            var fileUniqueId = 0;\n            VPLUtil.getUniqueId = function() {\n                return fileUniqueId++;\n            };\n        })();\n        (function() {\n            var regExt = /\\.([^.]*)$/;\n            var regImg = /^(gif|jpg|jpeg|png|ico)$/i;\n            var regBin = /^(zip|jar|pdf|tar|bin|7z|arj|deb|gzip|rar|rpm|dat|db|dll|rtf|doc|docx|odt|exe|com)$/i;\n            var regBlk = /^blockly[0123]?$/;\n            VPLUtil.fileExtension = function(fileName) {\n                var res = regExt.exec(fileName);\n                return res !== null ? res[1] : '';\n            };\n            VPLUtil.isImage = function(fileName) {\n                return regImg.test(VPLUtil.fileExtension(fileName));\n            };\n            VPLUtil.isBinary = function(fileName) {\n                return VPLUtil.isImage(fileName) || regBin.test(VPLUtil.fileExtension(fileName));\n            };\n            VPLUtil.isBlockly = function(fileName) {\n                return regBlk.test(VPLUtil.fileExtension(fileName));\n            };\n            var regInvalidFileName = /[\\cA-\\cZ]|[:-@]|[{-~]|\\\\|\\[|\\]|[/^`´]|^-|^ | $|\\.\\./;\n            VPLUtil.validFileName = function(fileName) {\n                if (fileName.length < 1) {\n                    return false;\n                }\n                if (fileName.length > 128) {\n                    return false;\n                }\n                return !(regInvalidFileName.test(fileName));\n            };\n        })();\n        VPLUtil.getCurrentTime = function() {\n            return parseInt((new Date()).valueOf() / 1000);\n        };\n        VPLUtil.encodeBinary = function(name, data) {\n            if (!VPLUtil.isBinary(name)) {\n                return btoa(unescape(encodeURIComponent(data)));\n            }\n            return btoa(VPLUtil.ArrayBuffer2String(data));\n        };\n\n        VPLUtil.decodeBinary = function(name, data) {\n            var decoded = atob(data);\n            if (!VPLUtil.isBinary(name)) {\n                return decodeURIComponent(escape(decoded));\n            }\n            return VPLUtil.String2ArrayBuffer(decoded);\n        };\n\n        VPLUtil.validPath = function(path) {\n            if (path.length > 256) {\n                return false;\n            }\n            var dirs = path.split(\"/\");\n            for (var i = 0; i < dirs.length; i++) {\n                if (!VPLUtil.validFileName(dirs[i])) {\n                    return false;\n                }\n            }\n            return true;\n        };\n        VPLUtil.getFileName = function(path) {\n            var dirs = path.split(\"/\");\n            return dirs[dirs.length - 1];\n        };\n        VPLUtil.dataFromURLData = function(data) {\n            return data.substr(data.indexOf(',') + 1);\n        };\n        VPLUtil.readZipFile = function(data, save, progressBar, end) {\n            if (!end) {\n                end = VPLUtil.doNothing;\n            }\n            if (typeof JUnzip == 'undefined') {\n                VPLUtil.loadScript(['../editor/zip/inflate.js',\n                    '../editor/zip/unzip.js']\n                , function() {\n                    VPLUtil.readZipFile(data, save, progressBar, end);\n                });\n                return;\n            }\n            var ab = VPLUtil.ArrayBuffer2String(data);\n            var unzipper = new JUnzip(ab);\n            if (!unzipper.isZipFile()) {\n                VPLUtil.log('Not a ZIP file');\n                end();\n                return;\n            }\n            unzipper.readEntries();\n            var out = unzipper.entries.length;\n            /**\n             * Process each entry in the zip file.\n             * Recursive process.\n             * @param {int} i Entry to process.\n             */\n            function process(i) {\n                if (i >= out || progressBar.isClosed()) {\n                    end();\n                    return;\n                }\n                var entry = unzipper.entries[i];\n                var fileName = entry.fileName;\n                var data;\n                // Is directory entry then skip.\n                if (fileName.match(/\\/$/)) {\n                    process(i + 1);\n                } else {\n                    progressBar.processFile(fileName);\n                    var uncompressed = '';\n                    if (entry.compressionMethod === 0) {\n                        // Plain file.\n                        uncompressed = entry.data;\n                    } else if (entry.compressionMethod === 8) {\n                        uncompressed = JSInflate.inflate(entry.data);\n                    }\n                    if (VPLUtil.isBinary(fileName)) {\n                        // If binary use as arrayBuffer.\n                        save({name: fileName, contents: btoa(uncompressed), encoding: 1});\n                        // TODO Show message when error.\n                        process(i + 1);\n                    } else {\n                        data = VPLUtil.String2ArrayBuffer(uncompressed);\n                        var blob = new Blob([data], {\n                            type: 'text/plain'\n                        });\n                        var fr = new FileReader();\n                        fr.onload = function(e) {\n                            save({name: fileName, contents: e.target.result, encoding: 0});\n                            process(i + 1);\n                        };\n                        fr.onerror = function(e) {\n                            VPLUtil.log(e);\n                            i = out;\n                            process(i + 1);\n                            // TODO Show message when error.\n                        };\n                        fr.readAsText(blob);\n                    }\n                }\n            }\n            process(0);\n        };\n\n        VPLUtil.readSelectedFiles = function(filesToRead, save, end) {\n            // Process all File objects.\n            var pb = new VPLUtil.progressBar('import', 'import');\n            var errorsMessages = '';\n            if (!end) {\n                end = VPLUtil.doNothing;\n            }\n            pb.processFile = function(name) {\n                pb.setLabel(name);\n            };\n            /**\n             * Read each file in filesToReas\n             * Recursive process.\n             * @param {int} sec secuencial file to read\n             */\n            function readSecuencial(sec) {\n                if (sec >= filesToRead.length || pb.isClosed()) {\n                    end();\n                    pb.close();\n                    if (errorsMessages > '') {\n                        VPLUtil.showErrorMessage(errorsMessages);\n                    }\n                    return;\n                }\n                var f = filesToRead[sec];\n                pb.processFile(f.name);\n                var binary = VPLUtil.isBinary(f.name);\n                var reader = new FileReader();\n                var ext = VPLUtil.fileExtension(f.name).toLowerCase();\n                reader.onload = function(e) {\n                    if (binary) {\n                        if (ext == 'zip') {\n                            try {\n                                VPLUtil.readZipFile(e.target.result, save, pb, function() {\n                                                                                  readSecuencial(sec + 1);\n                                                                               });\n                                return;\n                            } catch (ex) {\n                                VPLUtil.showErrorMessage(ex + \" : \" + f.name);\n                            }\n                        } else {\n                            var data = VPLUtil.dataFromURLData(e.target.result);\n                            save({name: f.name, contents: data, encoding: 1});\n                        }\n                    } else {\n                        save({name: f.name, contents: e.target.result, encoding: 0});\n                    }\n                    readSecuencial(sec + 1);\n                };\n                reader.onerror = function(e) {\n                    errorsMessages += \"Error \\\"\" + e.target.error + \"\\\" reading \" + f.name + \"\\n\";\n                    readSecuencial(sec + 1);\n                };\n                if (binary) {\n                    if (ext == 'zip') {\n                        reader.readAsArrayBuffer(f);\n                    } else {\n                        reader.readAsDataURL(f);\n                    }\n                } else {\n                    reader.readAsText(f);\n                }\n            }\n            readSecuencial(0);\n        };\n        (function() {\n            var MIME = {\n                'gif': 'image/gif',\n                'jpg': 'image/jpeg',\n                'jpeg': 'image/jpeg',\n                'png': 'image/png',\n                'ico': 'image/vnd.microsoft.icon',\n                'pdf': 'application/pdf'\n            };\n            VPLUtil.getMIME = function(fileName) {\n                var ext = VPLUtil.fileExtension(fileName);\n                if (ext in MIME) {\n                    return MIME[ext];\n                }\n                return 'application/octet-stream';\n            };\n            VPLUtil.getTimeLeft = function(timeLeft) {\n                var res = '';\n                var minute = 60;\n                var hour = 60 * minute;\n                var day = 24 * hour;\n                if (timeLeft < 0) {\n                    res += '-';\n                    timeLeft = -timeLeft;\n                }\n                var timePending = timeLeft;\n                var days = parseInt(timePending / day);\n                timePending -= days * day;\n                if (days !== 0) {\n                    res += days + 'T';\n                }\n                var hours = parseInt(timePending / hour);\n                timePending -= hours * hour;\n                var minutes = parseInt(timePending / minute);\n                timePending -= minutes * minute;\n                var seconds = parseInt(timePending);\n                res += ('00' + hours).substr(-2) + ':';\n                res += ('00' + minutes).substr(-2);\n                if (timeLeft < hour) {\n                    res += ':' + ('00' + seconds).substr(-2);\n                }\n                return res;\n            };\n        })();\n        (function() {\n            var maplang = {\n                'abap': 'abap',\n                'abc': 'abc',\n                'ada': 'ada', 'ads': 'ada', 'adb': 'ada',\n                'as': 'actionscript', 'as3': 'actionscript',\n                'asm': 'assembly_x86',\n                'bash': 'sh',\n                'bat': 'batchfile',\n                'c': 'c_cpp', 'C': 'c_cpp', 'cc': 'c_cpp', 'cpp': 'c_cpp', 'c++': 'c_cpp',\n                'hxx': 'c_cpp', 'h': 'c_cpp', 'H': 'c_cpp',\n                'cases': 'cases',\n                'cbl': 'cobol', 'cob': 'cobol',\n                'coffee': 'coffee',\n                'clj': 'clojure',\n                'cs': 'csharp',\n                'css': 'css',\n                'd': 'd',\n                'dart': 'dart',\n                'e': 'eiffel',\n                'erl': 'erlang', 'hrl': 'erlang',\n                'f': 'fortran', 'f77': 'fortran', 'f90': 'fortran', 'for': 'fortran',\n                'go': 'golang',\n                'groovy': 'groovy',\n                'gv': 'dot',\n                'hs': 'haskell',\n                'htm': 'html', 'html': 'html',\n                'hx': 'haxe',\n                'java': 'java',\n                'jl': 'julia',\n                'js': 'javascript',\n                'json': 'json',\n                'jsp': 'jsp',\n                'jsx': 'jsx',\n                'kt': 'kotlin', 'kts': 'kotlin',\n                'm': 'matlab',\n                'md': 'markdown',\n                'less': 'less',\n                'lisp': 'lisp', 'lsp': 'lisp',\n                'lua': 'lua',\n                'pas': 'pascal', 'p': 'pascal',\n                'perl': 'perl', 'prl': 'perl',\n                'php': 'php',\n                'pro': 'prolog', 'pl': 'prolog',\n                'py': 'python',\n                'R': 'r', 'r': 'r',\n                'rb': 'ruby', 'ruby': 'ruby',\n                's': 'assembly_x86',\n                'sass': 'sass',\n                'scala': 'scala',\n                'scm': 'scheme',\n                'scss': 'scss',\n                'sh': 'sh',\n                'swift': 'swift',\n                'sql': 'sql',\n                'svg': 'svg',\n                'tex': 'tex',\n                'tcl': 'tcl',\n                'ts': 'typescript',\n                'twig': 'twig',\n                'vbs': 'vbscript',\n                'v': 'verilog', 'vh': 'verilog',\n                'vhd': 'vhdl', 'vhdl': 'vhdl',\n                'xml': 'xml',\n                'yaml': 'yaml'\n            };\n            VPLUtil.langType = function(ext) {\n                if (ext in maplang) {\n                    return maplang[ext];\n                }\n                return 'plain_text';\n            };\n        })();\n        (function() {\n            var i18n = {};\n            var strreg = /\\{\\\\*\\$a\\\\*}/g;\n            VPLUtil.str = function(key, parm) {\n                if (!i18n[key]) {\n                    return '{' + key + '}';\n                }\n                if (typeof parm != 'undefined') {\n                    return i18n[key].replace(strreg, parm);\n                } else {\n                    return i18n[key];\n                }\n            };\n            VPLUtil.setStr = function(newi18n) {\n                for (var key in newi18n) {\n                    if (newi18n.hasOwnProperty(key)) {\n                        i18n[key] = newi18n[key];\n                    }\n                }\n                VPLUtil.dialogbaseOptions = {\n                    minWidth: 200,\n                    autoOpen: false,\n                    width: 'auto',\n                    closeText: VPLUtil.str('cancel'),\n                    modal: true,\n                    dialogClass: 'vpl_ide vpl_ide_dialog'\n                };\n            };\n            VPLUtil.setStr(window.VPLi18n);\n        })();\n        (function() {\n            var delayedActions = {};\n            var afterAllActions = {};\n            var shortTimeout = 20;\n            var longTimeout = 100;\n            var numberDelayed = 0;\n            VPLUtil.delay = function(id, func, arg1, arg2) {\n                if (typeof delayedActions[id] != 'undefined') {\n                    clearTimeout(delayedActions[id]);\n                    numberDelayed--;\n                }\n                numberDelayed++;\n                delayedActions[id] = setTimeout(function() {\n                    numberDelayed--;\n                    func(arg1, arg2);\n                    delete delayedActions[id];\n                }, shortTimeout);\n            };\n            VPLUtil.longDelay = function(id, func, arg1, arg2) {\n                if (typeof delayedActions[id] != 'undefined') {\n                    clearTimeout(delayedActions[id]);\n                    numberDelayed--;\n                }\n                numberDelayed++;\n                delayedActions[id] = setTimeout(function() {\n                    numberDelayed--;\n                    func(arg1, arg2);\n                    delete delayedActions[id];\n                }, longTimeout);\n            };\n            var setAfterTimeout = function(id, func, arg1, arg2) {\n                if (typeof afterAllActions[id] != 'undefined') {\n                    clearTimeout(afterAllActions[id]);\n                }\n                return setTimeout(function() {\n                        if (numberDelayed > 0) {\n                            afterAllActions[id] = setAfterTimeout(id, func, arg1, arg2);\n                        } else {\n                             func(arg1, arg2);\n                             delete afterAllActions[id];\n                        }\n                    }, longTimeout);\n            };\n            VPLUtil.afterAll = function(id, func, arg1, arg2) {\n                afterAllActions[id] = setAfterTimeout(id, func, arg1, arg2);\n            };\n        })();\n        VPLUtil.iconModified = function() {\n            var html = '<span title=\"' + VPLUtil.str('modified') + '\" class=\"vpl_ide_charicon\">';\n            html += '<i class=\"fa fa-star\"></i>' + '</span> ';\n            return html;\n        };\n        VPLUtil.iconDelete = function() {\n            var html = ' <span title=\"' + VPLUtil.str('delete') + '\" class=\"vpl_ide_charicon vpl_ide_delicon\">';\n            html += '<i class=\"fa fa-trash\"></i>' + '</span> ';\n            return html;\n        };\n        VPLUtil.iconClose = function() {\n            var html = ' <span title=\"' + VPLUtil.str('closebuttontitle');\n            html += '\" class=\"vpl_ide_charicon vpl_ide_closeicon\">' + '<i class=\"fa fa-remove\"></i>' + '</span> ';\n            return html;\n        };\n        VPLUtil.iconRequired = function() {\n            var html = ' <span title=\"' + VPLUtil.str('required') + '\" class=\"vpl_ide_charicon\">';\n            html += '<i class=\"fa fa-shield\"></i>' + '</span> ';\n            return html;\n        };\n        VPLUtil.iconFolder = function() {\n            return '<i class=\"fa fa-folder-open-o\"></i>';\n        };\n        (function() {\n            var menuIcons = {\n                'filelist': 'folder-open-o',\n                'filelistclose': 'folder-o',\n                'new': 'file-code-o',\n                'rename': 'pencil',\n                'delete': 'trash',\n                'multidelete': 'trash|list',\n                'close': 'remove',\n                'comments': 'commenting',\n                'import': 'upload',\n                'print': 'print',\n                'edit': 'edit',\n                'undo': 'undo',\n                'redo': 'repeat',\n                'select_all': 'location-arrow',\n                'find': 'search',\n                'find_replace': 'exchange',\n                'next': 'search-plus',\n                'resetfiles': 'refresh',\n                'download': 'download',\n                'fullscreen': 'expand',\n                'regularscreen': 'compress',\n                'save': 'save',\n                'shortcuts': 'flash',\n                'sort': 'list-ol',\n                'run': 'rocket',\n                'running': 'rocket fa-spin',\n                'debug': 'bug',\n                'evaluate': 'check-square-o',\n                'console': 'terminal',\n                'about': 'question',\n                'info': 'info-circle',\n                'alert': 'warning',\n                'trash': 'trash',\n                'retrieve': 'download',\n                'spinner': 'refresh fa-spin',\n                'keyboard': 'keyboard-o',\n                'clipboard': 'clipboard',\n                'timeleft': 'clock-o',\n                'copy': 'copy',\n                'paste': 'paste',\n                'more': 'plus-square',\n                'less': 'minus-square',\n                'resize': 'arrows-alt',\n                'graphic': 'picture-o',\n                'send': 'send',\n                'theme':  'paint-brush',\n                'user': 'user',\n                'fontsize': 'text-height',\n                'close-rightpanel': 'caret-square-o-right',\n                'open-rightpanel': 'caret-square-o-left'\n            };\n            VPLUtil.genIcon = function(icon, size) {\n                if (!menuIcons[icon]) {\n                    return '';\n                }\n                var classes = 'fa fa-';\n                if (!size) {\n                    classes += 'lg';\n                } else {\n                    classes += size;\n                }\n                var icons = menuIcons[icon].split('|');\n                var ret = '';\n                for (var i = 0; i < icons.length; i++) {\n                    ret += \"<i class='\" + classes + ' fa-' + icons[i] + \"'></i>\";\n                }\n                return ret;\n            };\n        })();\n        // UI operations.\n        VPLUtil.setTitleBar = function(dialog, type, icon, buttons, handler) {\n            var title = $(dialog).parent().find(\"span.ui-dialog-title\");\n            /**\n             * Generate HTML for a button with icon\n             * @param {string} e name of botton.\n             * @returns {string} Html tag <a> as a button.\n             */\n            function genButton(e) {\n                var html = \"<a id='vpl_\" + type + \"_\" + e + \"' href='#' title='\" + VPLUtil.str(e) + \"'>\";\n                html += VPLUtil.genIcon(e, 'fw') + \"</a>\";\n                return html;\n            }\n            var html = VPLUtil.genIcon(icon);\n            html += \" <span class='\" + type + \"-title-buttons'></span>\";\n            html += \"<span class='\" + type + \"-title-text'></span>\";\n            title.html(html);\n            var titleButtons = title.find(\"span.\" + type + \"-title-buttons\");\n            var titleText = title.find(\"span.\" + type + \"-title-text\");\n            html = \"\";\n            for (var i = 0; i < buttons.length; i++) {\n                html += genButton(buttons[i]);\n            }\n            titleButtons.html(html);\n            for (var ih = 0; ih < handler.length; ih++) {\n                var button = title.find('#vpl_' + type + '_' + buttons[ih]);\n                button.button().click(handler[ih]);\n                button.css('padding', '1px 3px');\n            }\n            titleButtons.on('focus', '*', function() {\n                                              $(this).blur();\n                                          });\n            return titleText;\n        };\n        VPLUtil.setDialogTitleIcon = function(dialog, icon) {\n            var title = $(dialog).parent().find(\"span.ui-dialog-title\");\n            title.html(VPLUtil.genIcon(icon) + ' ' + title.html());\n        };\n        VPLUtil.progressBar = function(title, message, onUserClose) {\n            var labelHTML = '<span class=\"vpl_ide_progressbarlabel\"></span>';\n            var sppiner = '<div class=\"vpl_ide_progressbaricon\">' + VPLUtil.genIcon('spinner') + '</div>';\n            var pbHTML = ' <div class=\"vpl_ide_progressbar\">' + sppiner + labelHTML + '</div>';\n            var HTML = '<div class=\"vpl_ide_dialog\" style=\"display:none;\">' + pbHTML + '</div>';\n            var dialog = $(HTML);\n            $('body').append(dialog);\n            var progressbar = dialog.find('.vpl_ide_progressbar');\n            var label = progressbar.find('.vpl_ide_progressbarlabel');\n            dialog.dialog({\n                'title': VPLUtil.str(title),\n                resizable: false,\n                autoOpen: false,\n                width: 200,\n                height: 20,\n                minHeight: 20,\n                modal: true,\n                dialogClass: 'vpl_ide vpl_ide_dialog',\n                close: function(event) {\n                    if (dialog) {\n                        if (onUserClose && event.originalEvent) {\n                            onUserClose();\n                        }\n                        onUserClose = false;\n                    }\n                }\n            });\n            this.setLabel = function(t, icon) {\n                if (dialog) {\n                    label.text(t);\n                    if (icon) {\n                        label.html(VPLUtil.genIcon(icon) + ' ' + label.html());\n                    }\n                }\n            };\n            this.close = function() {\n                if (dialog) {\n                    dialog.dialog('destroy');\n                    $(dialog).remove();\n                    dialog = false;\n                }\n            };\n            this.isClosed = function() {\n                return dialog === false;\n            };\n            var titleTag = dialog.siblings().find('.ui-dialog-title');\n            titleTag.html(VPLUtil.genIcon(title) + ' ' + titleTag.html());\n            this.setLabel(VPLUtil.str(message));\n            dialog.dialog('open');\n            dialog.dialog('option', 'height', 'auto');\n        };\n        /**\n         * Shows a dialog with a message.\n         * @param {string} message\n         * @param {Object} initialoptions icon, title, actions handler (ok, yes, no, close)\n         * @returns {JQuery} JQueryUI Dialog object already open\n         */\n        VPLUtil.showMessage = function(message, initialoptions) {\n            var options = $.extend({}, VPLUtil.dialogbaseOptions, initialoptions);\n            var messageDialog = $('<div class=\"vpl_ide_dialog\" style=\"display:none\"></div>');\n            var icon = '';\n            var contents = ' <span class=\"dmessage\">' + message.replace(/\\n/g, '<br>') + '</span>';\n            messageDialog.html(contents);\n            if (typeof options.icon == 'undefined') {\n                icon = 'info';\n            } else {\n                icon = options.icon;\n                delete options.icon;\n            }\n            if (!options.title) {\n                options.title = VPLUtil.str('warning');\n            }\n            $('body').append(messageDialog);\n            var messageButtons = {};\n            if (typeof initialoptions.ok == 'function') {\n                messageButtons[VPLUtil.str('ok')] = function() {\n                    $(this).dialog('close');\n                    initialoptions.ok();\n                };\n                messageButtons[VPLUtil.str('cancel')] = function() {\n                    $(this).dialog('close');\n                };\n                delete options.ok;\n            } else if (typeof initialoptions.yes == 'function') {\n                messageButtons[VPLUtil.str('yes')] = function() {\n                    $(this).dialog('close');\n                    initialoptions.yes();\n                };\n                messageButtons[VPLUtil.str('no')] = function() {\n                    $(this).dialog('close');\n                };\n                delete options.yes;\n            } else {\n                messageButtons[VPLUtil.str('close')] = function() {\n                    $(this).dialog('close');\n                };\n            }\n            if (options.next) {\n                messageButtons[VPLUtil.str('next')] = function() {\n                    $(this).dialog('close');\n                    initialoptions.next();\n                };\n            }\n            options.close = function() {\n                    $(this).remove();\n                    if (initialoptions.close) {\n                        initialoptions.close();\n                    }\n            };\n            options.buttons = messageButtons;\n\n            messageDialog.dialog(options);\n            var titleTag = messageDialog.siblings().find('.ui-dialog-title');\n            titleTag.html(VPLUtil.genIcon(icon) + ' ' + titleTag.html());\n\n            messageDialog.setMessage = function(men) {\n                $(messageDialog).find('.dmessage').html(men.replace(/\\n/g, '<br>'));\n            };\n\n            messageDialog.dialog('open');\n            return messageDialog;\n        };\n        VPLUtil.showErrorMessage = function(message, options) {\n            var currentOptions = $.extend({}, VPLUtil.dialogbaseOptions, {\n                title: VPLUtil.str('error'),\n                icon: 'alert'\n            });\n            if (options) {\n                currentOptions = $.extend(currentOptions, options);\n            }\n            return VPLUtil.showMessage(message, currentOptions);\n        };\n        /**\n         * Request an action to de server: save, run, debug, evaluate, update, getresult, etc.\n         * @param {string} action Name of action to request.\n         * @param {string} title The title that shows the progress dialog\n         * @param {object} data Data to send to the server\n         * @param {string} URL URL to the server entry point, lacking action\n         * @param {boolean} noDialog If true then no dialog is shown\n         * @returns {deferred} Defferred object\n         */\n        VPLUtil.requestAction = function(action, title, data, URL, noDialog) {\n            var deferred = $.Deferred();\n            var request = null;\n            var xhr = false;\n            var apb = false;\n            if (!noDialog) {\n                if (title === '') {\n                    title = 'connecting';\n                }\n                apb = new VPLUtil.progressBar(action, title, function() {\n                    if (request.readyState != 4) {\n                        if (xhr && xhr.abort) {\n                            xhr.abort();\n                        }\n                    }\n                });\n            }\n            request = $.ajax({\n                beforeSend: function(jqXHR) {\n                    xhr = jqXHR;\n                    return true;\n                },\n                async: true,\n                type: \"POST\",\n                url: URL + action,\n                'data': JSON.stringify(data),\n                contentType: \"application/json; charset=utf-8\",\n                dataType: \"json\"\n            }).always(function() {\n                if (!noDialog) {\n                    apb.close();\n                }\n            }).done(function(response) {\n                if (!response.success) {\n                    deferred.reject(response.error);\n                } else {\n                    deferred.resolve(response.response);\n                }\n            }).fail(function(jqXHR, textStatus, errorThrown) {\n                var message = VPLUtil.str('connection_fail') + ': ' + textStatus;\n                if (debugMode && errorThrown.message != undefined) {\n                    message += ': ' + errorThrown.message;\n                }\n                VPLUtil.log(message);\n                deferred.reject(message);\n            });\n            return deferred;\n        };\n        VPLUtil.supportWebSocket = function() {\n            if (\"WebSocket\" in window) {\n                return true;\n            }\n            return false;\n        };\n        VPLUtil.isAndroid = function() {\n            return window.navigator.userAgent.indexOf('Android') > -1;\n        };\n        VPLUtil.isFirefox = function() {\n            return window.navigator.userAgent.indexOf('Firefox') > -1;\n        };\n        VPLUtil.isMac = function() {\n            return window.navigator.userAgent.indexOf('Mac') > -1;\n        };\n        VPLUtil.clickServer = function(e) {\n            var w = 550;\n            var h = 450;\n            var left = (screen.width / 2) - (w / 2);\n            var top = (screen.height / 2) - (h / 2);\n            try {\n                var features = 'toolbar=no, location=no, directories=no, status=no, menubar=no';\n                features += ', resizable=yes, scrollbars=yes, copyhistory=no, width=' + w;\n                features += ', height=' + h + ', top=' + top + ', left=' + left;\n                var win = window.open($(this).attr('href'), '_blank', features);\n                if (!win) {\n                    return true;\n                }\n            } catch (ex) {\n                VPLUtil.log(ex);\n                return true;\n            }\n            e.preventDefault();\n            $(this).parent().hide();\n            return false;\n        };\n\n        VPLUtil.acceptCertificates = function(servers, getLastAction) {\n            if (servers.length > 0) {\n                // Generate links dialog.\n                var html = VPLUtil.str('acceptcertificatesnote');\n                html += '<ol>';\n                var i;\n                for (i in servers) {\n                    if (servers.hasOwnProperty(i)) {\n                        var n = 1 + i;\n                        html += '<li><a href=\"' + servers[i] + '\" target=\"_blank\">Server ';\n                        html += n + '</a></li>';\n                    }\n                }\n                html += '</ol>';\n                var m = VPLUtil.showMessage(html, {\n                    ok: function() {\n                        var action = getLastAction();\n                        if (action) {\n                            action();\n                        }\n                    },\n                    icon: 'unlocked',\n                    title: VPLUtil.str('acceptcertificates')\n                });\n                $(m).find('a').on('click keypress', VPLUtil.clickServer);\n            } else {\n                VPLUtil.log('servers.length == 0');\n                VPLUtil.showErrorMessage(VPLUtil.str('connection_fail'));\n            }\n        };\n        VPLUtil.monitorRunning = VPLUtil.returnFalse;\n        (function() {\n            var lastProccessID = -1;\n            VPLUtil.setProcessId = function(id) {\n                lastProccessID = id;\n            };\n            VPLUtil.getProcessId = function() {\n                return lastProccessID;\n            };\n        })();\n        VPLUtil.webSocketMonitor = function(coninfo, title, running, externalActions) {\n            VPLUtil.setProtocol(coninfo);\n            VPLUtil.setProcessId(coninfo.processid);\n            var ws = null;\n            var pb = null;\n            var deferred = $.Deferred();\n            var defail = function(m) {\n                deferred.reject(m);\n            };\n            var delegated = false;\n            var messageActions = {\n                'message': function(content) {\n                    var parsed = /^([^:]*):?([^]*)/.exec(content);\n                    var state = parsed[1];\n                    var detail = parsed[2];\n                    if (state == 'running') {\n                        state = running;\n                    }\n                    var text = VPLUtil.str(state);\n                    if (detail > '') {\n                        text += ': ' + detail;\n                    }\n                    if (pb !== null && !pb.isClosed()) {\n                        pb.setLabel(text);\n                    } else if (externalActions.getConsole && externalActions.getConsole().isOpen()) {\n                        externalActions.getConsole().setMessage(text);\n                    } else {\n                        VPLUtil.log('Error: no dialogo. Message not shown: ' + text);\n                    }\n                },\n                'compilation': function(content) {\n                    if (externalActions.setResult) {\n                        externalActions.setResult({\n                            'compilation': content,\n                        }, false);\n                    }\n                },\n                'retrieve': function() {\n                    var data = {\"processid\": VPLUtil.getProcessId()};\n                    pb.close();\n                    delegated = true;\n                    VPLUtil.requestAction('retrieve', '', data, externalActions.ajaxurl)\n                    .done(\n                        function(response) {\n                            deferred.resolve();\n                            if (externalActions.setResult) {\n                                externalActions.setResult(response, true);\n                            }\n                        }\n                   ).fail(defail);\n                },\n                'run': function(content) {\n                    pb.close();\n                    externalActions.run(content, coninfo, ws);\n                },\n                'close': function() {\n                    VPLUtil.log('ws close message from jail');\n                    ws.close();\n                    var data = {\"processid\": VPLUtil.getProcessId()};\n                    VPLUtil.requestAction('cancel', '', data, externalActions.ajaxurl, true);\n                }\n            };\n            try {\n                if (VPLUtil.supportWebSocket()) {\n                    ws = new WebSocket(coninfo.monitorURL);\n                } else {\n                    VPLUtil.log('ws not available');\n                    deferred.reject(VPLUtil.str('browserupdate'));\n                    return deferred;\n                }\n            } catch (e) {\n                VPLUtil.log('ws new say ' + e);\n                deferred.reject(e.message);\n                return deferred;\n            }\n            pb = new VPLUtil.progressBar(title, 'connecting', function() {\n                deferred.reject('Stopped by user');\n                ws.close();\n            });\n            ws.notOpen = true;\n            ws.onopen = function() {\n                ws.notOpen = false;\n                pb.setLabel(VPLUtil.str('connected'));\n                if (externalActions.open) {\n                    externalActions.open();\n                }\n            };\n            ws.onerror = function(event) {\n                VPLUtil.log('ws error ' + event);\n                pb.close();\n                if (coninfo.secure && ws.notOpen) {\n                    VPLUtil.requestAction('getjails', 'retrieve', {}, externalActions.ajaxurl)\n                    .done(function(response) {\n                        VPLUtil.acceptCertificates(response.servers, function() {\n                            return externalActions.getLastAction();\n                        });\n                    })\n                    .fail(defail);\n                } else {\n                    deferred.reject(VPLUtil.str('connection_fail'));\n                }\n                if (externalActions.close) {\n                    VPLUtil.delay('externalActions.close', externalActions.close);\n                }\n            };\n            ws.onclose = function() {\n                if (externalActions.getConsole) {\n                    externalActions.getConsole().disconnect();\n                }\n                if (!ws.notOpen) {\n                    pb.close();\n                    if (!delegated && deferred.state() != 'rejected') {\n                        deferred.resolve();\n                    }\n                }\n                if (externalActions.close) {\n                    externalActions.close();\n                }\n            };\n\n            ws.onmessage = function(event) {\n                var message = /^([^:]+):([^]*)/.exec(event.data);\n                if (message !== null) {\n                    var action = message[1];\n                    var content = message[2];\n                    if (messageActions[action]) {\n                        messageActions[action](content);\n                    }\n                } else {\n                    pb.setLabel(VPLUtil.str('error') + ': ' + event.data);\n                }\n            };\n            VPLUtil.monitorRunning = function() {\n                return ws !== null && ws.readyState != WebSocket.CLOSED;\n            };\n            return deferred;\n        };\n\n        /**\n         * Run a command in a execution server with input/output using a WebSocket\n         * @param {string} URL to VPL editor services in Moodle server\n         * @param {string} command Command to run in execution server\n         * @param {array.<{name: string, contents: string, encoding: number}>} files\n         *         array of objects name, contents and encoding 0 => UTF-8, 1 => Base64\n         * @returns {object} deferred.\n         *         Use done() to set handler to receive the WebSocket. Use fail to set error handler.\n         */\n        VPLUtil.directRun = function(URL, command, files) {\n            var deferred = $.Deferred();\n            $.ajax({\n                async: true,\n                type: \"POST\",\n                url: URL + 'directrun',\n                'data': JSON.stringify({\"command\": command, \"files\": files}),\n                contentType: \"application/json; charset=utf-8\",\n                dataType: \"json\"\n            }).done(function(result) {\n                if (!result.success) {\n                    deferred.reject(result.error);\n                } else {\n                    var response = result.response;\n                    VPLUtil.setProtocol(response);\n                    var ws = new WebSocket(response.executionURL);\n                    log.debug('Conecting with:' + response.executionURL);\n                    deferred.resolve({processid: response.processid, homepath: response.homepath, connection: ws});\n                }\n            }).fail(function(jqXHR, textStatus, errorThrown) {\n                var message = 'Connection fail' + ': ' + textStatus;\n                if (errorThrown.message != undefined) {\n                    message += ': ' + errorThrown.message;\n                }\n                log.debug(message);\n                deferred.reject(message);\n            });\n            return deferred;\n        };\n        /**\n         * Function to experiment with Direct run.\n         * Limits: one data send and 10 messages received and 10 minutes connected\n         * @param {string} URL to server\n         * @param {string} command Command to prepare direct run. Execution of command must generate vpl_execution\n         * @param {object} data to send to server\n         */\n         VPLUtil.directRunTest = function(URL, command, data) {\n            var files = [{name: 'a.c', contents: 'int main(){return 0;}', encoding: 0},\n                         {name: 'b.c', contents: 'int f(){return 1;}', encoding: 0}];\n            VPLUtil.directRun(URL, command, files)\n                .done(function(result) {\n                    var mcount = 0;\n                    result.connection.onopen = function() {\n                        log.debug(\"Ws open \" + result.homepath + \" processid \" + result.processid);\n                        if (data != undefined) {\n                            result.connection.send(data);\n                        }\n                        setTimeout(function() { //  Close test if open for more than 10 minutes.\n                            result.connection.close();\n                        }, 60 * 10 * 1000);\n                    };\n                    result.connection.onmessage = function(event) {\n                        log.debug(\"WS Message (\" + ++mcount + \"): \" + event.data);\n                        if (mcount >= 10) {\n                            result.connection.close();\n                        }\n                    };\n                    result.connection.onerror = function(event) {\n                        log.debug(\"WS error: \" + event);\n                    };\n                    result.connection.onclose = function(event) {\n                        log.debug(\"WS close: \" + event.code + \" \" + event.reason);\n                    };\n                })\n                .fail(function(message) {\n                    log.debug(\"Direct run fail. URL: \" + URL + \" command: \" + command + \" message: \" + message);\n                });\n        };\n        VPLUtil.processResult = function(text, filenames, sh, noFormat, folding) {\n            if (typeof text == 'undefined' || text.replace(/^\\s+$/gm, '') == '') {\n                return '';\n            }\n            /**\n             * Adds escape to the text\n             * @param {string} t text to escape\n             * @returns {string} result\n             */\n            function escReg(t) {\n                return t.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/, \"\\\\$&\");\n            }\n            var regtitgra = /\\([-]?[\\d]+[.]?[\\d]*\\)\\s*$/;\n            var regtit = /^-.*/;\n            var regcas = /^\\s*>/;\n            // TODO adds error? use first anotation for icon.\n            var regError = new RegExp('\\\\[err\\\\]|error|' + escReg(VPLUtil.str('error')), 'i');\n            var regWarning = new RegExp('\\\\[warn\\\\]|warning|note|' + escReg(VPLUtil.str('warning')), 'i');\n            var regInformation = new RegExp('\\\\[info\\\\]|information', 'i');\n            var state = '';\n            var html = '';\n            var comment = '';\n            var case_ = '';\n            var lines = text.split(/\\r\\n|\\n|\\r/);\n            var regFiles = [];\n            var lastAnotation = false;\n            var lastAnotationFile = false;\n            var afterTitle = false;\n            /**\n             * Generate attribute href for the editor in sh\n             * @param {int} i Index of sh\n             * @return {strng} href\n             */\n            function getHref(i) {\n                if (typeof sh[i].getTagId === 'undefined') {\n                    return 'href=\"#\" ';\n                } else {\n                    return 'href=\"#' + sh[i].getTagId() + '\" ';\n                }\n            }\n            (function() {\n                for (var i = 0; i < filenames.length; i++) {\n                    var regf = escReg(filenames[i]);\n                    // Filename:N, filename(N), filename N, filename line N, filename on line N.\n                    // N=#|#:#|#,#.\n                    var reg = \"(^| |/)\" + regf + \"( on line | line |:|\\\\()(\\\\d+)(:|,)?(\\\\d+)?(\\\\))?\";\n                    regFiles[i] = new RegExp(reg, 'm');\n                }\n            })();\n            /**\n             * Generate the file links in the comments to point to the files\n             * @param {string} line Line to modify\n             * @param {string} rawline Text to include in annotation\n             * @returns {string} The line modified\n             */\n            function genFileLinks(line, rawline) {\n                var used = false;\n                for (var i = 0; i < regFiles.length; i++) {\n                    var reg = regFiles[i];\n                    var match;\n                    while ((match = reg.exec(line)) !== null) {\n                        var anot = sh[i].getAnnotations();\n                        // Annotation format {row:,column:,raw:,type:error,warning,info;text} .\n                        lastAnotationFile = i;\n                        used = true;\n                        var type;\n                        if (line.search(regError) > -1) {\n                            type = 'error';\n                        } else if (line.search(regWarning) > -1) {\n                            type = 'warning';\n                        } else if (line.search(regInformation) > -1) {\n                            type = 'info';\n                        } else {\n                            type = 'error';\n                        }\n                        lastAnotation = {\n                            'row': (match[3] - 1),\n                            'column': match[5],\n                            'type': type,\n                            'text': rawline,\n                        };\n                        anot.push(lastAnotation);\n                        var fileName = filenames[i];\n                        var href = getHref(i);\n                        var lt = VPLUtil.sanitizeText(fileName);\n                        var data = 'data-file=\"' + fileName + '\" data-line=\"' + match[3] + '\"';\n                        line = line.replace(reg, '$1<a ' + href + ' class=\"vpl_fl\" ' + data + '>' + lt + '$2$3$4$5$6</a>');\n                        sh[i].setAnnotations(anot);\n                    }\n                }\n                if (!used && lastAnotation) {\n                    if (rawline !== '') {\n                        lastAnotation.text += \"\\n\" + rawline;\n                        sh[lastAnotationFile].setAnnotations(sh[lastAnotationFile].getAnnotations());\n                    } else {\n                        lastAnotation = false;\n                    }\n                }\n                return line;\n            }\n            /**\n             * Generates HTML for title line\n             * @param {string} line The line to process\n             * @returns {string} Line in HTML format\n             */\n            function getTitle(line) {\n                lastAnotation = false;\n                line = line.substr(1);\n                var end = regtitgra.exec(line);\n                if (end !== null) {\n                    line = line.substr(0, line.length - end[0].length);\n                }\n                var html = '';\n                if (folding) {\n                    html += '<a href=\"javascript:void(0)\" onclick=\"VPLUtil.showHideDiv(this)\">[+]</a>';\n                }\n                html += '<b class=\"ui-widget-header ui-corner-all\">' + VPLUtil.sanitizeText(line) + '</b><br>';\n                html = genFileLinks(html, line);\n                return html;\n            }\n            /**\n             * Returns comment that has been saved\n             * @returns {string}\n             */\n            function getComment() {\n                lastAnotation = false;\n                var ret = comment;\n                comment = '';\n                return ret;\n            }\n            /**\n             * Adds a new comment in HTML\n             * @param {string} rawline  Comment to add\n             */\n            function addComment(rawline) {\n                var line = VPLUtil.sanitizeText(rawline);\n                comment += genFileLinks(line, rawline) + '<br>';\n            }\n            /**\n             * Adds a new case\n             * @param {*} rawline Text to add\n             */\n            function addCase(rawline) {\n                var line = VPLUtil.sanitizeText(rawline);\n                case_ += genFileLinks(line, rawline) + \"\\n\";\n            }\n            /**\n             * Returns cases saved in HTML\n             * @returns {string}\n             */\n            function getCase() {\n                lastAnotation = false;\n                var ret = case_;\n                case_ = '';\n                return '<pre><i>' + ret + '</i></pre>';\n            }\n\n            for (var i = 0; i < lines.length; i++) {\n                var line = lines[i];\n                if (noFormat) {\n                    html += genFileLinks(VPLUtil.sanitizeText(line), line) + \"\\n\";\n                    continue;\n                }\n                var match = regcas.exec(line);\n                var regcasv = regcas.test(line);\n                if ((match !== null) != regcasv) {\n                    VPLUtil.log('error');\n                }\n                if (regtit.test(line)) {\n                    switch (state) {\n                        case 'comment':\n                            html += getComment();\n                            break;\n                        case 'case':\n                            html += getCase();\n                            break;\n                    }\n                    if (afterTitle) {\n                        html += '</div>';\n                    }\n                    html += getTitle(line);\n                    html += folding ? '<div style=\"display:none\">' : '<div>';\n                    afterTitle = true;\n                    state = '';\n                } else if (regcasv) {\n                    if (state == 'comment') {\n                        html += getComment();\n                    }\n                    addCase(line.substr(match[0].length));\n                    state = 'case';\n                } else {\n                    if (state == 'case') {\n                        html += getCase();\n                    }\n                    addComment(line);\n                    state = 'comment';\n                }\n            }\n            switch (state) {\n                case 'comment':\n                    html += getComment();\n                    break;\n                case 'case':\n                    html += getCase();\n                    break;\n            }\n            if (afterTitle) {\n                html += '</div>';\n            }\n            return html;\n        };\n        (function() {\n            var scriptsLoaded = [];\n            VPLUtil.loadScript = function(scripts, end) {\n                if (scripts.length == 0) {\n                    end();\n                    return;\n                }\n                var scriptURL = scripts[0];\n                if (typeof scriptsLoaded[scriptURL] == 'undefined') {\n                    scripts.shift();\n                    scriptsLoaded[scriptURL] = 1;\n                    var script = document.createElement('script');\n                    script.type = 'text/javascript';\n                    script.src = VPLUtil.options.scriptPath + scriptURL;\n                    script.onload = function() {\n                        scriptsLoaded[scriptURL] = 2;\n                        VPLUtil.loadScript(scripts, end);\n                    };\n                    document.head.appendChild(script);\n                } else if (scriptsLoaded[scriptURL] == 2) {\n                    scripts.shift();\n                    VPLUtil.loadScript(scripts, end);\n                } else {\n                    VPLUtil.log('Error loading js ' + scriptURL + ' ' + scriptsLoaded[scriptURL]);\n                    setTimeout(function() {\n                                  VPLUtil.loadScript(scripts, end);\n                               }, 50);\n                }\n            };\n            VPLUtil.isScriptLoading = function(scriptURL) {\n                if (typeof scriptsLoaded[scriptURL] == 'undefined') {\n                    return false;\n                }\n                return scriptsLoaded[scriptURL] == 1;\n            };\n            VPLUtil.isScriptLoaded = function(scriptURL) {\n                if (typeof scriptsLoaded[scriptURL] == 'undefined') {\n                    return false;\n                }\n                return scriptsLoaded[scriptURL] == 2;\n            };\n        })();\n        VPLUtil.adjustBlockly = function(work, offx, offy) {\n            var blocks = work.getAllBlocks();\n            var miy = 20000;\n            var may = -20000;\n            var mix = 20000;\n            var max = -20000;\n            for (var i = 0; i < blocks.length; i++) {\n                var xy = blocks[i].getRelativeToSurfaceXY();\n                miy = Math.min(miy, xy.y);\n                may = Math.max(may, xy.y);\n                mix = Math.min(mix, xy.x);\n                max = Math.max(max, xy.x);\n            }\n            blocks = work.getTopBlocks();\n            for (var j = 0; j < blocks.length; j++) {\n                blocks[j].moveBy(offx - mix, offy - miy);\n            }\n            return may - miy + 100 + offy;\n        };\n        (function() {\n            var files = [];\n            var results = [];\n            var shs = [];\n            /**\n             * Constructor for submission highlighter\n             * @param {Array} files Files to show highlighted\n             * @param {Array} results Output\n             */\n            function SubmissionHighlighter(files, results) {\n                var self = this;\n                this.files = files;\n                this.results = results;\n                setTimeout(function() {\n                              self.highlight();\n                           }, 10);\n            }\n            SubmissionHighlighter.prototype.highlightBlockly = function(preid) {\n                VPLUtil.loadScript(['../editor/blockly/blockly_compressed.js',\n                    '../editor/blockly/msg/js/en.js',\n                    '../editor/blockly/blocks_compressed.js']\n                , function() {\n                    var tag = $('#' + preid);\n                    var c = tag.html();\n                    $('#' + preid + 'load').remove();\n                    tag.html('');\n                    tag.show();\n                    c = $('<div />').html(c).text().replace(/\\n/g, \"\");\n                    var xml = Blockly.Xml.textToDom(c);\n                    tag.html('').height(300).width(tag.parent().width());\n                    var options = {\n                        toolbox: '',\n                        readOnly: true,\n                        media: '../editor/blockly/media/',\n                    };\n                    var work = Blockly.inject(preid, options);\n                    Blockly.Xml.domToWorkspace(xml, work);\n                    var hg = VPLUtil.adjustBlockly(work, 10, 10);\n                    tag.height(hg);\n                    tag.width('100%');\n                    Blockly.svgResize(work);\n                    Blockly.resizeSvgContents(work);\n                    var h = tag.html();\n                    work.dispose();\n                    tag.html(h);\n                });\n            };\n            SubmissionHighlighter.prototype.highlight = function() {\n                var self = this;\n                var needAce = false;\n                var files = this.files;\n                for (let i = 0; i < files.length; i++) {\n                    let file = files[i];\n                    if (VPLUtil.isBinary(file.fileName) || VPLUtil.isBlockly(file.fileName)) {\n                        continue;\n                    } else {\n                        needAce = true;\n                        break;\n                    }\n                }\n                if (needAce && typeof ace === 'undefined') {\n                    VPLUtil.loadScript(['../editor/ace9/ace.js'],\n                        function() {\n                           self.highlight();\n                        });\n                    return;\n                }\n                var results = this.results;\n                var shFiles = [];\n                var shFileNames = [];\n                for (let i = 0; i < files.length; i++) {\n                    let file = files[i];\n                    let preid = 'code' + file.tagId;\n                    if (VPLUtil.isBlockly(file.fileName)) {\n                        self.highlightBlockly(preid);\n                        continue;\n                    }\n                    var ext = VPLUtil.fileExtension(file.fileName);\n                    var lang = VPLUtil.langType(ext);\n                    $('#' + preid).show();\n                    $('#' + preid + 'load').remove();\n                    var sh = ace.edit(preid);\n                    sh.setTheme('ace/theme/' + file.theme);\n                    sh.getSession().setMode('ace/mode/' + lang);\n                    sh.renderer.setShowGutter(file.showln);\n                    sh.setReadOnly(true);\n                    sh.setHighlightActiveLine(false);\n                    sh.setAutoScrollEditorIntoView(true);\n                    sh.setOption('maxLines', file.nl);\n                    sh.getAnnotations = function() {\n                        return this.getSession().getAnnotations();\n                    };\n                    sh.setAnnotations = function(a) {\n                        return this.getSession().setAnnotations(a);\n                    };\n                    sh.getTagId = function() {\n                        return this.vplTagId;\n                    };\n                    sh.vplTagId = file.tagId;\n                    shFiles.push(sh);\n                    shFileNames.push(file.fileName);\n                    shs[file.tagId] = sh;\n                }\n                for (var ri = 0; ri < results.length; ri++) {\n                    var tag = document.getElementById(results[ri].tagId);\n                    var text = tag.textContent || tag.innerText;\n                    tag.innerHTML = VPLUtil.processResult(text, shFileNames, shFiles,\n                                                           results[ri].noFormat, results[ri].folding);\n                }\n            };\n\n            VPLUtil.addResults = function(tagId, noFormat, folding) {\n                results.push({'tagId': tagId, 'noFormat': noFormat, 'folding': folding});\n            };\n            VPLUtil.syntaxHighlightFile = function(tagId, fileName, theme, showln, nl) {\n                files.push({\n                    'tagId': tagId,\n                    'fileName': fileName,\n                    'theme': theme,\n                    'showln': showln,\n                    'nl': nl\n                 });\n            };\n            VPLUtil.syntaxHighlight = function() {\n                new SubmissionHighlighter(files, results);\n                files = [];\n                results = [];\n            };\n            VPLUtil.flEventHandler = function(event) {\n                var tag = event.target.getAttribute('href').substring(1);\n                var line = event.target.getAttribute('data-line');\n                var sh = shs[tag];\n                sh.gotoLine(line, 0);\n                sh.scrollToLine(line, true);\n            };\n            VPLUtil.setflEventHandler = function() {\n                var links = document.getElementsByClassName(\"vpl_fl\");\n                for (var i = 0; i < links.length; i++) {\n                    links[i].onclick = VPLUtil.flEventHandler;\n                }\n            };\n            VPLUtil.showHideDiv = function(a) {\n                var text = a;\n                var div = a;\n                if (!div.nextSibling) {\n                    div = div.parentNode;\n                }\n                div = div.nextSibling;\n                while (div.nodeName != 'DIV' && div.nodeName != 'PRE') {\n                    div = div.nextSibling;\n                    if (!div) {\n                        return;\n                    }\n                }\n                if (text) {\n                    if (text.innerHTML == '[+]') {\n                        if (div.savedDisplay) {\n                            div.style.display = div.savedDisplay;\n                        } else {\n                            div.style.display = '';\n                        }\n                        text.innerHTML = '[-]';\n                    } else {\n                        div.savedDisplay = div.style.display;\n                        div.style.display = 'none';\n                        text.innerHTML = '[+]';\n                    }\n                }\n            };\n\n        })();\n        VPLUtil.options = {\n            scriptPath: ''\n        };\n        if (typeof window.VPLDebugMode != 'undefined') {\n            debugMode = window.VPLDebugMode;\n        }\n        VPLUtil.init = function(options) {\n            VPLUtil.options = {\n                scriptPath: ''\n            };\n            $.extend(VPLUtil.options, options);\n            if (typeof window.VPLDebugMode != 'undefined') {\n                debugMode = window.VPLDebugMode;\n            }\n            VPLUtil.log(VPLUtil.options);\n        };\n        // Needs global use of VPLUtil for view source.\n        window.VPLUtil = VPLUtil;\n        return VPLUtil;\n    }\n);\n"],"names":["define","$","jqui","log","VPLUtil","doNothing","noop","returnFalse","returnTrue","fileUniqueId","MIME","maplang","i18n","strreg","menuIcons","lastProccessID","scriptsLoaded","debugMode","m","forced","debug","setUserPreferences","pref","ajax","async","type","url","data","JSON","stringify","contentType","dataType","getUserPreferences","func","getPreferences","done","scrollBarWidth","parent","child","width","appendTo","children","innerWidth","height","remove","sanitizeHTML","t","replace","html","sanitizeText","s","setProtocol","coninfo","secure","securePort","port","wsProtocol","window","location","protocol","URLBase","server","portToUse","monitorURL","monitorPath","executionURL","executionPath","ArrayBuffer2String","i","len","view","Uint8Array","chunks","length","push","String","fromCharCode","apply","subarray","Math","min","join","String2ArrayBuffer","ret","ArrayBuffer","u8","charCodeAt","getUniqueId","regExt","regImg","regBin","regBlk","fileExtension","fileName","res","exec","isImage","test","isBinary","isBlockly","regInvalidFileName","validFileName","getCurrentTime","parseInt","Date","valueOf","encodeBinary","name","btoa","unescape","encodeURIComponent","decodeBinary","decoded","atob","decodeURIComponent","escape","validPath","path","dirs","split","getFileName","dataFromURLData","substr","indexOf","readZipFile","save","progressBar","end","JUnzip","ab","unzipper","isZipFile","readEntries","out","entries","process","isClosed","entry","match","processFile","uncompressed","compressionMethod","JSInflate","inflate","contents","encoding","blob","Blob","fr","FileReader","onload","e","target","result","onerror","readAsText","loadScript","readSelectedFiles","filesToRead","pb","errorsMessages","setLabel","readSecuencial","sec","close","showErrorMessage","f","binary","reader","ext","toLowerCase","ex","error","readAsArrayBuffer","readAsDataURL","gif","jpg","jpeg","png","ico","pdf","getMIME","getTimeLeft","timeLeft","timePending","days","hours","minutes","seconds","abap","abc","ada","ads","adb","as","as3","asm","bash","bat","c","C","cc","cpp","hxx","h","H","cases","cbl","cob","coffee","clj","cs","css","d","dart","erl","hrl","f77","f90","for","go","groovy","gv","hs","htm","hx","java","jl","js","json","jsp","jsx","kt","kts","md","less","lisp","lsp","lua","pas","p","perl","prl","php","pro","pl","py","R","r","rb","ruby","sass","scala","scm","scss","sh","swift","sql","svg","tex","tcl","ts","twig","vbs","v","vh","vhd","vhdl","xml","yaml","langType","str","key","parm","setStr","newi18n","hasOwnProperty","dialogbaseOptions","minWidth","autoOpen","closeText","modal","dialogClass","VPLi18n","delayedActions","afterAllActions","numberDelayed","delay","id","arg1","arg2","clearTimeout","setTimeout","longDelay","setAfterTimeout","afterAll","iconModified","iconDelete","iconClose","iconRequired","iconFolder","filelist","filelistclose","new","rename","delete","multidelete","comments","import","print","edit","undo","redo","select_all","find","find_replace","next","resetfiles","download","fullscreen","regularscreen","shortcuts","sort","run","running","evaluate","console","about","info","alert","trash","retrieve","spinner","keyboard","clipboard","timeleft","copy","paste","more","resize","graphic","send","theme","user","fontsize","genIcon","icon","size","classes","icons","setTitleBar","dialog","buttons","handler","title","genButton","titleButtons","titleText","ih","button","click","on","this","blur","setDialogTitleIcon","message","onUserClose","sppiner","append","label","resizable","minHeight","event","originalEvent","text","titleTag","siblings","showMessage","initialoptions","options","extend","messageDialog","messageButtons","ok","yes","setMessage","men","currentOptions","requestAction","action","URL","noDialog","deferred","Deferred","request","xhr","apb","readyState","abort","beforeSend","jqXHR","always","response","success","resolve","reject","fail","textStatus","errorThrown","undefined","supportWebSocket","isAndroid","navigator","userAgent","isFirefox","isMac","clickServer","left","screen","w","top","features","open","attr","preventDefault","hide","acceptCertificates","servers","getLastAction","n","monitorRunning","setProcessId","getProcessId","webSocketMonitor","externalActions","processid","ws","defail","delegated","messageActions","content","parsed","state","detail","getConsole","isOpen","compilation","setResult","ajaxurl","WebSocket","notOpen","onopen","onclose","disconnect","onmessage","CLOSED","directRun","command","files","homepath","connection","directRunTest","mcount","code","reason","processResult","filenames","noFormat","folding","escReg","regtitgra","regtit","regcas","regError","RegExp","regWarning","regInformation","comment","case_","lines","regFiles","lastAnotation","lastAnotationFile","afterTitle","getHref","getTagId","genFileLinks","line","rawline","used","reg","anot","getAnnotations","search","row","column","href","lt","setAnnotations","getTitle","getComment","addComment","addCase","getCase","regcasv","scripts","scriptURL","shift","script","document","createElement","src","scriptPath","head","appendChild","isScriptLoading","isScriptLoaded","adjustBlockly","work","offx","offy","blocks","getAllBlocks","miy","may","mix","max","xy","getRelativeToSurfaceXY","y","x","getTopBlocks","j","moveBy","results","shs","SubmissionHighlighter","self","highlight","prototype","highlightBlockly","preid","tag","show","Blockly","Xml","textToDom","inject","toolbox","readOnly","media","domToWorkspace","hg","svgResize","resizeSvgContents","dispose","needAce","file","ace","shFiles","shFileNames","tagId","lang","setTheme","getSession","setMode","renderer","setShowGutter","showln","setReadOnly","setHighlightActiveLine","setAutoScrollEditorIntoView","setOption","nl","a","vplTagId","ri","getElementById","textContent","innerText","innerHTML","addResults","syntaxHighlightFile","syntaxHighlight","flEventHandler","getAttribute","substring","gotoLine","scrollToLine","setflEventHandler","links","getElementsByClassName","onclick","showHideDiv","div","nextSibling","parentNode","nodeName","savedDisplay","style","display","VPLDebugMode","init"],"mappings":"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"}