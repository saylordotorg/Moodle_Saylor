{"version":3,"sources":["../src/vplvnc.js"],"names":["define","$","jqui","VPLUtil","VPLClipboard","console","window","INCLUDE_URI","loadVNCScripts","Util","delay","load_scripts","VPLVNCClient","VNCDialogId","str","self","rfb","title","message","lastState","VNCDialog","canvas","onCloseAction","doNothing","clipboard","needResize","titleText","inputarea","document","createElement","style","position","left","top","width","height","opacity","backgroundColor","borderStyle","outlineStyle","autocapitalize","autocomplete","autocorrect","wrap","spellcheck","append","keyboardButton","is","blur","focus","pasteClipboard","isConnected","clipboardPasteFrom","getEntry2","receiveClipboard","text","setEntry1","openClipboard","show","getFocus","get_keyboard","set_focused","lostFocus","copyAction","getEntry1","execCommand","HTMLUpdateClipboard","genIcon","HTMLPaste","on","e","target","displayResize","w","h","setCanvasSize","get_display","viewportChange","controlDialogSize","bw","bh","dialog","parent","prev","outerHeight","closeOnEscape","autoOpen","modal","dialogClass","create","setTitleBar","dragStop","open","beforeClose","close","disconnect","resizeStop","css","updateTitle","setTitle","t","setMessage","updateState","state","oldstate","msg","log","connect","secure","host","port","password","path","onClose","RFB","set_local_cursor","get_cursor_uri","isOpen","hide","round","v","Math","floor","getCanvasSize"],"mappings":"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","sourcesContent":["// This file is part of VPL for Moodle - http://vpl.dis.ulpgc.es/\n//\n// VPL for Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// VPL for Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with VPL for Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * VNC client control\n *\n * @copyright 2014 Juan Carlos Rodríguez-del-Pino\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author Juan Carlos Rodríguez-del-Pino <jcrodriguez@dis.ulpgc.es>\n */\n\n/* globals RFB */\n/* globals Util */\n\ndefine(\n    [\n        'jquery',\n        'jqueryui',\n        'mod_vpl/vplutil',\n        'mod_vpl/vplclipboard',\n        'core/log'\n    ],\n    function($, jqui, VPLUtil, VPLClipboard, console) {\n        window.INCLUDE_URI = \"../editor/noVNC/include/\";\n        /**\n         * Load VNC Script after the Util (\"util.js\" is loaded\n         */\n        function loadVNCScripts() {\n            if (typeof Util == 'undefined') {\n                VPLUtil.delay('loadVNCScripts', loadVNCScripts);\n            } else {\n                Util.load_scripts([\"webutil.js\", \"base64.js\", \"websock.js\", \"des.js\",\n                \"keysymdef.js\", \"keyboard.js\", \"input.js\", \"display.js\",\n                \"jsunzip.js\", \"rfb.js\", \"keysym.js\"]);\n            }\n        }\n        VPLUtil.delay('loadVNCScripts', loadVNCScripts);\n        var VPLVNCClient = function(VNCDialogId, str) {\n            var self = this;\n            var rfb;\n            var title = '';\n            var message = '';\n            var lastState = '';\n            var VNCDialog = $('#' + VNCDialogId);\n            var canvas = $('#' + VNCDialogId + \" canvas\");\n            var onCloseAction = VPLUtil.doNothing;\n            var clipboard;\n            var needResize = true;\n            var titleText;\n            var inputarea = window.document.createElement('input');\n            inputarea.style.position = 'absolute';\n            inputarea.style.left = '0px';\n            inputarea.style.top = '-10000px';\n            inputarea.style.width = '1em';\n            inputarea.style.height = '1ex';\n            inputarea.style.opacity = '0';\n            inputarea.style.backgroundColor = 'transparent';\n            inputarea.style.borderStyle = 'none';\n            inputarea.style.outlineStyle = 'none';\n            inputarea.autocapitalize = 'off';\n            inputarea.autocomplete = 'off';\n            inputarea.autocorrect = 'off';\n            inputarea.wrap = 'off';\n            inputarea.spellcheck = 'false';\n            VNCDialog.append(inputarea);\n            /**\n             * Event handler of keyboard button.\n             */\n            function keyboardButton() {\n                if ($(inputarea).is(':focus')) {\n                    inputarea.blur();\n                } else {\n                    inputarea.focus();\n                }\n            }\n            /**\n             * Event handler of paste button at clipboard.\n             */\n            function pasteClipboard() {\n                if (self.isConnected()) {\n                    rfb.clipboardPasteFrom(clipboard.getEntry2());\n                }\n            }\n            /**\n             * Event handler of paste button at clipboard.\n             *\n             * @param {object} rfb vnc client object\n             * @param {string} text Text received\n             */\n            function receiveClipboard(rfb, text) {\n                clipboard.setEntry1(text);\n            }\n            /**\n             * Event handler of clipboard button.\n             */\n            function openClipboard() {\n                clipboard.show();\n            }\n            /**\n             * Inform rfb of focus received.\n             */\n            function getFocus() {\n                if (self.isConnected()) {\n                    rfb.get_keyboard().set_focused(true);\n                }\n            }\n            /**\n             * Inform rfb of focus lost.\n             */\n            function lostFocus() {\n                if (self.isConnected()) {\n                    rfb.get_keyboard().set_focused(false);\n                }\n            }\n            /**\n             * Tries to do a copy.\n             */\n            function copyAction() {\n                clipboard.setEntry1(clipboard.getEntry1());\n                document.execCommand('copy');\n            }\n            var HTMLUpdateClipboard = VPLUtil.genIcon('copy', 'sw') + ' ' + str('copy');\n            var HTMLPaste = VPLUtil.genIcon('paste', 'sw') + ' ' + str('paste');\n            clipboard = new VPLClipboard('vpl_dialog_vnc_clipboard', HTMLUpdateClipboard, copyAction, HTMLPaste, pasteClipboard,\n                    lostFocus);\n            canvas.on('click', function(e) {\n                if (e.target == canvas[0]) {\n                    getFocus();\n                } else {\n                    lostFocus();\n                }\n            });\n            this.displayResize = function() { // TODO hot screen resize.\n                if (self.isConnected()) {\n                    var w = VNCDialog.width();\n                    var h = VNCDialog.height();\n                    self.setCanvasSize(w, h);\n                    rfb.get_display().viewportChange(0, 0, w, h);\n                }\n            };\n            /**\n             * Event handler that limit the size of the vnc client windows.\n             *\n             */\n            function controlDialogSize() {\n                // Resize if dialog is large than screen.\n                var bw = $('html').width();\n                var bh = $(window).height();\n                if (VNCDialog.width() > bw) {\n                    needResize = true;\n                    VNCDialog.dialog(\"option\", \"width\", bw);\n                }\n                if (VNCDialog.parent().height() > bh) {\n                    needResize = true;\n                    VNCDialog.dialog(\"option\", \"height\", bh - VNCDialog.prev().outerHeight());\n                }\n            }\n            VNCDialog.dialog({\n                closeOnEscape: false,\n                autoOpen: false,\n                modal: true,\n                width: 'auto',\n                height: 'auto',\n                dialogClass: 'vpl_ide vpl_vnc',\n                create: function() {\n                    titleText = VPLUtil.setTitleBar(VNCDialog, 'vnc', 'graphic', ['clipboard', 'keyboard'], [openClipboard,\n                            keyboardButton]);\n                },\n                dragStop: controlDialogSize,\n                focus: getFocus,\n                open: controlDialogSize,\n                beforeClose: function() {\n                    if (needResize) {\n                        var w = VNCDialog.width();\n                        var h = VNCDialog.height();\n                        needResize = false;\n                        self.setCanvasSize(w, h);\n                    }\n                },\n                close: function() {\n                    self.disconnect();\n                },\n                resizeStop: function() {\n                    controlDialogSize();\n                    needResize = true;\n                }\n            });\n            VNCDialog.css(\"padding\", \"1px\");\n            VNCDialog.parent().css('z-index', 2000);\n            this.updateTitle = function() {\n                var text = title;\n                if (message !== '') {\n                    text += ' (' + message + ')';\n                }\n                titleText.text(str('console') + \": \" + text);\n            };\n            this.setTitle = function(t) {\n                title = t;\n                this.updateTitle();\n            };\n            this.setMessage = function(t) {\n                message = t;\n                this.updateTitle();\n            };\n            /**\n             * Event handler to show vnc client state in windows title.\n             *\n             * @param {object} rfb vnc client\n             * @param {string} state Name of the state\n             * @param {string} oldstate Name of the old state. Not used\n             * @param {string} msg State detail message\n             */\n            function updateState(rfb, state, oldstate, msg) {\n                lastState = state;\n                switch (state) {\n                    case \"normal\":\n                        self.setMessage('');\n                        self.setTitle(str('connected'));\n                        break;\n                    case \"disconnect\":\n                    case \"disconnected\":\n                        self.setTitle(str('connection_closed'));\n                        break;\n                    case \"failed\":\n                        self.setTitle(str('connection_fail'));\n                        console.log(\"VNC client: \" + msg);\n                        break;\n                    default:\n                        self.setMessage('');\n                        self.setTitle(str('connecting'));\n                }\n            }\n\n            this.connect = function(secure, host, port, password, path, onClose) {\n                clipboard.setEntry1('');\n                onCloseAction = onClose;\n                self.show();\n                var target = $('#' + VNCDialogId + \" canvas\")[0];\n                if (!rfb) {\n                    rfb = new RFB({\n                        'target': target,\n                        'encrypt': secure,\n                        'repeaterID': '',\n                        'true_color': true,\n                        'local_cursor': true,\n                        'shared': false,\n                        'view_only': false,\n                        'onUpdateState': updateState,\n                        'onPasswordRequired': null,\n                        'onClipboard': receiveClipboard\n                    });\n                    rfb.set_local_cursor(rfb.get_display().get_cursor_uri());\n                }\n                if (!port) {\n                    port = secure ? 443 : 80;\n                }\n                rfb.connect(host, port, password, path);\n            };\n            this.isOpen = function() {\n                return VNCDialog.dialog(\"isOpen\");\n            };\n            this.close = function() {\n                VNCDialog.dialog(\"close\");\n            };\n            this.isConnected = function() {\n                return rfb && lastState != 'disconnected';\n            };\n            this.disconnect = function() {\n                if (rfb) {\n                    rfb.disconnect();\n                }\n                onCloseAction();\n                clipboard.hide();\n            };\n            /**\n             * Round a number to event and not less than 100.\n             *\n             * @param {number} v value to round\n             *\n             * @returns {int}\n             */\n            function round(v) {\n                if (v < 100) {\n                    v = 100;\n                }\n                return Math.floor(v / 2) * 2;\n            }\n            this.getCanvasSize = function() {\n                return canvas.width() + \"x\" + canvas.height();\n            };\n\n            this.setCanvasSize = function(w, h) {\n                canvas.width(round(w));\n                canvas.height(round(h));\n            };\n            this.show = function() {\n                VNCDialog.dialog('open');\n                VNCDialog.width('auto');\n                VNCDialog.height('auto');\n            };\n            self.setCanvasSize($(window).width() - 150, $(window).height() - 150);\n        };\n        return VPLVNCClient;\n    }\n);\n"],"file":"vplvnc.min.js"}