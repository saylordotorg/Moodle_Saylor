{"version":3,"sources":["../src/ttbrowserrec.js"],"names":["define","$","log","debug","recognition","recognizing","final_transcript","start_timestamp","lang","interval","clone","extend","will_work_ok","brave","navigator","edge","userAgent","toLowerCase","indexOf","window","init","waveheight","uniqueid","SpeechRecognition","webkitSpeechRecognition","continuous","interimResults","waveHeight","prepare_html","register_events","canvas","canvasCtx","getContext","set_grammar","grammar","SpeechGrammarList","webkitSpeechGrammarList","speechRecognitionList","addFromString","grammars","start","that","Date","now","onstart","setInterval","drawWave","stop","clearInterval","clearRect","width","setTimeout","onfinalspeechcapture","onend","onerror","event","error","timeStamp","name","onresult","interim_transcript","i","resultIndex","results","length","isFinal","transcript","oninterimspeechcapture","bufferLength","fillStyle","fillRect","lineWidth","strokeStyle","beginPath","x","v","Math","random","y","lineTo","stroke","speechtext"],"mappings":"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","sourcesContent":["/* jshint ignore:start */\ndefine(['jquery', 'core/log'], function ($, log) {\n\n    \"use strict\"; // jshint ;_;\n\n    log.debug('speech_browser: initialising');\n\n    return {\n\n        recognition: null,\n        recognizing: false,\n        final_transcript: '',\n        start_timestamp: 0,\n        lang: 'en-US',\n        interval: 0,\n\n\n        //for making multiple instances\n        clone: function () {\n            return $.extend(true, {}, this);\n        },\n\n        will_work_ok: function(opts){\n            var brave = typeof navigator.brave !== 'undefined';\n            if(brave){return false;}\n\n            var edge = navigator.userAgent.toLowerCase().indexOf(\"edg/\") > -1;\n            if(edge){return false;}\n\n            return ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window);\n        },\n\n        init: function (lang,waveheight,uniqueid) {\n            var SpeechRecognition = SpeechRecognition || webkitSpeechRecognition;\n            this.recognition = new SpeechRecognition();\n            this.recognition.continuous = true;\n            this.recognition.interimResults = false;\n            this.lang = lang;\n            this.waveHeight = waveheight;\n            this.uniqueid = uniqueid;\n            this.prepare_html();\n            this.register_events();\n        },\n\n        prepare_html: function(){\n            this.canvas =$('#' + this.uniqueid + \"_waveform\");\n            this.canvasCtx = this.canvas[0].getContext(\"2d\");\n        },\n\n        set_grammar: function (grammar) {\n            var SpeechGrammarList = SpeechGrammarList || webkitSpeechGrammarList;\n            if (SpeechGrammarList) {\n                var speechRecognitionList = new SpeechGrammarList();\n                speechRecognitionList.addFromString(grammar, 1);\n                this.recognition.grammars = speechRecognitionList;\n            }\n        },\n\n        start: function () {\n            var that =this;\n\n            //If we already started ignore this\n            if (this.recognizing) {\n                return;\n            }\n            this.recognizing = true;\n            this.final_transcript = '';\n            this.recognition.lang = this.lang;//select_dialect.value;\n            this.recognition.start();\n            this.start_timestamp = Date.now();//event.timeStamp;\n            that.onstart();\n\n\n            //kick off animation\n            that.interval = setInterval(function() {\n                that.drawWave();\n            }, 100);\n\n\n        },\n        stop: function () {\n            var that=this;\n            this.recognizing = false;\n            this.recognition.stop();\n            clearInterval(this.interval);\n            this.canvasCtx.clearRect(0, 0, this.canvas.width()*2, this.waveHeight * 2);\n            setTimeout(function() {\n                that.onfinalspeechcapture(that.final_transcript);\n            }, 1000);\n            this.onend();\n        },\n\n        register_events: function () {\n\n            var recognition = this.recognition;\n            var that = this;\n\n            recognition.onerror = function (event) {\n                if (event.error == 'no-speech') {\n                    log.debug('info_no_speech');\n                }\n                if (event.error == 'audio-capture') {\n                    log.debug('info_no_microphone');\n                }\n                if (event.error == 'not-allowed') {\n                    if (event.timeStamp - that.start_timestamp < 100) {\n                        log.debug('info_blocked');\n                    } else {\n                        log.debug('info_denied');\n                    }\n                }\n                that.onerror({error: {name: event.error}});\n            };\n\n            recognition.onend = function () {\n                if(that.recognizing){\n                    that.recognition.start();\n                }\n\n            };\n\n            recognition.onresult = function (event) {\n                var interim_transcript = '';\n                for (var i = event.resultIndex; i < event.results.length; ++i) {\n                    if (event.results[i].isFinal) {\n                        that.final_transcript += event.results[i][0].transcript;\n                    } else {\n                        interim_transcript += event.results[i][0].transcript;\n                        that.oninterimspeechcapture(interim_transcript);\n                    }\n                }\n\n            };\n        },//end of register events\n\n        drawWave: function() {\n\n            var width = this.canvas.width() * 2;\n            var bufferLength=4096;\n\n            this.canvasCtx.fillStyle = 'white';\n            this.canvasCtx.fillRect(0, 0, width, this.waveHeight*2);\n\n            this.canvasCtx.lineWidth = 5;\n            this.canvasCtx.strokeStyle = 'gray';\n            this.canvasCtx.beginPath();\n\n            var slicewaveWidth = width / bufferLength;\n            var x = 0;\n\n            for (var i = 0; i < bufferLength; i++) {\n\n                var v = ((Math.random() * 64) + 96) / 128.0;\n                var y = v * this.waveHeight;\n\n                if (i === 0) {\n                    // this.canvasCtx.moveTo(x, y);\n                } else {\n                    this.canvasCtx.lineTo(x, y);\n                }\n                x += slicewaveWidth;\n            }\n\n            this.canvasCtx.lineTo(width, this.waveHeight);\n            this.canvasCtx.stroke();\n\n        },\n\n        onstart: function () {\n            log.debug('started');\n        },\n        onerror: function () {\n            log.debug('error');\n        },\n        onend: function () {\n            log.debug('end');\n        },\n        onfinalspeechcapture: function (speechtext) {\n            log.debug(speechtext);\n        },\n        oninterimspeechcapture: function (speechtext) {\n            // log.debug(speechtext);\n        }\n\n    };//end of returned object\n});//total end"],"file":"ttbrowserrec.min.js"}