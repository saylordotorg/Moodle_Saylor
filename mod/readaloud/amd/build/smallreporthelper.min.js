define(["jquery","core/log","mod_readaloud/definitions","core/str","core/ajax","core/notification"],function(a,b,c,d,e,f){"use strict";b.debug("Click to hear: initialising");return{controls:{},ready:!1,remotetranscribe:!1,attemptid:0,checking:"... checking ...",secstillcheck:"Checking again in: ",notgradedyet:"Your reading has not been evaluated yet.",evaluated:"Your reading has been evaluated.",init:function init(a){this.attemptid=a.attemptid;this.ready=a.ready;this.remotetranscribe=a.remotetranscribe;this.filename=a.filename;this.register_controls();this.register_events();if(!this.ready&&this.remotetranscribe&&this.attemptid){this.check_for_results(this,15);this.check_for_audio(0)}},init_strings:function init_strings(){var a=this;d.get_string("checking","mod_readaloud").done(function(b){a.checking=b});d.get_string("secs_till_check","mod_readaloud").done(function(b){a.secstillcheck=b});d.get_string("notgradedyet","mod_readaloud").done(function(b){a.notgradedyet=b});d.get_string("evaluatedmessage","mod_readaloud").done(function(b){a.evaluated=b})},register_controls:function register_controls(){this.controls.heading=a("."+c.smallreportheading);this.controls.player=a("."+c.smallreportplayer);this.controls.dummyplayer=a("."+c.smallreportdummyplayer);this.controls.rating=a("."+c.smallreportrating);this.controls.status=a("."+c.smallreportstatus);this.controls.fullreportbutton=a("."+c.fullreportbutton)},register_events:function register_events(){this},check_for_audio:function check_for_audio(c){var d=this;a.ajax({url:d.filename,method:"HEAD",cache:!1,error:function error(){b.debug("403 errors are normal here, till the audio file arrives back from conversion");setTimeout(function(){d.check_for_audio(c+500)},c)},success:function success(a,b,e){switch(e.status){case 200:d.controls.player.attr("src",d.filename);d.controls.player.show();d.controls.dummyplayer.hide();break;default:setTimeout(function(){d.check_for_audio(c+500)},c);}}})},check_for_results:function check_for_results(a,c){c=c-1;if(0<c){setTimeout(a.check_for_results,1e3,a,c);a.controls.status.text(a.secstillcheck+c);return}a.controls.status.text(a.checking);e.call([{methodname:"mod_readaloud_check_for_results",args:{attemptid:a.attemptid},done:function done(d){var e=JSON.parse(d);if(e){switch(e.ready){case!0:b.debug("result fetched");for(var f="",g=0;5>g;g++){f=f+(e.rating>g?"<i class=\"fa fa-lg fa-star\"></i>":"<i class=\"fa fa-lg fa-star-o\"></i>")}a.controls.heading.text(a.evaluated);a.controls.rating.html(f);a.controls.status.hide();a.controls.fullreportbutton.show();break;case!1:default:b.debug("result not fetched");setTimeout(a.check_for_results,1e3,a,15);a.controls.status.text(a.secstillcheck+c);}}},fail:f.exception}])}}});
//# sourceMappingURL=smallreporthelper.min.js.map
