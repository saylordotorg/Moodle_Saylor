define ("mod_readaloud/modelaudiokaraoke",["jquery","core/log","mod_readaloud/definitions"],function(a,b,c){"use strict";b.debug("Model Audio Karaoke: initialising");return{controls:{},breaks:[],endwordnumber:0,currentstartbreak:!1,modeling:!1,cd:{audioplayerclass:c.audioplayerclass,wordplayerclass:c.wordplayerclass,wordclass:c.wordclass,spaceclass:c.spaceclass,endspaceclass:c.endspaceclass,passagecontainer:c.passagecontainer,activesentence:c.activesentence,stopbutton:"mod_readaloud_button_stop",playbutton:"mod_readaloud_button_play"},init:function init(a){if(a.breaks){var b=JSON.parse(a.breaks);this.set_breaks(b)}if(a.modeling){this.modeling=!0}if(a.audioplayerclass){this.cd.audioplayerclass=a.audioplayerclass}this.register_controls();this.endwordnumber=this.controls.eachword.length;this.register_events()},set_breaks:function set_breaks(a){this.breaks=a;this.sort_breaks();this.number_breaks()},sort_breaks:function sort_breaks(){this.breaks.sort(function(c,a){return c.audiotime-a.audiotime})},number_breaks:function number_breaks(){for(var a=this,b=0;b<a.breaks.length;b++){a.breaks[b].breaknumber=b+1}},pause_audio:function pause_audio(){this.controls.audioplayer[0].pause()},play_audio:function play_audio(){this.controls.audioplayer[0].play()},fetch_audio_url:function fetch_audio_url(){return this.controls.audioplayer.attr("src")},register_controls:function register_controls(){this.controls.audioplayer=a("#"+this.cd.audioplayerclass);this.controls.eachword=a("."+this.cd.wordclass);this.controls.eachspace=a("."+this.cd.spaceclass);this.controls.eachwordorspace=a("."+this.cd.spaceclass+",."+this.cd.wordclass);this.controls.passagecontainer=a("."+this.cd.passagecontainer);this.controls.stopbutton=a("#"+this.cd.stopbutton);this.controls.playbutton=a("#"+this.cd.playbutton)},register_events:function register_events(){var b=this,c=this.controls.audioplayer[0];this.controls.playbutton.on("click",function(){c.play()});this.controls.stopbutton.on("click",function(){c.pause();c.currentTime=0});if(!this.modeling){this.controls.eachwordorspace.on("click",function(){for(var d=parseInt(a(this).attr("data-wordnumber")),e=!1,f=0;f<b.breaks.length;f++){if(b.breaks[f].wordnumber<d){e=b.breaks[f]}else{break}}if(!!e){c.pause();c.currentTime=e.audiotime;c.play()}})}var d=function(){b.controls.eachword.removeClass(b.cd.activesentence);b.controls.eachspace.removeClass(b.cd.activesentence);b.currentstartbreak=!1};c.onended=d;c.onpause=d;c.ontimeupdate=function(){for(var d=c.currentTime,e=!1,f=!1,g=0;g<b.breaks.length;g++){if(d>=b.breaks[g].audiotime&&g+1===b.breaks.length){e=b.breaks[g];f={wordnumber:b.endwordnumber+1,audiotime:0}}else if(d>=b.breaks[g].audiotime&&d<b.breaks[g+1].audiotime){e=b.breaks[g];f=b.breaks[g+1];break}else if(0===g&&d<b.breaks[g].audiotime&&0<d){e={wordnumber:0,audiotime:0,breaknumber:0};f=b.breaks[g]}}if(!1===b.currentstartbreak||e.wordnumber!==b.currentstartbreak.wordnumber){var h=a("."+b.cd.activesentence).text();b.previousstartbreak=b.currentstartbreak;b.currentstartbreak=e;b.controls.eachword.removeClass(b.cd.activesentence);b.controls.eachspace.removeClass(b.cd.activesentence);if(!1!==e&&!1!==f){for(var j=e.wordnumber+1;j<=f.wordnumber;j++){a("#"+b.cd.spaceclass+"_"+j).addClass(b.cd.activesentence);a("#"+b.cd.wordclass+"_"+j).addClass(b.cd.activesentence)}}b.on_reach_audio_break(h,b.previousstartbreak,b.currentstartbreak,b.breaks)}}},on_reach_audio_break:function on_reach_audio_break(a,c,d){b.debug(a);b.debug(c);b.debug(d)}}});
//# sourceMappingURL=modelaudiokaraoke.min.js.map
