{"version":3,"file":"pollyhelper.min.js","sources":["../src/pollyhelper.js"],"sourcesContent":["define(['jquery', 'core/log'], function ($, log) {\n    \"use strict\"; // jshint ;_;\n    /*\n    This file helps you get Polly URLs at runtime\n     */\n\n    log.debug('Polly helper: initialising');\n\n    return {\n        token:  '',\n        region: '',\n        owner: '',\n\n        init: function(token, region, owner){\n            this.token =token;\n            this.region=region;\n            this.owner=owner;\n        },\n\n        fetch_polly_url: function(speaktext,texttype, voice) {\n\n                //The REST API we are calling\n                var functionname = 'local_cpapi_fetch_polly_url';\n\n                //fetch the Posturl. We need this.\n                //set up our ajax request\n                var xhr = new XMLHttpRequest();\n                var that = this;\n\n                //set up our handler for the response\n                xhr.onreadystatechange = function (e) {\n                    if (this.readyState === 4) {\n                        if (xhr.status == 200) {\n\n                            //get a yes or forgetit or tryagain\n                            var payload = xhr.responseText;\n                            var payloadobject = JSON.parse(payload);\n                            if (payloadobject) {\n                                //returnCode > 0  indicates an error\n                                if (payloadobject.returnCode > 0) {\n                                    log.debug(payloadobject.returnMessage);\n                                    return false;\n                                    //if all good, then lets do the embed\n                                } else if (payloadobject.returnCode === 0){\n                                    var pollyurl = payloadobject.returnMessage;\n                                    that.onnewpollyurl(pollyurl);\n                                } else {\n                                    log.debug('Polly Signed URL Request failed:');\n                                    log.debug(payloadobject);\n                                }\n                            } else {\n                                log.debug('Polly Signed URL Request something bad happened');\n                            }\n                        } else {\n                            log.debug('Polly Signed URL Request Not 200 response:' + xhr.status);\n                        }\n                    }\n                };\n\n                //log.debug(params);\n                var xhrparams = \"wstoken=\" + this.token\n                + \"&wsfunction=\" + functionname\n                + \"&moodlewsrestformat=\" + 'json'\n                + \"&text=\" + encodeURIComponent(speaktext)\n                + '&texttype=' + texttype\n                + '&voice=' + voice\n                + '&appid=' + 'mod_readaloud'\n                + '&owner=' + this.owner\n                + '&region=' + this.region;\n\n                var serverurl = 'https://cloud.poodll.com' + \"/webservice/rest/server.php\";\n                xhr.open(\"POST\", serverurl, true);\n                xhr.setRequestHeader(\"Cache-Control\", \"no-cache\");\n                xhr.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded\");\n                xhr.send(xhrparams);\n        },\n\n        onnewpollyurl: function (pollyurl) {\n            //do something\n            log.debug(pollyurl);\n        },\n\n    };//end of return value\n});"],"names":["define","$","log","debug","token","region","owner","init","fetch_polly_url","speaktext","texttype","voice","xhr","XMLHttpRequest","that","this","onreadystatechange","e","readyState","status","payload","responseText","payloadobject","JSON","parse","returnCode","returnMessage","pollyurl","onnewpollyurl","xhrparams","encodeURIComponent","open","setRequestHeader","send"],"mappings":"AAAAA,mCAAO,CAAC,SAAU,aAAa,SAAUC,EAAGC,YAMxCA,IAAIC,MAAM,8BAEH,CACHC,MAAQ,GACRC,OAAQ,GACRC,MAAO,GAEPC,KAAM,SAASH,MAAOC,OAAQC,YACrBF,MAAOA,WACPC,OAAOA,YACPC,MAAMA,OAGfE,gBAAiB,SAASC,UAAUC,SAAUC,WAOlCC,IAAM,IAAIC,eACVC,KAAOC,KAGXH,IAAII,mBAAqB,SAAUC,MACP,IAApBF,KAAKG,cACa,KAAdN,IAAIO,OAAe,KAGfC,QAAUR,IAAIS,aACdC,cAAgBC,KAAKC,MAAMJ,YAC3BE,cAAe,IAEXA,cAAcG,WAAa,SAC3BvB,IAAIC,MAAMmB,cAAcI,gBACjB,EAEJ,GAAiC,IAA7BJ,cAAcG,WAAiB,KAClCE,SAAWL,cAAcI,cAC7BZ,KAAKc,cAAcD,eAEnBzB,IAAIC,MAAM,oCACVD,IAAIC,MAAMmB,oBAGdpB,IAAIC,MAAM,wDAGdD,IAAIC,MAAM,6CAA+CS,IAAIO,aAMrEU,UAAY,WAAad,KAAKX,MAAlB,wEAGH0B,mBAAmBrB,WAC9B,aAAeC,SACf,UAAYC,MALE,8BAOFI,KAAKT,MACjB,WAAaS,KAAKV,OAGpBO,IAAImB,KAAK,OADO,uDACY,GAC5BnB,IAAIoB,iBAAiB,gBAAiB,YACtCpB,IAAIoB,iBAAiB,eAAgB,qCACrCpB,IAAIqB,KAAKJ,YAGjBD,cAAe,SAAUD,UAErBzB,IAAIC,MAAMwB"}