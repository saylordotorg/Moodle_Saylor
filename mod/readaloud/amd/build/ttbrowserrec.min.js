define ("mod_readaloud/ttbrowserrec",["jquery","core/log"],function(a,b){"use strict";b.debug("speech_browser: initialising");return{recognition:null,recognizing:!1,final_transcript:"",start_timestamp:0,lang:"en-US",interval:0,clone:function clone(){return a.extend(!0,{},this)},will_work_ok:function will_work_ok(){var a="undefined"!=typeof navigator.brave;if(a){return!1}var b=-1<navigator.userAgent.toLowerCase().indexOf("edg/");if(b){return!1}return"webkitSpeechRecognition"in window||"SpeechRecognition"in window},init:function init(a,b,c){var d=d||webkitSpeechRecognition;this.recognition=new d;this.recognition.continuous=!0;this.recognition.interimResults=!1;this.lang=a;this.waveHeight=b;this.uniqueid=c;this.prepare_html();this.register_events()},prepare_html:function prepare_html(){this.canvas=a("#"+this.uniqueid+"_waveform");this.canvasCtx=this.canvas[0].getContext("2d")},set_grammar:function set_grammar(a){var b=b||webkitSpeechGrammarList;if(b){var c=new b;c.addFromString(a,1);this.recognition.grammars=c}},start:function start(){var a=this;if(this.recognizing){return}this.recognizing=!0;this.final_transcript="";this.recognition.lang=this.lang;this.recognition.start();this.start_timestamp=Date.now();a.onstart();a.interval=setInterval(function(){a.drawWave()},100)},stop:function stop(){var a=this;this.recognizing=!1;this.recognition.stop();clearInterval(this.interval);this.canvasCtx.clearRect(0,0,2*this.canvas.width(),2*this.waveHeight);setTimeout(function(){a.onfinalspeechcapture(a.final_transcript)},1e3);this.onend()},register_events:function register_events(){var a=this.recognition,c=this;a.onerror=function(a){if("no-speech"==a.error){b.debug("info_no_speech")}if("audio-capture"==a.error){b.debug("info_no_microphone")}if("not-allowed"==a.error){if(100>a.timeStamp-c.start_timestamp){b.debug("info_blocked")}else{b.debug("info_denied")}}c.onerror({error:{name:a.error}})};a.onend=function(){if(c.recognizing){c.recognition.start()}};a.onresult=function(a){for(var b="",d=a.resultIndex;d<a.results.length;++d){if(a.results[d].isFinal){c.final_transcript+=a.results[d][0].transcript}else{b+=a.results[d][0].transcript;c.oninterimspeechcapture(b)}}}},drawWave:function drawWave(){var a=2*this.canvas.width(),b=4096;this.canvasCtx.fillStyle="white";this.canvasCtx.fillRect(0,0,a,2*this.waveHeight);this.canvasCtx.lineWidth=5;this.canvasCtx.strokeStyle="gray";this.canvasCtx.beginPath();for(var c=0,d=0;d<b;d++){var e=(64*Math.random()+96)/128,f=e*this.waveHeight;if(!(0==d)){this.canvasCtx.lineTo(c,f)}c+=a/b}this.canvasCtx.lineTo(a,this.waveHeight);this.canvasCtx.stroke()},onstart:function onstart(){b.debug("started")},onerror:function onerror(){b.debug("error")},onend:function onend(){b.debug("end")},onfinalspeechcapture:function onfinalspeechcapture(a){b.debug(a)},oninterimspeechcapture:function oninterimspeechcapture(){}}});
//# sourceMappingURL=ttbrowserrec.min.js.map
