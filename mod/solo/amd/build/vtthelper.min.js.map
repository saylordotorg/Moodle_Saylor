{"version":3,"file":"vtthelper.min.js","sources":["../src/vtthelper.js"],"sourcesContent":["define([\"jquery\"], function($) {\n  return {\n\n      //borrowed and altered from : https://github.com/dsslimshaddy/vtt-to-json/blob/master/index.js\n      convertVttToJson: function(vttString) {\n\n           var current = {};\n           var sections = [];\n          var tidyexp = /<\\/?[^>]+(>|$)/g;\n           var start =  false;\n           var that = this;\n\n           var vttArray = vttString.split('\\n');\n            vttArray.forEach(function(line, index){\n\n                var nicerline = line.replace(tidyexp, \"\");\n\n                if (nicerline === \" \"){\n                    //do what?\n                } else if (nicerline == \"\") {\n                        //do what?\n                } else if (line.indexOf('-->') !== -1 ) {\n                    start = true;\n\n                    if (current.start ) {\n                        sections.push(that.clone(current));\n                    }\n\n                    current = {\n                        start: that.timeString2ms(line.split(\"-->\")[0].trimRight().split(\" \").pop()),\n                        end: that.timeString2ms(line.split(\"-->\")[1].trimLeft().split(\" \").shift()),\n                        part: ''\n                    }\n                } else {\n                    if (start){\n                        if (sections.length !== 0) {\n                            if (sections[sections.length - 1].part.replace(tidyexp, \"\") === line.replace(nicerline, \"\")) {\n                                //do what?\n                            } else {\n                                //if current part is empty, just set it\n                                if (current.part.length === 0) {\n                                    current.part = line;\n                                //if its partyly full, add to it\n                                } else {\n                                    current.part = current.part +  \" \" +  line;\n                                }\n                            }\n                        } else {\n                            current.part = line;\n                            sections.push(that.clone(current));\n\n                            //clear the current section ( so it is not added again)\n                            //this means very first transcription can not have two lines ...nor last one ...ok\n                            current.start = false;\n                            current.end = false;\n                            current.part = '';\n                        }\n                    }\n                }\n        });\n\n         //if we got to the end but we have an unpushed current, we push that to our return array here\n          // If it's the last line of the transcriptions\n          if (current.start) {\n              sections.push(that.clone(current));\n          }\n\n        sections.forEach(function(section){\n            section.part = section.part.replace(tidyexp, \"\")\n        });\n        return(sections);\n    },\n\n      //borrowed and altered from https://github.com/linclark/vtt-json/blob/0.0.x/lib/vtt-serializer.js\n    convertJsonToVtt: function(thejson){\n          var ret = \"WEBVTT\";\n          ret +='\\n\\n';\n          var that = this;\n          $.each(thejson,function(index,item) {\n              var start = that.ms2TimeString(item.start);\n              var end = that.ms2TimeString(item.end);\n              ret += start + ' --> ' + end + '\\n';\n              ret += item.part + '\\n';\n              ret +='\\n';\n          });\n        return ret;\n    },\n\n      //we use this to make sure that the string we will pass for conversion to ms, is well formed\n      validateTimeString: function(rawstring){\n        if(!rawstring){return false;}\n        rawstring=rawstring.trim();\n        var bits = rawstring.split(':');\n        if(bits.length!==3){return false;}\n         var reg = new RegExp('^[0-9]+$');\n        for(var bit=0; bit <=3;bit++){\n            var strbit = bits[bit];\n\n            switch(bit){\n                //hours\n                case 0:\n                    if(!reg.test(strbit)){\n                        return false;\n                    }\n                    var hours = parseInt(strbit);\n                    if(hours <0 || hours > 23){return false;}\n                    break;\n\n                //mins\n                case 1:\n                    if(!reg.test(strbit)){\n                        return false;\n                    }\n                    var mins = parseInt(strbit);\n                    if(mins <0 || mins > 59){return false;}\n                    break;\n                case 2:\n                    var secondbits = strbit.split('.');\n                    if(secondbits.length != 2){\n                        return false;\n                    }\n                    var secs = secondbits[0];\n                    var millisecs = secondbits[1];\n\n                    //test seconds\n                    if(!reg.test(secs)){\n                        return false;\n                    }\n                    var secs = parseInt(secs);\n                    if(secs <0 || secs > 59){return false;}\n\n                    //test millisecs\n                    if(!reg.test(millisecs)){\n                        return false;\n                    }\n                    var millisecs = parseInt(millisecs);\n                    if(millisecs <0 || millisecs > 999){return false;}\n                    break;\n            }\n          }\n         return true;\n      },\n\n    // helpers\n    //largely incomprehensible time functions from here...\n    //   http://codereview.stackexchange.com/questions/45335/milliseconds-to-time-string-time-string-to-milliseconds\n        timeString2ms: function(a,b){// time(HH:MM:SS.mss) // optimized\n            //console.log(a);\n            //console.log(this.validateTimeString(a));\n            return a=a.split('.'), // optimized\n                b=a[1]*1||0, // optimized\n                a=a[0].split(':'),\n            b+(a[2]?a[0]*3600+a[1]*60+a[2]*1:a[1]?a[0]*60+a[1]*1:a[0]*1)*1e3 // optimized\n        },\n\n      ms2TimeString: function(a,k,s,m,h){\n        return k=a%1e3, // optimized by konijn\n                s=a/1e3%60|0,\n                m=a/6e4%60|0,\n                h=a/36e5%24|0,\n            (h?(h<10?'0'+h:h)+':':'00:')+ // optimized\n            (m<10?0:'')+m+':'+  // optimized\n            (s<10?0:'')+s+'.'+ // optimized\n            (k<100?k<10?'00':0:'')+k // optimized\n        },\n\n        clone: function(obj) {\n            if (null == obj || \"object\" != typeof obj) return obj;\n            var copy = obj.constructor();\n            for (var attr in obj) {\n                if (obj.hasOwnProperty(attr)) copy[attr] = obj[attr];\n            }\n            return copy;\n        }\n\n    }\n});\n"],"names":["define","$","convertVttToJson","vttString","current","sections","tidyexp","start","that","this","split","forEach","line","index","nicerline","replace","indexOf","push","clone","timeString2ms","trimRight","pop","end","trimLeft","shift","part","length","section","convertJsonToVtt","thejson","ret","each","item","ms2TimeString","validateTimeString","rawstring","bits","trim","reg","RegExp","bit","strbit","test","hours","parseInt","mins","secondbits","secs","millisecs","a","b","k","s","m","h","obj","copy","constructor","attr","hasOwnProperty"],"mappings":"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"}