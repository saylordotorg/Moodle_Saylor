define(["jquery","core/log","mod_solo/definitions","mod_solo/cloudpoodllloader","mod_solo/recorderhelper"],(function($,log,def,cloudpoodllloader,recorderhelper){return log.debug("Recorder controller: initialising"),{clone:function(){return $.extend(!0,{},this)},init:function(props){var dd=this.clone();if(props.hasOwnProperty("token"))dd.activitydata=props;else{var theid="#amdopts_"+props.widgetid,configcontrol=$(theid).get(0);if(!configcontrol)return void log.debug("solo Recorder Controller: No config found on page. Giving up.");dd.activitydata=JSON.parse(configcontrol.value),dd.activitydata.widgetid=props.widgetid,$(theid).remove()}dd.cmid=props.cmid,dd.recorderid=dd.activitydata.recorderid,dd.updatecontrolid=dd.activitydata.widgetid+"_"+def.C_UPDATECONTROL,dd.streamingresultsid=dd.activitydata.widgetid+def.C_STREAMINGCONTROL,log.debug(dd.activitydata),log.debug("updateid",dd.updatecontrolid),dd.is_browser_ok()&&dd.setup_recorder()},is_browser_ok:function(){return navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia},setup_recorder:function(){var dd=this,uploadwarning=($(".mod_solo_step2").find("form"),$(".mod_solo_uploadwarning")),recordingcontainer=$(".mod_solo_recordingcontainer");recorderhelper.init(dd.activitydata,(function(eventdata){dd.activitydata.transcriber==def.transcriber_amazonstreaming&&(dd.streamingresults=[])}),(function(eventdata){$("button.mod_solo_step2_btn").attr("disabled",!0)}),(function(eventdata){(uploadwarning.show(),$("#"+dd.updatecontrolid).val(eventdata.mediaurl),dd.activitydata.transcriber==def.transcriber_amazonstreaming&&dd.streamingresults&&dd.streamingresults.length>0)&&$("#"+dd.streamingresultsid).val(JSON.stringify(dd.streamingresults));recordingcontainer.hide()}),(function(eventdata){eventdata.capturedspeech;var speechresults=eventdata.speechresults;dd.activitydata.transcriber==def.transcriber_amazonstreaming&&(dd.streamingresults.push(speechresults),log.debug(dd.streamingresults))}),(function(){uploadwarning.hide(),$("button.mod_solo_step2_btn").attr("disabled",!1),$("button.mod_solo_step2_btn").trigger("click")}),(function(eventdata){log.debug(eventdata.id),log.debug(eventdata.uploaddetails),log.debug(eventdata.uploaddetails.postURL),log.debug(dd.activitydata.localposturl);var xhr=new XMLHttpRequest,params="datatype=register";params+="&id="+eventdata.id,params+="&posturl="+encodeURIComponent(eventdata.uploaddetails.postURL),xhr.open("POST",dd.activitydata.localposturl,!0),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.setRequestHeader("Cache-Control","no-cache"),xhr.send(params)}))},process_html:function(){this.activitydata;this.controls={}},register_events:function(){}}}));

//# sourceMappingURL=recordercontroller.min.js.map